{"ast":null,"code":"//console.log(\"Loading PathLib.js\");\nfunction Path() {\n  this.tkeys = 2;\n  this.keys = {\n    path: [],\n    // selected keys\n    other: [],\n    // keys available for selection\n    trash: [] // invisible keys\n\n  };\n  this.other = {\n    table: [],\n    // table keys\n    rest: [],\n    // keys available for table\n    ignore: [] /// keys to ignore\n\n  };\n  this.trash = {\n    found: [],\n    // keys found in documents\n    rest: [],\n    // other relevant keys keys\n    ignore: [] /// keys to ignore\n\n  };\n  this.list = []; // keys in listing...\n\n  this.valid = []; // list of valid keys\n\n  this.ignore = [\"max\", \"min\", \"minlat\", \"minlon\", \"maxlat\", \"maxlon\", \"cnt\"];\n  this.select = {\n    val: {},\n    where: {},\n    cnt: {},\n    range: {}\n  }; // current selection criteria\n\n  this.where = {}; // current cache for where expressions\n\n  this.home = {\n    path: [],\n    val: {},\n    range: {},\n    tkeys: 2\n  }; // initial home for data...\n\n  this.film = {\n    index: null,\n    reel: [],\n    play: false,\n    label: \"\",\n    title: \"\"\n  }; // reel={label:\"\",path:[],val:{},range:{}} \n\n  this.tooltip = {\n    keys: [],\n    // keys that will be displayed (in addition to row/col-keys)\n    select: [],\n    // extra level of keys to distinguish reports\n    sort: [],\n    // which keys should be sorted?\n    click: []\n  }; // which keys should be clickable...\n\n  this.type = {\n    path: {\n      ityp: -1,\n      ptyp: \"path\"\n    },\n    eye: {\n      ityp: 0,\n      ptyp: \"eye\"\n    },\n    table: {\n      ityp: 1,\n      ptyp: \"table\"\n    },\n    rest: {\n      ityp: 2,\n      ptyp: \"rest\"\n    },\n    trash: {\n      ityp: 3,\n      ptyp: \"trash\"\n    },\n    trashRest: {\n      ityp: 4,\n      ptyp: \"trashRest\"\n    },\n    row: {\n      ityp: 5,\n      ptyp: \"row\"\n    },\n    col: {\n      ityp: 6,\n      ptyp: \"col\"\n    },\n    item: {\n      ityp: 7,\n      ptyp: \"item\"\n    }\n  };\n  this.order = {}; // how to order data\t    \n\n  this.init = function (state) {\n    state.Utils.init(\"Path\", this);\n  };\n\n  this.cleanKeys = function (pkeys, val) {\n    var keys = Object.keys(val);\n    var lenk = keys.length;\n\n    for (var ii = 0; ii < lenk; ii++) {\n      var key = keys[ii];\n\n      if (pkeys.indexOf(key) === -1) {\n        val[key] = undefined;\n      }\n    }\n  };\n\n  this.cleanSelect = function (state) {\n    var pkeys = state.Path.keys.path;\n    this.cleanKeys(pkeys, state.Path.select.val);\n    this.cleanKeys(pkeys, state.Path.select.range);\n  };\n\n  this.goHome = function (state) {\n    var buff = state.Utils.cp(state.Path.keys.path);\n    state.Utils.remArray(buff, state.Path.home.path);\n    state.Utils.remArray(state.Path.keys.other, buff);\n    state.Utils.remArray(state.Path.keys.other, state.Path.home.path);\n    state.Utils.prepArray(state.Path.keys.other, buff);\n    state.Path.select.val = state.Utils.cp(state.Path.home.val);\n    state.Path.select.range = state.Utils.cp(state.Path.home.range);\n    state.Path.keys.path = state.Utils.cp(state.Path.home.path);\n    state.Path.tkeys = state.Path.home.tkeys; //console.log(\">>>>>> Path.goHome: \",JSON.stringify(state.Path.home),JSON.stringify(state.Path.keys.path));\n\n    state.Utils.pushUrl(state);\n    state.Navigate.store(state);\n    state.Navigate.refreshHistory(state);\n    state.Show.show(state);\n  };\n\n  this.setHome = function (state) {\n    state.Path.cleanSelect(state);\n    this.home.path = state.Utils.cp(state.Path.keys.path);\n    this.home.val = state.Utils.cp(state.Path.select.val);\n    this.home.range = state.Utils.cp(state.Path.select.range);\n    this.home.tkeys = state.Path.tkeys;\n    state.Utils.pushUrl(state); //console.log(\"Setting home.\");\n  };\n\n  this.getSnapshort = function (state) {\n    // store state\n    var snap = {\n      keys: state.Utils.cp(state.Path.keys),\n      select: state.Utils.cp(state.Path.select),\n      tkeys: state.Path.tkeys\n    };\n\n    if (snap.keys.path.other !== undefined) {\n      console.log(\"Snapshort:\", JSON.stringify(snap.keys.path));\n      snap.keys.path.other = state.Utils.clean(snap.keys.path.other, 2);\n    }\n\n    ;\n    return snap;\n  };\n\n  this.getSnapshot = function (state) {\n    // store state\n    return {\n      keys: state.Utils.cp(state.Path.keys),\n      other: state.Utils.cp(state.Path.other),\n      select: state.Utils.cp(state.Path.select),\n      order: state.Utils.cp(state.Path.order),\n      tkeys: state.Path.tkeys\n    };\n  };\n\n  this.setSnapshot = function (state, snapshot) {\n    // store state\n    state.Utils.restore(state.Path, snapshot);\n\n    if (state.Path.keys.trash === undefined) {\n      state.Path.keys.trash = [];\n    }\n\n    ;\n  };\n\n  this.addFilm = function (state, snapshot) {\n    var film = state.Path.film;\n    var reel = film.reel;\n\n    if (snapshot === undefined) {\n      snapshot = this.getSnapshort(state);\n    }\n\n    ;\n    snapshot.label = film.label;\n    reel.push(snapshot);\n    state.Utils.pushUrl(state);\n    return reel.length - 1;\n  };\n\n  this.setFilm = function (state, label, pos, snapshot) {\n    var film = state.Path.film;\n    var reel = film.reel;\n\n    if (snapshot === undefined) {\n      snapshot = this.getSnapshort(state);\n    }\n\n    ;\n    snapshot.label = label;\n    reel[pos] = snapshot;\n    state.Utils.pushUrl(state);\n    return pos;\n  };\n\n  this.moveFilm = function (state, pos) {\n    var film = state.Path.film;\n    var reel = film.reel;\n    var len = reel.length;\n\n    if (pos !== undefined && pos > 0 && pos < len) {\n      var snapshot = reel[pos];\n      reel[pos] = reel[pos - 1];\n      reel[pos - 1] = snapshot;\n    }\n\n    state.Utils.pushUrl(state);\n  };\n\n  this.removeFilm = function (state, pos) {\n    var label = \"\";\n    var film = state.Path.film;\n    var reel = film.reel;\n\n    if (pos === undefined) {\n      pos = 0;\n    }\n\n    ;\n\n    if (reel.length > 0 && pos < reel.length) {\n      var trash = reel.splice(pos, 1);\n      label = trash[0].label; //console.log(\"Snapshot:\",JSON.stringify(trash),label);\n\n      if (reel.length <= 0) {\n        film.index = null;\n      } else {\n        film.index = Math.min(film.index, reel.length);\n      }\n    } else {\n      film.index = null;\n    }\n\n    if (label === undefined) {\n      label = \"\";\n    }\n\n    ;\n    film.label = label;\n    console.log(\"Removing :\", pos, label, reel.length);\n    state.Show.showFilm(state);\n    state.Utils.pushUrl(state);\n    return label;\n  };\n\n  this.toggleFilm = function (state) {\n    var film = state.Path.film;\n    film.play = !film.play;\n    state.Utils.pushUrl(state);\n    return film.play;\n  };\n\n  this.getFilmPlay = function (state) {\n    var film = state.Path.film;\n    return film.play;\n  };\n\n  this.nextFilm = function (state, pos) {\n    var film = state.Path.film;\n    var reel = film.reel;\n    var len = reel.length;\n\n    if (pos !== undefined && pos < len) {\n      //console.log(\"Next film\",film.play,pos,film.index,len);\n      var snapshot = reel[pos];\n      this.setSnapshot(state, snapshot);\n      this.setLabel(state, snapshot.label);\n      this.setMapTitle(state, snapshot.label);\n      state.Show.show(state);\n      return snapshot.label;\n    } else if (pos === undefined && film.play) {\n      if (film.index === undefined || film.index === null) {\n        film.index = 0;\n      } else {\n        film.index = (film.index + 1) % len;\n      }\n\n      ; //console.log(\"Next index film\",film.index,len);\n\n      return this.nextFilm(state, film.index);\n    }\n  };\n\n  this.setMapTitle = function (state, label) {\n    var film = state.Path.film; //console.log(\"Setting map title:\",label);\n\n    state.Utils.pushUrl(state);\n    film.title = label;\n  };\n\n  this.getMapTitle = function (state) {\n    var film = state.Path.film;\n    return film.title;\n  };\n\n  this.setLabel = function (state, label) {\n    var film = state.Path.film;\n    state.Utils.pushUrl(state);\n    film.label = label;\n  };\n\n  this.getLabel = function (state) {\n    var film = state.Path.film;\n    return film.label;\n  };\n\n  this.setFilmLabel = function (state, pos, label) {\n    var film = state.Path.film;\n    var reel = film.reel;\n    var snapshot = reel[pos];\n    snapshot.label = label;\n    state.Utils.pushUrl(state);\n  };\n\n  this.getFilmLabel = function (state, pos) {\n    var film = state.Path.film;\n    var reel = film.reel;\n    var snapshot = reel[pos];\n    return snapshot.label;\n  };\n\n  this.getFilmCnt = function (state) {\n    var film = state.Path.film;\n    var reel = film.reel;\n    return reel.length;\n  };\n\n  this.getReels = function (state) {\n    var film = state.Path.film;\n    return film.reel;\n  };\n\n  this.toggleSelect = function (state, key, val) {\n    var vals = state.Path.select.val[key]; //console.log(\"toggleSelect:\",key,JSON.stringify(vals),\"'\"+val+\"'\");\n\n    if (vals !== undefined) {\n      var vid = vals.indexOf(val);\n\n      if (vid !== -1) {\n        // remove item\n        vals.splice(vid, 1);\n\n        if (vals.length === 0) {\n          // can never be totally empty...\n          vals.push(state.Database.makeKeytrg(state, key, state.Database.keytrg.Max));\n        }\n\n        state.Path.select.val[key] = vals;\n      } else {\n        state.Path.select.val[key].push(val); // add item\n      }\n\n      state.Database.setWhere(state, key, state.Path.select.val[key]);\n      state.Show.showPath(state); //console.log(\"Finally Vals:\",key,JSON.stringify(state.Path.select.val[key]));\n    }\n  };\n\n  this.getTitle = function (state) {\n    var title = \"\";\n    var keys = state.Path.keys.path;\n    keys.forEach(function (key, index) {\n      if (state.Path.select !== undefined && state.Path.select.val !== undefined && state.Path.select.range !== undefined) {\n        var vals = state.Path.select.val[key];\n        var range = state.Path.select.range[key]; //console.log(\"   select:\",key,JSON.stringify(vals));\n\n        if (range !== undefined) {\n          if (title !== \"\") {\n            title = title + \" | \";\n          }\n\n          ;\n          title = title + key + \"<\" + range[0] + \",\" + range[1] + \">\";\n        } else {\n          if (vals === undefined) {\n            vals = [];\n          }\n\n          ;\n          var lenv = vals.length;\n\n          for (var ii = 0; ii < lenv; ii++) {\n            var val = vals[ii];\n\n            if (title !== \"\") {\n              title = title + \" | \";\n            }\n\n            ;\n            title = title + state.Database.getTitleDynamic(state, key, val);\n          }\n        }\n      } else {\n        console.log(\"********* Corrupt select...\", JSON.stringify(state.Path.select));\n      }\n    }); //console.log(\"Pathlib getTitle keys:\",JSON.stringify(keys),title);\n\n    return title;\n  };\n\n  this.makeCnt = function (state, key) {\n    return state.Path.select.val[key].length;\n  };\n\n  this.getOrderValues = function (state, skey) {\n    if (state.Path.order[skey] === undefined) {\n      //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n      return state.Matrix.values[skey];\n    } else {\n      var vals = state.Matrix.values[skey];\n      var plen = vals;\n\n      for (var ii = 0; ii < plen; ii++) {\n        var val = vals[ii];\n\n        if (state.Path.order[skey].indexOf(val) === -1) {\n          state.Path.order[skey].push(val);\n        }\n      }\n\n      ;\n      return state.Path.order[skey];\n    }\n\n    ;\n  };\n\n  this.makeOrderValues = function (state, skey) {\n    if (state.Path.order === undefined) {\n      state.Path.order = {};\n    }\n\n    ;\n\n    if (state.Path.order[skey] === undefined) {\n      //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n      state.Path.order[skey] = state.Utils.cp(state.Matrix.values[skey]);\n    } else {\n      var vals = state.Matrix.values[skey];\n      var plen = vals;\n\n      for (var ii = 0; ii < plen; ii++) {\n        var val = vals[ii];\n\n        if (state.Path.order[skey].indexOf(val) === -1) {\n          state.Path.order[skey].push(val);\n        }\n      }\n\n      ;\n    }\n\n    ;\n    return state.Path.order[skey];\n  };\n\n  this.bumpOrder = function (state, skey, value) {\n    //console.log(\"Bump order:\",skey,value,JSON.stringify(state.Path.order));\n    if (value === \"\") {\n      state.Path.order[skey] = undefined;\n    } else {\n      this.makeOrderValues(state, skey);\n      var vid = state.Path.order[skey].indexOf(value);\n\n      if (vid !== -1 && vid > 0) {\n        var src = state.Path.order[skey].splice(vid, 1); // remove from array   \n\n        state.Utils.spliceArray(state.Path.order[skey], vid - 1, 0, src);\n      }\n\n      ;\n    }\n\n    state.Show.showConfig(state);\n  };\n\n  this.setWhere = function (state) {\n    state.Path.keys.path.forEach(function (item, index) {\n      state.Database.setWhere(state, item, state.Path.select.val[item]);\n    });\n  };\n\n  this.makePath = function (state) {\n    // note that not all keys are present in the data!\n    //console.log(\"Entering makepath.\",JSON.stringify(this.keys));\n    var ii, key;\n    var bdeb = false;\n    var pathSet = [];\n\n    if (this.keys.path === undefined) {\n      this.keys.path = [];\n    }\n\n    ;\n\n    if (this.keys.other === undefined) {\n      this.keys.other = [];\n    }\n\n    ;\n\n    if (this.keys.trash === undefined) {\n      this.keys.trash = [];\n    }\n\n    ;\n\n    if (this.keys.path.length > 0 || this.keys.other.length > 0 || this.keys.trash.length > 0) {\n      // remove duplicates\n      //console.log(\"Filtering.\");\n      var olen;\n      this.keys.path = this.keys.path.filter(this.Unique);\n      this.keys.other = this.keys.other.filter(this.Unique);\n      this.keys.trash = this.keys.trash.filter(this.Unique);\n\n      if (bdeb) {\n        console.log(\"Remove invalid keys from path.\", JSON.stringify(this.keys));\n      }\n\n      ; // remove invalid keys from path\n\n      var plen = this.keys.path.length;\n\n      for (ii = 0; ii < plen; ii++) {\n        key = this.keys.path[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          if (this.select !== undefined && this.select.range[key] !== undefined) {//console.log(\"**** Keeping:\",key);\n          } else {\n            this.keys.path.splice(ii, 1);\n            ii = ii - 1;\n            plen = plen - 1;\n          }\n\n          ;\n        }\n      }\n\n      if (bdeb) {\n        console.log(\"Remove invalid keys from other.\", JSON.stringify(this.keys));\n      }\n\n      ; // remove invalid keys from other\n\n      olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.other.rest.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      }\n\n      if (bdeb) {\n        console.log(\"Remove invalid keys from trash.\", JSON.stringify(this.keys));\n      }\n\n      ; // remove invalid keys from trash\n\n      olen = this.keys.trash.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.trash[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.keys.trash.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      }\n\n      if (bdeb) {\n        console.log(\"Select:\", JSON.stringify(this.select));\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Trash:\", JSON.stringify(this.keys.trash), JSON.stringify(this.where));\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Updating trash with keys:\", JSON.stringify(this.keys));\n      }\n\n      ; // we already have a path, update trash with new keys\n\n      if (this.select.val === undefined) {\n        this.select.val = {};\n      }\n\n      ;\n\n      if (this.select.where === undefined) {\n        this.select.where = {};\n      }\n\n      ;\n\n      if (this.select.cnt === undefined) {\n        this.select.cnt = {};\n      }\n\n      ;\n\n      if (this.select.range === undefined) {\n        this.select.range = {};\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Updated trash with keys.\", JSON.stringify(this.keys));\n      }\n\n      ;\n    } else {\n      // new path...\n      if (bdeb) {\n        console.log(\"New path\");\n      }\n\n      ; // ...define this.select.val for all keys in input data\n\n      for (key in state.Database.keyCnt) {\n        pathSet[key] = \"data\";\n      }\n\n      ;\n      this.keys.path = [];\n      this.other.table = [];\n      this.other.rest = [];\n      this.select.val = {}; // no values are set so far\n\n      this.select.where = {}; // no values are set so far\n\n      this.select.cnt = {}; // no values are set so far\n\n      this.select.range = {}; // no values are set so far\n\n      this.where = {};\n\n      if (bdeb) {\n        console.log(\"Copy default trash keys.\", JSON.stringify(state.Default.current.trash));\n      }\n\n      ; // copy default trash keys (that are used) to trash...\n\n      if (state.Default.current.trash !== undefined) {\n        var tlen = state.Default.current.trash.length;\n\n        for (ii = 0; ii < tlen; ii++) {\n          key = state.Default.current.trash[ii];\n\n          if (pathSet[key] !== undefined) {\n            //\t\t\tif (state.Utils.missing(this.keys.trash,key)) { \n            //\t\t\t    this.keys.trash.push(key);\n            //\t\t\t};\n            pathSet[key] = undefined; // ignore key from now on...\n          }\n        }\n\n        if (bdeb) {\n          console.log(\"Pathset:\", JSON.stringify(pathSet), JSON.stringify(state.Default.current.trash));\n        }\n\n        ;\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Copy default other keys.\", JSON.stringify(this.keys));\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"makePath A:\", JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other), JSON.stringify(state.Path.keys.trash));\n      }\n\n      ; // console.log(\"Added trash:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));\n      // copy default other keys (that are used) to other...\n\n      if (state.Default.current.other !== undefined) {\n        var klen = state.Default.current.other.length;\n\n        for (ii = 0; ii < klen; ii++) {\n          key = state.Default.current.other[ii];\n\n          if (pathSet[key] !== undefined) {\n            // key not present in input data\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ;\n            pathSet[key] = \"found\";\n          }\n        }\n      }\n\n      if (bdeb) {\n        console.log(\"makePath B:\", JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other), JSON.stringify(state.Path.keys.trash));\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Add missing keys.\", JSON.stringify(this.keys));\n      }\n\n      ; // add missing keys to path\n\n      for (key in state.Database.keyCnt) {\n        if (state.Utils.missing(this.ignore, key)) {\n          if (pathSet[key] === \"data\") {\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ;\n\n            if (bdeb) {\n              console.log(\"Added key:\", key);\n            }\n\n            ;\n            pathSet[key] = \"added\";\n          }\n        }\n\n        ;\n      }\n\n      ; // add undefined values in values\n      // for (key in state.Database.keyCnt) {\n      //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n      // \tstate.Database.values[key].push(undefined);\n      //     }\n      // }\n      // sort sub-path according to count...\n      // this.keys.other=this.keys.other.sort(function(state,a, b) {\n      //     if (state.Database.values[a]  === undefined) {\n      // \treturn -1;\n      //     } else if (state.Database.values[b]  === undefined) {\n      // \treturn 1;\n      //     } else {\n      // \treturn state.Database.values[a].length - state.Database.values[b].length\n      //     }\n      // });\n\n      if (bdeb) {\n        console.log(\"makePath C:\", JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other), JSON.stringify(state.Path.keys.trash));\n      }\n\n      ;\n\n      if (bdeb) {\n        console.log(\"Push other keys to table and rest.\", JSON.stringify(this.keys));\n      }\n\n      ;\n      var glen = this.keys.other.length;\n\n      for (ii = 0; ii < glen; ii++) {\n        key = this.keys.other[ii];\n\n        if (ii < this.tkeys) {\n          this.other.table.push(key);\n        } else {\n          this.other.rest.push(key);\n        }\n      }\n    } // all keys not accounted for are trash..\n\n\n    if (this.keys !== undefined && this.keys.path !== undefined && this.keys.other !== undefined && this.keys.trash !== undefined && this.where !== undefined) {\n      for (key in state.Database.keyCnt) {\n        //console.log(\"Key:\",key);\n        // && state.Utils.missing(this.ignore,key)\n        if (this.keys.path.indexOf(key) === -1 && this.keys.other.indexOf(key) === -1 && this.keys.trash.indexOf(key) === -1) {\n          pathSet[key] = \"trash\";\n          this.select.val[key] = undefined;\n          this.select.where[key] = undefined;\n          this.select.cnt[key] = undefined;\n          this.select.range[key] = undefined;\n          this.where[key] = \"\";\n          this.keys.trash.push(key);\n        }\n\n        ;\n      }\n    }\n\n    if (this.list.length === 0) {\n      state.Utils.cpArray(this.list, state.Path.keys.other);\n    }\n\n    ; //state.Path.setWhere(state);\n\n    if (bdeb) {\n      console.log(\"makePath D:\", JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other), JSON.stringify(state.Path.keys.trash));\n    }\n\n    ;\n\n    if (bdeb) {\n      console.log(\"makePath Where:\", JSON.stringify(state.Path.where));\n    }\n\n    ;\n\n    if (bdeb) {\n      console.log(\"makePath Select:\", JSON.stringify(state.Path.keys.path), JSON.stringify(state.Path.select.val));\n    }\n\n    ;\n    state.Navigate.reset(state); //console.log(\"keys:\",JSON.stringify(state.Database.values));\n    //console.log(\"Before Valid:\",JSON.stringify(state.Path.valid),JSON.stringify(state.Path.keys));\n\n    state.Utils.cpArray(state.Path.valid, state.Path.keys.path);\n    state.Utils.cpArray(state.Path.valid, state.Path.keys.other);\n    state.Utils.cpArray(state.Path.valid, state.Path.keys.trash); //console.log(\"After Valid:\",JSON.stringify(state.Path.valid),JSON.stringify(state.Path.keys));\n    //console.log(\"Completed makepath.\");\n  };\n\n  this.getRange = function (state, key) {\n    return state.Path.select.range[key];\n  };\n\n  this.setRange = function (state, key, range) {\n    state.Path.select.range[key] = range;\n  };\n\n  this.setRangeValue = function (state, range, index, value) {\n    range[index] = value;\n  };\n\n  this.getIndex = function (state, trg) {\n    return this.keys.path.indexOf(trg);\n  };\n\n  this.getActiveKeys = function (state) {\n    var buff = [];\n    state.Utils.cpArray(buff, state.Path.keys.path);\n    state.Utils.cpArray(buff, state.Path.keys.other); //state.Utils.cpArray(buff,state.Path.keys.trash);\n\n    return buff;\n  };\n\n  this.getVisibleKeys = function (state) {\n    var buff = [];\n    state.Utils.cpArray(buff, state.Path.list); //state.Utils.cpArray(buff,state.Path.keys.path);\n    //state.Utils.cpArray(buff,state.Path.keys.other);\n    //state.Utils.cpArray(buff,state.Path.keys.trash);\n\n    return buff;\n  };\n\n  this.toggleVisibleKeys = function (state, key) {\n    var sid = state.Path.list.indexOf(key);\n\n    if (sid === -1) {\n      this.list.push(key);\n    } else {\n      state.Path.list.splice(sid, 1); // remove from path\n    }\n\n    state.Show.show(state, false);\n  };\n\n  this.isVisible = function (state, key) {\n    var sid = state.Path.list.indexOf(key);\n    return sid !== -1;\n  };\n\n  this.exportAllKeys = function (state) {\n    // export keys from \"all\" to \"rest\"\n    this.other.table = [];\n    this.other.rest = [];\n    this.other.ignore = [];\n    var jj = 0;\n    var key, ii;\n    var delay = false;\n\n    if (this.keys.other !== undefined) {\n      var olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii]; //console.log(\"Processing key:\",key,ii);\n\n        if (key === \"\") {\n          if (jj === 0) {\n            delay = true;\n          } else if (jj < this.tkeys) {\n            jj = jj + 1;\n          } //\t\t} else if (state.Matrix.keyCnt[key] === undefined ||\n          //\t\t\t   state.Matrix.keyCnt[key] === 0) {\n          //\t\t    //console.log(\"Ignoring key:\",key,JSON.stringify(state.Matrix.keyCnt[key]));\n\n        } else {\n          //console.log(\"Adding key:\",key,JSON.stringify(state.Matrix.keyCnt[key]));\n          if (key !== \"\" & key !== null) {\n            if (state.Matrix.keyCnt[key] === undefined || state.Matrix.keyCnt[key] === 0) {\n              this.other.ignore.push(key); // ignore key...\n            } else if (jj < this.tkeys) {\n              this.other.table.push(key);\n              jj = jj + 1;\n\n              if (delay && jj < this.tkeys) {\n                jj = jj + 1;\n              }\n\n              ;\n            } else {\n              this.other.rest.push(key);\n            }\n          } else {\n            console.log(\"Strange key:\", key, jj, this.tkeys);\n          }\n        }\n      }\n\n      ;\n    } //console.log(\"Ignoring:\",JSON.stringify(this.other.ignore));\n    // export from trash\n\n\n    if (this.keys.trash !== undefined) {\n      this.trash.found = [];\n      this.trash.ignore = [];\n      this.trash.rest = [];\n      var tlen = this.keys.trash.length;\n\n      for (ii = 0; ii < tlen; ii++) {\n        key = this.keys.trash[ii]; //console.log(\"Export trash:\",key,state.Matrix.keyCnt[key],\n        // state.Utils.missing(this.ignore,key));\n\n        if (key !== null) {\n          if (!state.Utils.missing(this.ignore, key)) {\n            this.trash.ignore.push(key);\n          } else if (state.Matrix.keyCnt[key] === undefined || state.Matrix.keyCnt[key].cnt === 0) {\n            this.trash.rest.push(key);\n          } else {\n            this.trash.found.push(key);\n          }\n        } else {\n          console.log(\"Strange key:\", ii, key);\n        }\n      }\n    }\n\n    ; //console.log(\"Exported:\",JSON.stringify(this.trash));\n    // sanity check...\n    //console.log(\"Keys:\",JSON.stringify(this.keys));\n\n    var vlen = this.valid.length;\n\n    for (ii = 0; ii < vlen; ii++) {\n      key = this.valid[ii];\n\n      if (this.keys.path.indexOf(key) === -1 && this.keys.other.indexOf(key) === -1 && this.keys.trash.indexOf(key) === -1) {\n        //console.log(\"**** Path failed sanity check:\",\n        //JSON.stringify(this.keys),JSON.stringify(this.keys.trash),key);\n        this.keys.trash.push(key);\n      }\n    } //this.sortTableKeys(state);\n    //console.log(\"Exported:\",\n    //\t    JSON.stringify(this.keys),\n    //\t    JSON.stringify(this.other),\n    //\t    JSON.stringify(this.keys.trash));\n\n  };\n\n  this.addTableKeyToPath = function (state, key, val, where, cnt) {\n    // keep abscissa\n    var sid = state.Path.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      // key is a table-key...\n      if (typeof val == \"object\") {\n        state.Path.select.val[key] = val;\n      } else {\n        state.Path.select.val[key] = [val];\n      }\n\n      state.Path.where[key] = where;\n\n      if (state.Utils.missing(state.Path.keys.path, key)) {\n        //console.log(\"Adding to path:\",JSON.stringify(key));\n        state.Utils.pushKey(state.Path.keys.path, key); //state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n      }\n\n      ;\n      return true;\n    } else {\n      console.log(\"Missing '\", key, \"' in other:\", JSON.stringify(state.Path.keys));\n      return false;\n    }\n  }; // move key from table to path\n\n\n  this.tableKeyToPath = function (state, key, val, where, cnt) {\n    // keep abscissa\n    //console.log(\"this.Selecting:\",key,\"=\",val,\", where=\",where);\n    var sid = state.Path.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      // key is a table-key...\n      if (typeof val == \"object\") {\n        state.Path.select.val[key] = val;\n      } else {\n        state.Path.select.val[key] = [val];\n      }\n\n      state.Path.where[key] = where;\n      var src = state.Path.keys.other.splice(sid, 1); // remove from path\n\n      if (state.Utils.missing(state.Path.keys.path, src)) {\n        //console.log(\"Adding to path:\",JSON.stringify(src));\n        state.Utils.pushKey(state.Path.keys.path, src); //state.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n      }\n\n      ;\n\n      if (cnt > 1 && state.Utils.missing(state.Path.keys.trash, src)) {\n        //console.log(\"Adding \",JSON.stringify(src),\" to trash.\");\n        state.Utils.pushKey(state.Path.keys.trash, src); //state.Path.keys.trash=state.Path.keys.trash.concat(src)\n      }\n\n      ; //console.log(\"Selectkey:\",JSON.stringify(setup),JSON.stringify(src));\n\n      return true;\n    } else {\n      console.log(\"Missing '\", key, \"' in other:\", JSON.stringify(state.Path.keys));\n      return false;\n    }\n  }; // get X-priority, {colx,coly1,coly2...)\n\n\n  this.sortTableKeys = function (state) {\n    // make priority index\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr); // sort the array according to priority\n\n    this.other.table = arr.sort(function (a, b) {\n      if (a === \"\") {\n        return 1;\n      } else if (b === \"\") {\n        return -1;\n      } else if (pri[a] < pri[b]) {\n        return 1;\n      } else if (pri[a] > pri[b]) {\n        return -1;\n      } else {\n        return 0;\n      }\n    }); //console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n    //\t\" Pri:\",JSON.stringify(state.Layout.priority),\n    //\t\" P:\",JSON.stringify(pri));\n\n    return;\n  };\n\n  this.keyVal = function (state, key) {\n    if (this.select.val[key] !== undefined && this.select.val[key] !== null && this.select.val[key] !== \"\") {\n      return this.select.val[key];\n    } else {\n      return;\n    }\n  };\n\n  this.keyValOk = function (state, val) {\n    var ok = true;\n    return ok;\n  };\n\n  this.moveKey = function (state, styp, skey, ttyp, tid) {\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, 1); // remove from path\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKeys = function (state, styp, skeys, ttyp, tid) {\n    var len = skeys.length;\n\n    for (var ss = 0; ss < len; ss++) {\n      var skey = skeys[ss];\n      var sid = this.keys[styp].indexOf(skey);\n\n      if (sid !== -1) {\n        var src = this.keys[styp].splice(sid, 1); // remove from path\n\n        if (tid === undefined || tid === -1) {\n          this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n        } else {\n          state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n        }\n      }\n    }\n  };\n\n  this.swapTableKey = function (state, skey, tkey) {\n    var sid = this.other.table.indexOf(skey);\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== sid && this.other.table.length > 1) {\n      var tin2 = this.keys.other.indexOf(this.other.table[1]);\n      var tkey2 = this.keys.other.splice(tin2, 1); // remove from array\n\n      state.Utils.spliceArray(this.keys.other, 0, 0, tkey2); //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.delTableKey = function (state, key) {\n    var secondkey;\n    var secondind;\n    var sid = this.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      var sin = this.other.table.indexOf(key);\n      var save = sin === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      this.pullKey(state, \"other\", key);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return sin;\n    }\n  };\n\n  this.duplicateTableKey = function (state, key) {\n    //console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n    var sid = this.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      // exists\n      state.Utils.spliceArray(this.keys.other, sid, 0, key); //console.log(\"Duplicated key:\",key,JSON.stringify(this.keys.other));\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTableKey = function (state, skey, ttyp, tid) {\n    var sid = this.keys.other.indexOf(skey);\n\n    if (sid !== -1) {\n      //var sin=\n      this.delTableKey(state, skey);\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(skey); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, skey);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKey2Table = function (state, styp, skey, tkey) {\n    //console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n    var tid = this.keys.other.indexOf(tkey);\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (tid !== -1 && sid !== -1 && skey !== tkey) {\n      // exists and is not the same\n      this.keys[styp][sid] = tkey;\n      this.keys.other[tid] = skey;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveOther2Table = function (state, key) {\n    //console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n    var sid = this.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      // exists\n      var src = this.keys.other.splice(sid, 1); // remove from array\n\n      state.Utils.spliceArray(this.keys.other, 0, 0, src); //console.log(\"Moved key:\",key,JSON.stringify(this.keys.other));\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash2Table = function (state, tkey) {\n    var secondkey;\n    var secondind;\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== -1) {\n      var save = tid === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      ;\n      var tin = this.keys.other.indexOf(tkey);\n      this.moveTrash(state, \"other\", tin + 1);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash = function (state, ttyp, tin) {\n    state.Utils.spliceArray(this.keys[ttyp], tin, 0, this.keys.trash);\n    this.keys.trash = [];\n  };\n\n  this.moveAllKey = function (state, styp, skey, ttyp, tid) {\n    var lenp = this.keys[styp].length;\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, lenp - sid);\n      state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveAllFirst = function (state, ttyp, tin) {\n    var tlen = this.keys[ttyp].length;\n    var src = this.keys[ttyp].splice(tin, tlen - tin);\n    state.Utils.spliceArray(this.keys[ttyp], 0, 0, src);\n  };\n\n  this.filterKeys = function (state, arr) {\n    var out = [];\n    var alen = arr.length;\n\n    for (var ii = 0; ii < alen; ii++) {\n      var val = arr[ii];\n\n      if (this.keyValOk(state, val)) {\n        out.push(val);\n      }\n    } //console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\n\n    return out;\n  };\n\n  this.pullArrayKey = function (state, array, key) {\n    var sin = array.indexOf(key);\n\n    if (sin !== -1) {\n      //var src=\n      array.splice(sin, 1); // remove from path\n    }\n\n    ;\n    return sin;\n  }; //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n\n\n  this.getFirstKey = function (state) {\n    return this.other.table[0];\n  };\n\n  this.getSecondKey = function (state) {\n    return this.other.table[1];\n  };\n\n  this.getColKey = function (state) {\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr);\n    var mode = state.Layout.getLayoutMode(state);\n\n    if (mode !== state.Layout.modes.layout.Table && mode !== state.Layout.modes.layout.List) {\n      // Map or Custom\n      return \"_lon\";\n    } else if (pri[this.other.table[0]] < pri[this.other.table[1]]) {\n      return this.other.table[1];\n    } else {\n      return this.other.table[0];\n    }\n  };\n\n  this.getRowKey = function (state) {\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr);\n    var mode = state.Layout.getLayoutMode(state);\n\n    if (mode !== state.Layout.modes.layout.Table && mode !== state.Layout.modes.layout.List) {\n      // Map or Custom\n      return \"_lat\";\n    } else if (pri[this.other.table[0]] < pri[this.other.table[1]]) {\n      return this.other.table[0];\n    } else {\n      return this.other.table[1];\n    }\n  };\n\n  this.pushKey = function (state, typ, key, ind) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n    }\n\n    state.Utils.clean(this.keys[typ]);\n  };\n\n  this.pullKey = function (state, typ, key) {\n    var sin = this.keys[typ].indexOf(key);\n\n    if (sin !== -1) {\n      var src = this.keys[typ].splice(sin, 1); // remove from path\n\n      if (src !== key) {\n        console.log(\"System error:\", src, key);\n      }\n\n      return sin;\n    }\n\n    ;\n  };\n\n  this.pushColKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 0, 0, key);\n    }\n  };\n\n  this.pushRowKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 1, 0, key);\n    }\n  };\n\n  this.checkNewPath = function (state, styp, skey) {\n    // check if values are defined for path\n    var ok, ii;\n    var sid = this.keys.path.indexOf(skey);\n\n    if (styp === this.type.table.ptyp) {\n      ok = true;\n      var lent = this.other.table.length - 1;\n\n      if (sid !== undefined) {\n        lent = sid + 1;\n      }\n\n      ;\n\n      for (ii = 0; ii <= lent; ii++) {\n        var key = this.other.table[ii];\n\n        if (this.keyVal(state, key) === undefined) {\n          ok = false;\n        }\n      }\n    } else if (styp === this.type.rest.ptyp) {\n      ok = this.checkNewPath(state, this.type.table.ptyp);\n\n      if (ok) {\n        var lenr = this.other.rest.length - 1;\n\n        if (sid !== undefined) {\n          lenr = sid + 1;\n        }\n\n        ;\n\n        for (ii = 0; ii <= lenr; ii++) {\n          key = this.other.rest[ii];\n\n          if (this.keyVal(state, key) === undefined) {\n            ok = false;\n          }\n        }\n      }\n    }\n\n    return ok;\n  }; //values[key]=values[key].filter(this.Unique);\n\n\n  this.Unique = function (value, index, self) {\n    return self.indexOf(value) === index;\n  };\n\n  this.getClickableTooltipKeys = function (state, data) {\n    var colkey = data.colkey;\n    var rowkey = data.rowkey;\n    var click = [rowkey, colkey];\n    state.Utils.cpArray(click, state.Path.tooltip.click);\n    return click;\n  };\n\n  this.getTooltipKeys = function (state, data, tooltip) {\n    var colkey = data.colkey;\n    var rowkey = data.rowkey;\n    var colvalues = data.colvalues;\n    var rowval = data.rowval;\n    var keys = [];\n\n    if (colvalues === undefined) {\n      keys.push(colkey);\n    }\n\n    if (rowval === undefined) {\n      keys.push(rowkey);\n    }\n\n    state.Utils.cpArray(keys, state.Path.tooltip.keys);\n    state.Utils.remArray(keys, state.Path.keys.path); //state.Utils.remArray(keys,state.Path.other.table);\n\n    keys = state.Utils.keepHash(keys, tooltip);\n    return keys;\n  };\n}\n\n;\nexport default Path;","map":{"version":3,"sources":["/home/franktt/react/varseltavle_new/src/lib/PathLib.js"],"names":["Path","tkeys","keys","path","other","trash","table","rest","ignore","found","list","valid","select","val","where","cnt","range","home","film","index","reel","play","label","title","tooltip","sort","click","type","ityp","ptyp","eye","trashRest","row","col","item","order","init","state","Utils","cleanKeys","pkeys","Object","lenk","length","ii","key","indexOf","undefined","cleanSelect","goHome","buff","cp","remArray","prepArray","pushUrl","Navigate","store","refreshHistory","Show","show","setHome","getSnapshort","snap","console","log","JSON","stringify","clean","getSnapshot","setSnapshot","snapshot","restore","addFilm","push","setFilm","pos","moveFilm","len","removeFilm","splice","Math","min","showFilm","toggleFilm","getFilmPlay","nextFilm","setLabel","setMapTitle","getMapTitle","getLabel","setFilmLabel","getFilmLabel","getFilmCnt","getReels","toggleSelect","vals","vid","Database","makeKeytrg","keytrg","Max","setWhere","showPath","getTitle","forEach","lenv","getTitleDynamic","makeCnt","getOrderValues","skey","Matrix","values","plen","makeOrderValues","bumpOrder","value","src","spliceArray","showConfig","makePath","bdeb","pathSet","olen","filter","Unique","keyCnt","Default","current","tlen","klen","missing","glen","cpArray","reset","getRange","setRange","setRangeValue","getIndex","trg","getActiveKeys","getVisibleKeys","toggleVisibleKeys","sid","isVisible","exportAllKeys","jj","delay","vlen","addTableKeyToPath","pushKey","tableKeyToPath","sortTableKeys","arr","pri","Layout","getPriorityIndex","a","b","keyVal","keyValOk","ok","moveKey","styp","ttyp","tid","concat","moveKeys","skeys","ss","swapTableKey","tkey","tin2","tkey2","delTableKey","secondkey","secondind","sin","save","pullKey","duplicateTableKey","moveTableKey","moveKey2Table","moveOther2Table","moveTrash2Table","tin","moveTrash","moveAllKey","lenp","moveAllFirst","filterKeys","out","alen","pullArrayKey","array","getFirstKey","getSecondKey","getColKey","mode","getLayoutMode","modes","layout","Table","List","getRowKey","typ","ind","pushColKey","pushRowKey","checkNewPath","lent","lenr","self","getClickableTooltipKeys","data","colkey","rowkey","getTooltipKeys","colvalues","rowval","keepHash"],"mappings":"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","sourcesContent":["//console.log(\"Loading PathLib.js\");\n\nfunction Path() {\n    this.tkeys=2;\n    this.keys={path:[],  // selected keys\n\t       other:[], // keys available for selection\n\t       trash:[]  // invisible keys\n\t      };\n    this.other={table:[], // table keys\n\t\trest:[],  // keys available for table\n\t\tignore:[] /// keys to ignore\n\t       };\n    this.trash={found:[],  // keys found in documents\n\t\trest:[],   // other relevant keys keys\n\t\tignore:[] /// keys to ignore\n\t       };        \n    this.list=[];          // keys in listing...\n    this.valid=[];         // list of valid keys\n    this.ignore=[\"max\",\"min\",\"minlat\",\"minlon\",\"maxlat\",\"maxlon\",\"cnt\"];\n    this.select={val:{},where:{},cnt:{},range:{}};  // current selection criteria\n    this.where={};         // current cache for where expressions\n    this.home={path:[],val:{},range:{},tkeys:2};  // initial home for data...\n    this.film={ index:null, reel:[], play:false, label:\"\", title:\"\" } ;// reel={label:\"\",path:[],val:{},range:{}} \n    this.tooltip={keys:[],   // keys that will be displayed (in addition to row/col-keys)\n\t\t  select:[], // extra level of keys to distinguish reports\n\t\t  sort:[],   // which keys should be sorted?\n\t\t  click:[]}; // which keys should be clickable...\n    this.type = {\n\tpath :      {ityp:-1,ptyp:\"path\"},\n\teye :       {ityp:0, ptyp:\"eye\"},\n\ttable :     {ityp:1, ptyp:\"table\"},\n\trest :      {ityp:2, ptyp:\"rest\"},\n\ttrash :     {ityp:3, ptyp:\"trash\"},\n\ttrashRest : {ityp:4, ptyp:\"trashRest\"},\n\trow :       {ityp:5, ptyp:\"row\"},\n\tcol :       {ityp:6, ptyp:\"col\"},\n\titem :      {ityp:7, ptyp:\"item\"}\n    };\n    this.order={}; // how to order data\t    \n    this.init=function(state){\n\tstate.Utils.init(\"Path\",this);\n    };\n    this.cleanKeys=function(pkeys,val) {\n\tvar keys=Object.keys(val);\n\tvar lenk=keys.length;\n\tfor (var ii=0;ii<lenk;ii++) {\n\t    var key=keys[ii];\n\t    if (pkeys.indexOf(key) === -1) {\n\t\tval[key]=undefined;\n\t    }\n\t}\n    }\n    this.cleanSelect=function(state) {\n\tvar pkeys=state.Path.keys.path;\n\tthis.cleanKeys(pkeys,state.Path.select.val);\n\tthis.cleanKeys(pkeys,state.Path.select.range);\n    };\n    this.goHome=function(state) {\n\tvar buff=state.Utils.cp(state.Path.keys.path);\n\tstate.Utils.remArray(buff,state.Path.home.path);\n\tstate.Utils.remArray(state.Path.keys.other,buff);\n\tstate.Utils.remArray(state.Path.keys.other,state.Path.home.path);\n\tstate.Utils.prepArray(state.Path.keys.other,buff);\n\tstate.Path.select.val=state.Utils.cp(state.Path.home.val);\n\tstate.Path.select.range=state.Utils.cp(state.Path.home.range);\n\tstate.Path.keys.path=state.Utils.cp(state.Path.home.path);\n\tstate.Path.tkeys=state.Path.home.tkeys;\n\t//console.log(\">>>>>> Path.goHome: \",JSON.stringify(state.Path.home),JSON.stringify(state.Path.keys.path));\n\tstate.Utils.pushUrl(state);\n\tstate.Navigate.store(state);\n\tstate.Navigate.refreshHistory(state);\n\tstate.Show.show(state);\n    };\n    this.setHome=function(state) {\n\tstate.Path.cleanSelect(state);\n\tthis.home.path=state.Utils.cp(state.Path.keys.path);\n\tthis.home.val=state.Utils.cp(state.Path.select.val);\n\tthis.home.range=state.Utils.cp(state.Path.select.range);\n\tthis.home.tkeys=state.Path.tkeys;\n\tstate.Utils.pushUrl(state);\n\t//console.log(\"Setting home.\");\n    };\n    this.getSnapshort=function(state) { // store state\n\tvar snap={keys:state.Utils.cp(state.Path.keys),\n\t\t  select:state.Utils.cp(state.Path.select),\n\t\t  tkeys:state.Path.tkeys\n\t\t }\n\tif (snap.keys.path.other !== undefined) {\n\t    console.log(\"Snapshort:\",JSON.stringify(snap.keys.path));\n\t    snap.keys.path.other=state.Utils.clean(snap.keys.path.other,2);\n\t};\n\treturn snap;\n    };\n    this.getSnapshot=function(state) { // store state\n\treturn {keys:state.Utils.cp(state.Path.keys),\n\t\tother:state.Utils.cp(state.Path.other),\n\t\tselect:state.Utils.cp(state.Path.select),\n\t\torder:state.Utils.cp(state.Path.order),\n\t\ttkeys:state.Path.tkeys\n\t       };\n    };\n    this.setSnapshot=function(state,snapshot) { // store state\n\tstate.Utils.restore(state.Path,snapshot);\n\tif (state.Path.keys.trash===undefined) { state.Path.keys.trash=[];};\n    };\n    this.addFilm=function(state,snapshot) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tif (snapshot === undefined) {\n\t    snapshot=this.getSnapshort(state);\n\t};\n\tsnapshot.label=film.label;\n\treel.push(snapshot);\n\tstate.Utils.pushUrl(state);\n\treturn reel.length-1;\n    };\n    this.setFilm=function(state,label,pos,snapshot) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tif (snapshot === undefined) {\n\t    snapshot=this.getSnapshort(state);\n\t};\n\tsnapshot.label=label;\n\treel[pos]=snapshot;\n\tstate.Utils.pushUrl(state);\n\treturn pos;\n    };\n    this.moveFilm=function(state,pos) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tvar len=reel.length;\n\tif (pos !== undefined && pos>0 && pos < len) {\n\t    var snapshot=reel[pos];\n\t    reel[pos]=reel[pos-1];\n\t    reel[pos-1]=snapshot;\n\t}\n\tstate.Utils.pushUrl(state);\n    }\n    this.removeFilm=function(state,pos) {\n\tvar label=\"\";\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tif (pos === undefined) { pos=0;};\n\tif (reel.length > 0 && pos < reel.length) {\n\t    var trash=reel.splice(pos, 1);\n\t    label=trash[0].label;\n\t    //console.log(\"Snapshot:\",JSON.stringify(trash),label);\n\t    if (reel.length <= 0) {\n\t\tfilm.index=null;\n\t    } else {\n\t\tfilm.index=Math.min(film.index,reel.length);\n\t    }\n\t} else {\n\t    film.index=null;\n\t}\n\tif (label===undefined) {label=\"\";};\n\tfilm.label=label;\n\tconsole.log(\"Removing :\",pos,label,reel.length);\n\tstate.Show.showFilm(state);\n\tstate.Utils.pushUrl(state);\n\treturn label;\n    };\n    this.toggleFilm=function(state) {\n\tvar film=state.Path.film;\n\tfilm.play = ! film.play;\n\tstate.Utils.pushUrl(state);\n\treturn film.play;\n    };\n    this.getFilmPlay=function(state) {\n\tvar film=state.Path.film;\n\treturn film.play;\n    };\n    this.nextFilm=function(state,pos) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tvar len=reel.length;\n\tif (pos !== undefined && pos < len) {\n\t    //console.log(\"Next film\",film.play,pos,film.index,len);\n\t    var snapshot=reel[pos];\n\t    this.setSnapshot(state,snapshot);\n\t    this.setLabel(state,snapshot.label);\n\t    this.setMapTitle(state,snapshot.label);\n\t    state.Show.show(state);\n\t    return snapshot.label;\n\t} else if (pos === undefined && film.play) {\n\t    if (film.index === undefined || film.index===null) {\n\t\tfilm.index=0;\n\t    } else { \n\t\tfilm.index= (film.index+1)%len;\n\t    };\n\t    //console.log(\"Next index film\",film.index,len);\n\t    return this.nextFilm(state,film.index);\n\t}\n    };\n    this.setMapTitle=function(state,label) {\n\tvar film=state.Path.film;\n\t//console.log(\"Setting map title:\",label);\n\tstate.Utils.pushUrl(state);\n\tfilm.title=label;\n    };\n    this.getMapTitle=function(state) {\n\tvar film=state.Path.film;\n\treturn film.title;\n    };\n    this.setLabel=function(state,label) {\n\tvar film=state.Path.film;\n\tstate.Utils.pushUrl(state);\n\tfilm.label=label;\n    };\n    this.getLabel=function(state) {\n\tvar film=state.Path.film;\n\treturn film.label;\n    };\n    this.setFilmLabel=function(state,pos,label) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tvar snapshot=reel[pos];\n\tsnapshot.label=label;\n\tstate.Utils.pushUrl(state);\n    };\n    this.getFilmLabel=function(state,pos) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\tvar snapshot=reel[pos];\n\treturn snapshot.label;\n    };\n    this.getFilmCnt=function(state) {\n\tvar film=state.Path.film;\n\tvar reel=film.reel;\n\treturn reel.length;\n    };\n    this.getReels=function(state) {\n\tvar film=state.Path.film;\n\treturn film.reel;\n    };\n    this.toggleSelect=function(state,key,val) {\n\tvar vals=state.Path.select.val[key];\n\t//console.log(\"toggleSelect:\",key,JSON.stringify(vals),\"'\"+val+\"'\");\n\tif (vals !== undefined) {\n\t    var vid=vals.indexOf(val)\n\t    if (vid !== -1) {  // remove item\n\t\tvals.splice(vid,1);\n\t\tif (vals.length===0) { // can never be totally empty...\n\t\t    vals.push(state.Database.makeKeytrg(state,key,state.Database.keytrg.Max));\n\t\t}\n\t\tstate.Path.select.val[key]=vals;\n\t    } else {\n\t\tstate.Path.select.val[key].push(val); // add item\n\t    }\n\t    state.Database.setWhere(state,key,state.Path.select.val[key]);\n\t    state.Show.showPath(state);\n\t    //console.log(\"Finally Vals:\",key,JSON.stringify(state.Path.select.val[key]));\n\t}\n    };\n    this.getTitle=function(state) {\n\tvar title=\"\";\n\tvar keys=state.Path.keys.path;\n\tkeys.forEach(\n\t    function(key,index) {\n\t\tif (state.Path.select !== undefined\n\t\t    && state.Path.select.val !== undefined\n\t\t    && state.Path.select.range !== undefined) {\n\t\t    var vals=state.Path.select.val[key];\n\t\t    var range=state.Path.select.range[key];\n\t\t    //console.log(\"   select:\",key,JSON.stringify(vals));\n\t\t    if (range !== undefined) {\n\t\t\tif (title !== \"\") { title=title + \" | \";};\n\t\t\ttitle=title+key+\"<\"+range[0]+\",\"+range[1]+\">\";\n\t\t    } else { \n\t\t\tif (vals === undefined) {vals=[];};\n\t\t\tvar lenv=vals.length\n\t\t\tfor (var ii=0;ii<lenv;ii++) {\n\t\t\tvar val=vals[ii]\n\t\t\t    if (title !== \"\") { title=title + \" | \";};\n\t\t\t    title=title+state.Database.getTitleDynamic(state,key,val);\n\t\t\t}\n\t\t    }\n\t\t} else {\n\t\t    console.log(\"********* Corrupt select...\",\n\t\t\t\tJSON.stringify(state.Path.select));\n\t\t}\n\t    }\n\t);\n\t//console.log(\"Pathlib getTitle keys:\",JSON.stringify(keys),title);\n\treturn title;\n    };\n    this.makeCnt=function(state,key) {\n\treturn state.Path.select.val[key].length;\n    };\n    this.getOrderValues=function(state,skey){\n        if (state.Path.order[skey] === undefined) {\n            //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n            return state.Matrix.values[skey];\n        } else {\n\t    var vals = state.Matrix.values[skey];\n\t    var plen = vals;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar val=vals[ii];\n\t\tif (state.Path.order[skey].indexOf(val)===-1) {\n\t\t    state.Path.order[skey].push(val);\n\t\t}\n\t    };\n\t    return state.Path.order[skey];\n\t};\n    };\n    this.makeOrderValues=function(state,skey){\n        if (state.Path.order === undefined) {state.Path.order={};};\n        if (state.Path.order[skey] === undefined) {\n            //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n            state.Path.order[skey]=state.Utils.cp(state.Matrix.values[skey]);\n        } else {\n\t    var vals = state.Matrix.values[skey];\n\t    var plen = vals;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar val=vals[ii];\n\t\tif (state.Path.order[skey].indexOf(val)===-1) {\n\t\t    state.Path.order[skey].push(val);\n\t\t}\n\t    };\n\t};\n\treturn state.Path.order[skey];\n    };\n    this.bumpOrder=function(state,skey,value) {\n\t//console.log(\"Bump order:\",skey,value,JSON.stringify(state.Path.order));\n\tif (value===\"\") {\n\t    state.Path.order[skey]=undefined;\n\t} else {\n\t    this.makeOrderValues(state,skey);\n\t    var vid=state.Path.order[skey].indexOf(value);\n\t    if (vid !== -1 && vid > 0) {\n\t\tvar src=state.Path.order[skey].splice(vid, 1); // remove from array   \n\t\tstate.Utils.spliceArray(state.Path.order[skey],vid-1,0,src);\n\t    };\n\t}\n\tstate.Show.showConfig(state);\n    };\n    this.setWhere=function(state) {\n\tstate.Path.keys.path.forEach(\n\t    function(item,index) {\n\t\tstate.Database.setWhere(state,item,state.Path.select.val[item]);\n\t    });\n    };\n    this.makePath=function(state) { // note that not all keys are present in the data!\n\t//console.log(\"Entering makepath.\",JSON.stringify(this.keys));\n\tvar ii,key;\n\tvar bdeb=false;\n\tvar pathSet=[];\n\tif (this.keys.path === undefined) {this.keys.path=[];};\n\tif (this.keys.other === undefined) {this.keys.other=[];};\n\tif (this.keys.trash === undefined) {this.keys.trash=[];};\n\tif (this.keys.path.length > 0 ||\n\t    this.keys.other.length > 0 ||\n\t    this.keys.trash.length > 0) {\n\t    // remove duplicates\n\t    //console.log(\"Filtering.\");\n\t    var olen;\n\t    this.keys.path=this.keys.path.filter(this.Unique);\n\t    this.keys.other=this.keys.other.filter(this.Unique);\n\t    this.keys.trash=this.keys.trash.filter(this.Unique);\n\t    if (bdeb) {console.log(\"Remove invalid keys from path.\",JSON.stringify(this.keys));};\n\t    // remove invalid keys from path\n\t    var plen = this.keys.path.length;\n\t    for (ii = 0; ii < plen; ii++) {\n\t\tkey=this.keys.path[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    if (this.select !== undefined &&\n\t\t\tthis.select.range[key] !== undefined) {\n\t\t\t//console.log(\"**** Keeping:\",key);\n\t\t    } else {\n\t\t\tthis.keys.path.splice(ii, 1);\n\t\t\tii=ii-1;\n\t\t\tplen=plen-1;\n\t\t    };\n\t\t}\n\t    }\n\t    if (bdeb) {console.log(\"Remove invalid keys from other.\",JSON.stringify(this.keys));};\n\t    // remove invalid keys from other\n\t    olen = this.keys.other.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.other.rest.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    if (bdeb) {console.log(\"Remove invalid keys from trash.\",JSON.stringify(this.keys));};\n\t    // remove invalid keys from trash\n\t    olen = this.keys.trash.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.keys.trash[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.keys.trash.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    if (bdeb) {console.log(\"Select:\",JSON.stringify(this.select));};\n\t    if (bdeb) {console.log(\"Trash:\",JSON.stringify(this.keys.trash),JSON.stringify(this.where));};\n\t    if (bdeb) {console.log(\"Updating trash with keys:\",JSON.stringify(this.keys));};\n\t    // we already have a path, update trash with new keys\n\t    if (this.select.val === undefined) { this.select.val={};};\n\t    if (this.select.where === undefined) { this.select.where={};};\n\t    if (this.select.cnt === undefined) { this.select.cnt={};};\n\t    if (this.select.range === undefined) { this.select.range={};};\n\t    if (bdeb) {console.log(\"Updated trash with keys.\",JSON.stringify(this.keys));};\n\t} else {\n\t    // new path...\n\t    if (bdeb) {console.log(\"New path\");};\n\t    // ...define this.select.val for all keys in input data\n\t    for (key in state.Database.keyCnt) {\n\t\tpathSet[key]=\"data\";\n\t    };\n\t    this.keys.path=[];\n\t    this.other.table=[]\n\t    this.other.rest=[]\n\t    this.select.val={}; // no values are set so far\n\t    this.select.where={}; // no values are set so far\n\t    this.select.cnt={}; // no values are set so far\n\t    this.select.range={}; // no values are set so far\n\t    this.where={}\n\t    if (bdeb) {console.log(\"Copy default trash keys.\",JSON.stringify(state.Default.current.trash));};\n\t    // copy default trash keys (that are used) to trash...\n\t    if (state.Default.current.trash !== undefined) {\n\t\tvar tlen = state.Default.current.trash.length;\n\t\tfor (ii = 0; ii < tlen; ii++) {\n\t\t    key=state.Default.current.trash[ii];\n\t\t    if (pathSet[key] !== undefined) {\n//\t\t\tif (state.Utils.missing(this.keys.trash,key)) { \n//\t\t\t    this.keys.trash.push(key);\n//\t\t\t};\n\t\t\tpathSet[key]=undefined; // ignore key from now on...\n\t\t    }\n\t\t}\n\t\tif (bdeb) {console.log(\"Pathset:\",JSON.stringify(pathSet),JSON.stringify(state.Default.current.trash));};\n\t    };\n\t    if (bdeb) {console.log(\"Copy default other keys.\",JSON.stringify(this.keys));};\n\t    if (bdeb) {console.log(\"makePath A:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));};\n\t    // console.log(\"Added trash:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));\n\t    // copy default other keys (that are used) to other...\n\t    if (state.Default.current.other !== undefined) {\n\t\tvar klen = state.Default.current.other.length;\n\t\tfor (ii = 0; ii < klen; ii++) {\n\t\t    key=state.Default.current.other[ii];\n\t\t    if (pathSet[key] !== undefined) { // key not present in input data\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\tpathSet[key]=\"found\";\n\t\t    }\n\t\t}\n\t    }\n\t    if (bdeb) {console.log(\"makePath B:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));};\n\t    if (bdeb) {console.log(\"Add missing keys.\",JSON.stringify(this.keys));};\n\t    // add missing keys to path\n\t    for (key in state.Database.keyCnt) {\n\t\tif (state.Utils.missing(this.ignore,key)) {\n\t\t    if (pathSet[key] === \"data\") {\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\tif (bdeb) {console.log(\"Added key:\",key);};\n\t\t\tpathSet[key] = \"added\";\n\t\t    }\n\t\t};\n\t    };\n\t    // add undefined values in values\n\t    // for (key in state.Database.keyCnt) {\n\t    //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n\t    // \tstate.Database.values[key].push(undefined);\n\t    //     }\n\t    // }\n\t    // sort sub-path according to count...\n\t    // this.keys.other=this.keys.other.sort(function(state,a, b) {\n\t    //     if (state.Database.values[a]  === undefined) {\n\t    // \treturn -1;\n\t    //     } else if (state.Database.values[b]  === undefined) {\n\t    // \treturn 1;\n\t    //     } else {\n\t    // \treturn state.Database.values[a].length - state.Database.values[b].length\n\t    //     }\n\t    // });\n\t    if (bdeb) {console.log(\"makePath C:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));};\n\t    if (bdeb) {console.log(\"Push other keys to table and rest.\",JSON.stringify(this.keys));};\n\t    var glen = this.keys.other.length;\n\t    for (ii = 0; ii < glen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (ii<this.tkeys) {\n\t\t    this.other.table.push(key);\n\t\t} else {\n\t\t    this.other.rest.push(key);\n\t\t}\n\t    }\n\t}\n\t// all keys not accounted for are trash..\n\tif (this.keys !== undefined\n\t    && this.keys.path !== undefined\n\t    && this.keys.other !== undefined\n\t    && this.keys.trash !== undefined\n\t    && this.where !== undefined) {\n\t    for (key in state.Database.keyCnt) {\n\t\t//console.log(\"Key:\",key);\n\t\t// && state.Utils.missing(this.ignore,key)\n\t\tif (this.keys.path.indexOf(key)  === -1 && \n\t\t    this.keys.other.indexOf(key)  === -1 && \n\t\t    this.keys.trash.indexOf(key)  === -1) {\n\t\t    pathSet[key]=\"trash\";\n\t\t    this.select.val[key]=undefined;\n\t\t    this.select.where[key]=undefined;\n\t\t    this.select.cnt[key]=undefined;\n\t\t    this.select.range[key]=undefined;\n\t\t    this.where[key]=\"\";\n\t\t    this.keys.trash.push(key);\n\t\t};\n\t    }\n\t}\n\tif (this.list.length === 0) {\n\t    state.Utils.cpArray(this.list,state.Path.keys.other);\n\t};\n\t//state.Path.setWhere(state);\n\tif (bdeb) {console.log(\"makePath D:\",JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other),JSON.stringify(state.Path.keys.trash));};\n\tif (bdeb) {console.log(\"makePath Where:\",JSON.stringify(state.Path.where));};\n\tif (bdeb) {console.log(\"makePath Select:\",JSON.stringify(state.Path.keys.path),JSON.stringify(state.Path.select.val));};\n\tstate.Navigate.reset(state);\n\t//console.log(\"keys:\",JSON.stringify(state.Database.values));\n\t//console.log(\"Before Valid:\",JSON.stringify(state.Path.valid),JSON.stringify(state.Path.keys));\n\tstate.Utils.cpArray(state.Path.valid,state.Path.keys.path);\n\tstate.Utils.cpArray(state.Path.valid,state.Path.keys.other);\n\tstate.Utils.cpArray(state.Path.valid,state.Path.keys.trash);\n\t//console.log(\"After Valid:\",JSON.stringify(state.Path.valid),JSON.stringify(state.Path.keys));\n\t//console.log(\"Completed makepath.\");\n    };\n    this.getRange=function(state,key) {\n\treturn state.Path.select.range[key];\n    }\n    this.setRange=function(state,key,range) {\n\tstate.Path.select.range[key]=range;\n    }\n    this.setRangeValue=function(state,range,index,value) {\n\trange[index]=value;\n    }\n    this.getIndex=function(state,trg) {\n\treturn this.keys.path.indexOf(trg);\n    };\n    this.getActiveKeys=function(state) {\n\tvar buff=[];\n\tstate.Utils.cpArray(buff,state.Path.keys.path);\n\tstate.Utils.cpArray(buff,state.Path.keys.other);\n\t//state.Utils.cpArray(buff,state.Path.keys.trash);\n\treturn buff;\n    };\n    this.getVisibleKeys=function(state) {\n\tvar buff=[];\n\tstate.Utils.cpArray(buff,state.Path.list);\n\t//state.Utils.cpArray(buff,state.Path.keys.path);\n\t//state.Utils.cpArray(buff,state.Path.keys.other);\n\t//state.Utils.cpArray(buff,state.Path.keys.trash);\n\treturn buff;\n    };\n    this.toggleVisibleKeys=function(state,key) {\n\tvar sid=state.Path.list.indexOf(key);\n\tif (sid===-1) {\n\t    this.list.push(key);\n\t} else {\n\t    state.Path.list.splice(sid, 1); // remove from path\n\t}\n\tstate.Show.show(state,false);\n    }\n    this.isVisible=function(state,key) {\n\tvar sid=state.Path.list.indexOf(key);\n\treturn (sid!==-1)\n    }\n    this.exportAllKeys=function(state) { // export keys from \"all\" to \"rest\"\n\tthis.other.table=[];\n\tthis.other.rest=[];\n\tthis.other.ignore=[];\n\tvar jj=0;\n\tvar key,ii;\n\tvar delay=false;\n\tif (this.keys.other !== undefined) {\n\t    var olen=this.keys.other.length;\n\t    for (ii=0;ii<olen;ii++) {\n\t\tkey=this.keys.other[ii];\n\t\t//console.log(\"Processing key:\",key,ii);\n\t\tif (key === \"\") {\n\t\t    if (jj === 0) {\n\t\t\tdelay=true;\n\t\t    } else if (jj < this.tkeys) {\n\t\t\tjj=jj+1\n\t\t    }\n//\t\t} else if (state.Matrix.keyCnt[key] === undefined ||\n//\t\t\t   state.Matrix.keyCnt[key] === 0) {\n//\t\t    //console.log(\"Ignoring key:\",key,JSON.stringify(state.Matrix.keyCnt[key]));\n\t\t} else {\n\t\t    //console.log(\"Adding key:\",key,JSON.stringify(state.Matrix.keyCnt[key]));\n\t\t    if (key !== \"\" & key !== null) {\n\t\t\tif ((state.Matrix.keyCnt[key] === undefined ||\n\t\t\t     state.Matrix.keyCnt[key] === 0)) {\n\t\t\t    this.other.ignore.push(key); // ignore key...\n\t\t\t} else if (jj < this.tkeys) {\n\t\t\t    this.other.table.push(key);\n\t\t\t    jj=jj+1;\n\t\t\t    if (delay && jj<this.tkeys) {jj=jj+1;};\n\t\t\t} else  {\n\t\t\t    this.other.rest.push(key);\n\t\t\t}\n\t\t    } else {\n\t\t\tconsole.log(\"Strange key:\",key,jj,this.tkeys);\n\t\t    }\n\t\t}\n\t    };\n\t}\n\t//console.log(\"Ignoring:\",JSON.stringify(this.other.ignore));\n\t// export from trash\n\tif (this.keys.trash !== undefined) {\n\t    this.trash.found=[];\n\t    this.trash.ignore=[];\n\t    this.trash.rest=[];\n\t    var tlen=this.keys.trash.length;\n\t    for (ii=0;ii<tlen;ii++) {\n\t\tkey=this.keys.trash[ii];\n\t\t//console.log(\"Export trash:\",key,state.Matrix.keyCnt[key],\n\t\t// state.Utils.missing(this.ignore,key));\n\t\tif (key !== null) {\n\t\t    if (! state.Utils.missing(this.ignore,key)) {\n\t\t\tthis.trash.ignore.push(key);\n\t\t    } else if (state.Matrix.keyCnt[key] === undefined ||\n\t\t\t       state.Matrix.keyCnt[key].cnt === 0) {\n\t\t\tthis.trash.rest.push(key);\n\t\t    } else {\n\t\t\tthis.trash.found.push(key);\n\t\t    }\n\t\t} else {\n\t\t    console.log(\"Strange key:\",ii,key);\n\t\t}\n\t    }\n\t};\n\t//console.log(\"Exported:\",JSON.stringify(this.trash));\n\t// sanity check...\n\t//console.log(\"Keys:\",JSON.stringify(this.keys));\n\tvar vlen=this.valid.length;\n\tfor (ii=0;ii<vlen;ii++) {\n\t    key=this.valid[ii];\n\t    if (this.keys.path.indexOf(key)===-1 &&\n\t\tthis.keys.other.indexOf(key)===-1 &&\n\t\tthis.keys.trash.indexOf(key)===-1) {\n\t\t//console.log(\"**** Path failed sanity check:\",\n\t\t//JSON.stringify(this.keys),JSON.stringify(this.keys.trash),key);\n\t\tthis.keys.trash.push(key);\n\t    }\n\t}\n\t//this.sortTableKeys(state);\n\t//console.log(\"Exported:\",\n\t//\t    JSON.stringify(this.keys),\n\t//\t    JSON.stringify(this.other),\n\t//\t    JSON.stringify(this.keys.trash));\n    };\n    this.addTableKeyToPath=function(state,key,val,where,cnt) { // keep abscissa\n\tvar sid = state.Path.keys.other.indexOf(key);\n\tif (sid !== -1) { // key is a table-key...\n\t    if (typeof (val)==\"object\") {\n\t\tstate.Path.select.val[key]=val;\n\t    } else {\n\t\tstate.Path.select.val[key]=[val];\n\t    }\n\t    state.Path.where[key]=where;\n\t    if ( state.Utils.missing(state.Path.keys.path,key)) {\n\t\t//console.log(\"Adding to path:\",JSON.stringify(key));\n\t\tstate.Utils.pushKey(state.Path.keys.path,key);\n\t\t//state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n\t    };\n\t    return true;\n\t} else {\n\t    console.log(\"Missing '\",key,\"' in other:\",JSON.stringify(state.Path.keys));\n\t    return false;\n\t}\n    };\n    // move key from table to path\n    this.tableKeyToPath=function(state,key,val,where,cnt) { // keep abscissa\n\t//console.log(\"this.Selecting:\",key,\"=\",val,\", where=\",where);\n\tvar sid = state.Path.keys.other.indexOf(key);\n\tif (sid !== -1) { // key is a table-key...\n\t    if (typeof (val)==\"object\") {\n\t\tstate.Path.select.val[key]=val;\n\t    } else {\n\t\tstate.Path.select.val[key]=[val];\n\t    }\n\t    state.Path.where[key]=where;\n\t    var src=state.Path.keys.other.splice(sid, 1); // remove from path\n\t    if ( state.Utils.missing(state.Path.keys.path,src)) {\n\t\t//console.log(\"Adding to path:\",JSON.stringify(src));\n\t\tstate.Utils.pushKey(state.Path.keys.path,src);\n\t\t//state.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t    };\n\t    if (cnt>1 && state.Utils.missing(state.Path.keys.trash,src)) {\n\t\t//console.log(\"Adding \",JSON.stringify(src),\" to trash.\");\n\t\tstate.Utils.pushKey(state.Path.keys.trash,src);\n\t\t//state.Path.keys.trash=state.Path.keys.trash.concat(src)\n\t    };\n\t    //console.log(\"Selectkey:\",JSON.stringify(setup),JSON.stringify(src));\n\t    return true;\n\t} else {\n\t    console.log(\"Missing '\",key,\"' in other:\",JSON.stringify(state.Path.keys));\n\t    return false;\n\t}\n    };\n    // get X-priority, {colx,coly1,coly2...)\n    this.sortTableKeys=function(state){\n\t// make priority index\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\t// sort the array according to priority\n\tthis.other.table=arr.sort(function(a,b){\n\t    if (a  === \"\") { \n\t\treturn 1;\n\t    } else if (b  === \"\") {\n\t\treturn -1;\n\t    } else if (pri[a]<pri[b]) { \n\t\treturn 1;\n\t    } else if (pri[a]>pri[b]) {\n\t\treturn -1;\n\t    } else {\n\t\treturn 0;\n\t    }\n\t});\n\t//console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n\t//\t\" Pri:\",JSON.stringify(state.Layout.priority),\n\t//\t\" P:\",JSON.stringify(pri));\n\treturn\n    };\n    this.keyVal=function(state,key) {\n\tif (this.select.val[key] !== undefined &&\n\t    this.select.val[key] !== null &&\n\t    this.select.val[key] !== \"\") {\n\t    return this.select.val[key];\n\t} else {\n\t    return;\n\t}\n    };\n    this.keyValOk=function(state,val) {\n\tvar ok=true;\n\treturn ok;\n    };\n    this.moveKey=function(state,styp,skey,ttyp,tid) {\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid, 1);    // remove from path\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKeys=function(state,styp,skeys,ttyp,tid) {\n\tvar len=skeys.length\n\tfor (var ss=0;ss<len;ss++) {\n\t    var skey=skeys[ss];\n\t    var sid=this.keys[styp].indexOf(skey);\n\t    if (sid !== -1) {\n\t\tvar src=this.keys[styp].splice(sid, 1);    // remove from path\n\t\tif (tid  === undefined || tid  === -1) {\n\t\t    this.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t\t} else {\n\t\t    state.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t\t}\n\t    }\n\t}\n    };\n    this.swapTableKey=function(state,skey,tkey) {\n\tvar sid=this.other.table.indexOf(skey);\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== sid && this.other.table.length > 1) {\n\t    var tin2=this.keys.other.indexOf(this.other.table[1]);\n\t    var tkey2=this.keys.other.splice(tin2, 1);    // remove from array\n\t    state.Utils.spliceArray(this.keys.other,0, 0, tkey2);\n\t    //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.delTableKey=function(state,key) {\n\tvar secondkey;\n\tvar secondind;\n\tvar sid=this.keys.other.indexOf(key);\n\tif (sid !== -1) {\n\t    var sin=this.other.table.indexOf(key);\n\t    var save=(sin  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    }\n\t    this.pullKey(state,\"other\",key);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return sin;\n\t}\n    };\n    this.duplicateTableKey=function(state,key) {\n\t//console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n\tvar sid=this.keys.other.indexOf(key)\n\tif (sid !== -1) { // exists\n\t    state.Utils.spliceArray(this.keys.other,sid, 0, key);\n\t    //console.log(\"Duplicated key:\",key,JSON.stringify(this.keys.other));\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTableKey=function(state,skey,ttyp,tid) {\n\tvar sid=this.keys.other.indexOf(skey);\n\tif (sid !== -1) {\n\t    //var sin=\n\t    this.delTableKey(state,skey);\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(skey);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, skey);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKey2Table=function(state,styp,skey,tkey) {\n\t//console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n\tvar tid=this.keys.other.indexOf(tkey);\n\tvar sid=this.keys[styp].indexOf(skey)\n\tif (tid !== -1 && sid !== -1 && skey !== tkey) { // exists and is not the same\n\t    this.keys[styp][sid]=tkey\n\t    this.keys.other[tid]=skey\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveOther2Table=function(state,key) {\n\t//console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n\tvar sid=this.keys.other.indexOf(key)\n\tif (sid !== -1) { // exists\n\t    var src=this.keys.other.splice(sid, 1);    // remove from array\n\t    state.Utils.spliceArray(this.keys.other,0, 0, src);\n\t    //console.log(\"Moved key:\",key,JSON.stringify(this.keys.other));\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash2Table=function(state,tkey) {\n\tvar secondkey;\n\tvar secondind;\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== -1) {\n\t    var save=(tid  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    };\n\t    var tin=this.keys.other.indexOf(tkey);\n\t    this.moveTrash(state,\"other\",tin+1);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash=function(state,ttyp,tin) {\n\tstate.Utils.spliceArray(this.keys[ttyp],tin, 0, this.keys.trash);\n\tthis.keys.trash=[];\n    };\n    this.moveAllKey=function(state,styp,skey,ttyp,tid) {\n\tvar lenp=this.keys[styp].length;\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid,lenp-sid);\n\t    state.Utils.spliceArray(this.keys[ttyp],tid,0,src);\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveAllFirst=function(state,ttyp,tin) {\n\tvar tlen=this.keys[ttyp].length;\n\tvar src=this.keys[ttyp].splice(tin,tlen-tin);\n\tstate.Utils.spliceArray(this.keys[ttyp],0, 0,src);\n    };\n    this.filterKeys=function(state,arr) {\n\tvar out=[];\n\tvar alen=arr.length;\n\tfor(var ii=0; ii<alen; ii++) {\n\t    var val=arr[ii];\n\t    if (this.keyValOk(state,val)) {\n\t\tout.push(val);\n\t    }\n\t}\n\t//console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\treturn out;\n    };\n    this.pullArrayKey=function(state,array,key) {\n\tvar sin=array.indexOf(key);\n\tif (sin !== -1) {\n\t    //var src=\n\t    array.splice(sin, 1);    // remove from path\n\t};\n\treturn sin;\n    };\n    //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n    this.getFirstKey=function(state) {\n\treturn this.other.table[0];\n    };\n    this.getSecondKey=function(state) {\n\treturn this.other.table[1];\n    };\n    this.getColKey=function(state) {\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\tvar mode=state.Layout.getLayoutMode(state);\n\tif (mode !== state.Layout.modes.layout.Table &&\n\t    mode !== state.Layout.modes.layout.List) { // Map or Custom\n\t    return \"_lon\";\n\t} else if (pri[this.other.table[0]] < pri[this.other.table[1]]) {\n\t    return this.other.table[1];\n\t} else {\n\t    return this.other.table[0];\n\t}\n    };\n    this.getRowKey=function(state) {\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\tvar mode=state.Layout.getLayoutMode(state);\n\tif (mode !== state.Layout.modes.layout.Table &&\n\t    mode !== state.Layout.modes.layout.List) { // Map or Custom\n\t    return \"_lat\";\n\t} else if (pri[this.other.table[0]] < pri[this.other.table[1]]) {\n\t    return this.other.table[0];\n\t} else {\n\t    return this.other.table[1];\n\t}\n    };\n    this.pushKey=function(state,typ,key,ind) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n\t}\n\tstate.Utils.clean(this.keys[typ]);\n    };\n    this.pullKey=function(state,typ,key) {\n\tvar sin=this.keys[typ].indexOf(key);\n\tif (sin !== -1) {\n\t    var src=this.keys[typ].splice(sin, 1);    // remove from path\n\t    if (src !== key) {console.log(\"System error:\",src,key);}\n\t    return sin;\n\t};\n    };\n    this.pushColKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,0, 0, key);\n\t}\n    };\n    this.pushRowKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,1, 0, key);\n\t}\n    };\n    this.checkNewPath=function(state,styp,skey) { // check if values are defined for path\n\tvar ok,ii;\n\tvar sid=this.keys.path.indexOf(skey);\n\tif (styp  === this.type.table.ptyp) {\n\t    ok=true;\n\t    var lent=this.other.table.length-1;\n\t    if (sid !== undefined) {lent=sid+1;};\n\t    for (ii = 0; ii <= lent; ii++) {\n\t\tvar key=this.other.table[ii];\n\t\tif (this.keyVal(state,key)  === undefined) {\n\t\t    ok=false;\n\t\t}\n\t    }\n\t} else if (styp  === this.type.rest.ptyp) {\n\t    ok=this.checkNewPath(state,this.type.table.ptyp);\n\t    if (ok) {\n\t\tvar lenr=this.other.rest.length-1;\n\t\tif (sid !== undefined) {lenr=sid+1;};\n\t\tfor (ii = 0; ii <= lenr; ii++) {\n\t\t    key=this.other.rest[ii];\n\t\t    if (this.keyVal(state,key)  === undefined) {\n\t\t\tok=false;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\treturn ok;\n    };\n    //values[key]=values[key].filter(this.Unique);\n    this.Unique=function(value, index, self) { \n\treturn self.indexOf(value)  === index;\n    }\n    this.getClickableTooltipKeys=function(state,data) {\n\tvar colkey=data.colkey;\n\tvar rowkey=data.rowkey;\n\tvar click=[rowkey,colkey];\n\tstate.Utils.cpArray(click,state.Path.tooltip.click);\n\treturn click;\n    }\n    this.getTooltipKeys=function(state,data,tooltip) {\n\tvar colkey=data.colkey;\n\tvar rowkey=data.rowkey;\n\tvar colvalues=data.colvalues;\n\tvar rowval=data.rowval;\n\tvar keys=[];\n\tif (colvalues===undefined) {keys.push(colkey);}\n\tif (rowval===undefined) {keys.push(rowkey);}\n\tstate.Utils.cpArray(keys,state.Path.tooltip.keys);\n\tstate.Utils.remArray(keys,state.Path.keys.path);\n\t//state.Utils.remArray(keys,state.Path.other.table);\n\tkeys=state.Utils.keepHash(keys,tooltip);\n\treturn keys;\n    }\n};\nexport default Path;\n"]},"metadata":{},"sourceType":"module"}