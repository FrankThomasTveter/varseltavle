{"ast":null,"code":"//console.log(\"Loading LayoutLib.js\");\nfunction Layout() {\n  this.rotate = undefined; // should labels on x-axis be rotated?\n\n  this.priority = undefined; // which key should be on the abscissa\n\n  this.init = function (state) {\n    state.Utils.init(\"Layout\", this);\n  };\n\n  this.fullscreen = false;\n  this.fonts = [\"12px Fixed\", \"18px Fixed\", \"24px Fixed\", \"36px Fixed\", \"48px Fixed\"]; //\n\n  this.lfonts = [\"24px Fixed\", \"36px Fixed\", \"48px Fixed\", \"72px Fixed\", \"96px Fixed\"]; //\n\n  this.state = {\n    viewMode: 0,\n    // should we show trash contents?\n    cellMode: 0,\n    // sum, series, item\n    layoutMode: 0,\n    // table, list, map\n    cfont: 0,\n    tooltip: 1\n  };\n  this.modes = {\n    view: {\n      nopath: 0,\n      path: 1\n    },\n    cell: {\n      Sum: 0,\n      Series: 1\n    },\n    layout: {\n      Table: 0,\n      List: 1,\n      Chart: 2,\n      Globe: 3\n    }\n  };\n\n  this.toggleTooltip = function (state) {\n    this.state.tooltip = (this.state.tooltip + 1) % 3; //console.log(\"Tooltip:\",this.state.tooltip);\n\n    state.Utils.pushUrl(state);\n    state.Show.show(state, true);\n  };\n\n  this.changeFont = function (state) {\n    this.state.cfont = (this.state.cfont + 1) % this.fonts.length;\n    state.Utils.pushUrl(state);\n    state.Show.show(state, false);\n  };\n\n  this.toggleView = function (state) {\n    //console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\n    if (this.state.viewMode === this.modes.view.nopath) {\n      this.state.viewMode = this.modes.view.path;\n    } else if (this.state.viewMode === this.modes.view.path) {\n      this.state.viewMode = this.modes.view.nopath;\n    }\n\n    ; //console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\n\n    state.Show.showPath(state);\n    state.Show.showConfig(state);\n  };\n\n  this.toggleMode = function (state, layoutMode, cellMode) {\n    //console.log(\"ToggleMode:\",layoutMode,cellMode);\n    //var reload=(layoutMode !== state.Layout.state.layoutMode);\n    var newismap = layoutMode === state.Layout.modes.layout.Chart || layoutMode === state.Layout.modes.layout.Globe;\n    var oldismap = state.Layout.state.layoutMode === state.Layout.modes.layout.Chart || state.Layout.state.layoutMode === state.Layout.modes.layout.Globe;\n    var newiscus = layoutMode !== state.Layout.modes.layout.Table && layoutMode !== state.Layout.modes.layout.List && layoutMode !== state.Layout.modes.layout.Chart && layoutMode !== state.Layout.modes.layout.Globe;\n    var oldiscus = state.Layout.state.layoutMode !== state.Layout.modes.layout.Table && state.Layout.state.layoutMode !== state.Layout.modes.layout.List && state.Layout.state.layoutMode !== state.Layout.modes.layout.Chart && state.Layout.state.layoutMode !== state.Layout.modes.layout.Globe;\n    var changed = state.Layout.state.layoutMode !== layoutMode;\n    var reload = newismap && (!oldismap || changed) || oldismap && (!newismap || changed) || oldiscus && (!newiscus || changed) || newiscus && (!oldiscus || changed); //console.log(\"Reload:\",reload,newismap,oldismap,newiscus,oldiscus,changed);\n\n    state.Layout.state.layoutMode = layoutMode;\n    state.Layout.state.cellMode = cellMode; //state.Show.showConfig(state);\n\n    state.Show.showAll(state, reload);\n  };\n\n  this.getDim = function (state) {\n    //console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\n    var colkey = state.Path.getColKey(state);\n    var rowkey = state.Path.getRowKey(state);\n\n    if (colkey !== undefined && rowkey !== undefined) {\n      return 2;\n    } else if (colkey !== undefined || rowkey !== undefined) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n\n  this.setLayoutMode = function (state, mode) {\n    var om = this.state.layoutMode;\n    var o = this.getLayoutMode(state);\n    this.state.layoutMode = mode;\n    var n = this.getLayoutMode(state); //console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\n\n    if (o !== n) {\n      state.Show.showAll(state);\n    } else if (om !== mode) {\n      state.Show.showMode(state);\n    }\n  };\n\n  this.setCellMode = function (state, mode) {\n    var om = this.state.cellMode;\n    var o = this.getCellMode(state);\n    this.state.cellMode = mode;\n    var n = this.getCellMode(state); //console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\n\n    if (o !== n) {\n      state.Show.showAll(state);\n    } else if (om !== mode) {\n      state.Show.showMode(state);\n    }\n  };\n\n  this.getLayoutMode = function (state) {\n    //console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\n    var mode = this.state.layoutMode;\n\n    if (mode === this.modes.layout.List && state.Matrix.cnt > state.Matrix.popSeries) {\n      mode = this.modes.layout.Table;\n    }\n\n    return mode;\n  };\n\n  this.getCellMode = function (state) {\n    var mode = this.state.cellMode;\n\n    if (mode === this.modes.cell.Single && state.Matrix.cnt > state.Matrix.popSingle) {\n      mode = this.modes.cell.Series;\n    }\n\n    if (mode === this.modes.cell.Series && state.Matrix.cnt > state.Matrix.popSeries) {\n      mode = this.modes.cell.Sum;\n    }\n\n    return mode;\n  };\n\n  this.toggleFullScreen = function (state) {\n    //var pos=0;\n    if (!document.fullscreenElement && // alternative standard method\n    !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {\n      // current working methods\n      if (document.documentElement.requestFullscreen) {\n        document.documentElement.requestFullscreen(); //pos=1;\n      } else if (document.documentElement.msRequestFullscreen) {\n        document.documentElement.msRequestFullscreen(); //pos=2;\n      } else if (document.documentElement.mozRequestFullScreen) {\n        document.documentElement.mozRequestFullScreen(); //pos=3;\n      } else if (document.webkitRequestFullscreen) {\n        document.webkitRequestFullscreen(); //pos=4;\n      } else {//pos=5;\n        }\n\n      this.fullscreen = true;\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen(); //pos=6;\n      } else if (document.msExitFullscreen) {\n        document.msExitFullscreen(); //pos=7;\n      } else if (document.mozCancelFullScreen) {\n        document.mozCancelFullScreen(); //pos=8;\n      } else if (document.webkitExitFullscreen) {\n        document.webkitExitFullscreen(); //pos=9;\n      } else {//pos=10;\n        }\n\n      this.fullscreen = false;\n    }\n\n    state.Show.showConfig(state);\n    console.log(\"Toggle fullscreen:\", this.fullscreen);\n  }; // adjust keys so that rows/cols have more than on entry...\n\n\n  this.getPriorityKeys = function (state) {\n    if (state.Layout.priority === undefined) {\n      state.Layout.priority = state.Database.keyCnt.keys();\n    } else {\n      var keys = Object.keys(state.Database.keyCnt);\n      ;\n      var plen = keys;\n\n      for (var ii = 0; ii < plen; ii++) {\n        var key = keys[ii];\n\n        if (state.Layout.priority.indexOf(key) === -1) {\n          state.Layout.priority.push(key);\n        }\n      }\n\n      ;\n    }\n\n    ;\n    return state.Layout.priority; //state.Utils.invertedArray()\n  };\n\n  this.increaseSelect = function (state, key, type) {\n    var kid, src;\n\n    if (type === \"select\") {\n      kid = state.Path.keys.path.indexOf(key); //console.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\n      if (kid !== -1 && kid > 0) {\n        src = state.Path.keys.path.splice(kid, 1); // remove from array   \n\n        state.Utils.spliceArray(state.Path.keys.path, kid - 1, 0, src);\n      }\n    } else if (type === \"otherTable\" || type === \"otherRest\") {\n      kid = state.Path.keys.other.indexOf(key); //console.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\n      if (kid !== -1 && kid > 0) {\n        src = state.Path.keys.other.splice(kid, 1); // remove from array   \n\n        state.Utils.spliceArray(state.Path.keys.other, kid - 1, 0, src);\n      }\n    }\n\n    ; // export\n\n    state.Path.exportAllKeys(state); //console.log(\"IncreaseSelect:\",key,type,JSON.stringify(state.Path.keys));\n\n    state.Show.showConfig(state);\n    state.Show.showPath(state);\n  };\n\n  this.increasePriority = function (state, key) {\n    var kid = state.Layout.priority.indexOf(key); //console.log(\"Bumping:\",key,kid,JSON.stringify(state.Layout.priority));\n\n    if (kid !== -1 && kid > 0) {\n      var src = state.Layout.priority.splice(kid, 1); // remove from array   \n\n      state.Utils.spliceArray(state.Layout.priority, kid - 1, 0, src);\n    }\n\n    state.Show.showConfig(state);\n  };\n\n  this.getPriorityIndex = function (state, arr) {\n    var len, ii;\n    var pri = {};\n    len = arr.length;\n\n    for (ii = 0; ii < len; ii++) {\n      pri[arr[ii]] = 0;\n    }\n\n    ;\n\n    if (this.priority !== undefined) {\n      len = this.priority.length;\n\n      for (ii = 0; ii < len; ii++) {\n        var key = this.priority[ii];\n        pri[key] = len + 1 - ii;\n      }\n\n      ;\n    }\n\n    ;\n    return pri;\n  };\n\n  this.changePriority = function (state, key, trg) {\n    // key -> trg\n    if (key === undefined || trg === undefined) {\n      return;\n    }\n\n    console.log(\"Priority:\", key, \"->\", trg, JSON.stringify(this.priority)); //if (typeof trg  === \"undefined\") {\n\n    var col = state.Path.other.table[0];\n    var row = state.Path.other.table[1]; //var icol=0;\n    //var irow=0;\n\n    var ikey = 0;\n    var itrg = 0;\n    var len = this.priority.length;\n\n    for (var ii = 0; ii < len; ii++) {\n      if (this.priority[ii] === col) {//icol=len+1-ii;\n      }\n\n      ;\n\n      if (this.priority[ii] === row) {//irow=len+1-ii;\n      }\n\n      ;\n\n      if (this.priority[ii] === key) {\n        ikey = len + 1 - ii;\n      }\n\n      if (this.priority[ii] === trg) {\n        itrg = len + 1 - ii;\n      }\n    }\n\n    if (itrg < ikey) {\n      // demote existing key\n      if (itrg > 0) {\n        // key exists on priority list\n        state.Utils.spliceArray(this.priority, len + 2 - itrg, 0, key); // add after\n\n        console.log(\"Added:\", JSON.stringify(this.priority), ikey, itrg, key); //var src=\n\n        this.priority.splice(len + 1 - ikey, 1); // remove\n      } else {\n        // key exists, target does not\n        //var src=\n        this.priority.splice(len + 1 - ikey, 1); // remove\n\n        this.priority.concat(key);\n      }\n    } else if (itrg > ikey) {\n      // demote, key may not exist on priority list\n      if (ikey > 0) {\n        // key exists on priority list\n        //var src=\n        this.priority.splice(len + 1 - ikey, 1); // remove\n\n        state.Utils.spliceArray(this.priority, len + 1 - itrg, 0, key); // add before\n      } else {\n        // key is not on priority list\n        state.Utils.spliceArray(this.priority, len + 1 - itrg, 0, key); // add before\n      }\n    } else if (itrg === 0) {\n      // key and target not on the priority list\n      this.priority.concat(key);\n    }\n\n    console.log(\"Changed priority:\", JSON.stringify(this.priority), ikey, itrg);\n    return true;\n  }; //this.flipTable=function(state) {\n  //    var bb=this.colrow[0];\n  //    this.colrow[0]=this.colrow[1];\n  //    this.colrow[1]=bb;\n  //    //console.log(\"Setup:\",JSON.stringify(setup));\n  //};\n\n\n  this.getPriority = function (state) {\n    return state.Utils.cp(this.priority);\n  };\n\n  this.setPriority = function (state, priority) {\n    this.priority = priority;\n  };\n\n  this.getDescription = function (state, element, skeys) {\n    if (element.cnt === 1) {\n      var s = \"\";\n      var docs = element.docs;\n      var doc = docs[0];\n      var klen = skeys.length;\n\n      for (var jj = 0; jj < klen; jj++) {\n        var d = skeys[jj] + \"=\" + doc[skeys[jj]];\n        ;\n\n        if (s !== \"\") {\n          s = s + \" \" + d;\n        } else {\n          s = d;\n        }\n      }\n\n      return s;\n    } else {\n      return element.cnt;\n    }\n  };\n\n  this.setPlan = function (plan, set) {\n    var keys = Object.keys(set);\n    var lenk = keys.length;\n\n    for (var ii = 0; ii < lenk; ii++) {\n      var key = keys[ii];\n      var val = set[key];\n      plan[key] = val;\n    }\n\n    ;\n  };\n\n  this.getTextWidth = function (txt, fontname, fontsize) {\n    if (this.getTextWidth.c === undefined) {\n      this.getTextWidth.c = document.createElement('canvas');\n      this.getTextWidth.ctx = this.getTextWidth.c.getContext('2d');\n    }\n\n    if (fontname !== undefined) {\n      this.getTextWidth.ctx.font = fontsize + ' ' + fontname;\n    } else {\n      this.getTextWidth.ctx.font = this.getFont();\n    }\n\n    return this.getTextWidth.ctx.measureText(txt).width;\n  };\n\n  this.getTextHeight = function (fontname, fontsize) {\n    if (this.getTextHeight.c === undefined) {\n      this.getTextHeight.c = document.createElement('canvas');\n      this.getTextHeight.ctx = this.getTextHeight.c.getContext('2d');\n    }\n\n    if (fontname !== undefined) {\n      this.getTextHeight.ctx.font = fontsize + ' ' + fontname;\n    } else {\n      this.getTextHeight.ctx.font = this.getFont();\n    }\n\n    return this.getTextHeight.ctx.measureText('M').width;\n  };\n\n  this.getDescender = function (fontname, fontsize) {\n    return this.getTextHeight(fontname, fontsize) * 0.3;\n  };\n\n  this.maxWidth = function (values, border) {\n    var swidth = 0;\n    var mwidth = 0;\n    var lenv = values.length;\n\n    for (var ii = 0; ii < lenv; ii++) {\n      var cwidth = this.getTextWidth(values[ii]) + 2 * border;\n\n      if (cwidth > mwidth) {\n        mwidth = cwidth;\n      }\n\n      swidth = swidth + cwidth;\n    }\n\n    return {\n      max: mwidth,\n      sum: swidth\n    };\n  };\n\n  this.makeDocTitle = function (state, doc) {\n    var title = \"\";\n    var len = state.Path.tooltip.keys.length;\n\n    for (var ii = 0; ii < len; ii++) {\n      var key = state.Path.tooltip.keys[ii];\n\n      if (doc[key] !== undefined) {\n        if (title !== \"\") {\n          title = title + \", \";\n        }\n\n        ;\n        title = title + key + \"=\" + doc[key];\n      }\n\n      ;\n    }\n\n    return title;\n  };\n\n  this.makeCntTitle = function (state, docs) {\n    var title = \"\";\n\n    if (this.state.title === 1) {\n      var dlen = docs.length;\n\n      for (var ii = 0; ii < dlen; ii++) {\n        var doc = docs[ii];\n\n        if (doc._title !== undefined) {\n          if (title !== \"\") {\n            title = title + \"|\";\n          }\n\n          ;\n          title = title + doc._title;\n        }\n      }\n    }\n\n    return title;\n  };\n\n  this.getFont = function () {\n    return this.fonts[this.state.cfont];\n  };\n\n  this.getLargeFont = function () {\n    return this.lfonts[this.state.cfont];\n  };\n\n  this.makePlan = function (label, iwidth, iheight) {\n    // get height/width ratio\n    var plan = {};\n    var hh = 0;\n    var ww = 0;\n    var dh = this.getTextHeight();\n    var dw = this.getTextWidth(label);\n\n    if (dh / dw > iheight / iwidth) {\n      hh = Math.floor(iheight / 3);\n      ww = Math.floor(hh * dw / dh);\n    } else {\n      ww = Math.floor(iwidth / 3);\n      hh = Math.floor(ww * dh / dw);\n    }\n\n    plan.font = hh + 'px Fixed';\n    plan.xoffset = (iwidth - ww) / 2;\n    plan.yoffset = (iheight - hh) / 2;\n    plan.height = iheight;\n    plan.width = iwidth;\n    plan.rotate = false;\n    plan.step = 1;\n    plan.border = 0; //console.log(\"Plan:\",JSON.stringify(plan));\n\n    return plan;\n  };\n\n  this.makePlans = function (colkey, rowkey, colvalues, rowvalues, iwidth, iheight, border) {\n    var descender = this.getDescender();\n\n    if (border === null) {\n      border = 0;\n    }\n\n    iheight = iheight - 15;\n    border = border + 1; // descender\n    // text boundaries\n\n    var mheight = this.getTextHeight() + 2 * (descender + 1); //props.theme.spacing.unit;\n\n    var plans = {\n      cell: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      },\n      hdr: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      },\n      hd1: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      },\n      hd2: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      },\n      row: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      },\n      col: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: mheight * 2,\n        height: mheight,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.getFont()\n      }\n    };\n\n    if (iwidth <= 0) {\n      return plans;\n    }\n\n    ;\n    var hdrHeight, hdrWidth, cellHeight, cellWidth, hdr1Width, hdr2Width, hx, rot, stp, lenr, lenc, cheight;\n    lenc = colvalues.length;\n    lenr = rowvalues.length; //console.log(\"Height:\",iheight,lenr,border);\n\n    if (colkey.substr(0, 1) === \"_\") {\n      rot = false;\n      stp = 1;\n      hdrHeight = 0;\n      hdrWidth = 0;\n      hdr1Width = 0;\n      hdr2Width = 0;\n      hx = cellWidth / 2; //var height=iheight-((lenr+1)*(border+5))-15;\n\n      var width = iwidth;\n      cheight = iheight - hdrHeight;\n      cellHeight = cheight / lenr - 2 * border - 5; //console.log(\"CellHeight:\",cellHeight,height,lenr,border);\n\n      cellWidth = width / lenc - 2 * border; //console.log(\"Keys:\",colkey, rowkey, lenc, lenr, cellWidth, cellHeight, iwidth,iheight,border);\n      //console.log(\"Keys col:\",colkey, JSON.stringify(colvalues), lenc, iwidth, cellWidth);\n      //console.log(\"Keys row:\",rowkey, JSON.stringify(rowvalues), lenr, iheight, cellHeight);\n    } else if (colkey !== undefined) {\n      var wh = this.maxWidth(rowvalues, border);\n      var ww = this.maxWidth(colvalues, border);\n      var zwidth1 = colkey === \"\" ? 0 : this.getTextWidth(colkey) + 2 * border; //props.theme.spacing.unit;\n\n      var zwidth2 = rowkey === \"\" ? 0 : this.getTextWidth(rowkey) + 2 * border; //props.theme.spacing.unit;\n      // var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n      // table boundaries\n\n      var hwidth = Math.max(wh.max, zwidth1 + zwidth2) + mheight;\n      width = iwidth - hwidth; // calculate cell width...\n\n      var mwidth = ww.max; //var swidth=ww.sum;\n      //console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\n\n      if (mwidth * lenc < width) {\n        // horisontal\n        rot = false;\n        stp = 1;\n        cellWidth = width / lenc;\n        hdrHeight = mheight;\n        hx = (cellWidth - mwidth) / 2; //console.log(\"Plan (normal):\",JSON.stringify(plans));\n      } else if (mheight * lenc < width) {\n        // rotate\n        rot = true;\n        stp = 1;\n        cellWidth = width / lenc;\n        hdrHeight = mwidth;\n        hx = (cellWidth - mheight) / 2; //console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cellWidth*lenc);\n      } else {\n        // rotate and use steps\n        rot = true;\n        stp = Math.ceil(lenc * mheight / width);\n        cellWidth = stp * width / lenc;\n        hdrHeight = mwidth;\n        hx = (cellWidth - mheight) / 2; //console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cellWidth,hdrHeight,hx);\n      } // calculate cell height\n\n\n      cheight = iheight - hdrHeight - 2 * border; //height=iheight-hdrHeight-((lenr+1)*border)-15;\n      //console.log(\"Height:\",iheight,cheight,mheight*lenr);\n\n      if (mheight * lenr < cheight) {\n        // \n        cellHeight = Math.min(mheight * 10, cheight / lenr) - 2 * border - 3;\n      } else {\n        cellHeight = mheight - 2 * border - 3;\n      }\n\n      hdrWidth = hwidth; //console.log(\"Cells:\",hdrHeight,cellHeight,iheight,lenr,mheight);\n\n      var dw = (hdrWidth - zwidth1 - zwidth2) / 2;\n      hdr1Width = zwidth1 + dw;\n      hdr2Width = zwidth2 + dw;\n    }\n\n    this.setPlan(plans.cell, {\n      width: cellWidth,\n      height: cellHeight,\n      step: stp,\n      font: this.getFont()\n    });\n    this.setPlan(plans.hdr, {\n      width: hdrWidth,\n      height: hdrHeight,\n      font: this.getFont()\n    });\n    this.setPlan(plans.hd1, {\n      width: hdr1Width,\n      height: hdrHeight,\n      align: \"right\",\n      font: this.getFont()\n    });\n    this.setPlan(plans.hd2, {\n      width: hdr2Width,\n      height: hdrHeight,\n      font: this.getFont()\n    });\n    this.setPlan(plans.col, {\n      width: cellWidth,\n      height: hdrHeight,\n      xoffset: hx,\n      step: stp,\n      rotate: rot,\n      font: this.getFont()\n    });\n    this.setPlan(plans.row, {\n      width: hdrWidth,\n      height: cellHeight,\n      font: this.getFont()\n    }); //console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n\n    return plans;\n  };\n}\n\n;\nexport default Layout;","map":{"version":3,"sources":["/home/franktt/react/varseltavle_new/src/lib/LayoutLib.js"],"names":["Layout","rotate","undefined","priority","init","state","Utils","fullscreen","fonts","lfonts","viewMode","cellMode","layoutMode","cfont","tooltip","modes","view","nopath","path","cell","Sum","Series","layout","Table","List","Chart","Globe","toggleTooltip","pushUrl","Show","show","changeFont","length","toggleView","showPath","showConfig","toggleMode","newismap","oldismap","newiscus","oldiscus","changed","reload","showAll","getDim","colkey","Path","getColKey","rowkey","getRowKey","setLayoutMode","mode","om","o","getLayoutMode","n","showMode","setCellMode","getCellMode","Matrix","cnt","popSeries","Single","popSingle","toggleFullScreen","document","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","documentElement","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","console","log","getPriorityKeys","Database","keyCnt","keys","Object","plen","ii","key","indexOf","push","increaseSelect","type","kid","src","splice","spliceArray","other","exportAllKeys","increasePriority","getPriorityIndex","arr","len","pri","changePriority","trg","JSON","stringify","col","table","row","ikey","itrg","concat","getPriority","cp","setPriority","getDescription","element","skeys","s","docs","doc","klen","jj","d","setPlan","plan","set","lenk","val","getTextWidth","txt","fontname","fontsize","c","createElement","ctx","getContext","font","getFont","measureText","width","getTextHeight","getDescender","maxWidth","values","border","swidth","mwidth","lenv","cwidth","max","sum","makeDocTitle","title","makeCntTitle","dlen","_title","getLargeFont","makePlan","label","iwidth","iheight","hh","ww","dh","dw","Math","floor","xoffset","yoffset","height","step","makePlans","colvalues","rowvalues","descender","mheight","plans","hdr","hd1","hd2","hdrHeight","hdrWidth","cellHeight","cellWidth","hdr1Width","hdr2Width","hx","rot","stp","lenr","lenc","cheight","substr","wh","zwidth1","zwidth2","hwidth","ceil","min","align"],"mappings":"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","sourcesContent":["//console.log(\"Loading LayoutLib.js\");\n\nfunction Layout() {\n    this.rotate=undefined;  // should labels on x-axis be rotated?\n    this.priority=undefined;// which key should be on the abscissa\n    this.init=function(state){\n\tstate.Utils.init(\"Layout\",this);\n    };\n    this.fullscreen=false;\n    this.fonts=[\"12px Fixed\",\"18px Fixed\",\"24px Fixed\",\"36px Fixed\",\"48px Fixed\"\n\t       ];\n    //\n    this.lfonts=[\"24px Fixed\",\"36px Fixed\",\"48px Fixed\",\"72px Fixed\",\"96px Fixed\"\n\t       ];\n    //\n    this.state={viewMode:0,       // should we show trash contents?\n\t\tcellMode:0,       // sum, series, item\n\t\tlayoutMode:0,     // table, list, map\n\t\tcfont:0,\n\t\ttooltip:1,\n\t       };\n    this.modes={view:{nopath:0,\n\t\t      path:1,\n\t\t     },\n\t\tcell:{Sum:0,\n\t\t      Series:1,\n\t\t     },\n\t\tlayout:{Table:0,\n\t\t\tList:1,\n\t\t\tChart:2,\n\t\t\tGlobe:3\n\t\t       }\n\t       };\n    this.toggleTooltip=function(state) {\n\tthis.state.tooltip=(this.state.tooltip+1)%3;\n\t//console.log(\"Tooltip:\",this.state.tooltip);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,true);\n    };\n    this.changeFont=function(state) {\n\tthis.state.cfont=((this.state.cfont +1) % this.fonts.length);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,false);\n    };\n    this.toggleView=function(state) {\n\t//console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\n\tif (this.state.viewMode === this.modes.view.nopath) {\n\t    this.state.viewMode=this.modes.view.path;\n\t} else if (this.state.viewMode === this.modes.view.path) {\n\t    this.state.viewMode=this.modes.view.nopath;\n\t};\n\t//console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\n\tstate.Show.showPath(state);\n\tstate.Show.showConfig(state);\n    };\n    this.toggleMode=function(state,layoutMode,cellMode) {\n\t//console.log(\"ToggleMode:\",layoutMode,cellMode);\n\t//var reload=(layoutMode !== state.Layout.state.layoutMode);\n\tvar newismap = (layoutMode===state.Layout.modes.layout.Chart ||\n\t\t\tlayoutMode===state.Layout.modes.layout.Globe);\n\tvar oldismap = (state.Layout.state.layoutMode===state.Layout.modes.layout.Chart ||\n\t\t\tstate.Layout.state.layoutMode===state.Layout.modes.layout.Globe);\n\tvar newiscus=(layoutMode!==state.Layout.modes.layout.Table &&\n\t\t\t layoutMode!==state.Layout.modes.layout.List &&\n\t\t\t layoutMode!==state.Layout.modes.layout.Chart &&\n\t\t\t layoutMode!==state.Layout.modes.layout.Globe);\n\tvar oldiscus=(state.Layout.state.layoutMode!==state.Layout.modes.layout.Table &&\n\t\t\t state.Layout.state.layoutMode!==state.Layout.modes.layout.List &&\n\t\t\t state.Layout.state.layoutMode!==state.Layout.modes.layout.Chart &&\n\t\t\t state.Layout.state.layoutMode!==state.Layout.modes.layout.Globe);\n\tvar changed= state.Layout.state.layoutMode!==layoutMode;\n\tvar reload=(   ( newismap && (! oldismap || changed))\n\t\t       || ( oldismap && (! newismap || changed))\n\t\t       || ( oldiscus && (! newiscus || changed))\n\t\t       || ( newiscus && (! oldiscus || changed)));\n\t//console.log(\"Reload:\",reload,newismap,oldismap,newiscus,oldiscus,changed);\n\tstate.Layout.state.layoutMode=layoutMode;\n\tstate.Layout.state.cellMode=cellMode;\n\t//state.Show.showConfig(state);\n\tstate.Show.showAll(state,reload);\n    };\n    this.getDim=function(state) {\n\t//console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\n        var colkey=state.Path.getColKey(state);\n        var rowkey=state.Path.getRowKey(state);\n\tif (colkey !== undefined && rowkey !== undefined) {\n\t    return 2;\n\t} else if (colkey !== undefined || rowkey !== undefined) {\n\t    return 1;\n\t} else {\n\t    return 0;\n\t}\n    };\n    this.setLayoutMode=function(state,mode) {\n\tvar om=this.state.layoutMode;\n\tvar o=this.getLayoutMode(state);\n\tthis.state.layoutMode=mode;\n\tvar n=this.getLayoutMode(state);\n\t//console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.setCellMode=function(state,mode) {\n\tvar om=this.state.cellMode;\n\tvar o=this.getCellMode(state);\n\tthis.state.cellMode=mode;\n\tvar n=this.getCellMode(state);\n\t//console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.getLayoutMode=function(state) {\n\t//console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\n\tvar mode=this.state.layoutMode;\n\tif (mode  === this.modes.layout.List && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.layout.Table;\n\t}\n\treturn mode;\n    };\n    this.getCellMode=function(state) {\n\tvar mode=this.state.cellMode;\n\tif (mode  === this.modes.cell.Single && state.Matrix.cnt > state.Matrix.popSingle) {\n\t    mode=this.modes.cell.Series;\n\t}\n\tif (mode  === this.modes.cell.Series && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.cell.Sum;\n\t}\n\treturn mode;\n    };\n    this.toggleFullScreen=function(state) {\n\t//var pos=0;\n\tif (!document.fullscreenElement &&    // alternative standard method\n\t    !document.mozFullScreenElement && \n\t    !document.webkitFullscreenElement && \n\t    !document.msFullscreenElement ) {  // current working methods\n\t    if (document.documentElement.requestFullscreen) {\n\t\tdocument.documentElement.requestFullscreen();\n\t\t//pos=1;\n\t    } else if (document.documentElement.msRequestFullscreen) {\n\t\tdocument.documentElement.msRequestFullscreen();\n\t\t//pos=2;\n\t    } else if (document.documentElement.mozRequestFullScreen) {\n\t\tdocument.documentElement.mozRequestFullScreen();\n\t\t//pos=3;\n\t    } else if (document.webkitRequestFullscreen) {\n\t\tdocument.webkitRequestFullscreen();\n\t\t//pos=4;\n\t    } else {\n\t\t//pos=5;\n\t    }\n\t    this.fullscreen=true;\n\t} else {\n\t    if (document.exitFullscreen) {\n\t\tdocument.exitFullscreen();\n\t\t//pos=6;\n\t    } else if (document.msExitFullscreen) {\n\t\tdocument.msExitFullscreen();\n\t\t//pos=7;\n\t    } else if (document.mozCancelFullScreen) {\n\t\tdocument.mozCancelFullScreen();\n\t\t//pos=8;\n\t    } else if (document.webkitExitFullscreen) {\n\t\tdocument.webkitExitFullscreen();\n\t\t//pos=9;\n\t    } else {\n\t\t//pos=10;\n\t    }\n\t    this.fullscreen=false;\n\t}\n\tstate.Show.showConfig(state);\n\tconsole.log(\"Toggle fullscreen:\",this.fullscreen);\n    };\n    // adjust keys so that rows/cols have more than on entry...\n    this.getPriorityKeys=function(state){\n        if (state.Layout.priority === undefined) {\n            state.Layout.priority=state.Database.keyCnt.keys();\n        } else {\n\t    var keys = Object.keys(state.Database.keyCnt);;\n\t    var plen = keys;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar key=keys[ii];\n\t\tif (state.Layout.priority.indexOf(key)===-1) {\n\t\t    state.Layout.priority.push(key);\n\t\t}\n\t    };\n\t};\n\treturn state.Layout.priority; //state.Utils.invertedArray()\n    };\n    this.increaseSelect=function(state,key,type){\n\tvar kid,src;\n\tif (type === \"select\") {\n\t    kid=state.Path.keys.path.indexOf(key);\n\t    //console.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\t    if (kid !== -1 && kid > 0) {\n\t\tsrc=state.Path.keys.path.splice(kid, 1); // remove from array   \n\t\tstate.Utils.spliceArray(state.Path.keys.path,kid-1,0,src);\n\t    }\n\t} else if (type === \"otherTable\" || type === \"otherRest\") {\n\t    kid=state.Path.keys.other.indexOf(key);\n\t    //console.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\t    if (kid !== -1 && kid > 0) {\n\t\tsrc=state.Path.keys.other.splice(kid, 1); // remove from array   \n\t\tstate.Utils.spliceArray(state.Path.keys.other,kid-1,0,src);\n\t    }\n\t};\n\t// export\n\tstate.Path.exportAllKeys(state);\n\t//console.log(\"IncreaseSelect:\",key,type,JSON.stringify(state.Path.keys));\n\tstate.Show.showConfig(state);\n\tstate.Show.showPath(state);\n    };\n    this.increasePriority=function(state,key){\n\tvar kid=state.Layout.priority.indexOf(key);\n\t//console.log(\"Bumping:\",key,kid,JSON.stringify(state.Layout.priority));\n\tif (kid !== -1 && kid > 0) {\n\t    var src=state.Layout.priority.splice(kid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Layout.priority,kid-1,0,src);\n\t}\n\tstate.Show.showConfig(state);\n    };\n    this.getPriorityIndex=function(state,arr) {\n\tvar len,ii;\n\tvar pri={};\n\tlen=arr.length;\n\tfor (ii=0;ii<len;ii++) {\n\t    pri[arr[ii]]=0;\n\t};\n\tif (this.priority !== undefined) {\n\t    len=this.priority.length\n\t    for (ii=0;ii<len;ii++) {\n\t\tvar key=this.priority[ii]\n\t\tpri[key]=len+1-ii\n\t    };\n\t};\n\treturn pri;\n    };\n    this.changePriority=function(state,key,trg) {  // key -> trg\n\tif (key  === undefined || trg  === undefined) { return;}\n\tconsole.log(\"Priority:\",key,\"->\",trg,JSON.stringify(this.priority));\n\t//if (typeof trg  === \"undefined\") {\n\tvar col=state.Path.other.table[0];\n\tvar row=state.Path.other.table[1];\n\t//var icol=0;\n\t//var irow=0;\n\tvar ikey=0;\n\tvar itrg=0;\n\tvar len=this.priority.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    if (this.priority[ii]  === col) {\n\t\t//icol=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === row) {\n\t\t//irow=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === key) {\n\t\tikey=len+1-ii;\n\t    }\n\t    if  (this.priority[ii]  === trg) {\n\t\titrg=len+1-ii;\n\t    }\n\t}\n\tif (itrg < ikey) {        // demote existing key\n\t    if (itrg > 0) {       // key exists on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+2-itrg,0,key);  // add after\n\n\t\tconsole.log(\"Added:\",JSON.stringify(this.priority),ikey,itrg,key);\n\t\t\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t    } else {              // key exists, target does not\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tthis.priority.concat(key)\t    \n\t    }\n\t} else if (itrg > ikey) { // demote, key may not exist on priority list\n\t    if (ikey>0) {         // key exists on priority list\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    } else {              // key is not on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    }\n\t} else if (itrg === 0) { // key and target not on the priority list\n\t    this.priority.concat(key)\n\t}\n\tconsole.log(\"Changed priority:\",JSON.stringify(this.priority),ikey,itrg);\n\treturn true;\n    }\n    //this.flipTable=function(state) {\n    //    var bb=this.colrow[0];\n    //    this.colrow[0]=this.colrow[1];\n    //    this.colrow[1]=bb;\n    //    //console.log(\"Setup:\",JSON.stringify(setup));\n    //};\n    this.getPriority=function(state) {\n\treturn state.Utils.cp(this.priority);\n    };\n    this.setPriority=function(state,priority) {\n\tthis.priority=priority;\n    }\n    this.getDescription=function(state,element,skeys) {\n\tif (element.cnt  === 1) {\n\t    var s=\"\";\n\t    var docs=element.docs;\n\t    var doc=docs[0];\n\t    var klen=skeys.length;\n\t    for (var jj = 0; jj < klen; jj++) {\n\t\tvar d=skeys[jj]+\"=\"+doc[skeys[jj]];;\n\t\tif (s !== \"\") {\n\t\t    s=s+\" \"+d\n\t\t} else {\n\t\t    s=d;\n\t\t}\n\t    }\n\t    return s;\n\t} else {\n\t    return element.cnt;\n\t}\n    };\n    this.setPlan=function(plan,set) {\n\tvar keys=Object.keys(set);\n\tvar lenk=keys.length;\n\tfor (var ii=0; ii<lenk; ii++) {\n\t    var key=keys[ii];\n\t    var val=set[key];\n\t    plan[key]=val;\n\t};\n    };\n    this.getTextWidth=function(txt, fontname, fontsize){\n\tif(this.getTextWidth.c === undefined){\n            this.getTextWidth.c=document.createElement('canvas');\n            this.getTextWidth.ctx=this.getTextWidth.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextWidth.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextWidth.ctx.font = this.getFont();\n\t}\n\treturn this.getTextWidth.ctx.measureText(txt).width;\n    };\n    this.getTextHeight=function(fontname, fontsize){\n\tif(this.getTextHeight.c === undefined){\n            this.getTextHeight.c=document.createElement('canvas');\n            this.getTextHeight.ctx=this.getTextHeight.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextHeight.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextHeight.ctx.font = this.getFont();\n\t}\n\treturn this.getTextHeight.ctx.measureText('M').width;\n    };\n    this.getDescender=function(fontname,fontsize) {\n\treturn this.getTextHeight(fontname,fontsize)*0.3;\n    }\n    this.maxWidth=function(values,border) {\n\tvar swidth=0;\n\tvar mwidth=0;\n\tvar lenv=values.length;\n\tfor (var ii=0;ii<lenv;ii++) {\n\t    var cwidth = this.getTextWidth(values[ii])+2*border;\n\t    if (cwidth > mwidth) {\n\t\tmwidth=cwidth;\n\t    }\n\t    swidth=swidth+cwidth;\n\t}\n\treturn {max:mwidth,sum:swidth};\n    }\n    this.makeDocTitle=function(state,doc) {\n\tvar title=\"\";\n\tvar len=state.Path.tooltip.keys.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    var key=state.Path.tooltip.keys[ii];\n\t    if (doc[key] !== undefined) {\n\t\tif (title !== \"\") { title=title+\", \";};\n\t\ttitle=title+key+\"=\"+doc[key];\n\t    };\n\t}\n\treturn title;\n    };\n    this.makeCntTitle=function(state,docs) {\n\tvar title=\"\"\n\tif (this.state.title === 1) {\n\t    var dlen=docs.length;\n\t    for (var ii = 0; ii < dlen; ii++) {\n    \t\tvar doc=docs[ii];\n\t\tif (doc._title !== undefined) {\n\t\t    if (title !== \"\") { title=title+\"|\";};\n\t\t    title=title+doc._title;\n\t\t}\n\t    }\n\t}\n\treturn title;\n    };\n    this.getFont=function(){\n\treturn this.fonts[this.state.cfont];\n    };\n    this.getLargeFont=function(){\n\treturn this.lfonts[this.state.cfont];\n    };\n    this.makePlan=function(label,iwidth,iheight){\n\t// get height/width ratio\n\tvar plan={};\n\tvar hh=0;\n\tvar ww=0;\n\tvar dh=this.getTextHeight();\n\tvar dw=this.getTextWidth(label);\n\tif (dh/dw > iheight/iwidth) {\n\t    hh=Math.floor(iheight/3);\n\t    ww=Math.floor(hh*dw/dh);\n\t} else {\n\t    ww=Math.floor(iwidth/3);\n\t    hh=Math.floor(ww*dh/dw);\n\t}\n\tplan.font=hh + 'px Fixed';\n\tplan.xoffset=(iwidth-ww)/2;\n\tplan.yoffset=(iheight-hh)/2;\n\tplan.height=iheight;\n\tplan.width=iwidth;\n\tplan.rotate=false;\n\tplan.step=1;\n\tplan.border=0;\n\t//console.log(\"Plan:\",JSON.stringify(plan));\n\treturn plan;\n    }\n    this.makePlans=function(colkey,rowkey,colvalues,rowvalues,iwidth,iheight,border) {\n\tvar descender=this.getDescender();\n\tif (border===null) {border=0;}\n\tiheight=iheight-15;\n\tborder=border+1; // descender\n\t// text boundaries\n\tvar mheight=this.getTextHeight() + 2 * (descender+1);       //props.theme.spacing.unit;\n\tvar plans={cell:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()}, \n\t\t   hdr:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()},\n\t\t   hd1:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()},\n\t\t   hd2:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()},\n\t\t   row:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()},\n\t\t   col:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.getFont()}};\n\tif (iwidth <= 0) { return plans;};\n\tvar hdrHeight, hdrWidth, cellHeight, cellWidth, hdr1Width, hdr2Width, hx, rot, stp,lenr,lenc, cheight;\n\tlenc=colvalues.length;\n\tlenr=rowvalues.length;\n\t//console.log(\"Height:\",iheight,lenr,border);\n\tif (colkey.substr(0,1) === \"_\") {\n\t    rot=false;\n\t    stp=1\n\t    hdrHeight=0;\n\t    hdrWidth=0;\n\t    hdr1Width=0;\n\t    hdr2Width=0;\n\t    hx=(cellWidth)/2;\n\t    //var height=iheight-((lenr+1)*(border+5))-15;\n\t    var width=iwidth;\n\t    cheight=iheight-hdrHeight;\n\t    cellHeight=cheight/lenr - 2*border-5;\n\t    //console.log(\"CellHeight:\",cellHeight,height,lenr,border);\n\t    cellWidth=width/lenc - 2*border;\n\t    //console.log(\"Keys:\",colkey, rowkey, lenc, lenr, cellWidth, cellHeight, iwidth,iheight,border);\n\t    //console.log(\"Keys col:\",colkey, JSON.stringify(colvalues), lenc, iwidth, cellWidth);\n\t    //console.log(\"Keys row:\",rowkey, JSON.stringify(rowvalues), lenr, iheight, cellHeight);\n\t} else if (colkey!==undefined) {\n\t    var wh=this.maxWidth(rowvalues,border);\n\t    var ww=this.maxWidth(colvalues,border);\n\t    var zwidth1 =(colkey===\"\"?0:this.getTextWidth(colkey) + 2 * border);   //props.theme.spacing.unit;\n\t    \n\t    var zwidth2 =(rowkey===\"\"?0:this.getTextWidth(rowkey) + 2 * border);   //props.theme.spacing.unit;\n\t    // var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n\t    // table boundaries\n\t    var hwidth=Math.max(wh.max,zwidth1+zwidth2) + mheight;\n\t    width=iwidth-hwidth;\n\t    // calculate cell width...\n\t    var mwidth=ww.max;\n\t    //var swidth=ww.sum;\n\t    //console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\n\t    if (mwidth*lenc < width) { // horisontal\n\t\trot=false;\n\t\tstp=1\n\t\tcellWidth=width/lenc;\n\t\thdrHeight=mheight;\n\t\thx=(cellWidth-mwidth)/2;\n\t\t//console.log(\"Plan (normal):\",JSON.stringify(plans));\n\t    } else if (mheight*lenc < width) { // rotate\n\t\trot=true;\n\t\tstp=1\n\t\tcellWidth=width/lenc;\n\t\thdrHeight=mwidth;\n\t\thx=(cellWidth-mheight)/2;\n\t\t//console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cellWidth*lenc);\n\t    } else { // rotate and use steps\n\t\trot=true;\n\t\tstp=Math.ceil(lenc*mheight/width);\n\t\tcellWidth=stp*width/lenc;\n\t\thdrHeight=mwidth;\n\t\thx=(cellWidth-mheight)/2;\n\t\t//console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cellWidth,hdrHeight,hx);\n\t    }\n\t    // calculate cell height\n\t    cheight=iheight-hdrHeight-2*border;\n\t    //height=iheight-hdrHeight-((lenr+1)*border)-15;\n\t    //console.log(\"Height:\",iheight,cheight,mheight*lenr);\n\t    if (mheight*lenr < cheight) { // \n\t\tcellHeight=Math.min(mheight*10,cheight/lenr)-2*border-3;\n\t    } else {\n\t\tcellHeight=mheight - 2*border-3;\n\t    }\n\t    hdrWidth=hwidth;\n\t    //console.log(\"Cells:\",hdrHeight,cellHeight,iheight,lenr,mheight);\n\t    var dw=(hdrWidth-zwidth1-zwidth2)/2;\n\t    hdr1Width=zwidth1+dw;\n\t    hdr2Width=zwidth2+dw;\n\t}\n\tthis.setPlan(plans.cell,{width:cellWidth, height:cellHeight, step:stp, font:this.getFont()});\n\tthis.setPlan(plans.hdr, {width:hdrWidth,  height:hdrHeight,  font:this.getFont()});\n\tthis.setPlan(plans.hd1, {width:hdr1Width, height:hdrHeight,  align:\"right\", font:this.getFont()});\n\tthis.setPlan(plans.hd2, {width:hdr2Width, height:hdrHeight,  font:this.getFont()});\n\tthis.setPlan(plans.col, {width:cellWidth, height:hdrHeight,  xoffset:hx, step:stp,rotate:rot, font:this.getFont()});\n\tthis.setPlan(plans.row, {width:hdrWidth,  height:cellHeight, font:this.getFont()});\n\t//console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n\treturn plans;\n    }\n};\nexport default Layout;\n"]},"metadata":{},"sourceType":"module"}