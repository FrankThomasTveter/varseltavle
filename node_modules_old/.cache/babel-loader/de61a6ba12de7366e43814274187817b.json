{"ast":null,"code":"//console.log(\"Loading MatrixLib.js\");\nfunction Grid() {\n  this.bdeb = false;\n  this.resolution = 20; // map resolution\n\n  this.eps = 0.5; // marker resolution\n\n  this.area = {};\n\n  this.init = function (state) {\n    var par = \"Grid\";\n    state.Utils.init(par, this);\n  };\n\n  this.roundup = function (val) {\n    return Math.ceil(val * 1000) / 1000;\n  };\n\n  this.rounddown = function (val) {\n    return Math.floor(val * 1000) / 1000;\n  };\n\n  this.posToVal = function (state, pos, min, max) {\n    var res = this.getRes(min, max); //this.resolution-1\n\n    if (pos !== undefined && min !== undefined && !isNaN(min) && max !== undefined && !isNaN(max)) {\n      var dlon = Math.max(this.eps, (max - min) / res); //var dbor=dlon/2;\n\n      var val = Number(pos) * dlon + min;\n\n      if (this.bdeb) {\n        console.log(\"PosToVal \", pos, min, max, val);\n      }\n\n      ;\n      return val;\n    } else {\n      return 0;\n    }\n\n    ;\n  };\n\n  this.valToPos = function (state, val, min, max) {\n    var res = this.getRes(min, max); //this.resolution-1\n\n    if (val !== undefined && min !== undefined && !isNaN(min) && max !== undefined && !isNaN(max)) {\n      var dlon = Math.max(this.eps, (max - min) / res);\n      ;\n\n      if (max === min) {\n        console.log(\"ValToPos#\", Number(val) - min, dlon, res / 2);\n        return Math.floor(res / 2);\n      } else {\n        //console.log(\"ValToPos init:\",val,min,max,res);\n        var dbor = dlon / 2;\n        var pos = (Number(val) - min + dbor) / dlon;\n\n        if (this.bdeb) {\n          console.log(\"ValToPos:\", pos, Number(val) - min + dbor, dlon);\n        }\n\n        ;\n        return Math.max(0, Math.min(res, Math.floor(pos)));\n      }\n    } else {\n      console.log(\"Missing valtopos-parameters.\");\n      return 0;\n    }\n  };\n\n  this.lonToPos = function (state, val) {\n    var min = this.area.minlon;\n    var max = this.area.maxlon;\n    return this.valToPos(state, val, min, max);\n  };\n\n  this.posToLon = function (state, pos) {\n    var min = this.area.minlon;\n    var max = this.area.maxlon;\n    return this.posToVal(state, pos, min, max);\n  };\n\n  this.latToPos = function (state, val) {\n    var min = this.area.minlat;\n    var max = this.area.maxlat;\n    return this.valToPos(state, val, min, max);\n  };\n\n  this.posToLat = function (state, pos) {\n    var min = this.area.minlat;\n    var max = this.area.maxlat;\n    return this.posToVal(state, pos, min, max);\n  };\n\n  this.getRes = function (min, max) {\n    var dlat = Math.max(this.eps, (max - min) / this.resolution);\n    var res = Math.max(1, Math.floor(0.5 + (max - min) / dlat));\n    res = this.resolution;\n    return res;\n  };\n\n  this.getResolution = function () {\n    var a = this.area;\n    var res = {\n      lat: this.getRes(a.minlat, a.maxlat) + 1,\n      lon: this.getRes(a.minlon, a.maxlon) + 1\n    }; //console.log(\"Resolution:\",JSON.stringify(res));\n\n    return res;\n  };\n\n  this.getLonRange = function (state, lon) {\n    var min = parseFloat(this.area.minlon); //Number(arr[0]);\n\n    var max = parseFloat(this.area.maxlon); //Number(arr[arr.length-1]);\n\n    var pos = this.valToPos(state, lon, min, max);\n    var lonmin = this.rounddown(this.posToVal(state, pos - 0.506, min, max));\n    var lonmax = this.roundup(this.posToVal(state, pos + 0.494, min, max));\n    return {\n      min: lonmin,\n      max: lonmax\n    };\n  };\n\n  this.getLonWhere = function (state, keylon, lon) {\n    var range = this.getLonRange(state, lon);\n    var lonmin = range.min;\n    var lonmax = range.max;\n\n    if (parseFloat(lonmin) < parseFloat(lonmax)) {\n      return '' + keylon + ' >= ' + lonmin + ' and ' + keylon + ' < ' + lonmax + '';\n    } else {\n      return '' + keylon + ' >= ' + lonmax + ' and ' + keylon + ' < ' + lonmin + '';\n    }\n  };\n\n  this.getLatRange = function (state, lat) {\n    var min = parseFloat(this.area.minlat); //Number(arr[0]);\n\n    var max = parseFloat(this.area.maxlat); //Number(arr[arr.length-1]);\n\n    var pos = this.valToPos(state, lat, min, max);\n    var latmin = this.rounddown(this.posToVal(state, pos - 0.506, min, max));\n    var latmax = this.roundup(this.posToVal(state, pos + 0.494, min, max));\n    return {\n      min: latmin,\n      max: latmax\n    };\n  };\n\n  this.getLatWhere = function (state, keylat, lat) {\n    var range = this.getLatRange(state, lat);\n    var latmin = range.min;\n    var latmax = range.max;\n\n    if (parseFloat(latmin) < parseFloat(latmax)) {\n      return '' + keylat + ' >= ' + latmin + ' and ' + keylat + ' < ' + latmax + '';\n    } else {\n      return '' + keylat + ' >= ' + latmax + ' and ' + keylat + ' < ' + latmin + '';\n    }\n  };\n\n  this.getLats = function (state) {\n    var res = this.getResolution(state, this.resolution);\n    var vals = [];\n\n    if (this.bdeb) {\n      console.log(\"Initial area:\", JSON.stringify(this.area));\n    }\n\n    ;\n\n    for (var ii = 0; ii < res.lat; ii++) {\n      var lat = this.posToLat(state, res.lat - ii - 1);\n\n      if (this.bdeb) {\n        console.log(\"Values _lat:\", res.lat, ii, lat);\n      }\n\n      ;\n      vals.push(lat);\n    }\n\n    return vals;\n  };\n\n  this.getLons = function (state) {\n    var res = this.getResolution(state, this.resolution);\n    var vals = [];\n\n    for (var ii = 0; ii < res.lon; ii++) {\n      var lon = this.posToLon(state, ii);\n\n      if (this.bdeb) {\n        console.log(\"Values _lon:\", res.lon, ii, lon);\n      }\n\n      ;\n      vals.push(lon);\n    }\n\n    return vals;\n  };\n\n  this.setArea = function (iminlat, imaxlat, iminlon, imaxlon) {\n    var minlat = parseFloat(iminlat);\n    var maxlat = parseFloat(imaxlat);\n    var minlon = parseFloat(iminlon);\n    var maxlon = parseFloat(imaxlon);\n    var epslon = maxlon - minlon;\n    var epslat = maxlat - minlat;\n\n    if (epslon < this.eps) {\n      maxlon = maxlon + this.eps / 2;\n      minlon = minlon - this.eps / 2;\n    }\n\n    ;\n\n    if (epslat < this.eps) {\n      maxlat = maxlat + this.eps / 2;\n      minlat = minlat - this.eps / 2;\n    }\n\n    ;\n    this.area = {\n      minlat: minlat,\n      maxlat: maxlat,\n      minlon: minlon,\n      maxlon: maxlon\n    }; //console.log(\"setArea:\",JSON.stringify(this.area),iminlat,imaxlat,iminlon,imaxlon);\n  };\n\n  this.setRange = function (range, val) {\n    //console.log(\"SetRange Start:\",JSON.stringify(range),val);\n    if (range === undefined) {\n      range = [val, val];\n    } else {\n      range = [Math.min(val, range[0]), Math.max(val, range[1])];\n    }\n\n    ; //console.log(\"SetRange Final:\",JSON.stringify(range),val);\n\n    return range;\n  };\n\n  this.adjustRange = function (range) {\n    if (range !== undefined) {\n      //console.log(\"Adjusting:\",JSON.stringify(range));\n      var dx = range[1] - range[0];\n      range = [range[0] - dx * 0.01, range[1] + dx * 0.01];\n\n      if (range[0] > 0 && range[0] - dx < 0) {\n        range[0] = 0;\n      }\n\n      if (range[1] < 0 && range[1] + dx > 0) {\n        range[1] = 0;\n      } //console.log(\"Result:\",JSON.stringify(range));\n\n\n      return range;\n    }\n  };\n}\n\n;\nexport default Grid;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/GridLib.js"],"names":["Grid","bdeb","resolution","eps","area","init","state","par","Utils","roundup","val","Math","ceil","rounddown","floor","posToVal","pos","min","max","res","getRes","undefined","isNaN","dlon","Number","console","log","valToPos","dbor","lonToPos","minlon","maxlon","posToLon","latToPos","minlat","maxlat","posToLat","dlat","getResolution","a","lat","lon","getLonRange","parseFloat","lonmin","lonmax","getLonWhere","keylon","range","getLatRange","latmin","latmax","getLatWhere","keylat","getLats","vals","JSON","stringify","ii","push","getLons","setArea","iminlat","imaxlat","iminlon","imaxlon","epslon","epslat","setRange","adjustRange","dx"],"mappings":"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","sourcesContent":["//console.log(\"Loading MatrixLib.js\");\n\nfunction Grid() {\n    this.bdeb=false;\n    this.resolution=20; // map resolution\n    this.eps=0.5;       // marker resolution\n    this.area={};\n    this.init=function(state){\n\tvar par=\"Grid\";\n\tstate.Utils.init(par,this);\n    };\n    this.roundup=function(val) {\n\treturn Math.ceil(val*1000)/1000;\n    }\n    this.rounddown=function(val) {\n\treturn Math.floor(val*1000)/1000;\n    }\n    this.posToVal=function(state,pos,min,max) {\n\tvar res=this.getRes(min,max);//this.resolution-1\n\tif (pos !== undefined &&\n\t    min !== undefined && ! isNaN(min) &&\n\t    max !== undefined && ! isNaN(max)) {\n\t    var dlon=Math.max(this.eps,(max-min)/res);\n\t    //var dbor=dlon/2;\n\t    var val=( (Number(pos)) * dlon ) + min;\n\t    if (this.bdeb) {console.log(\"PosToVal \",pos,min,max,val);};\n\t    return val;\n\t} else {\n\t    return 0;\n\t};\n    };\n    this.valToPos=function(state,val,min,max) {\n\tvar res=this.getRes(min,max);//this.resolution-1\n\tif (val !== undefined &&\n\t    min !== undefined && ! isNaN(min) &&\n\t    max !== undefined && ! isNaN(max) ) {\n\t    var dlon=Math.max(this.eps,(max-min)/res);;\n\t    if (max===min) {\n\t\tconsole.log(\"ValToPos#\",Number(val)-min,dlon,res/2);\n\t\treturn Math.floor(res/2);\n\t    } else {\n\t\t//console.log(\"ValToPos init:\",val,min,max,res);\n\t\tvar dbor=dlon/2;\n\t\tvar pos=(Number(val) - min + dbor)/dlon;\n\t\tif(this.bdeb){console.log(\"ValToPos:\",pos,Number(val)-min+dbor,dlon);};\n\t\treturn Math.max(0,Math.min(res,Math.floor(pos)))\n\t    }\n\t} else {\n\t    console.log(\"Missing valtopos-parameters.\")\n\t    return 0;\n\t}\n    };\n    this.lonToPos=function(state,val) {\n\tvar min=this.area.minlon;\n\tvar max=this.area.maxlon;\n\treturn this.valToPos(state,val,min,max)\n    };\n    this.posToLon=function(state,pos) {\n\tvar min=this.area.minlon;\n\tvar max=this.area.maxlon;\n\treturn this.posToVal(state,pos,min,max)\n    };\n    this.latToPos=function(state,val) {\n\tvar min=this.area.minlat;\n\tvar max=this.area.maxlat;\n\treturn this.valToPos(state,val,min,max)\n    };\n    this.posToLat=function(state,pos) {\n\tvar min=this.area.minlat;\n\tvar max=this.area.maxlat;\n\treturn this.posToVal(state,pos,min,max)\n\t};\n    this.getRes=function (min,max) {\n\tvar dlat=Math.max(this.eps,(max-min)/this.resolution);\n\tvar res=Math.max(1,Math.floor(0.5+((max-min)/dlat)))\n\tres=this.resolution;\n\treturn res;\n    }\n    this.getResolution=function () {\n\tvar a=this.area;\n\tvar res={lat:this.getRes(a.minlat,a.maxlat)+1,lon:this.getRes(a.minlon,a.maxlon)+1};\n\t//console.log(\"Resolution:\",JSON.stringify(res));\n\treturn res;\n    };\n    this.getLonRange=function(state,lon) {\n\tvar min=parseFloat(this.area.minlon);//Number(arr[0]);\n\tvar max=parseFloat(this.area.maxlon);//Number(arr[arr.length-1]);\n\tvar pos=this.valToPos(state,lon,min,max);\n\tvar lonmin=this.rounddown(this.posToVal(state,pos-0.506,min,max));\n\tvar lonmax=this.roundup(this.posToVal(state,pos+0.494,min,max));\n\treturn {min:lonmin,max:lonmax};\n    }\n    this.getLonWhere=function(state,keylon,lon) {\n\tvar range=this.getLonRange(state,lon);\n\tvar lonmin=range.min;\n\tvar lonmax=range.max;\n\tif (parseFloat(lonmin) < parseFloat(lonmax)) {\n\t    return ''+keylon+' >= '+lonmin+' and '+keylon+ ' < '+lonmax+'';\n\t} else {\n\t    return ''+keylon+' >= '+lonmax+' and '+keylon+ ' < '+lonmin+'';\n\t}\n    };\n    this.getLatRange=function(state,lat) {\n\tvar min=parseFloat(this.area.minlat);//Number(arr[0]);\n\tvar max=parseFloat(this.area.maxlat);//Number(arr[arr.length-1]);\n\tvar pos=this.valToPos(state,lat,min,max);\n\tvar latmin=this.rounddown(this.posToVal(state,pos-0.506,min,max));\n\tvar latmax=this.roundup(this.posToVal(state,pos+0.494,min,max));\n\treturn {min:latmin,max:latmax};\n    }\n    this.getLatWhere=function(state,keylat,lat) {\n\tvar range=this.getLatRange(state,lat);\n\tvar latmin=range.min;\n\tvar latmax=range.max;\n\tif (parseFloat(latmin) < parseFloat(latmax)) {\n\t    return ''+keylat+' >= '+latmin+' and '+keylat+ ' < '+latmax+'';\n\t} else {\n\t    return ''+keylat+' >= '+latmax+' and '+keylat+ ' < '+latmin+'';\n\t}\n    };\n    this.getLats=function(state) {\n\tvar res=this.getResolution(state,this.resolution);\n\tvar vals=[];\n\tif (this.bdeb) {console.log(\"Initial area:\",JSON.stringify(this.area));};\n\tfor (var ii=0;ii<res.lat;ii++) {\n\t    var lat=this.posToLat(state,res.lat-ii-1);\n\t    if (this.bdeb) {console.log(\"Values _lat:\",res.lat,ii,lat)};\n\t    vals.push(lat);\n\t}\n\treturn vals;\n    };\n    this.getLons=function(state) {\n\tvar res=this.getResolution(state,this.resolution);\n\tvar vals=[];\n\tfor (var ii=0;ii<res.lon;ii++) {\n\t    var lon=this.posToLon(state,ii);\n\t    if (this.bdeb) {console.log(\"Values _lon:\",res.lon,ii,lon)};\n\t    vals.push(lon);\n\t}\n\treturn vals;\n    };\n    this.setArea=function(iminlat,imaxlat,iminlon,imaxlon) {\n\tvar minlat=parseFloat(iminlat);\n\tvar maxlat=parseFloat(imaxlat);\n\tvar minlon=parseFloat(iminlon);\n\tvar maxlon=parseFloat(imaxlon);\n\tvar epslon=maxlon-minlon;\n\tvar epslat=maxlat-minlat;\n\tif (epslon < this.eps) {\n\t    maxlon=maxlon+this.eps/2;\n\t    minlon=minlon-this.eps/2;\n\t};\n\tif (epslat < this.eps) {\n\t    maxlat=maxlat+this.eps/2;\n\t    minlat=minlat-this.eps/2;\n\t};\n\tthis.area={minlat:minlat,maxlat:maxlat,minlon:minlon,maxlon:maxlon};\n\t//console.log(\"setArea:\",JSON.stringify(this.area),iminlat,imaxlat,iminlon,imaxlon);\n    }\n    this.setRange=function(range,val) {\n\t//console.log(\"SetRange Start:\",JSON.stringify(range),val);\n\tif (range  === undefined) {\n\t    range=[val,val];\n\t} else {\n\t    range=[Math.min(val,range[0]),Math.max(val,range[1])];\n\t};\n\t//console.log(\"SetRange Final:\",JSON.stringify(range),val);\n\treturn range;\n    };\n    this.adjustRange=function(range) {\n\tif (range !== undefined) {\n\t    //console.log(\"Adjusting:\",JSON.stringify(range));\n\t    var dx=(range[1]-range[0]);\n\t    range=[range[0]-dx*0.01,range[1]+dx*0.01];\n\t    if (range[0]>0 && range[0]-dx<0) { range[0]=0;}\n\t    if (range[1]<0 && range[1]+dx>0) { range[1]=0;}\n\t    //console.log(\"Result:\",JSON.stringify(range));\n\t    return range;\n\t}\n    };\n};\nexport default Grid;\n"]},"metadata":{},"sourceType":"module"}