{"ast":null,"code":"//console.log(\"Loading DefaultLib.js\");\nfunction Default() {\n  this.setupdir = \"def/\"; // defaults directory\n\n  this.setup = \"defaults.json\"; // defaults file, contains default setup...\n\n  this.path = \"test.json\";\n  this.current = {};\n  this.start = undefined; // setup at start\n\n  this.init = function (state) {\n    // executed before anything else...\n    state.Utils.init(\"setup\", this);\n  }; // Maps for copying data between: setup, default state, current state, url\n  // Syntax: [[target, source],...], target=[level0,level1,level2...] etc.\n  // what we copy from Setup-file to the default setup at startup (before url) | if default setup is empty...\n\n\n  this.cpSetupToDefaultFill = [[[\"Database\", \"data\"], [\"data\"]], [[\"other\"], [\"other\"]], [[\"trash\"], [\"trash\"]], [[\"custom\"], [\"custom\"]]]; // what we copy from Setup-file to the default setup | always\n\n  this.cpSetupToDefaultForce = [[[\"Threshold\", \"thrs\"], [\"thrs\"]], [[\"Colors\", \"colors\"], [\"colors\"]], [[\"Path\", \"order\"], [\"order\"]], [[\"Path\", \"select\"], [\"select\"]], [[\"Path\", \"home\"], [\"home\"]], [[\"Path\", \"film\"], [\"film\"]], [[\"Path\", \"tooltip\"], [\"tooltip\"]], [[\"Path\", \"list\"], [\"list\"]], [[\"Layout\", \"priority\"], [\"priority\"]], [[\"Layout\", \"state\"], [\"state\"]], [[\"Settings\", \"visible\"], [\"visible\"]], [[\"Svg\", \"config\"], [\"svg\"]], [[\"Custom\", \"maps\"], [\"custom\"]]]; // what we copy from current state to the default setup | if default setup is empty\n\n  this.cpStateToDefaultFill = [[[\"Database\", \"data\"], [\"Database\", \"data\"]], [[\"Threshold\", \"thrs\"], [\"Threshold\", \"thrs\"]], [[\"Colors\", \"colors\"], [\"Colors\", \"colors\"]], [[\"Path\", \"order\"], [\"Path\", \"order\"]], [[\"Path\", \"home\"], [\"Path\", \"home\"]], [[\"Path\", \"film\"], [\"Path\", \"film\"]], [[\"Path\", \"tooltip\", \"keys\"], [\"Path\", \"tooltip\", \"keys\"]], [[\"Path\", \"tooltip\", \"select\"], [\"Path\", \"tooltip\", \"select\"]], [[\"Path\", \"tooltip\", \"sort\"], [\"Path\", \"tooltip\", \"sort\"]], [[\"Path\", \"tooltip\", \"click\"], [\"Path\", \"tooltip\", \"click\"]], [[\"Path\", \"list\"], [\"Path\", \"list\"]], [[\"Path\", \"select\"], [\"Path\", \"select\"]], [[\"Path\", \"keys\", \"path\"], [\"Path\", \"keys\", \"path\"]], [[\"Path\", \"keys\", \"other\"], [\"Path\", \"keys\", \"other\"]], [[\"Path\", \"keys\", \"trash\"], [\"Path\", \"keys\", \"trash\"]], [[\"Layout\", \"priority\"], [\"Layout\", \"priority\"]], [[\"Layout\", \"state\"], [\"Layout\", \"state\"]], [[\"Settings\", \"visible\"], [\"Settings\", \"visible\"]], [[\"Svg\", \"config\"], [\"Svg\", \"config\"]], [[\"Custom\", \"maps\"], [\"Custom\", \"maps\"]]]; // what we copy from current state to the default setup | always\n\n  this.cpStateToDefaultForce = [[[\"Path\", \"home\"], [\"Path\", \"home\"]], [[\"Colors\", \"colors\"], [\"Colors\", \"colors\"]], [[\"Custom\", \"maps\"], [\"Custom\", \"maps\"]]]; // what we copy from the default to the state | if state is empty\n\n  this.cpDefaultToStateFill = this.cpStateToDefaultFill;\n  this.cpDefaultToStateForce = [[[\"Database\", \"data\"], [\"Database\", \"data\"]]]; // what we copy from the start default to the current default | if current default is empty\n\n  this.cpDefaultToDefaultFill = this.cpStateToDefaultFill; //\n\n  this.loadDefault = function (state, response, callbacks) {\n    var file = this.setup;\n\n    if (state.Threshold.thrs !== undefined) {\n      // defaults already loaded, execute callback...\n      state.File.next(state, \"\", callbacks);\n    } else {\n      var path = state.Default.setupdir + state.Default.setup;\n      console.log(\"Default setup:\", path, file);\n      state.File.load(state, path, callbacks);\n    }\n  };\n\n  this.makeStart = function (state, response, callbacks) {\n    if (state.Default.start === undefined) {\n      state.Default.start = {};\n      state.Utils.copyFill(state, state, state.Default.start, state.Default.cpStateToDefaultFill); //console.log(\"Start:\",JSON.stringify(state.Layout.state));\n      //console.log(\"State:\",JSON.stringify(state.Layout.state));\n      //state.Default.save(state);\n    } //console.log(\">>>>>>>>>>>State:\",JSON.stringify(state.Layout.state));\n    //console.log(\">>>>>>>>>>>Start:\",JSON.stringify(state.Default.start.Layout.state));\n\n\n    state.File.next(state, \"\", callbacks);\n  };\n\n  this.processDefault = function (state, response, callbacks) {\n    if (state.Threshold.thrs !== undefined) {\n      // defaults already loaded, execute callback...\n      state.File.next(state, \"\", callbacks);\n    } else {\n      try {\n        var setup = JSON.parse(response);\n      } catch (e) {\n        console.log(\"Setup response:\", response);\n        alert(\"Default '\" + state.Default.setup + \"' contains Invalid SETUP:\" + e.name + \":\" + e.message);\n      }\n\n      if (setup !== undefined) {\n        //console.log(\"State:\",JSON.stringify(state.Database));\n        state.Utils.copyForce(state, state.Default.current, state, state.Default.cpDefaultToStateForce);\n        state.Utils.copyFill(state, setup, state.Default.current, state.Default.cpSetupToDefaultFill);\n        state.Utils.copyForce(state, setup, state.Default.current, state.Default.cpSetupToDefaultForce);\n        state.Utils.copyFill(state, state.Default.current, state, state.Default.cpDefaultToStateFill); //console.log(\"SETUP:\",JSON.stringify(setup.data));\n        //console.log(\"Default:\",JSON.stringify(state.Default.current.Database));\n        //console.log(\"State:\",JSON.stringify(state.Database));\n      }\n\n      ; // finally execute next callback\n\n      state.File.next(state, \"\", callbacks);\n    }\n  };\n\n  this.resetSetup = function (state, response, callbacks) {\n    try {\n      var setup = JSON.parse(response);\n    } catch (e) {\n      alert(\"Default '\" + state.Default.setup + \"' contains Invalid SETUP:\" + e.name + \":\" + e.message);\n    }\n\n    if (setup !== undefined && state.Default.start !== undefined) {\n      console.log(\"Reset state:\", JSON.stringify(state.Path));\n      state.Default.current = {};\n      state.Utils.copyFill(state, setup, state.Default.current, state.Default.cpSetupToDefaultFill);\n      state.Utils.copyForce(state, setup, state.Default.current, state.Default.cpSetupToDefaultForce);\n      state.Utils.copyFill(state, state.Default.start, state.Default.current, state.Default.cpDefaultToDefaultFill);\n      state.Utils.copyForce(state, state.Default.current, state, state.Default.cpDefaultToStateFill); //console.log(\"SETUP:\",JSON.stringify(setup.tooltip));\n      //console.log(\"Default:\",JSON.stringify(state.Default.Path.tooltip));\n\n      state.Database.resetSetup(state);\n      console.log(\"Reset State:\", JSON.stringify(state.Path));\n    }\n\n    ;\n  };\n\n  this.getSetup = function (state) {\n    // get updated information\n    var setup = {};\n    var current = {}; //console.log(\"Current:\",JSON.stringify(state.Colors.colors));\n\n    state.Utils.copyFill(state, state.Default.current, current, state.Default.cpDefaultToDefaultFill);\n    state.Utils.copyForce(state, state, current, state.Default.cpStateToDefaultForce);\n    state.Utils.copyForce(state, current, setup, state.Utils.invert(state.Default.cpSetupToDefaultForce));\n    state.Utils.copyFill(state, current, setup, state.Utils.invert(state.Default.cpSetupToDefaultFill)); //console.log(\"Current:\",JSON.stringify(state.Default.current));\n    //console.log(\"Setup:\",JSON.stringify(current));\n    //JSON.stringify(setup, null, \"   \");\n\n    return setup;\n  };\n\n  this.saveSetup = function (state) {\n    var setup = state.Utils.prettyJson(state.Default.getSetup(state));\n    state.Utils.save(setup, \"setup.json\", \"json\");\n  };\n\n  this.hasChanged = function (state, pth) {\n    var src = state.Default.start;\n    var trg = state;\n    var lenp = pth.length;\n\n    for (var ii = 0; ii < lenp; ii++) {\n      var p = pth[ii];\n\n      if (src[p] !== undefined) {\n        src = src[p];\n      } else {\n        //console.log(\"Missing Defaults-key:\",\"'\"+p+\"'\",\n        //\t    \"(path=\",JSON.stringify(pth),\") Default root=\",\n        //\t    JSON.stringify(Object.keys(src)));\n        return true;\n      }\n\n      if (trg[p] !== undefined) {\n        trg = trg[p];\n      } else {\n        console.log(\"Missing State-key:\", p, JSON.stringify(pth), JSON.stringify(Object.keys(trg)));\n        return true;\n      }\n    }\n\n    var s = JSON.stringify(src);\n    var t = JSON.stringify(trg); //console.log(\"Checking:\\'\",JSON.stringify(pth),\"\\'\\n\\'\",s,\"\\'\\n\",t,\"->\",s!==t);\n\n    return s !== t;\n  };\n}\n\n;\nexport default Default;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/DefaultLib.js"],"names":["Default","setupdir","setup","path","current","start","undefined","init","state","Utils","cpSetupToDefaultFill","cpSetupToDefaultForce","cpStateToDefaultFill","cpStateToDefaultForce","cpDefaultToStateFill","cpDefaultToStateForce","cpDefaultToDefaultFill","loadDefault","response","callbacks","file","Threshold","thrs","File","next","console","log","load","makeStart","copyFill","processDefault","JSON","parse","e","alert","name","message","copyForce","resetSetup","stringify","Path","Database","getSetup","invert","saveSetup","prettyJson","save","hasChanged","pth","src","trg","lenp","length","ii","p","Object","keys","s","t"],"mappings":"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","sourcesContent":["//console.log(\"Loading DefaultLib.js\");\nfunction Default() {\n    this.setupdir=\"def/\"; // defaults directory\n    this.setup=\"defaults.json\"; // defaults file, contains default setup...\n    this.path=\"test.json\";\n    this.current={};\n    this.start=undefined; // setup at start\n    this.init=function(state){ // executed before anything else...\n\tstate.Utils.init(\"setup\",this);\n    };\n    // Maps for copying data between: setup, default state, current state, url\n    // Syntax: [[target, source],...], target=[level0,level1,level2...] etc.\n    // what we copy from Setup-file to the default setup at startup (before url) | if default setup is empty...\n    this.cpSetupToDefaultFill= [[[\"Database\",\"data\"],        [\"data\"]],\n\t\t\t       [[\"other\"],                  [\"other\"]],\n\t\t\t       [[\"trash\"],                  [\"trash\"]],\n\t\t\t       [[\"custom\"],                 [\"custom\"]]\n\t\t\t      ];\n    // what we copy from Setup-file to the default setup | always\n    this.cpSetupToDefaultForce=[[[\"Threshold\",\"thrs\"],      [\"thrs\"]],\n\t\t\t       [[\"Colors\",\"colors\"],        [\"colors\"]],\n\t\t\t       [[\"Path\",\"order\"],           [\"order\"]],\n\t\t\t       [[\"Path\",\"select\"],          [\"select\"]],\n\t\t\t       [[\"Path\",\"home\"],            [\"home\"]],\n\t\t\t       [[\"Path\",\"film\"],            [\"film\"]],\n\t\t\t       [[\"Path\",\"tooltip\"],         [\"tooltip\"]],\n\t\t\t       [[\"Path\",\"list\"],            [\"list\"]],\n\t\t\t       [[\"Layout\",\"priority\"],      [\"priority\"]],\n\t\t\t       [[\"Layout\",\"state\"],         [\"state\"]],\n\t\t\t       [[\"Settings\",\"visible\"],     [\"visible\"]],\n\t\t\t       [[\"Svg\",\"config\"],           [\"svg\"]],\n\t\t\t       [[\"Custom\",\"maps\"],          [\"custom\"]]\n\t\t\t      ];\n    // what we copy from current state to the default setup | if default setup is empty\n    this.cpStateToDefaultFill= [[[\"Database\",\"data\"],        [\"Database\",\"data\"]],\n\t\t\t\t[[\"Threshold\",\"thrs\"],       [\"Threshold\",\"thrs\"]],\n\t\t\t\t[[\"Colors\",\"colors\"],        [\"Colors\",\"colors\"]],\n\t\t\t\t[[\"Path\",\"order\"],           [\"Path\",\"order\"]],\n\t\t\t\t[[\"Path\",\"home\"],            [\"Path\",\"home\"]],\n\t\t\t\t[[\"Path\",\"film\"],            [\"Path\",\"film\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"keys\"],  [\"Path\",\"tooltip\",\"keys\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"select\"],[\"Path\",\"tooltip\",\"select\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"sort\"],  [\"Path\",\"tooltip\",\"sort\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"click\"], [\"Path\",\"tooltip\",\"click\"]],\n\t\t\t\t[[\"Path\",\"list\"],            [\"Path\",\"list\"]],\n\t\t\t\t[[\"Path\",\"select\"],          [\"Path\",\"select\"]],\n\t\t\t\t[[\"Path\",\"keys\",\"path\"],     [\"Path\",\"keys\",\"path\"]],\n\t\t\t\t[[\"Path\",\"keys\",\"other\"],    [\"Path\",\"keys\",\"other\"]],\n\t\t\t\t[[\"Path\",\"keys\",\"trash\"],    [\"Path\",\"keys\",\"trash\"]],\n\t\t\t\t[[\"Layout\",\"priority\"],      [\"Layout\",\"priority\"]],\n\t\t\t\t[[\"Layout\",\"state\"],         [\"Layout\",\"state\"]],\n\t\t\t\t[[\"Settings\",\"visible\"],     [\"Settings\",\"visible\"]],\n\t\t\t        [[\"Svg\",\"config\"],           [\"Svg\",\"config\"]],\n\t\t\t\t[[\"Custom\",\"maps\"],          [\"Custom\",\"maps\"]]\n\t\t\t       ];\n    // what we copy from current state to the default setup | always\n    this.cpStateToDefaultForce=[[[\"Path\",\"home\"],            [\"Path\",\"home\"]],\n\t\t\t\t[[\"Colors\",\"colors\"],        [\"Colors\",\"colors\"]],\n\t\t\t\t[[\"Custom\",\"maps\"],          [\"Custom\",\"maps\"]]];\n    // what we copy from the default to the state | if state is empty\n    this.cpDefaultToStateFill=this.cpStateToDefaultFill;\n    this.cpDefaultToStateForce=[[[\"Database\",\"data\"],        [\"Database\",\"data\"]]];\n    // what we copy from the start default to the current default | if current default is empty\n    this.cpDefaultToDefaultFill=this.cpStateToDefaultFill;\n    //\n    this.loadDefault=function(state, response, callbacks ) {\n\tvar file=this.setup;\n\tif (state.Threshold.thrs !== undefined) { // defaults already loaded, execute callback...\n\t    state.File.next(state,\"\",callbacks);\n\t} else {\n\t    var path=state.Default.setupdir + state.Default.setup;\n\t    console.log(\"Default setup:\",path,file);\n\t    state.File.load(state,path,callbacks);\n\t}\n    };\n    this.makeStart=function(state,response,callbacks) {\n\tif (state.Default.start === undefined) {\n\t    state.Default.start={};\n\t    state.Utils.copyFill(state, state, state.Default.start, state.Default.cpStateToDefaultFill);\n\t    //console.log(\"Start:\",JSON.stringify(state.Layout.state));\n\t    //console.log(\"State:\",JSON.stringify(state.Layout.state));\n\t    //state.Default.save(state);\n\t}\n\t//console.log(\">>>>>>>>>>>State:\",JSON.stringify(state.Layout.state));\n\t//console.log(\">>>>>>>>>>>Start:\",JSON.stringify(state.Default.start.Layout.state));\n\tstate.File.next(state,\"\",callbacks);\n    };\n    this.processDefault=function(state,response,callbacks) {\n\tif (state.Threshold.thrs !== undefined) { // defaults already loaded, execute callback...\n\t    state.File.next(state,\"\",callbacks);\n\t} else {\n\t    try {\n\t\tvar setup = JSON.parse(response);\n\t    } catch (e) {\n\t\tconsole.log(\"Setup response:\",response);\n\t\talert(\"Default '\"+state.Default.setup+\"' contains Invalid SETUP:\"+e.name+\":\"+e.message);\n\t    }\n\t    if (setup !== undefined) {\n\t\t//console.log(\"State:\",JSON.stringify(state.Database));\n\t\t\n\t\tstate.Utils.copyForce(state, state.Default.current, state,                 state.Default.cpDefaultToStateForce);\n\t\tstate.Utils.copyFill(state, setup,                   state.Default.current, state.Default.cpSetupToDefaultFill);\n\t\tstate.Utils.copyForce(state,setup,                   state.Default.current, state.Default.cpSetupToDefaultForce);\n\t\tstate.Utils.copyFill(state, state.Default.current,  state,                 state.Default.cpDefaultToStateFill);\n\t\t\n\t\t//console.log(\"SETUP:\",JSON.stringify(setup.data));\n\t\t//console.log(\"Default:\",JSON.stringify(state.Default.current.Database));\n\t\t//console.log(\"State:\",JSON.stringify(state.Database));\n\t\t\n\t    };\n\t    // finally execute next callback\n\t    state.File.next(state,\"\",callbacks);\n\t}\n    };\n    this.resetSetup=function(state,response,callbacks) {\n\ttry {\n\t    var setup = JSON.parse(response);\n\t} catch (e) {\n\t    alert(\"Default '\"+state.Default.setup+\"' contains Invalid SETUP:\"+e.name+\":\"+e.message);\n\t}\n\tif (setup !== undefined && state.Default.start !== undefined) {\n\t    console.log(\"Reset state:\",JSON.stringify(state.Path));\n\t    state.Default.current={};\n\t    state.Utils.copyFill( state, setup,                  state.Default.current, state.Default.cpSetupToDefaultFill);\n\t    state.Utils.copyForce(state, setup,                  state.Default.current, state.Default.cpSetupToDefaultForce);\n\t    state.Utils.copyFill( state, state.Default.start,   state.Default.current, state.Default.cpDefaultToDefaultFill);\n\t    state.Utils.copyForce(state, state.Default.current, state,                 state.Default.cpDefaultToStateFill);\n\t    //console.log(\"SETUP:\",JSON.stringify(setup.tooltip));\n\t    //console.log(\"Default:\",JSON.stringify(state.Default.Path.tooltip));\n\t    state.Database.resetSetup(state);\n\t    console.log(\"Reset State:\",JSON.stringify(state.Path));\n\t};\n    };\n    this.getSetup=function(state) {\n\t// get updated information\n\tvar setup={};\n\tvar current={};\n\t//console.log(\"Current:\",JSON.stringify(state.Colors.colors));\n\tstate.Utils.copyFill(state,  state.Default.current, current, state.Default.cpDefaultToDefaultFill);\n\tstate.Utils.copyForce(state, state,                 current, state.Default.cpStateToDefaultForce);\n\tstate.Utils.copyForce(state, current,               setup,    state.Utils.invert(state.Default.cpSetupToDefaultForce));\n\tstate.Utils.copyFill(state,  current,               setup,    state.Utils.invert(state.Default.cpSetupToDefaultFill));\n\t//console.log(\"Current:\",JSON.stringify(state.Default.current));\n\t//console.log(\"Setup:\",JSON.stringify(current));\n\t//JSON.stringify(setup, null, \"   \");\n\treturn setup;\n    };\n    this.saveSetup=function(state) {\n\tvar setup=state.Utils.prettyJson(state.Default.getSetup(state));\n\tstate.Utils.save(setup,\"setup.json\",\"json\");\n    };\n    this.hasChanged=function(state,pth) {\n\tvar src=state.Default.start;\n\tvar trg=state;\n\tvar lenp=pth.length;\n\tfor (var ii=0;ii<lenp;ii++) {\n\t    var p=pth[ii];\n\t    if (src[p] !== undefined) {\n\t\tsrc=src[p];\n\t    } else {\n\t\t//console.log(\"Missing Defaults-key:\",\"'\"+p+\"'\",\n\t\t//\t    \"(path=\",JSON.stringify(pth),\") Default root=\",\n\t\t//\t    JSON.stringify(Object.keys(src)));\n\t\treturn true;\n\t    }\n\t    if (trg[p] !== undefined) {\n\t\ttrg=trg[p];\n\t    } else {\n\t\tconsole.log(\"Missing State-key:\",p,JSON.stringify(pth),JSON.stringify(Object.keys(trg)));\n\t\treturn true;\n\t    }\n\t}\n\tvar s=JSON.stringify(src);\n\tvar t=JSON.stringify(trg);\n\t//console.log(\"Checking:\\'\",JSON.stringify(pth),\"\\'\\n\\'\",s,\"\\'\\n\",t,\"->\",s!==t);\n\treturn s!==t;\n    };\n};\nexport default Default;\n"]},"metadata":{},"sourceType":"module"}