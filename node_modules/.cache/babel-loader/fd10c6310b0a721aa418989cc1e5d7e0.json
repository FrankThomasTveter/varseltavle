{"ast":null,"code":"//console.log(\"Loading PathLib.js\");\nfunction Path() {\n  this.keys = {\n    path: [],\n    // selected keys\n    other: [] // keys available for selection\n\n  };\n  this.other = {\n    table: [],\n    // table keys\n    rest: [] // keys available for selection\n\n  };\n  this.hidden = {\n    keys: [],\n    // hidden keys\n    values: {},\n    // hidden values\n    stored: {},\n    // stored values of hidden keys\n    level: undefined // hidden level\n\n  };\n  this.trash = []; // remaining valid keys\n\n  this.filter = {\n    val: {}\n  }; // initial filter for data...\n\n  this.select = {\n    val: {}\n  };\n  this.where = {};\n  this.ignore = [\"max\", \"min\", \"minlat\", \"minlon\", \"maxlat\", \"maxlon\"];\n  this.type = {\n    path: {\n      ityp: -1,\n      ptyp: \"path\"\n    },\n    eye: {\n      ityp: 0,\n      ptyp: \"eye\"\n    },\n    table: {\n      ityp: 1,\n      ptyp: \"table\"\n    },\n    rest: {\n      ityp: 2,\n      ptyp: \"rest\"\n    },\n    trash: {\n      ityp: 3,\n      ptyp: \"trash\"\n    },\n    trashRest: {\n      ityp: 4,\n      ptyp: \"trashRest\"\n    },\n    row: {\n      ityp: 5,\n      ptyp: \"row\"\n    },\n    col: {\n      ityp: 6,\n      ptyp: \"col\"\n    },\n    item: {\n      ityp: 7,\n      ptyp: \"item\"\n    }\n  };\n  this.order = undefined; // how to order data\t    \n\n  this.init = function (state) {\n    var par = \"Path\";\n    state.Utils.init(par, this);\n  };\n\n  this.cleanSelect = function (state) {\n    var pkeys = state.Path.keys.path;\n    var keys = Object.keys(state.Path.select.val);\n    var lenk = keys.length;\n\n    for (var ii = 0; ii < lenk; ii++) {\n      var key = keys[ii];\n\n      if (pkeys.indexOf(key) === -1) {\n        state.Path.select.val[key] = undefined;\n      }\n    }\n  };\n\n  this.setFilter = function (state) {\n    state.Path.cleanSelect(state);\n    this.filter.val = state.Utils.cp(state.Path.select.val);\n    state.Utils.pushUrl(state);\n    console.log(\"Setting filter.\");\n  };\n\n  this.getSnapshot = function (state) {\n    // store state\n    return {\n      keys: state.Utils.cp(state.Path.keys),\n      other: state.Utils.cp(state.Path.other),\n      trash: state.Utils.cp(state.Path.hidden),\n      select: state.Utils.cp(state.Path.select),\n      order: state.Utils.cp(state.Path.order)\n    };\n  };\n\n  this.setSnapshot = function (state, snapshot) {\n    // store state\n    state.Utils.restore(state.Path, snapshot);\n  };\n\n  this.toggleSelect = function (state, key, val) {\n    var vals = state.Path.select.val[key];\n    console.log(\"toggleSelect:\", key, val, JSON.stringify(vals));\n\n    if (vals !== undefined) {\n      var vid = vals.indexOf(val);\n\n      if (vid !== -1) {\n        // remove item\n        var src = vals.splice(vid, 1);\n\n        if (vals.length == 0) {\n          // can never be totally empty...\n          vals.push(\"MAX(\" + key + \")\");\n        }\n\n        state.Path.select.val[key] = vals;\n      } else {\n        state.Path.select.val[key].push(val); // add item\n      }\n\n      this.setWhere(state, key);\n      state.Show.showConfig(state);\n      console.log(\"Finally Vals:\", key, JSON.stringify(state.Path.select.val[key]));\n    }\n  };\n\n  this.setWhere = function (state, key) {\n    var where = this.parseWhere(state, key);\n    state.Path.where[key] = where;\n  };\n\n  this.parseWhere = function (state, key) {\n    var where = \"\";\n    var vals = state.Path.select.val[key];\n\n    if (vals === undefined) {\n      vals = [];\n    }\n\n    ;\n    var lenv = vals.length;\n\n    for (var ii = 0; ii < lenv; ii++) {\n      var val = vals[ii];\n\n      if (where !== \"\") {\n        where = where + \" OR \";\n      }\n\n      ;\n\n      if (val === \"null\") {\n        where = where + key + \" is NULL\";\n      } else if (val === \"MAX(\" + key + \")\") {\n        // this is a function\n        var parse = state.Utils.getMax(state.Database.values[key]); //console.log(\"parseWhere:\",key,parse,JSON.stringify(state.Database.values[key]));\n\n        if (parse === undefined) {\n          where = where + key + \" is NULL\";\n        } else {\n          where = where + key + \"='\" + parse + \"'\";\n        }\n\n        ;\n      } else if (val === \"MIN(\" + key + \")\") {\n        // this is a function\n        var parse = state.Utils.getMin(state.Database.values[key]);\n\n        if (parse === undefined) {\n          where = where + key + \" is NULL\";\n        } else {\n          where = where + key + \"='\" + parse + \"'\";\n        }\n\n        ;\n      } else {\n        where = where + key + \"='\" + val + \"'\";\n      }\n    }\n\n    ;\n    return where;\n  };\n\n  this.makeCnt = function (state, key) {\n    return state.Path.select.val[key].length;\n  };\n\n  this.getOrderValues = function (state, skey) {\n    if (state.Path.order === undefined) {\n      state.Path.order = {};\n    }\n\n    ;\n\n    if (state.Path.order[skey] === undefined) {\n      //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n      state.Path.order[skey] = state.Utils.cp(state.Matrix.values[skey]);\n    } else {\n      var vals = state.Matrix.values[skey];\n      var plen = vals;\n\n      for (var ii = 0; ii < plen; ii++) {\n        var val = vals[ii];\n\n        if (state.Path.order[skey].indexOf(val) === -1) {\n          state.Path.order[skey].push(val);\n        }\n      }\n\n      ;\n    }\n\n    ;\n    return state.Path.order[skey];\n  };\n\n  this.bumpOrder = function (state, skey, value) {\n    console.log(\"Bump order:\", skey, value);\n    var vid = state.Path.order[skey].indexOf(value);\n\n    if (vid !== -1 && vid > 0) {\n      var src = state.Path.order[skey].splice(vid, 1); // remove from array   \n\n      state.Utils.spliceArray(state.Path.order[skey], vid - 1, 0, src);\n    }\n\n    ;\n    state.Show.showConfig(state);\n  };\n\n  this.makePath = function (state) {\n    // note that not all keys are present in the data!\n    //console.log(\"Entering makepath.\",JSON.stringify(this.keys));\n    var ii, key;\n    var pathSet = [];\n\n    if (this.keys.path === undefined) {\n      this.keys.path = [];\n    }\n\n    ;\n\n    if (this.keys.other === undefined) {\n      this.keys.other = [];\n    }\n\n    ;\n\n    if (this.trash === undefined) {\n      this.trash = [];\n    }\n\n    ;\n\n    if (this.keys.path.length > 0 || this.keys.other.length > 0 || this.trash.length > 0) {\n      // remove duplicates\n      //console.log(\"Filtering.\");\n      var olen;\n      this.keys.path = this.keys.path.filter(this.Unique);\n      this.keys.other = this.keys.other.filter(this.Unique);\n      this.trash = this.trash.filter(this.Unique); //console.log(\"setup:\",JSON.stringify(setup));\n      //console.log(\"Remove invalid keys from path.\");\n      // remove invalid keys from path\n\n      var plen = this.keys.path.length;\n\n      for (ii = 0; ii < plen; ii++) {\n        key = this.keys.path[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.keys.path.splice(ii, 1);\n          ii = ii - 1;\n          plen = plen - 1;\n        }\n      } //console.log(\"Remove invalid keys from other.\");\n      // remove invalid keys from other\n\n\n      olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.other.rest.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      } //console.log(\"Remove invalid keys from trash.\");\n      // remove invalid keys from trash\n\n\n      olen = this.trash.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.trash[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.hidden.keys.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      } //console.log(\"Update trash with keys.\");\n      // we already have a path, update trash with new keys\n\n\n      for (key in state.Database.keyCnt) {\n        if (this.keys.path.indexOf(key) === -1 && this.keys.other.indexOf(key) === -1 && this.trash.indexOf(key) === -1) {\n          pathSet[key] = \"trash\";\n          this.select.val[key] = \"\";\n          this.where[key] = \"\";\n          this.trash.push(key);\n        }\n      }\n    } else {\n      // new path...\n      //console.log(\"New path\");\n      // ...define this.select.val for all keys in input data\n      for (key in state.Database.keyCnt) {\n        pathSet[key] = \"data\";\n      }\n\n      ;\n      this.keys.path = [];\n      this.other.table = [];\n      this.other.rest = [];\n      this.hidden.keys = [];\n      this.hidden.values = {};\n      this.select.val = {}; // no values are set so far\n\n      this.where = {}; //console.log(\"Copy default trash keys.\",JSON.stringify(state.Default.trash));\n      // copy default trash keys (that are used) to trash...\n\n      if (state.Default.trash !== undefined) {\n        var tlen = state.Default.trash.length;\n\n        for (ii = 0; ii < tlen; ii++) {\n          key = state.Default.trash[ii];\n\n          if (pathSet[key] !== undefined) {\n            if (state.Utils.missing(this.trash, key)) {\n              this.trash.push(key);\n            }\n\n            ;\n\n            if (state.Utils.missing(this.hidden.keys, key)) {\n              this.hidden.keys.push(key);\n            }\n\n            ;\n            pathSet[key] = undefined; // ignore key from now on...\n          }\n        } //console.log(\"Pathset:\",JSON.stringify(pathSet),JSON.stringify(state.Default.trash));\n\n      }\n\n      ; //console.log(\"Copy default other keys.\");\n      //console.log(\"Added trash:\",JSON.stringify(setup));\n      // copy default other keys (that are used) to other...\n\n      if (state.Default.other !== undefined) {\n        var klen = state.Default.other.length;\n\n        for (ii = 0; ii < klen; ii++) {\n          key = state.Default.other[ii];\n\n          if (pathSet[key] !== undefined) {\n            // key not present in input data\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ;\n            pathSet[key] = \"found\";\n          }\n        }\n      } //console.log(\"Add missing keys.\");\n      // add missing keys to path\n\n\n      for (key in state.Database.keyCnt) {\n        if (state.Utils.missing(this.trash, key)) {\n          if (pathSet[key] === \"data\") {\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ; //console.log(\"Added key:\",key);\n\n            pathSet[key] = \"added\";\n          }\n        }\n\n        ;\n      }\n\n      ; // add undefined values in values\n      // for (key in state.Database.keyCnt) {\n      //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n      // \tstate.Database.values[key].push(undefined);\n      //     }\n      // }\n      // // sort sub-path according to count...\n      // this.keys.other=this.keys.other.sort(function(state,a, b) {\n      //     if (state.Database.values[a]  === undefined) {\n      // \treturn -1;\n      //     } else if (state.Database.values[b]  === undefined) {\n      // \treturn 1;\n      //     } else {\n      // \treturn state.Database.values[a].length - state.Database.values[b].length\n      //     }\n      // });\n      //console.log(\"Push other keys to table and rest.\");\n\n      var glen = this.keys.other.length;\n\n      for (ii = 0; ii < glen; ii++) {\n        key = this.keys.other[ii];\n\n        if (ii < 2) {\n          this.other.table.push(key);\n        } else {\n          this.other.rest.push(key);\n        }\n      }\n    }\n\n    state.Navigate.reset(state); //console.log(\"keys:\",JSON.stringify(state.Database.values));\n    //console.log(\"Completed makepath.\");\n  };\n\n  this.getIndex = function (state, trg) {\n    return this.keys.path.indexOf(trg);\n  };\n\n  this.exportAllKeys = function (state) {\n    // export keys from \"all\" to \"rest\"\n    this.other.table = [];\n    this.other.rest = [];\n    var jj = 0;\n    var key, ii;\n\n    if (this.keys.other !== undefined) {\n      var olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii];\n\n        if (state.Matrix.keyCnt[key] !== undefined && state.Matrix.keyCnt[key] > 0) {\n          if (jj < 2) {\n            this.other.table.push(key);\n            jj = jj + 1;\n          } else {\n            this.other.rest.push(key);\n          }\n        }\n      }\n\n      ;\n    }\n\n    this.hidden.keys = [];\n\n    if (this.trash !== undefined) {\n      var tlen = this.trash.length;\n\n      for (ii = 0; ii < tlen; ii++) {\n        key = this.trash[ii];\n\n        if (this.ignore.indexOf(key) === -1) {\n          //if (state.Matrix.keyCnt[key] !== undefined) {\n          this.hidden.keys.push(key);\n        }\n      }\n    }\n\n    ; //this.sortTableKeys(state);\n    //console.log(\"Exported:\",JSON.stringify(this.other));\n  };\n\n  this.checkTableKeys = function (state) {\n    var ret = [];\n    var where = state.Database.getWhere(state);\n    state.Matrix.initKeyCnt(state);\n    state.Matrix.mapKeyCnt(state, where, 0, state.Path.keys.other); // possible table keys (no undefined)\n\n    state.Path.exportAllKeys(state); //console.log(\"this.checkTableKeys Entering.\",JSON.stringify(setup));\n\n    var keys = state.Path.other.table;\n    var bdone = !keys.length < 2;\n    var iinew = -1;\n    var jjnew = -1;\n    var order = state.Utils.cp(state.Path.keys.other);\n\n    do {\n      //console.log(\"this.checkTableKeys Looping.\");\n      if (keys.length < 2) {\n        bdone = true;\n      } else {\n        // check for number of column values\n        var docs = state.Database.getCntDocs(state, where, state.Path.other.table); // current table keys\n\n        var slen = state.Path.other.table.length;\n        var hits = {};\n        var maxh = {};\n        var kval = {};\n        var ii, jj, key, val; // loop over docs\n\n        var dlen = docs.length;\n\n        for (ii = 0; ii < dlen; ii++) {\n          var doc = docs[ii]; //console.log(\"Trash doc=\",ii,JSON.stringify(doc));\n\n          for (jj = 0; jj < slen; jj++) {\n            key = state.Path.other.table[jj];\n\n            if (doc[key] !== undefined) {\n              val = doc[key];\n              kval[key] = val;\n\n              if (hits[key] === undefined) {\n                hits[key] = {};\n              }\n\n              hits[key][val] = 1 + (hits[key][val] || 0); //console.log(\"Found:\",key,val,hits[key][val]);\n\n              if (hits[key][val] > (maxh[key] || 0)) {\n                maxh[key] = hits[key][val];\n              }\n            }\n          }\n        } //console.log(\"this.checkTableKeys Checking.\",dlen);\n\n\n        var rm = {};\n        bdone = true; //console.log(\"Max:\",JSON.stringify(maxh));\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n          rm[key] = \"\"; //console.log(\"Checking:\",key,JSON.stringify(maxh));\n\n          if (maxh[key] !== undefined) {\n            if (maxh[key] === 1) {\n              rm[key] = \"other\";\n            } else if (maxh[key] === dlen) {\n              // remove key from table\n              rm[key] = \"self\";\n            }\n          }\n        }\n\n        var rmthis = {};\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n\n          if (rm[key] === \"other\") {\n            for (var kk = 0; kk < slen; kk++) {\n              var rkey = state.Path.other.table[kk];\n\n              if (kk !== jj) {\n                rmthis[rkey] = \"trash\";\n                iinew = kk;\n              }\n            }\n          } else if (rm[key] === \"self\") {\n            rmthis[key] = \"path\";\n            jjnew = jj;\n          }\n        }\n\n        if (iinew !== -1 && jjnew !== -1) {\n          iinew = -1;\n          jjnew = -1;\n        } //console.log(\"Rm:\",JSON.stringify(rmthis),JSON.stringify(rm));\n\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n\n          if (rmthis[key] !== undefined) {\n            bdone = false;\n            var sin = state.Path.keys.other.indexOf(key);\n\n            if (sin !== -1) {\n              if (jj === 0) {// flipTable\n                //console.log(\"Flipped table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n              } else {//console.log(\"Not Flipping table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n                }\n\n              ;\n              var src = state.Path.keys.other.splice(sin, 1); // remove from path\n\n              if (rmthis[key] === \"trash\") {\n                // trash key\n                //console.log(\"### Trashing:\",key);\n                state.Path.trash = state.Path.trash.concat(src); // last path position\n\n                ret = ret.concat(src);\n              } else if (rmthis[key] === \"path\") {\n                // add to path\n                // add to path...\n                val = kval[key]; //console.log(\"### Pathing:\",key,val);\n\n                state.Path.keys.path = state.Path.keys.path.concat(src); // last path position\n\n                state.Path.select.val[key] = [val];\n                state.Path.where[key] = key + '=\"' + val + '\"';\n                this.order[key] = order; //this.last.flip[key]=this.getFlip(state);\n              }\n\n              ;\n            }\n          }\n        }\n\n        if (!bdone) {\n          state.Path.exportAllKeys(state);\n        }\n      }\n\n      ;\n    } while (!bdone); //console.log(\"this.checkTableKeys Done.\",JSON.stringify(state.Path.other.table));\n\n\n    return ret;\n  }; // get X-priority, {colx,coly1,coly2...)\n\n\n  this.sortTableKeys = function (state) {\n    // make priority index\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr); // sort the array according to priority\n\n    this.other.table = arr.sort(function (a, b) {\n      if (a === \"\") {\n        return 1;\n      } else if (b === \"\") {\n        return -1;\n      } else if (pri[a] < pri[b]) {\n        return 1;\n      } else if (pri[a] > pri[b]) {\n        return -1;\n      } else {\n        return 0;\n      }\n    }); //console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n    //\t\" Pri:\",JSON.stringify(state.Layout.priority),\n    //\t\" P:\",JSON.stringify(pri));\n\n    return;\n  };\n\n  this.keyVal = function (state, key) {\n    if (this.select.val[key] !== undefined && this.select.val[key] !== null && this.select.val[key] !== \"\") {\n      return this.select.val[key];\n    } else {\n      return;\n    }\n  };\n\n  this.keyValOk = function (state, val) {\n    var ok = true;\n\n    if (this.hidden.level === undefined) {// no level threshold defined, val is ok\n    } else if (state.Matrix.levCnt[val] === undefined) {\n      // val does not occur, how strange...\n      ok = false; //console.log(\"keyValOk -- no levcnt or level\",val);\n    } else {\n      // val occurs and level threshold defined...\n      ok = false;\n\n      for (var lev in state.Matrix.levCnt[val]) {\n        if (this.hidden.level === null && lev !== null) {\n          ok = true;\n        } else if (this.hidden.level === -1 && lev !== null && lev !== -1) {\n          ok = true;\n        } else if (this.hidden.level >= 0 && lev !== null && lev !== -1 && lev < this.hidden.level) {\n          ok = true;\n        } //console.log(\"Checking \",val,lev,this.hidden.level,\"=>\",ok);\n\n      } //if (! ok) {\n      //\tconsole.log(\"keyValOk -- no valid level\",val,JSON.stringify(state.Matrix.levCnt[val]),this.hidden.level);\n      //}\n\n    }\n\n    return ok;\n  };\n\n  this.makeOrder = function (state, typ, order) {\n    // rearrange setup according to order...\n    if (order !== undefined) {\n      var buff = [];\n\n      for (var kk = 0; kk < order.length; kk++) {\n        if (order[kk] !== \"\") {\n          var sin = this.keys[typ].indexOf(order[kk]);\n\n          if (sin !== -1) {\n            var src = this.keys[typ].splice(sin, 1); // remove from path\n\n            buff = buff.concat(src);\n          }\n        }\n      }\n\n      state.Utils.spliceArray(this.keys[typ], 0, 0, buff);\n    }\n  };\n\n  this.moveKey = function (state, styp, skey, ttyp, tid) {\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, 1); // remove from path\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKeys = function (state, styp, skeys, ttyp, tid) {\n    var len = skeys.length;\n\n    for (var ss = 0; ss < len; ss++) {\n      var skey = skeys[ss];\n      var sid = this.keys[styp].indexOf(skey);\n\n      if (sid !== -1) {\n        var src = this.keys[styp].splice(sid, 1); // remove from path\n\n        if (tid === undefined || tid === -1) {\n          this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n        } else {\n          state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n        }\n      }\n    }\n  };\n\n  this.swapTableKey = function (state, skey, tkey) {\n    var sid = this.other.table.indexOf(skey);\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== sid && this.other.table.length > 1) {\n      var tin2 = this.keys.other.indexOf(this.other.table[1]);\n      var tkey2 = this.keys.other.splice(tin2, 1); // remove from array\n\n      state.Utils.spliceArray(this.keys.other, 0, 0, tkey2); //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.delTableKey = function (state, key) {\n    var secondkey;\n    var secondind;\n    var sid = this.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      var sin = this.other.table.indexOf(key);\n      var save = sin === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      this.pullKey(state, \"other\", key);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return sin;\n    }\n  };\n\n  this.moveTableKey = function (state, skey, ttyp, tid) {\n    var sid = this.keys.other.indexOf(skey);\n\n    if (sid !== -1) {\n      //var sin=\n      this.delTableKey(state, skey);\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(skey); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, skey);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKey2Table = function (state, styp, skey, tkey) {\n    //console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n    var tid = this.keys.other.indexOf(tkey);\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (tid !== -1 && sid !== -1 && skey !== tkey) {\n      // exists and is not the same\n      this.keys[styp][sid] = tkey;\n      this.keys.other[tid] = skey;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash2Table = function (state, tkey) {\n    var secondkey;\n    var secondind;\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== -1) {\n      var save = tid === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      ;\n      var tin = this.keys.other.indexOf(tkey);\n      this.moveTrash(state, \"other\", tin + 1);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash = function (state, ttyp, tin) {\n    state.Utils.spliceArray(this.keys[ttyp], tin, 0, this.trash);\n    this.trash = [];\n  };\n\n  this.moveAllKey = function (state, styp, skey, ttyp, tid) {\n    var lenp = this.keys[styp].length;\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, lenp - sid);\n      state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveAllFirst = function (state, ttyp, tin) {\n    var tlen = this.keys[ttyp].length;\n    var src = this.keys[ttyp].splice(tin, tlen - tin);\n    state.Utils.spliceArray(this.keys[ttyp], 0, 0, src);\n  };\n\n  this.filterKeys = function (state, arr) {\n    var out = [];\n    var alen = arr.length;\n\n    for (var ii = 0; ii < alen; ii++) {\n      var val = arr[ii];\n\n      if (this.keyValOk(state, val)) {\n        out.push(val);\n      }\n    } //console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\n\n    return out;\n  };\n\n  this.pullArrayKey = function (state, array, key) {\n    var sin = array.indexOf(key);\n\n    if (sin !== -1) {\n      //var src=\n      array.splice(sin, 1); // remove from path\n    }\n\n    ;\n    return sin;\n  }; //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n\n\n  this.getColKey = function (state) {\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      return \"_lon\";\n    } else if (pri[this.other.table[0]] >= pri[this.other.table[1]]) {\n      return this.other.table[0];\n    } else {\n      return this.other.table[1];\n    }\n  };\n\n  this.getRowKey = function (state) {\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      return \"_lat\";\n    } else if (pri[this.other.table[0]] >= pri[this.other.table[1]]) {\n      return this.other.table[1];\n    } else {\n      return this.other.table[0];\n    }\n  };\n\n  this.pushKey = function (state, typ, key, ind) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n    }\n  };\n\n  this.pullKey = function (state, typ, key) {\n    var sin = this.keys[typ].indexOf(key);\n\n    if (sin !== -1) {\n      var src = this.keys[typ].splice(sin, 1); // remove from path\n\n      if (src !== key) {\n        console.log(\"System error:\", src, key);\n      }\n\n      return sin;\n    }\n\n    ;\n  };\n\n  this.pushColKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 0, 0, key);\n    }\n  };\n\n  this.pushRowKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 1, 0, key);\n    }\n  };\n\n  this.checkNewPath = function (state, styp, skey) {\n    // check if values are defined for path\n    var ok, ii;\n    var sid = this.keys.path.indexOf(skey);\n\n    if (styp === this.type.table.ptyp) {\n      ok = true;\n      var lent = this.other.table.length - 1;\n\n      if (sid !== undefined) {\n        lent = sid + 1;\n      }\n\n      ;\n\n      for (ii = 0; ii <= lent; ii++) {\n        var key = this.other.table[ii];\n\n        if (this.keyVal(state, key) === undefined) {\n          ok = false;\n        }\n      }\n    } else if (styp === this.type.rest.ptyp) {\n      ok = this.checkNewPath(state, this.type.table.ptyp);\n\n      if (ok) {\n        var lenr = this.other.rest.length - 1;\n\n        if (sid !== undefined) {\n          lenr = sid + 1;\n        }\n\n        ;\n\n        for (ii = 0; ii <= lenr; ii++) {\n          key = this.other.rest[ii];\n\n          if (this.keyVal(state, key) === undefined) {\n            ok = false;\n          }\n        }\n      }\n    }\n\n    return ok;\n  }; //values[key]=values[key].filter(this.Unique);\n\n\n  this.Unique = function (value, index, self) {\n    return self.indexOf(value) === index;\n  };\n}\n\n;\nexport default Path;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/PathLib.js"],"names":["Path","keys","path","other","table","rest","hidden","values","stored","level","undefined","trash","filter","val","select","where","ignore","type","ityp","ptyp","eye","trashRest","row","col","item","order","init","state","par","Utils","cleanSelect","pkeys","Object","lenk","length","ii","key","indexOf","setFilter","cp","pushUrl","console","log","getSnapshot","setSnapshot","snapshot","restore","toggleSelect","vals","JSON","stringify","vid","src","splice","push","setWhere","Show","showConfig","parseWhere","lenv","parse","getMax","Database","getMin","makeCnt","getOrderValues","skey","Matrix","plen","bumpOrder","value","spliceArray","makePath","pathSet","olen","Unique","keyCnt","Default","tlen","missing","klen","glen","Navigate","reset","getIndex","trg","exportAllKeys","jj","checkTableKeys","ret","getWhere","initKeyCnt","mapKeyCnt","bdone","iinew","jjnew","docs","getCntDocs","slen","hits","maxh","kval","dlen","doc","rm","rmthis","kk","rkey","sin","concat","sortTableKeys","arr","pri","Layout","getPriorityIndex","sort","a","b","keyVal","keyValOk","ok","levCnt","lev","makeOrder","typ","buff","moveKey","styp","ttyp","tid","sid","moveKeys","skeys","len","ss","swapTableKey","tkey","tin2","tkey2","delTableKey","secondkey","secondind","save","pullKey","pushKey","moveTableKey","moveKey2Table","moveTrash2Table","tin","moveTrash","moveAllKey","lenp","moveAllFirst","filterKeys","out","alen","pullArrayKey","array","getColKey","getLayoutMode","code","layout","Map","getRowKey","ind","pushColKey","pushRowKey","checkNewPath","lent","lenr","index","self"],"mappings":"AAAA;AAEA,SAASA,IAAT,GAAgB;AACZ,OAAKC,IAAL,GAAU;AAACC,IAAAA,IAAI,EAAC,EAAN;AAAU;AAChBC,IAAAA,KAAK,EAAC,EADA,CACG;;AADH,GAAV;AAGA,OAAKA,KAAL,GAAW;AAACC,IAAAA,KAAK,EAAC,EAAP;AAAW;AACxBC,IAAAA,IAAI,EAAC,EADQ,CACH;;AADG,GAAX;AAGA,OAAKC,MAAL,GAAY;AAACL,IAAAA,IAAI,EAAC,EAAN;AAAkB;AAC/BM,IAAAA,MAAM,EAAC,EADM;AACI;AACjBC,IAAAA,MAAM,EAAC,EAFM;AAEI;AACjBC,IAAAA,KAAK,EAACC,SAHO,CAGI;;AAHJ,GAAZ;AAKA,OAAKC,KAAL,GAAW,EAAX,CAZY,CAYI;;AAChB,OAAKC,MAAL,GAAY;AAACC,IAAAA,GAAG,EAAC;AAAL,GAAZ,CAbY,CAaU;;AACtB,OAAKC,MAAL,GAAY;AAACD,IAAAA,GAAG,EAAC;AAAL,GAAZ;AACA,OAAKE,KAAL,GAAW,EAAX;AACA,OAAKC,MAAL,GAAY,CAAC,KAAD,EAAO,KAAP,EAAa,QAAb,EAAsB,QAAtB,EAA+B,QAA/B,EAAwC,QAAxC,CAAZ;AACA,OAAKC,IAAL,GAAY;AACff,IAAAA,IAAI,EAAQ;AAACgB,MAAAA,IAAI,EAAC,CAAC,CAAP;AAASC,MAAAA,IAAI,EAAC;AAAd,KADG;AAEfC,IAAAA,GAAG,EAAS;AAACF,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KAFG;AAGff,IAAAA,KAAK,EAAO;AAACc,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KAHG;AAIfd,IAAAA,IAAI,EAAQ;AAACa,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KAJG;AAKfR,IAAAA,KAAK,EAAO;AAACO,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KALG;AAMfE,IAAAA,SAAS,EAAG;AAACH,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KANG;AAOfG,IAAAA,GAAG,EAAS;AAACJ,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KAPG;AAQfI,IAAAA,GAAG,EAAS;AAACL,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd,KARG;AASfK,IAAAA,IAAI,EAAQ;AAACN,MAAAA,IAAI,EAAC,CAAN;AAASC,MAAAA,IAAI,EAAC;AAAd;AATG,GAAZ;AAWA,OAAKM,KAAL,GAAWf,SAAX,CA5BY,CA4BU;;AACtB,OAAKgB,IAAL,GAAU,UAASC,KAAT,EAAe;AAC5B,QAAIC,GAAG,GAAC,MAAR;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYH,IAAZ,CAAiBE,GAAjB,EAAqB,IAArB;AACI,GAHD;;AAIA,OAAKE,WAAL,GAAiB,UAASH,KAAT,EAAgB;AACpC,QAAII,KAAK,GAACJ,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBC,IAA1B;AACA,QAAID,IAAI,GAAC+B,MAAM,CAAC/B,IAAP,CAAY0B,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAA9B,CAAT;AACA,QAAIoB,IAAI,GAAChC,IAAI,CAACiC,MAAd;;AACA,SAAK,IAAIC,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACF,IAAjB,EAAsBE,EAAE,EAAxB,EAA4B;AACxB,UAAIC,GAAG,GAACnC,IAAI,CAACkC,EAAD,CAAZ;;AACA,UAAIJ,KAAK,CAACM,OAAN,CAAcD,GAAd,MAAuB,CAAC,CAA5B,EAA+B;AAClCT,QAAAA,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,IAA2B1B,SAA3B;AACI;AACJ;AACG,GAVD;;AAWA,OAAK4B,SAAL,GAAe,UAASX,KAAT,EAAgB;AAClCA,IAAAA,KAAK,CAAC3B,IAAN,CAAW8B,WAAX,CAAuBH,KAAvB;AACA,SAAKf,MAAL,CAAYC,GAAZ,GAAgBc,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAjC,CAAhB;AACAc,IAAAA,KAAK,CAACE,KAAN,CAAYW,OAAZ,CAAoBb,KAApB;AACAc,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ;AACI,GALD;;AAMA,OAAKC,WAAL,GAAiB,UAAShB,KAAT,EAAgB;AAAE;AACtC,WAAO;AAAC1B,MAAAA,IAAI,EAAC0B,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWC,IAA1B,CAAN;AACNE,MAAAA,KAAK,EAACwB,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWG,KAA1B,CADA;AAENQ,MAAAA,KAAK,EAACgB,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWM,MAA1B,CAFA;AAGNQ,MAAAA,MAAM,EAACa,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWc,MAA1B,CAHD;AAINW,MAAAA,KAAK,EAACE,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWyB,KAA1B;AAJA,KAAP;AAKI,GAND;;AAOA,OAAKmB,WAAL,GAAiB,UAASjB,KAAT,EAAekB,QAAf,EAAyB;AAAE;AAC/ClB,IAAAA,KAAK,CAACE,KAAN,CAAYiB,OAAZ,CAAoBnB,KAAK,CAAC3B,IAA1B,EAA+B6C,QAA/B;AACI,GAFD;;AAGA,OAAKE,YAAL,GAAkB,UAASpB,KAAT,EAAeS,GAAf,EAAmBvB,GAAnB,EAAwB;AAC7C,QAAImC,IAAI,GAACrB,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,CAAT;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BN,GAA5B,EAAgCvB,GAAhC,EAAoCoC,IAAI,CAACC,SAAL,CAAeF,IAAf,CAApC;;AACA,QAAIA,IAAI,KAAKtC,SAAb,EAAwB;AACpB,UAAIyC,GAAG,GAACH,IAAI,CAACX,OAAL,CAAaxB,GAAb,CAAR;;AACA,UAAIsC,GAAG,KAAK,CAAC,CAAb,EAAgB;AAAG;AACtB,YAAIC,GAAG,GAACJ,IAAI,CAACK,MAAL,CAAYF,GAAZ,EAAgB,CAAhB,CAAR;;AACA,YAAIH,IAAI,CAACd,MAAL,IAAa,CAAjB,EAAoB;AAAE;AAClBc,UAAAA,IAAI,CAACM,IAAL,CAAU,SAAOlB,GAAP,GAAW,GAArB;AACH;;AACDT,QAAAA,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,IAA2BY,IAA3B;AACI,OAND,MAMO;AACVrB,QAAAA,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,EAA2BkB,IAA3B,CAAgCzC,GAAhC,EADU,CAC4B;AAClC;;AACD,WAAK0C,QAAL,CAAc5B,KAAd,EAAoBS,GAApB;AACAT,MAAAA,KAAK,CAAC6B,IAAN,CAAWC,UAAX,CAAsB9B,KAAtB;AACAc,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BN,GAA5B,EAAgCa,IAAI,CAACC,SAAL,CAAevB,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,CAAf,CAAhC;AACH;AACG,GAlBD;;AAmBA,OAAKmB,QAAL,GAAc,UAAS5B,KAAT,EAAeS,GAAf,EAAoB;AACrC,QAAIrB,KAAK,GAAC,KAAK2C,UAAL,CAAgB/B,KAAhB,EAAsBS,GAAtB,CAAV;AACAT,IAAAA,KAAK,CAAC3B,IAAN,CAAWe,KAAX,CAAiBqB,GAAjB,IAAsBrB,KAAtB;AACI,GAHD;;AAIA,OAAK2C,UAAL,GAAgB,UAAS/B,KAAT,EAAeS,GAAf,EAAoB;AACvC,QAAIrB,KAAK,GAAC,EAAV;AACA,QAAIiC,IAAI,GAACrB,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,CAAT;;AACA,QAAIY,IAAI,KAAKtC,SAAb,EAAwB;AAACsC,MAAAA,IAAI,GAAC,EAAL;AAAS;;AAAA;AAClC,QAAIW,IAAI,GAACX,IAAI,CAACd,MAAd;;AACA,SAAK,IAAIC,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACwB,IAAjB,EAAsBxB,EAAE,EAAxB,EAA4B;AACxB,UAAItB,GAAG,GAACmC,IAAI,CAACb,EAAD,CAAZ;;AACA,UAAIpB,KAAK,KAAK,EAAd,EAAkB;AAAEA,QAAAA,KAAK,GAACA,KAAK,GAAG,MAAd;AAAsB;;AAAA;;AAC1C,UAAIF,GAAG,KAAK,MAAZ,EAAoB;AACvBE,QAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,UAAtB;AACI,OAFD,MAEO,IAAIvB,GAAG,KAAG,SAAOuB,GAAP,GAAW,GAArB,EAA0B;AAAE;AACtC,YAAIwB,KAAK,GAACjC,KAAK,CAACE,KAAN,CAAYgC,MAAZ,CAAmBlC,KAAK,CAACmC,QAAN,CAAevD,MAAf,CAAsB6B,GAAtB,CAAnB,CAAV,CADoC,CAEpC;;AACA,YAAIwB,KAAK,KAAKlD,SAAd,EAAyB;AACrBK,UAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,UAAtB;AACH,SAFD,MAEO;AACHrB,UAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,IAAd,GAAmBwB,KAAnB,GAAyB,GAAjC;AACH;;AAAA;AACG,OARM,MAQA,IAAI/C,GAAG,KAAG,SAAOuB,GAAP,GAAW,GAArB,EAA0B;AAAE;AACtC,YAAIwB,KAAK,GAACjC,KAAK,CAACE,KAAN,CAAYkC,MAAZ,CAAmBpC,KAAK,CAACmC,QAAN,CAAevD,MAAf,CAAsB6B,GAAtB,CAAnB,CAAV;;AACA,YAAIwB,KAAK,KAAKlD,SAAd,EAAyB;AACrBK,UAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,UAAtB;AACH,SAFD,MAEO;AACHrB,UAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,IAAd,GAAmBwB,KAAnB,GAAyB,GAAjC;AACH;;AAAA;AACG,OAPM,MAOA;AACV7C,QAAAA,KAAK,GAAGA,KAAK,GAAGqB,GAAR,GAAc,IAAd,GAAmBvB,GAAnB,GAAuB,GAA/B;AACI;AACJ;;AAAA;AACD,WAAOE,KAAP;AACI,GA9BD;;AA+BA,OAAKiD,OAAL,GAAa,UAASrC,KAAT,EAAeS,GAAf,EAAoB;AACpC,WAAOT,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,EAA2BF,MAAlC;AACI,GAFD;;AAGA,OAAK+B,cAAL,GAAoB,UAAStC,KAAT,EAAeuC,IAAf,EAAoB;AACpC,QAAIvC,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,KAAqBf,SAAzB,EAAoC;AAACiB,MAAAA,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,GAAiB,EAAjB;AAAqB;;AAAA;;AAC1D,QAAIE,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,MAA2BxD,SAA/B,EAA0C;AACtC;AACAiB,MAAAA,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,IAAuBvC,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAACwC,MAAN,CAAa5D,MAAb,CAAoB2D,IAApB,CAAf,CAAvB;AACH,KAHD,MAGO;AACV,UAAIlB,IAAI,GAAGrB,KAAK,CAACwC,MAAN,CAAa5D,MAAb,CAAoB2D,IAApB,CAAX;AACA,UAAIE,IAAI,GAAGpB,IAAX;;AACA,WAAK,IAAIb,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGiC,IAAtB,EAA4BjC,EAAE,EAA9B,EAAkC;AACrC,YAAItB,GAAG,GAACmC,IAAI,CAACb,EAAD,CAAZ;;AACA,YAAIR,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,EAAuB7B,OAAvB,CAA+BxB,GAA/B,MAAsC,CAAC,CAA3C,EAA8C;AAC1Cc,UAAAA,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,EAAuBZ,IAAvB,CAA4BzC,GAA5B;AACH;AACG;;AAAA;AACJ;;AAAA;AACD,WAAOc,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,CAAP;AACI,GAhBD;;AAiBA,OAAKG,SAAL,GAAe,UAAS1C,KAAT,EAAeuC,IAAf,EAAoBI,KAApB,EAA2B;AAC7C7B,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA0BwB,IAA1B,EAA+BI,KAA/B;AACA,QAAInB,GAAG,GAACxB,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,EAAuB7B,OAAvB,CAA+BiC,KAA/B,CAAR;;AACA,QAAInB,GAAG,KAAK,CAAC,CAAT,IAAcA,GAAG,GAAG,CAAxB,EAA2B;AACvB,UAAIC,GAAG,GAACzB,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,EAAuBb,MAAvB,CAA8BF,GAA9B,EAAmC,CAAnC,CAAR,CADuB,CACwB;;AAC/CxB,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB5C,KAAK,CAAC3B,IAAN,CAAWyB,KAAX,CAAiByC,IAAjB,CAAxB,EAA+Cf,GAAG,GAAC,CAAnD,EAAqD,CAArD,EAAuDC,GAAvD;AACH;;AAAA;AACDzB,IAAAA,KAAK,CAAC6B,IAAN,CAAWC,UAAX,CAAsB9B,KAAtB;AACI,GARD;;AASA,OAAK6C,QAAL,GAAc,UAAS7C,KAAT,EAAgB;AAAE;AACnC;AACA,QAAIQ,EAAJ,EAAOC,GAAP;AACA,QAAIqC,OAAO,GAAC,EAAZ;;AACA,QAAI,KAAKxE,IAAL,CAAUC,IAAV,KAAmBQ,SAAvB,EAAkC;AAAC,WAAKT,IAAL,CAAUC,IAAV,GAAe,EAAf;AAAmB;;AAAA;;AACtD,QAAI,KAAKD,IAAL,CAAUE,KAAV,KAAoBO,SAAxB,EAAmC;AAAC,WAAKT,IAAL,CAAUE,KAAV,GAAgB,EAAhB;AAAoB;;AAAA;;AACxD,QAAI,KAAKQ,KAAL,KAAeD,SAAnB,EAA8B;AAAC,WAAKC,KAAL,GAAW,EAAX;AAAe;;AAAA;;AAC9C,QAAI,KAAKV,IAAL,CAAUC,IAAV,CAAegC,MAAf,GAAwB,CAAxB,IACA,KAAKjC,IAAL,CAAUE,KAAV,CAAgB+B,MAAhB,GAAyB,CADzB,IAEA,KAAKvB,KAAL,CAAWuB,MAAX,GAAoB,CAFxB,EAE2B;AACvB;AACA;AACA,UAAIwC,IAAJ;AACA,WAAKzE,IAAL,CAAUC,IAAV,GAAe,KAAKD,IAAL,CAAUC,IAAV,CAAeU,MAAf,CAAsB,KAAK+D,MAA3B,CAAf;AACA,WAAK1E,IAAL,CAAUE,KAAV,GAAgB,KAAKF,IAAL,CAAUE,KAAV,CAAgBS,MAAhB,CAAuB,KAAK+D,MAA5B,CAAhB;AACA,WAAKhE,KAAL,GAAW,KAAKA,KAAL,CAAWC,MAAX,CAAkB,KAAK+D,MAAvB,CAAX,CANuB,CAOvB;AACA;AACA;;AACA,UAAIP,IAAI,GAAG,KAAKnE,IAAL,CAAUC,IAAV,CAAegC,MAA1B;;AACA,WAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGiC,IAAlB,EAAwBjC,EAAE,EAA1B,EAA8B;AACjCC,QAAAA,GAAG,GAAC,KAAKnC,IAAL,CAAUC,IAAV,CAAeiC,EAAf,CAAJ;;AACA,YAAIR,KAAK,CAACmC,QAAN,CAAec,MAAf,CAAsBxC,GAAtB,MAAgC1B,SAApC,EAA+C;AAC3C,eAAKT,IAAL,CAAUC,IAAV,CAAemD,MAAf,CAAsBlB,EAAtB,EAA0B,CAA1B;AACAA,UAAAA,EAAE,GAACA,EAAE,GAAC,CAAN;AACAiC,UAAAA,IAAI,GAACA,IAAI,GAAC,CAAV;AACH;AACG,OAlBsB,CAmBvB;AACA;;;AACAM,MAAAA,IAAI,GAAG,KAAKzE,IAAL,CAAUE,KAAV,CAAgB+B,MAAvB;;AACA,WAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGuC,IAAlB,EAAwBvC,EAAE,EAA1B,EAA8B;AACjCC,QAAAA,GAAG,GAAC,KAAKnC,IAAL,CAAUE,KAAV,CAAgBgC,EAAhB,CAAJ;;AACA,YAAIR,KAAK,CAACmC,QAAN,CAAec,MAAf,CAAsBxC,GAAtB,MAAgC1B,SAApC,EAA+C;AAC3C,eAAKP,KAAL,CAAWE,IAAX,CAAgBgD,MAAhB,CAAuBlB,EAAvB,EAA2B,CAA3B;AACAA,UAAAA,EAAE,GAACA,EAAE,GAAC,CAAN;AACAuC,UAAAA,IAAI,GAACA,IAAI,GAAC,CAAV;AACH;AACG,OA7BsB,CA8BvB;AACA;;;AACAA,MAAAA,IAAI,GAAG,KAAK/D,KAAL,CAAWuB,MAAlB;;AACA,WAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGuC,IAAlB,EAAwBvC,EAAE,EAA1B,EAA8B;AACjCC,QAAAA,GAAG,GAAC,KAAKzB,KAAL,CAAWwB,EAAX,CAAJ;;AACA,YAAIR,KAAK,CAACmC,QAAN,CAAec,MAAf,CAAsBxC,GAAtB,MAAgC1B,SAApC,EAA+C;AAC3C,eAAKJ,MAAL,CAAYL,IAAZ,CAAiBoD,MAAjB,CAAwBlB,EAAxB,EAA4B,CAA5B;AACAA,UAAAA,EAAE,GAACA,EAAE,GAAC,CAAN;AACAuC,UAAAA,IAAI,GAACA,IAAI,GAAC,CAAV;AACH;AACG,OAxCsB,CAyCvB;AACA;;;AACA,WAAKtC,GAAL,IAAYT,KAAK,CAACmC,QAAN,CAAec,MAA3B,EAAmC;AACtC,YAAI,KAAK3E,IAAL,CAAUC,IAAV,CAAemC,OAAf,CAAuBD,GAAvB,MAAiC,CAAC,CAAlC,IACA,KAAKnC,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwBD,GAAxB,MAAkC,CAAC,CADnC,IAEA,KAAKzB,KAAL,CAAW0B,OAAX,CAAmBD,GAAnB,MAA6B,CAAC,CAFlC,EAEqC;AACjCqC,UAAAA,OAAO,CAACrC,GAAD,CAAP,GAAa,OAAb;AACA,eAAKtB,MAAL,CAAYD,GAAZ,CAAgBuB,GAAhB,IAAqB,EAArB;AACA,eAAKrB,KAAL,CAAWqB,GAAX,IAAgB,EAAhB;AACA,eAAKzB,KAAL,CAAW2C,IAAX,CAAgBlB,GAAhB;AACH;AACG;AACJ,KAvDD,MAuDO;AACH;AACA;AACA;AACA,WAAKA,GAAL,IAAYT,KAAK,CAACmC,QAAN,CAAec,MAA3B,EAAmC;AACtCH,QAAAA,OAAO,CAACrC,GAAD,CAAP,GAAa,MAAb;AACI;;AAAA;AACD,WAAKnC,IAAL,CAAUC,IAAV,GAAe,EAAf;AACA,WAAKC,KAAL,CAAWC,KAAX,GAAiB,EAAjB;AACA,WAAKD,KAAL,CAAWE,IAAX,GAAgB,EAAhB;AACA,WAAKC,MAAL,CAAYL,IAAZ,GAAiB,EAAjB;AACA,WAAKK,MAAL,CAAYC,MAAZ,GAAmB,EAAnB;AACA,WAAKO,MAAL,CAAYD,GAAZ,GAAgB,EAAhB,CAZG,CAYiB;;AACpB,WAAKE,KAAL,GAAW,EAAX,CAbG,CAcH;AACA;;AACA,UAAIY,KAAK,CAACkD,OAAN,CAAclE,KAAd,KAAwBD,SAA5B,EAAuC;AAC1C,YAAIoE,IAAI,GAAGnD,KAAK,CAACkD,OAAN,CAAclE,KAAd,CAAoBuB,MAA/B;;AACA,aAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAG2C,IAAlB,EAAwB3C,EAAE,EAA1B,EAA8B;AAC1BC,UAAAA,GAAG,GAACT,KAAK,CAACkD,OAAN,CAAclE,KAAd,CAAoBwB,EAApB,CAAJ;;AACA,cAAIsC,OAAO,CAACrC,GAAD,CAAP,KAAiB1B,SAArB,EAAgC;AACnC,gBAAIiB,KAAK,CAACE,KAAN,CAAYkD,OAAZ,CAAoB,KAAKpE,KAAzB,EAA+ByB,GAA/B,CAAJ,EAAyC;AACrC,mBAAKzB,KAAL,CAAW2C,IAAX,CAAgBlB,GAAhB;AACH;;AAAA;;AACD,gBAAIT,KAAK,CAACE,KAAN,CAAYkD,OAAZ,CAAoB,KAAKzE,MAAL,CAAYL,IAAhC,EAAqCmC,GAArC,CAAJ,EAA+C;AAC3C,mBAAK9B,MAAL,CAAYL,IAAZ,CAAiBqD,IAAjB,CAAsBlB,GAAtB;AACH;;AAAA;AACDqC,YAAAA,OAAO,CAACrC,GAAD,CAAP,GAAa1B,SAAb,CAPmC,CAOX;AACpB;AACJ,SAbyC,CAc1C;;AACI;;AAAA,OA/BE,CAgCH;AACA;AACA;;AACA,UAAIiB,KAAK,CAACkD,OAAN,CAAc1E,KAAd,KAAwBO,SAA5B,EAAuC;AAC1C,YAAIsE,IAAI,GAAGrD,KAAK,CAACkD,OAAN,CAAc1E,KAAd,CAAoB+B,MAA/B;;AACA,aAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAG6C,IAAlB,EAAwB7C,EAAE,EAA1B,EAA8B;AAC1BC,UAAAA,GAAG,GAACT,KAAK,CAACkD,OAAN,CAAc1E,KAAd,CAAoBgC,EAApB,CAAJ;;AACA,cAAIsC,OAAO,CAACrC,GAAD,CAAP,KAAiB1B,SAArB,EAAgC;AAAE;AACrC,gBAAIiB,KAAK,CAACE,KAAN,CAAYkD,OAAZ,CAAoB,KAAK9E,IAAL,CAAUE,KAA9B,EAAoCiC,GAApC,CAAJ,EAA8C;AAC1C,mBAAKnC,IAAL,CAAUE,KAAV,CAAgBmD,IAAhB,CAAqBlB,GAArB;AACH;;AAAA;AACDqC,YAAAA,OAAO,CAACrC,GAAD,CAAP,GAAa,OAAb;AACI;AACJ;AACG,OA9CE,CA+CH;AACA;;;AACA,WAAKA,GAAL,IAAYT,KAAK,CAACmC,QAAN,CAAec,MAA3B,EAAmC;AACtC,YAAIjD,KAAK,CAACE,KAAN,CAAYkD,OAAZ,CAAoB,KAAKpE,KAAzB,EAA+ByB,GAA/B,CAAJ,EAAyC;AACrC,cAAIqC,OAAO,CAACrC,GAAD,CAAP,KAAiB,MAArB,EAA6B;AAChC,gBAAIT,KAAK,CAACE,KAAN,CAAYkD,OAAZ,CAAoB,KAAK9E,IAAL,CAAUE,KAA9B,EAAoCiC,GAApC,CAAJ,EAA8C;AAC1C,mBAAKnC,IAAL,CAAUE,KAAV,CAAgBmD,IAAhB,CAAqBlB,GAArB;AACH;;AAAA,aAH+B,CAIhC;;AACAqC,YAAAA,OAAO,CAACrC,GAAD,CAAP,GAAe,OAAf;AACI;AACJ;;AAAA;AACG;;AAAA,OA3DE,CA4DH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,UAAI6C,IAAI,GAAG,KAAKhF,IAAL,CAAUE,KAAV,CAAgB+B,MAA3B;;AACA,WAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAG8C,IAAlB,EAAwB9C,EAAE,EAA1B,EAA8B;AACjCC,QAAAA,GAAG,GAAC,KAAKnC,IAAL,CAAUE,KAAV,CAAgBgC,EAAhB,CAAJ;;AACA,YAAIA,EAAE,GAAC,CAAP,EAAU;AACN,eAAKhC,KAAL,CAAWC,KAAX,CAAiBkD,IAAjB,CAAsBlB,GAAtB;AACH,SAFD,MAEO;AACH,eAAKjC,KAAL,CAAWE,IAAX,CAAgBiD,IAAhB,CAAqBlB,GAArB;AACH;AACG;AACJ;;AACDT,IAAAA,KAAK,CAACuD,QAAN,CAAeC,KAAf,CAAqBxD,KAArB,EArJiC,CAsJjC;AACA;AACI,GAxJD;;AAyJA,OAAKyD,QAAL,GAAc,UAASzD,KAAT,EAAe0D,GAAf,EAAoB;AACrC,WAAO,KAAKpF,IAAL,CAAUC,IAAV,CAAemC,OAAf,CAAuBgD,GAAvB,CAAP;AACI,GAFD;;AAGA,OAAKC,aAAL,GAAmB,UAAS3D,KAAT,EAAgB;AAAE;AACxC,SAAKxB,KAAL,CAAWC,KAAX,GAAiB,EAAjB;AACA,SAAKD,KAAL,CAAWE,IAAX,GAAgB,EAAhB;AACA,QAAIkF,EAAE,GAAC,CAAP;AACA,QAAInD,GAAJ,EAAQD,EAAR;;AACA,QAAI,KAAKlC,IAAL,CAAUE,KAAV,KAAoBO,SAAxB,EAAmC;AAC/B,UAAIgE,IAAI,GAAC,KAAKzE,IAAL,CAAUE,KAAV,CAAgB+B,MAAzB;;AACA,WAAKC,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACuC,IAAb,EAAkBvC,EAAE,EAApB,EAAwB;AAC3BC,QAAAA,GAAG,GAAC,KAAKnC,IAAL,CAAUE,KAAV,CAAgBgC,EAAhB,CAAJ;;AACA,YAAIR,KAAK,CAACwC,MAAN,CAAaS,MAAb,CAAoBxC,GAApB,MAA6B1B,SAA7B,IACAiB,KAAK,CAACwC,MAAN,CAAaS,MAAb,CAAoBxC,GAApB,IAA2B,CAD/B,EACkC;AAC9B,cAAImD,EAAE,GAAG,CAAT,EAAY;AACf,iBAAKpF,KAAL,CAAWC,KAAX,CAAiBkD,IAAjB,CAAsBlB,GAAtB;AACAmD,YAAAA,EAAE,GAACA,EAAE,GAAC,CAAN;AACI,WAHD,MAGO;AACV,iBAAKpF,KAAL,CAAWE,IAAX,CAAgBiD,IAAhB,CAAqBlB,GAArB;AACI;AACJ;AACG;;AAAA;AACJ;;AACD,SAAK9B,MAAL,CAAYL,IAAZ,GAAiB,EAAjB;;AACA,QAAI,KAAKU,KAAL,KAAeD,SAAnB,EAA8B;AAC1B,UAAIoE,IAAI,GAAC,KAAKnE,KAAL,CAAWuB,MAApB;;AACA,WAAKC,EAAE,GAAC,CAAR,EAAUA,EAAE,GAAC2C,IAAb,EAAkB3C,EAAE,EAApB,EAAwB;AAC3BC,QAAAA,GAAG,GAAC,KAAKzB,KAAL,CAAWwB,EAAX,CAAJ;;AACA,YAAI,KAAKnB,MAAL,CAAYqB,OAAZ,CAAoBD,GAApB,MAA6B,CAAC,CAAlC,EAAqC;AACjC;AACA,eAAK9B,MAAL,CAAYL,IAAZ,CAAiBqD,IAAjB,CAAsBlB,GAAtB;AACH;AACG;AACJ;;AAAA,KA9BqC,CA+BtC;AACA;AACI,GAjCD;;AAkCA,OAAKoD,cAAL,GAAoB,UAAS7D,KAAT,EAAgB;AACvC,QAAI8D,GAAG,GAAC,EAAR;AACA,QAAI1E,KAAK,GAAGY,KAAK,CAACmC,QAAN,CAAe4B,QAAf,CAAwB/D,KAAxB,CAAZ;AACAA,IAAAA,KAAK,CAACwC,MAAN,CAAawB,UAAb,CAAwBhE,KAAxB;AACAA,IAAAA,KAAK,CAACwC,MAAN,CAAayB,SAAb,CAAuBjE,KAAvB,EAA6BZ,KAA7B,EAAmC,CAAnC,EAAqCY,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBE,KAArD,EAJuC,CAIsB;;AAC7DwB,IAAAA,KAAK,CAAC3B,IAAN,CAAWsF,aAAX,CAAyB3D,KAAzB,EALuC,CAMvC;;AACA,QAAI1B,IAAI,GAAC0B,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAA1B;AACA,QAAIyF,KAAK,GAAE,CAAE5F,IAAI,CAACiC,MAAP,GAAgB,CAA3B;AACA,QAAI4D,KAAK,GAAC,CAAC,CAAX;AACA,QAAIC,KAAK,GAAC,CAAC,CAAX;AACA,QAAItE,KAAK,GAACE,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAeZ,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBE,KAA/B,CAAV;;AACA,OAAG;AACC;AACA,UAAIF,IAAI,CAACiC,MAAL,GAAc,CAAlB,EAAqB;AACxB2D,QAAAA,KAAK,GAAC,IAAN;AACI,OAFD,MAEO;AACV;AACA,YAAIG,IAAI,GAACrE,KAAK,CAACmC,QAAN,CAAemC,UAAf,CAA0BtE,KAA1B,EAAgCZ,KAAhC,EAAsCY,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAvD,CAAT,CAFU,CAE8D;;AACxE,YAAI8F,IAAI,GAACvE,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuB8B,MAAhC;AACA,YAAIiE,IAAI,GAAC,EAAT;AACA,YAAIC,IAAI,GAAC,EAAT;AACA,YAAIC,IAAI,GAAC,EAAT;AACA,YAAIlE,EAAJ,EAAOoD,EAAP,EAAUnD,GAAV,EAAcvB,GAAd,CAPU,CAQV;;AACA,YAAIyF,IAAI,GAAGN,IAAI,CAAC9D,MAAhB;;AACA,aAAKC,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGmE,IAAlB,EAAwBnE,EAAE,EAA1B,EAA8B;AACtB,cAAIoE,GAAG,GAACP,IAAI,CAAC7D,EAAD,CAAZ,CADsB,CAE1B;;AACA,eAAKoD,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACW,IAAb,EAAkBX,EAAE,EAApB,EAAwB;AAC3BnD,YAAAA,GAAG,GAACT,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuBmF,EAAvB,CAAJ;;AACA,gBAAIgB,GAAG,CAACnE,GAAD,CAAH,KAAa1B,SAAjB,EAA4B;AACxBG,cAAAA,GAAG,GAAC0F,GAAG,CAACnE,GAAD,CAAP;AACAiE,cAAAA,IAAI,CAACjE,GAAD,CAAJ,GAAUvB,GAAV;;AACA,kBAAIsF,IAAI,CAAC/D,GAAD,CAAJ,KAAe1B,SAAnB,EAA8B;AAACyF,gBAAAA,IAAI,CAAC/D,GAAD,CAAJ,GAAU,EAAV;AAAc;;AAC7C+D,cAAAA,IAAI,CAAC/D,GAAD,CAAJ,CAAUvB,GAAV,IAAiB,KAAIsF,IAAI,CAAC/D,GAAD,CAAJ,CAAUvB,GAAV,KAAgB,CAApB,CAAjB,CAJwB,CAKxB;;AACA,kBAAIsF,IAAI,CAAC/D,GAAD,CAAJ,CAAUvB,GAAV,KAAkBuF,IAAI,CAAChE,GAAD,CAAJ,IAAW,CAA7B,CAAJ,EAAqC;AACxCgE,gBAAAA,IAAI,CAAChE,GAAD,CAAJ,GAAU+D,IAAI,CAAC/D,GAAD,CAAJ,CAAUvB,GAAV,CAAV;AACI;AACJ;AACG;AACJ,SA1BS,CA2BV;;;AACA,YAAI2F,EAAE,GAAC,EAAP;AACAX,QAAAA,KAAK,GAAC,IAAN,CA7BU,CA8BV;;AACA,aAAKN,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACW,IAAb,EAAkBX,EAAE,EAApB,EAAwB;AACpBnD,UAAAA,GAAG,GAACT,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuBmF,EAAvB,CAAJ;AACAiB,UAAAA,EAAE,CAACpE,GAAD,CAAF,GAAQ,EAAR,CAFoB,CAGpB;;AACA,cAAIgE,IAAI,CAAChE,GAAD,CAAJ,KAAc1B,SAAlB,EAA6B;AAChC,gBAAI0F,IAAI,CAAChE,GAAD,CAAJ,KAAe,CAAnB,EAAsB;AAClBoE,cAAAA,EAAE,CAACpE,GAAD,CAAF,GAAQ,OAAR;AACH,aAFD,MAEO,IAAIgE,IAAI,CAAChE,GAAD,CAAJ,KAAekE,IAAnB,EAAyB;AAAE;AAC9BE,cAAAA,EAAE,CAACpE,GAAD,CAAF,GAAQ,MAAR;AACH;AACG;AACJ;;AACD,YAAIqE,MAAM,GAAC,EAAX;;AACA,aAAKlB,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACW,IAAb,EAAkBX,EAAE,EAApB,EAAwB;AACpBnD,UAAAA,GAAG,GAACT,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuBmF,EAAvB,CAAJ;;AACA,cAAIiB,EAAE,CAACpE,GAAD,CAAF,KAAa,OAAjB,EAA0B;AAC7B,iBAAK,IAAIsE,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACR,IAAjB,EAAsBQ,EAAE,EAAxB,EAA4B;AACxB,kBAAIC,IAAI,GAAChF,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuBsG,EAAvB,CAAT;;AACA,kBAAIA,EAAE,KAAKnB,EAAX,EAAe;AAClBkB,gBAAAA,MAAM,CAACE,IAAD,CAAN,GAAa,OAAb;AACAb,gBAAAA,KAAK,GAACY,EAAN;AACI;AACJ;AACG,WARD,MAQO,IAAIF,EAAE,CAACpE,GAAD,CAAF,KAAa,MAAjB,EAAyB;AACnCqE,YAAAA,MAAM,CAACrE,GAAD,CAAN,GAAY,MAAZ;AACA2D,YAAAA,KAAK,GAACR,EAAN;AACI;AACJ;;AACD,YAAIO,KAAK,KAAK,CAAC,CAAX,IAAgBC,KAAK,KAAK,CAAC,CAA/B,EAAkC;AAC9BD,UAAAA,KAAK,GAAC,CAAC,CAAP;AACAC,UAAAA,KAAK,GAAC,CAAC,CAAP;AACH,SA9DS,CA+DV;;;AACA,aAAKR,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACW,IAAb,EAAkBX,EAAE,EAApB,EAAwB;AACpBnD,UAAAA,GAAG,GAACT,KAAK,CAAC3B,IAAN,CAAWG,KAAX,CAAiBC,KAAjB,CAAuBmF,EAAvB,CAAJ;;AACA,cAAIkB,MAAM,CAACrE,GAAD,CAAN,KAAgB1B,SAApB,EAA+B;AAClCmF,YAAAA,KAAK,GAAC,KAAN;AACA,gBAAIe,GAAG,GAACjF,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBE,KAAhB,CAAsBkC,OAAtB,CAA8BD,GAA9B,CAAR;;AACA,gBAAIwE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,kBAAIrB,EAAE,KAAM,CAAZ,EAAe,CAClB;AACA;AACI,eAHD,MAGO,CACV;AACI;;AAAA;AACD,kBAAInC,GAAG,GAACzB,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBE,KAAhB,CAAsBkD,MAAtB,CAA6BuD,GAA7B,EAAkC,CAAlC,CAAR,CAPY,CAOkC;;AAC9C,kBAAIH,MAAM,CAACrE,GAAD,CAAN,KAAiB,OAArB,EAA8B;AAAC;AAClC;AACAT,gBAAAA,KAAK,CAAC3B,IAAN,CAAWW,KAAX,GAAiBgB,KAAK,CAAC3B,IAAN,CAAWW,KAAX,CAAiBkG,MAAjB,CAAwBzD,GAAxB,CAAjB,CAFiC,CAEc;;AAC/CqC,gBAAAA,GAAG,GAACA,GAAG,CAACoB,MAAJ,CAAWzD,GAAX,CAAJ;AACI,eAJD,MAIO,IAAIqD,MAAM,CAACrE,GAAD,CAAN,KAAiB,MAArB,EAA6B;AAAC;AACxC;AACAvB,gBAAAA,GAAG,GAACwF,IAAI,CAACjE,GAAD,CAAR,CAFuC,CAGvC;;AACAT,gBAAAA,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBC,IAAhB,GAAqByB,KAAK,CAAC3B,IAAN,CAAWC,IAAX,CAAgBC,IAAhB,CAAqB2G,MAArB,CAA4BzD,GAA5B,CAArB,CAJuC,CAIgB;;AACvDzB,gBAAAA,KAAK,CAAC3B,IAAN,CAAWc,MAAX,CAAkBD,GAAlB,CAAsBuB,GAAtB,IAA2B,CAACvB,GAAD,CAA3B;AACAc,gBAAAA,KAAK,CAAC3B,IAAN,CAAWe,KAAX,CAAiBqB,GAAjB,IAAsBA,GAAG,GAAC,IAAJ,GAASvB,GAAT,GAAa,GAAnC;AACA,qBAAKY,KAAL,CAAWW,GAAX,IAAgBX,KAAhB,CAPuC,CAQvC;AACI;;AAAA;AACJ;AACG;AACJ;;AACD,YAAI,CAAEoE,KAAN,EAAa;AAAClE,UAAAA,KAAK,CAAC3B,IAAN,CAAWsF,aAAX,CAAyB3D,KAAzB;AAAiC;AAC3C;;AAAA;AACJ,KApGD,QAoGS,CAAEkE,KApGX,EAZuC,CAiHvC;;;AACA,WAAOJ,GAAP;AACI,GAnHD,CA7UY,CAicZ;;;AACA,OAAKqB,aAAL,GAAmB,UAASnF,KAAT,EAAe;AACrC;AACA,QAAIoF,GAAG,GAACpF,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAe,KAAKpC,KAAL,CAAWC,KAA1B,CAAR;AACA,QAAI4G,GAAG,GAACrF,KAAK,CAACsF,MAAN,CAAaC,gBAAb,CAA8BvF,KAA9B,EAAoCoF,GAApC,CAAR,CAHqC,CAIrC;;AACA,SAAK5G,KAAL,CAAWC,KAAX,GAAiB2G,GAAG,CAACI,IAAJ,CAAS,UAASC,CAAT,EAAWC,CAAX,EAAa;AACnC,UAAID,CAAC,KAAM,EAAX,EAAe;AAClB,eAAO,CAAP;AACI,OAFD,MAEO,IAAIC,CAAC,KAAM,EAAX,EAAe;AACzB,eAAO,CAAC,CAAR;AACI,OAFM,MAEA,IAAIL,GAAG,CAACI,CAAD,CAAH,GAAOJ,GAAG,CAACK,CAAD,CAAd,EAAmB;AAC7B,eAAO,CAAP;AACI,OAFM,MAEA,IAAIL,GAAG,CAACI,CAAD,CAAH,GAAOJ,GAAG,CAACK,CAAD,CAAd,EAAmB;AAC7B,eAAO,CAAC,CAAR;AACI,OAFM,MAEA;AACV,eAAO,CAAP;AACI;AACJ,KAZgB,CAAjB,CALqC,CAkBrC;AACA;AACA;;AACA;AACI,GAtBD;;AAuBA,OAAKC,MAAL,GAAY,UAAS3F,KAAT,EAAeS,GAAf,EAAoB;AACnC,QAAI,KAAKtB,MAAL,CAAYD,GAAZ,CAAgBuB,GAAhB,MAAyB1B,SAAzB,IACA,KAAKI,MAAL,CAAYD,GAAZ,CAAgBuB,GAAhB,MAAyB,IADzB,IAEA,KAAKtB,MAAL,CAAYD,GAAZ,CAAgBuB,GAAhB,MAAyB,EAF7B,EAEiC;AAC7B,aAAO,KAAKtB,MAAL,CAAYD,GAAZ,CAAgBuB,GAAhB,CAAP;AACH,KAJD,MAIO;AACH;AACH;AACG,GARD;;AAUA,OAAKmF,QAAL,GAAc,UAAS5F,KAAT,EAAed,GAAf,EAAoB;AACrC,QAAI2G,EAAE,GAAC,IAAP;;AACA,QAAI,KAAKlH,MAAL,CAAYG,KAAZ,KAAsBC,SAA1B,EAAqC,CAAE;AACtC,KADD,MACO,IAAIiB,KAAK,CAACwC,MAAN,CAAasD,MAAb,CAAoB5G,GAApB,MAA8BH,SAAlC,EAA6C;AAAE;AAClD8G,MAAAA,EAAE,GAAC,KAAH,CADgD,CAEhD;AACH,KAHM,MAGA;AAAE;AACLA,MAAAA,EAAE,GAAC,KAAH;;AACA,WAAK,IAAIE,GAAT,IAAgB/F,KAAK,CAACwC,MAAN,CAAasD,MAAb,CAAoB5G,GAApB,CAAhB,EAA0C;AAC7C,YAAI,KAAKP,MAAL,CAAYG,KAAZ,KAAuB,IAAvB,IAA+BiH,GAAG,KAAK,IAA3C,EAAiD;AAC7CF,UAAAA,EAAE,GAAC,IAAH;AACH,SAFD,MAEO,IAAI,KAAKlH,MAAL,CAAYG,KAAZ,KAAuB,CAAC,CAAxB,IAA8BiH,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,CAAC,CAA3D,EAA+D;AAClEF,UAAAA,EAAE,GAAC,IAAH;AACH,SAFM,MAEA,IAAI,KAAKlH,MAAL,CAAYG,KAAZ,IAAqB,CAArB,IAA2BiH,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK,CAAC,CAAzB,IAA8BA,GAAG,GAAG,KAAKpH,MAAL,CAAYG,KAA/E,EAAwF;AAC3F+G,UAAAA,EAAE,GAAC,IAAH;AACH,SAP4C,CAQ7C;;AACI,OAXE,CAYH;AACA;AACA;;AACH;;AACD,WAAOA,EAAP;AACI,GAvBD;;AAwBA,OAAKG,SAAL,GAAe,UAAShG,KAAT,EAAeiG,GAAf,EAAmBnG,KAAnB,EAA0B;AAAE;AAC9C,QAAIA,KAAK,KAAKf,SAAd,EAAyB;AACrB,UAAImH,IAAI,GAAC,EAAT;;AACA,WAAK,IAAInB,EAAE,GAAC,CAAZ,EAAeA,EAAE,GAAGjF,KAAK,CAACS,MAA1B,EAAkCwE,EAAE,EAApC,EAAuC;AAC1C,YAAIjF,KAAK,CAACiF,EAAD,CAAL,KAAc,EAAlB,EAAsB;AAClB,cAAIE,GAAG,GAAC,KAAK3G,IAAL,CAAU2H,GAAV,EAAevF,OAAf,CAAuBZ,KAAK,CAACiF,EAAD,CAA5B,CAAR;;AACA,cAAIE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnB,gBAAIxD,GAAG,GAAC,KAAKnD,IAAL,CAAU2H,GAAV,EAAevE,MAAf,CAAsBuD,GAAtB,EAA2B,CAA3B,CAAR,CADmB,CACoB;;AACvCiB,YAAAA,IAAI,GAACA,IAAI,CAAChB,MAAL,CAAYzD,GAAZ,CAAL;AACI;AACJ;AACG;;AACDzB,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU2H,GAAV,CAAxB,EAAuC,CAAvC,EAAyC,CAAzC,EAA2CC,IAA3C;AACH;AACG,GAdD;;AAeA,OAAKC,OAAL,GAAa,UAASnG,KAAT,EAAeoG,IAAf,EAAoB7D,IAApB,EAAyB8D,IAAzB,EAA8BC,GAA9B,EAAmC;AACnD,QAAIC,GAAG,GAAC,KAAKjI,IAAL,CAAU8H,IAAV,EAAgB1F,OAAhB,CAAwB6B,IAAxB,CAAR;;AACA,QAAIgE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,UAAI9E,GAAG,GAAC,KAAKnD,IAAL,CAAU8H,IAAV,EAAgB1E,MAAhB,CAAuB6E,GAAvB,EAA4B,CAA5B,CAAR,CADY,CAC+B;;AAC3C,UAAID,GAAG,KAAMvH,SAAT,IAAsBuH,GAAG,KAAM,CAAC,CAApC,EAAuC;AAC1C,aAAKhI,IAAL,CAAU+H,IAAV,IAAgB,KAAK/H,IAAL,CAAU+H,IAAV,EAAgBnB,MAAhB,CAAuBzD,GAAvB,CAAhB,CAD0C,CACW;AACjD,OAFD,MAEO;AACVzB,QAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwCC,GAAxC,EAA6C,CAA7C,EAAgD7E,GAAhD;AACI;;AACD,aAAO,IAAP;AACH,KARD,MAQM;AACF,aAAO,KAAP;AACH;AACG,GAbD;;AAcA,OAAK+E,QAAL,GAAc,UAASxG,KAAT,EAAeoG,IAAf,EAAoBK,KAApB,EAA0BJ,IAA1B,EAA+BC,GAA/B,EAAoC;AACrD,QAAII,GAAG,GAACD,KAAK,CAAClG,MAAd;;AACA,SAAK,IAAIoG,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACD,GAAjB,EAAqBC,EAAE,EAAvB,EAA2B;AACvB,UAAIpE,IAAI,GAACkE,KAAK,CAACE,EAAD,CAAd;AACA,UAAIJ,GAAG,GAAC,KAAKjI,IAAL,CAAU8H,IAAV,EAAgB1F,OAAhB,CAAwB6B,IAAxB,CAAR;;AACA,UAAIgE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnB,YAAI9E,GAAG,GAAC,KAAKnD,IAAL,CAAU8H,IAAV,EAAgB1E,MAAhB,CAAuB6E,GAAvB,EAA4B,CAA5B,CAAR,CADmB,CACwB;;AAC3C,YAAID,GAAG,KAAMvH,SAAT,IAAsBuH,GAAG,KAAM,CAAC,CAApC,EAAuC;AACnC,eAAKhI,IAAL,CAAU+H,IAAV,IAAgB,KAAK/H,IAAL,CAAU+H,IAAV,EAAgBnB,MAAhB,CAAuBzD,GAAvB,CAAhB,CADmC,CACkB;AACxD,SAFD,MAEO;AACHzB,UAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwCC,GAAxC,EAA6C,CAA7C,EAAgD7E,GAAhD;AACH;AACG;AACJ;AACG,GAdD;;AAeA,OAAKmF,YAAL,GAAkB,UAAS5G,KAAT,EAAeuC,IAAf,EAAoBsE,IAApB,EAA0B;AAC/C,QAAIN,GAAG,GAAC,KAAK/H,KAAL,CAAWC,KAAX,CAAiBiC,OAAjB,CAAyB6B,IAAzB,CAAR;AACA,QAAI+D,GAAG,GAAC,KAAK9H,KAAL,CAAWC,KAAX,CAAiBiC,OAAjB,CAAyBmG,IAAzB,CAAR;;AACA,QAAIP,GAAG,KAAKC,GAAR,IAAe,KAAK/H,KAAL,CAAWC,KAAX,CAAiB8B,MAAjB,GAA0B,CAA7C,EAAgD;AAC5C,UAAIuG,IAAI,GAAC,KAAKxI,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwB,KAAKlC,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAxB,CAAT;AACA,UAAIsI,KAAK,GAAC,KAAKzI,IAAL,CAAUE,KAAV,CAAgBkD,MAAhB,CAAuBoF,IAAvB,EAA6B,CAA7B,CAAV,CAF4C,CAEE;;AAC9C9G,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAUE,KAAlC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CuI,KAA9C,EAH4C,CAI5C;;AACA,aAAO,IAAP;AACH,KAND,MAMO;AACH,aAAO,KAAP;AACH;AACG,GAZD;;AAaA,OAAKC,WAAL,GAAiB,UAAShH,KAAT,EAAeS,GAAf,EAAoB;AACxC,QAAIwG,SAAJ;AACA,QAAIC,SAAJ;AACA,QAAIX,GAAG,GAAC,KAAKjI,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwBD,GAAxB,CAAR;;AACA,QAAI8F,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,UAAItB,GAAG,GAAC,KAAKzG,KAAL,CAAWC,KAAX,CAAiBiC,OAAjB,CAAyBD,GAAzB,CAAR;AACA,UAAI0G,IAAI,GAAElC,GAAG,KAAM,CAAnB;;AACA,UAAIkC,IAAJ,EAAU;AACbF,QAAAA,SAAS,GAAC,KAAKzI,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAV;AACAyI,QAAAA,SAAS,GAAC,KAAKE,OAAL,CAAapH,KAAb,EAAmB,OAAnB,EAA2BiH,SAA3B,CAAV;AACI;;AACD,WAAKG,OAAL,CAAapH,KAAb,EAAmB,OAAnB,EAA2BS,GAA3B;;AACA,UAAI0G,IAAI,IAAID,SAAS,KAAKnI,SAAtB,IAAmCmI,SAAS,KAAK,CAAC,CAAtD,EAAyD;AAC5D,aAAKG,OAAL,CAAarH,KAAb,EAAmB,OAAnB,EAA2BiH,SAA3B,EAAqCC,SAArC;AACI;;AACD,aAAOjC,GAAP;AACH;AACG,GAjBD;;AAkBA,OAAKqC,YAAL,GAAkB,UAAStH,KAAT,EAAeuC,IAAf,EAAoB8D,IAApB,EAAyBC,GAAzB,EAA8B;AACnD,QAAIC,GAAG,GAAC,KAAKjI,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwB6B,IAAxB,CAAR;;AACA,QAAIgE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ;AACA,WAAKS,WAAL,CAAiBhH,KAAjB,EAAuBuC,IAAvB;;AACA,UAAI+D,GAAG,KAAMvH,SAAT,IAAsBuH,GAAG,KAAM,CAAC,CAApC,EAAuC;AAC1C,aAAKhI,IAAL,CAAU+H,IAAV,IAAgB,KAAK/H,IAAL,CAAU+H,IAAV,EAAgBnB,MAAhB,CAAuB3C,IAAvB,CAAhB,CAD0C,CACY;AAClD,OAFD,MAEO;AACVvC,QAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwCC,GAAxC,EAA6C,CAA7C,EAAgD/D,IAAhD;AACI;;AACD,aAAO,IAAP;AACH,KATD,MASM;AACF,aAAO,KAAP;AACH;AACG,GAdD;;AAeA,OAAKgF,aAAL,GAAmB,UAASvH,KAAT,EAAeoG,IAAf,EAAoB7D,IAApB,EAAyBsE,IAAzB,EAA+B;AACrD;AACA,QAAIP,GAAG,GAAC,KAAKhI,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwBmG,IAAxB,CAAR;AACA,QAAIN,GAAG,GAAC,KAAKjI,IAAL,CAAU8H,IAAV,EAAgB1F,OAAhB,CAAwB6B,IAAxB,CAAR;;AACA,QAAI+D,GAAG,KAAK,CAAC,CAAT,IAAcC,GAAG,KAAK,CAAC,CAAvB,IAA4BhE,IAAI,KAAKsE,IAAzC,EAA+C;AAAE;AAC7C,WAAKvI,IAAL,CAAU8H,IAAV,EAAgBG,GAAhB,IAAqBM,IAArB;AACA,WAAKvI,IAAL,CAAUE,KAAV,CAAgB8H,GAAhB,IAAqB/D,IAArB;AACA,aAAO,IAAP;AACH,KAJD,MAIO;AACH,aAAO,KAAP;AACH;AACG,GAXD;;AAYA,OAAKiF,eAAL,GAAqB,UAASxH,KAAT,EAAe6G,IAAf,EAAqB;AAC7C,QAAII,SAAJ;AACA,QAAIC,SAAJ;AACA,QAAIZ,GAAG,GAAC,KAAK9H,KAAL,CAAWC,KAAX,CAAiBiC,OAAjB,CAAyBmG,IAAzB,CAAR;;AACA,QAAIP,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,UAAIa,IAAI,GAAEb,GAAG,KAAM,CAAnB;;AACA,UAAIa,IAAJ,EAAU;AACbF,QAAAA,SAAS,GAAC,KAAKzI,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAV;AACAyI,QAAAA,SAAS,GAAC,KAAKE,OAAL,CAAapH,KAAb,EAAmB,OAAnB,EAA2BiH,SAA3B,CAAV;AACI;;AAAA;AACD,UAAIQ,GAAG,GAAC,KAAKnJ,IAAL,CAAUE,KAAV,CAAgBkC,OAAhB,CAAwBmG,IAAxB,CAAR;AACA,WAAKa,SAAL,CAAe1H,KAAf,EAAqB,OAArB,EAA6ByH,GAAG,GAAC,CAAjC;;AACA,UAAIN,IAAI,IAAID,SAAS,KAAKnI,SAAtB,IAAmCmI,SAAS,KAAK,CAAC,CAAtD,EAAyD;AAC5D,aAAKG,OAAL,CAAarH,KAAb,EAAmB,OAAnB,EAA2BiH,SAA3B,EAAqCC,SAArC;AACI;;AACD,aAAO,IAAP;AACH,KAZD,MAYO;AACH,aAAO,KAAP;AACH;AACG,GAnBD;;AAoBA,OAAKQ,SAAL,GAAe,UAAS1H,KAAT,EAAeqG,IAAf,EAAoBoB,GAApB,EAAyB;AAC3CzH,IAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwCoB,GAAxC,EAA6C,CAA7C,EAAgD,KAAKzI,KAArD;AACA,SAAKA,KAAL,GAAW,EAAX;AACI,GAHD;;AAIA,OAAK2I,UAAL,GAAgB,UAAS3H,KAAT,EAAeoG,IAAf,EAAoB7D,IAApB,EAAyB8D,IAAzB,EAA8BC,GAA9B,EAAmC;AACtD,QAAIsB,IAAI,GAAC,KAAKtJ,IAAL,CAAU8H,IAAV,EAAgB7F,MAAzB;AACA,QAAIgG,GAAG,GAAC,KAAKjI,IAAL,CAAU8H,IAAV,EAAgB1F,OAAhB,CAAwB6B,IAAxB,CAAR;;AACA,QAAIgE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,UAAI9E,GAAG,GAAC,KAAKnD,IAAL,CAAU8H,IAAV,EAAgB1E,MAAhB,CAAuB6E,GAAvB,EAA2BqB,IAAI,GAACrB,GAAhC,CAAR;AACAvG,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwCC,GAAxC,EAA4C,CAA5C,EAA8C7E,GAA9C;AACA,aAAO,IAAP;AACH,KAJD,MAIO;AACH,aAAO,KAAP;AACH;AACG,GAVD;;AAWA,OAAKoG,YAAL,GAAkB,UAAS7H,KAAT,EAAeqG,IAAf,EAAoBoB,GAApB,EAAyB;AAC9C,QAAItE,IAAI,GAAC,KAAK7E,IAAL,CAAU+H,IAAV,EAAgB9F,MAAzB;AACA,QAAIkB,GAAG,GAAC,KAAKnD,IAAL,CAAU+H,IAAV,EAAgB3E,MAAhB,CAAuB+F,GAAvB,EAA2BtE,IAAI,GAACsE,GAAhC,CAAR;AACAzH,IAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU+H,IAAV,CAAxB,EAAwC,CAAxC,EAA2C,CAA3C,EAA6C5E,GAA7C;AACI,GAJD;;AAKA,OAAKqG,UAAL,GAAgB,UAAS9H,KAAT,EAAeoF,GAAf,EAAoB;AACvC,QAAI2C,GAAG,GAAC,EAAR;AACA,QAAIC,IAAI,GAAC5C,GAAG,CAAC7E,MAAb;;AACA,SAAI,IAAIC,EAAE,GAAC,CAAX,EAAcA,EAAE,GAACwH,IAAjB,EAAuBxH,EAAE,EAAzB,EAA6B;AACzB,UAAItB,GAAG,GAACkG,GAAG,CAAC5E,EAAD,CAAX;;AACA,UAAI,KAAKoF,QAAL,CAAc5F,KAAd,EAAoBd,GAApB,CAAJ,EAA8B;AACjC6I,QAAAA,GAAG,CAACpG,IAAJ,CAASzC,GAAT;AACI;AACJ,KARsC,CASvC;;;AACA,WAAO6I,GAAP;AACI,GAXD;;AAYA,OAAKE,YAAL,GAAkB,UAASjI,KAAT,EAAekI,KAAf,EAAqBzH,GAArB,EAA0B;AAC/C,QAAIwE,GAAG,GAACiD,KAAK,CAACxH,OAAN,CAAcD,GAAd,CAAR;;AACA,QAAIwE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ;AACAiD,MAAAA,KAAK,CAACxG,MAAN,CAAauD,GAAb,EAAkB,CAAlB,EAFY,CAEa;AAC5B;;AAAA;AACD,WAAOA,GAAP;AACI,GAPD,CArpBY,CA6pBZ;;;AACA,OAAKkD,SAAL,GAAe,UAASnI,KAAT,EAAgB;AAClC,QAAIoF,GAAG,GAACpF,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAe,KAAKpC,KAAL,CAAWC,KAA1B,CAAR;AACA,QAAI4G,GAAG,GAACrF,KAAK,CAACsF,MAAN,CAAaC,gBAAb,CAA8BvF,KAA9B,EAAoCoF,GAApC,CAAR;;AACA,QAAIpF,KAAK,CAAC6B,IAAN,CAAWuG,aAAX,CAAyBpI,KAAzB,MAAoCA,KAAK,CAAC6B,IAAN,CAAWwG,IAAX,CAAgBC,MAAhB,CAAuBC,GAA/D,EAAoE;AAChE,aAAO,MAAP;AACH,KAFD,MAEO,IAAIlD,GAAG,CAAC,KAAK7G,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAD,CAAH,IAA4B4G,GAAG,CAAC,KAAK7G,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAD,CAAnC,EAA0D;AAC7D,aAAO,KAAKD,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAP;AACH,KAFM,MAEA;AACH,aAAO,KAAKD,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAP;AACH;AACG,GAVD;;AAWA,OAAK+J,SAAL,GAAe,UAASxI,KAAT,EAAgB;AAClC,QAAIoF,GAAG,GAACpF,KAAK,CAACE,KAAN,CAAYU,EAAZ,CAAe,KAAKpC,KAAL,CAAWC,KAA1B,CAAR;AACA,QAAI4G,GAAG,GAACrF,KAAK,CAACsF,MAAN,CAAaC,gBAAb,CAA8BvF,KAA9B,EAAoCoF,GAApC,CAAR;;AACA,QAAIpF,KAAK,CAAC6B,IAAN,CAAWuG,aAAX,CAAyBpI,KAAzB,MAAoCA,KAAK,CAAC6B,IAAN,CAAWwG,IAAX,CAAgBC,MAAhB,CAAuBC,GAA/D,EAAoE;AAChE,aAAO,MAAP;AACH,KAFD,MAEO,IAAIlD,GAAG,CAAC,KAAK7G,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAD,CAAH,IAA4B4G,GAAG,CAAC,KAAK7G,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAD,CAAnC,EAA0D;AAC7D,aAAO,KAAKD,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAP;AACH,KAFM,MAEA;AACH,aAAO,KAAKD,KAAL,CAAWC,KAAX,CAAiB,CAAjB,CAAP;AACH;AACG,GAVD;;AAWA,OAAK4I,OAAL,GAAa,UAASrH,KAAT,EAAeiG,GAAf,EAAmBxF,GAAnB,EAAuBgI,GAAvB,EAA4B;AAC5C,QAAIhI,GAAG,KAAK1B,SAAR,IAAqB0B,GAAG,KAAK,EAAjC,EAAqC;AACjCT,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAU2H,GAAV,CAAxB,EAAwCwC,GAAxC,EAA6C,CAA7C,EAAgDhI,GAAhD;AACH;AACG,GAJD;;AAKA,OAAK2G,OAAL,GAAa,UAASpH,KAAT,EAAeiG,GAAf,EAAmBxF,GAAnB,EAAwB;AACxC,QAAIwE,GAAG,GAAC,KAAK3G,IAAL,CAAU2H,GAAV,EAAevF,OAAf,CAAuBD,GAAvB,CAAR;;AACA,QAAIwE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,UAAIxD,GAAG,GAAC,KAAKnD,IAAL,CAAU2H,GAAV,EAAevE,MAAf,CAAsBuD,GAAtB,EAA2B,CAA3B,CAAR,CADY,CAC8B;;AAC1C,UAAIxD,GAAG,KAAKhB,GAAZ,EAAiB;AAACK,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BU,GAA5B,EAAgChB,GAAhC;AAAsC;;AACxD,aAAOwE,GAAP;AACH;;AAAA;AACG,GAPD;;AAQA,OAAKyD,UAAL,GAAgB,UAAS1I,KAAT,EAAeS,GAAf,EAAoB;AACvC,QAAIA,GAAG,KAAK1B,SAAR,IAAqB0B,GAAG,KAAK,EAAjC,EAAqC;AACjCT,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAUE,KAAlC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CiC,GAA9C;AACH;AACG,GAJD;;AAKA,OAAKkI,UAAL,GAAgB,UAAS3I,KAAT,EAAeS,GAAf,EAAoB;AACvC,QAAIA,GAAG,KAAK1B,SAAR,IAAqB0B,GAAG,KAAK,EAAjC,EAAqC;AACjCT,MAAAA,KAAK,CAACE,KAAN,CAAY0C,WAAZ,CAAwB,KAAKtE,IAAL,CAAUE,KAAlC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8CiC,GAA9C;AACH;AACG,GAJD;;AAKA,OAAKmI,YAAL,GAAkB,UAAS5I,KAAT,EAAeoG,IAAf,EAAoB7D,IAApB,EAA0B;AAAE;AACjD,QAAIsD,EAAJ,EAAOrF,EAAP;AACA,QAAI+F,GAAG,GAAC,KAAKjI,IAAL,CAAUC,IAAV,CAAemC,OAAf,CAAuB6B,IAAvB,CAAR;;AACA,QAAI6D,IAAI,KAAM,KAAK9G,IAAL,CAAUb,KAAV,CAAgBe,IAA9B,EAAoC;AAChCqG,MAAAA,EAAE,GAAC,IAAH;AACA,UAAIgD,IAAI,GAAC,KAAKrK,KAAL,CAAWC,KAAX,CAAiB8B,MAAjB,GAAwB,CAAjC;;AACA,UAAIgG,GAAG,KAAKxH,SAAZ,EAAuB;AAAC8J,QAAAA,IAAI,GAACtC,GAAG,GAAC,CAAT;AAAY;;AAAA;;AACpC,WAAK/F,EAAE,GAAG,CAAV,EAAaA,EAAE,IAAIqI,IAAnB,EAAyBrI,EAAE,EAA3B,EAA+B;AAClC,YAAIC,GAAG,GAAC,KAAKjC,KAAL,CAAWC,KAAX,CAAiB+B,EAAjB,CAAR;;AACA,YAAI,KAAKmF,MAAL,CAAY3F,KAAZ,EAAkBS,GAAlB,MAA4B1B,SAAhC,EAA2C;AACvC8G,UAAAA,EAAE,GAAC,KAAH;AACH;AACG;AACJ,KAVD,MAUO,IAAIO,IAAI,KAAM,KAAK9G,IAAL,CAAUZ,IAAV,CAAec,IAA7B,EAAmC;AACtCqG,MAAAA,EAAE,GAAC,KAAK+C,YAAL,CAAkB5I,KAAlB,EAAwB,KAAKV,IAAL,CAAUb,KAAV,CAAgBe,IAAxC,CAAH;;AACA,UAAIqG,EAAJ,EAAQ;AACX,YAAIiD,IAAI,GAAC,KAAKtK,KAAL,CAAWE,IAAX,CAAgB6B,MAAhB,GAAuB,CAAhC;;AACA,YAAIgG,GAAG,KAAKxH,SAAZ,EAAuB;AAAC+J,UAAAA,IAAI,GAACvC,GAAG,GAAC,CAAT;AAAY;;AAAA;;AACpC,aAAK/F,EAAE,GAAG,CAAV,EAAaA,EAAE,IAAIsI,IAAnB,EAAyBtI,EAAE,EAA3B,EAA+B;AAC3BC,UAAAA,GAAG,GAAC,KAAKjC,KAAL,CAAWE,IAAX,CAAgB8B,EAAhB,CAAJ;;AACA,cAAI,KAAKmF,MAAL,CAAY3F,KAAZ,EAAkBS,GAAlB,MAA4B1B,SAAhC,EAA2C;AAC9C8G,YAAAA,EAAE,GAAC,KAAH;AACI;AACJ;AACG;AACJ;;AACD,WAAOA,EAAP;AACI,GA3BD,CA3sBY,CAuuBZ;;;AACA,OAAK7C,MAAL,GAAY,UAASL,KAAT,EAAgBoG,KAAhB,EAAuBC,IAAvB,EAA6B;AAC5C,WAAOA,IAAI,CAACtI,OAAL,CAAaiC,KAAb,MAAyBoG,KAAhC;AACI,GAFD;AAGH;;AAAA;AACD,eAAe1K,IAAf","sourcesContent":["//console.log(\"Loading PathLib.js\");\n\nfunction Path() {\n    this.keys={path:[], // selected keys\n\t       other:[] // keys available for selection\n\t      };\n    this.other={table:[], // table keys\n\t\trest:[]   // keys available for selection\n\t       };\n    this.hidden={keys:[],         // hidden keys\n\t\t values:{},       // hidden values\n\t\t stored:{},       // stored values of hidden keys\n\t\t level:undefined  // hidden level\n\t       };\n    this.trash=[];  // remaining valid keys\n    this.filter={val:{}}; // initial filter for data...\n    this.select={val:{}};\n    this.where={};\n    this.ignore=[\"max\",\"min\",\"minlat\",\"minlon\",\"maxlat\",\"maxlon\"];\n    this.type = {\n\tpath :      {ityp:-1,ptyp:\"path\"},\n\teye :       {ityp:0, ptyp:\"eye\"},\n\ttable :     {ityp:1, ptyp:\"table\"},\n\trest :      {ityp:2, ptyp:\"rest\"},\n\ttrash :     {ityp:3, ptyp:\"trash\"},\n\ttrashRest : {ityp:4, ptyp:\"trashRest\"},\n\trow :       {ityp:5, ptyp:\"row\"},\n\tcol :       {ityp:6, ptyp:\"col\"},\n\titem :      {ityp:7, ptyp:\"item\"}\n    };\n    this.order=undefined; // how to order data\t    \n    this.init=function(state){\n\tvar par=\"Path\";\n\tstate.Utils.init(par,this);\n    };\n    this.cleanSelect=function(state) {\n\tvar pkeys=state.Path.keys.path;\n\tvar keys=Object.keys(state.Path.select.val);\n\tvar lenk=keys.length;\n\tfor (var ii=0;ii<lenk;ii++) {\n\t    var key=keys[ii];\n\t    if (pkeys.indexOf(key) === -1) {\n\t\tstate.Path.select.val[key]=undefined;\n\t    }\n\t}\n    };\n    this.setFilter=function(state) {\n\tstate.Path.cleanSelect(state);\n\tthis.filter.val=state.Utils.cp(state.Path.select.val);\n\tstate.Utils.pushUrl(state);\n\tconsole.log(\"Setting filter.\");\n    };\n    this.getSnapshot=function(state) { // store state\n\treturn {keys:state.Utils.cp(state.Path.keys),\n\t\tother:state.Utils.cp(state.Path.other),\n\t\ttrash:state.Utils.cp(state.Path.hidden),\n\t\tselect:state.Utils.cp(state.Path.select),\n\t\torder:state.Utils.cp(state.Path.order)};\n    };\n    this.setSnapshot=function(state,snapshot) { // store state\n\tstate.Utils.restore(state.Path,snapshot);\n    };\n    this.toggleSelect=function(state,key,val) {\n\tvar vals=state.Path.select.val[key];\n\tconsole.log(\"toggleSelect:\",key,val,JSON.stringify(vals));\n\tif (vals !== undefined) {\n\t    var vid=vals.indexOf(val)\n\t    if (vid !== -1) {  // remove item\n\t\tvar src=vals.splice(vid,1);\n\t\tif (vals.length==0) { // can never be totally empty...\n\t\t    vals.push(\"MAX(\"+key+\")\");\n\t\t}\n\t\tstate.Path.select.val[key]=vals;\n\t    } else {\n\t\tstate.Path.select.val[key].push(val); // add item\n\t    }\n\t    this.setWhere(state,key);\n\t    state.Show.showConfig(state);\n\t    console.log(\"Finally Vals:\",key,JSON.stringify(state.Path.select.val[key]));\n\t}\n    };\n    this.setWhere=function(state,key) {\n\tvar where=this.parseWhere(state,key);\n\tstate.Path.where[key]=where;\n    };\n    this.parseWhere=function(state,key) {\n\tvar where=\"\";\n\tvar vals=state.Path.select.val[key];\n\tif (vals === undefined) {vals=[];};\n\tvar lenv=vals.length\n\tfor (var ii=0;ii<lenv;ii++) {\n\t    var val=vals[ii]\n\t    if (where !== \"\") { where=where + \" OR \";};\n\t    if (val === \"null\") {\n\t\twhere = where + key + \" is NULL\";\n\t    } else if (val===\"MAX(\"+key+\")\") { // this is a function\n\t\tvar parse=state.Utils.getMax(state.Database.values[key]);\n\t\t//console.log(\"parseWhere:\",key,parse,JSON.stringify(state.Database.values[key]));\n\t\tif (parse === undefined) {\n\t\t    where = where + key + \" is NULL\";\n\t\t} else {\n\t\t    where = where + key + \"='\"+parse+\"'\";\n\t\t};\n\t    } else if (val===\"MIN(\"+key+\")\") { // this is a function\n\t\tvar parse=state.Utils.getMin(state.Database.values[key]);\n\t\tif (parse === undefined) {\n\t\t    where = where + key + \" is NULL\";\n\t\t} else {\n\t\t    where = where + key + \"='\"+parse+\"'\";\n\t\t};\n\t    } else {\n\t\twhere = where + key + \"='\"+val+\"'\";\n\t    }\n\t};\n\treturn where;\n    };\n    this.makeCnt=function(state,key) {\n\treturn state.Path.select.val[key].length;\n    };\n    this.getOrderValues=function(state,skey){\n        if (state.Path.order === undefined) {state.Path.order={};};\n        if (state.Path.order[skey] === undefined) {\n            //console.log(\"Copying:\",JSON.stringify(Matrix.values[skey]));\n            state.Path.order[skey]=state.Utils.cp(state.Matrix.values[skey]);\n        } else {\n\t    var vals = state.Matrix.values[skey];\n\t    var plen = vals;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar val=vals[ii];\n\t\tif (state.Path.order[skey].indexOf(val)===-1) {\n\t\t    state.Path.order[skey].push(val);\n\t\t}\n\t    };\n\t};\n\treturn state.Path.order[skey];\n    };\n    this.bumpOrder=function(state,skey,value) {\n\tconsole.log(\"Bump order:\",skey,value);\n\tvar vid=state.Path.order[skey].indexOf(value);\n\tif (vid !== -1 && vid > 0) {\n\t    var src=state.Path.order[skey].splice(vid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Path.order[skey],vid-1,0,src);\n\t};\n\tstate.Show.showConfig(state);\n    };\n    this.makePath=function(state) { // note that not all keys are present in the data!\n\t//console.log(\"Entering makepath.\",JSON.stringify(this.keys));\n\tvar ii,key;\n\tvar pathSet=[];\n\tif (this.keys.path === undefined) {this.keys.path=[];};\n\tif (this.keys.other === undefined) {this.keys.other=[];};\n\tif (this.trash === undefined) {this.trash=[];};\n\tif (this.keys.path.length > 0 ||\n\t    this.keys.other.length > 0 ||\n\t    this.trash.length > 0) {\n\t    // remove duplicates\n\t    //console.log(\"Filtering.\");\n\t    var olen;\n\t    this.keys.path=this.keys.path.filter(this.Unique);\n\t    this.keys.other=this.keys.other.filter(this.Unique);\n\t    this.trash=this.trash.filter(this.Unique);\n\t    //console.log(\"setup:\",JSON.stringify(setup));\n\t    //console.log(\"Remove invalid keys from path.\");\n\t    // remove invalid keys from path\n\t    var plen = this.keys.path.length;\n\t    for (ii = 0; ii < plen; ii++) {\n\t\tkey=this.keys.path[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.keys.path.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    plen=plen-1;\n\t\t}\n\t    }\n\t    //console.log(\"Remove invalid keys from other.\");\n\t    // remove invalid keys from other\n\t    olen = this.keys.other.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.other.rest.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    //console.log(\"Remove invalid keys from trash.\");\n\t    // remove invalid keys from trash\n\t    olen = this.trash.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.trash[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.hidden.keys.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    //console.log(\"Update trash with keys.\");\n\t    // we already have a path, update trash with new keys\n\t    for (key in state.Database.keyCnt) {\n\t\tif (this.keys.path.indexOf(key)  === -1 && \n\t\t    this.keys.other.indexOf(key)  === -1 && \n\t\t    this.trash.indexOf(key)  === -1) {\n\t\t    pathSet[key]=\"trash\";\n\t\t    this.select.val[key]=\"\";\n\t\t    this.where[key]=\"\";\n\t\t    this.trash.push(key);\n\t\t}\n\t    }\n\t} else {\n\t    // new path...\n\t    //console.log(\"New path\");\n\t    // ...define this.select.val for all keys in input data\n\t    for (key in state.Database.keyCnt) {\n\t\tpathSet[key]=\"data\";\n\t    };\n\t    this.keys.path=[];\n\t    this.other.table=[]\n\t    this.other.rest=[]\n\t    this.hidden.keys=[];\n\t    this.hidden.values={};\n\t    this.select.val={}; // no values are set so far\n\t    this.where={}\n\t    //console.log(\"Copy default trash keys.\",JSON.stringify(state.Default.trash));\n\t    // copy default trash keys (that are used) to trash...\n\t    if (state.Default.trash !== undefined) {\n\t\tvar tlen = state.Default.trash.length;\n\t\tfor (ii = 0; ii < tlen; ii++) {\n\t\t    key=state.Default.trash[ii];\n\t\t    if (pathSet[key] !== undefined) {\n\t\t\tif (state.Utils.missing(this.trash,key)) { \n\t\t\t    this.trash.push(key);\n\t\t\t};\n\t\t\tif (state.Utils.missing(this.hidden.keys,key)) {\n\t\t\t    this.hidden.keys.push(key);\n\t\t\t};\n\t\t\tpathSet[key]=undefined; // ignore key from now on...\n\t\t    }\n\t\t}\n\t\t//console.log(\"Pathset:\",JSON.stringify(pathSet),JSON.stringify(state.Default.trash));\n\t    };\n\t    //console.log(\"Copy default other keys.\");\n\t    //console.log(\"Added trash:\",JSON.stringify(setup));\n\t    // copy default other keys (that are used) to other...\n\t    if (state.Default.other !== undefined) {\n\t\tvar klen = state.Default.other.length;\n\t\tfor (ii = 0; ii < klen; ii++) {\n\t\t    key=state.Default.other[ii];\n\t\t    if (pathSet[key] !== undefined) { // key not present in input data\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\tpathSet[key]=\"found\";\n\t\t    }\n\t\t}\n\t    }\n\t    //console.log(\"Add missing keys.\");\n\t    // add missing keys to path\n\t    for (key in state.Database.keyCnt) {\n\t\tif (state.Utils.missing(this.trash,key)) {\n\t\t    if (pathSet[key] === \"data\") {\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\t//console.log(\"Added key:\",key);\n\t\t\tpathSet[key] = \"added\";\n\t\t    }\n\t\t};\n\t    };\n\t    // add undefined values in values\n\t    // for (key in state.Database.keyCnt) {\n\t    //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n\t    // \tstate.Database.values[key].push(undefined);\n\t    //     }\n\t    // }\n\t    // // sort sub-path according to count...\n\t    // this.keys.other=this.keys.other.sort(function(state,a, b) {\n\t    //     if (state.Database.values[a]  === undefined) {\n\t    // \treturn -1;\n\t    //     } else if (state.Database.values[b]  === undefined) {\n\t    // \treturn 1;\n\t    //     } else {\n\t    // \treturn state.Database.values[a].length - state.Database.values[b].length\n\t    //     }\n\t    // });\n\t    //console.log(\"Push other keys to table and rest.\");\n\t    var glen = this.keys.other.length;\n\t    for (ii = 0; ii < glen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (ii<2) {\n\t\t    this.other.table.push(key);\n\t\t} else {\n\t\t    this.other.rest.push(key);\n\t\t}\n\t    }\n\t}\n\tstate.Navigate.reset(state);\n\t//console.log(\"keys:\",JSON.stringify(state.Database.values));\n\t//console.log(\"Completed makepath.\");\n    };\n    this.getIndex=function(state,trg) {\n\treturn this.keys.path.indexOf(trg);\n    };\n    this.exportAllKeys=function(state) { // export keys from \"all\" to \"rest\"\n\tthis.other.table=[];\n\tthis.other.rest=[];\n\tvar jj=0;\n\tvar key,ii;\n\tif (this.keys.other !== undefined) {\n\t    var olen=this.keys.other.length;\n\t    for (ii=0;ii<olen;ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (state.Matrix.keyCnt[key] !== undefined &&\n\t\t    state.Matrix.keyCnt[key] > 0) {\n\t\t    if (jj < 2) {\n\t\t\tthis.other.table.push(key);\n\t\t\tjj=jj+1;\n\t\t    } else {\n\t\t\tthis.other.rest.push(key);\n\t\t    }\n\t\t}\n\t    };\n\t}\n\tthis.hidden.keys=[];\n\tif (this.trash !== undefined) {\n\t    var tlen=this.trash.length;\n\t    for (ii=0;ii<tlen;ii++) {\n\t\tkey=this.trash[ii];\n\t\tif (this.ignore.indexOf(key) === -1) {\n\t\t    //if (state.Matrix.keyCnt[key] !== undefined) {\n\t\t    this.hidden.keys.push(key);\n\t\t}\n\t    }\n\t};\n\t//this.sortTableKeys(state);\n\t//console.log(\"Exported:\",JSON.stringify(this.other));\n    }\n    this.checkTableKeys=function(state) {\n\tvar ret=[];\n\tvar where = state.Database.getWhere(state);\n\tstate.Matrix.initKeyCnt(state);\n\tstate.Matrix.mapKeyCnt(state,where,0,state.Path.keys.other); // possible table keys (no undefined)\n\tstate.Path.exportAllKeys(state);\n\t//console.log(\"this.checkTableKeys Entering.\",JSON.stringify(setup));\n\tvar keys=state.Path.other.table;\n\tvar bdone= ! keys.length < 2;\n\tvar iinew=-1;\n\tvar jjnew=-1;\n\tvar order=state.Utils.cp(state.Path.keys.other);\n\tdo {\n\t    //console.log(\"this.checkTableKeys Looping.\");\n\t    if (keys.length < 2) {\n\t\tbdone=true;\n\t    } else {\n\t\t// check for number of column values\n\t\tvar docs=state.Database.getCntDocs(state,where,state.Path.other.table); // current table keys\n\t\tvar slen=state.Path.other.table.length;\n\t\tvar hits={};\n\t\tvar maxh={};\n\t\tvar kval={};\n\t\tvar ii,jj,key,val;\n\t\t// loop over docs\n\t\tvar dlen = docs.length;\n\t\tfor (ii = 0; ii < dlen; ii++) {\n    \t\t    var doc=docs[ii];\n\t\t    //console.log(\"Trash doc=\",ii,JSON.stringify(doc));\n\t\t    for (jj=0;jj<slen;jj++) {\n\t\t\tkey=state.Path.other.table[jj];\n\t\t\tif (doc[key] !== undefined) {\n\t\t\t    val=doc[key];\n\t\t\t    kval[key]=val;\n\t\t\t    if (hits[key]  === undefined) {hits[key]={};}\n\t\t\t    hits[key][val] = 1+ (hits[key][val]||0);\n\t\t\t    //console.log(\"Found:\",key,val,hits[key][val]);\n\t\t\t    if (hits[key][val] > (maxh[key]||0)) {\n\t\t\t\tmaxh[key]=hits[key][val];\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t\t//console.log(\"this.checkTableKeys Checking.\",dlen);\n\t\tvar rm={};\n\t\tbdone=true;\n\t\t//console.log(\"Max:\",JSON.stringify(maxh));\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    rm[key]=\"\";\n\t\t    //console.log(\"Checking:\",key,JSON.stringify(maxh));\n\t\t    if (maxh[key] !== undefined) {\n\t\t\tif (maxh[key]  === 1) {\n\t\t\t    rm[key]=\"other\";\n\t\t\t} else if (maxh[key]  === dlen) { // remove key from table\n\t\t\t    rm[key]=\"self\";\n\t\t\t}\n\t\t    }\n\t\t}\n\t\tvar rmthis={};\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    if (rm[key]  === \"other\") {\n\t\t\tfor (var kk=0;kk<slen;kk++) {\n\t\t\t    var rkey=state.Path.other.table[kk];\n\t\t\t    if (kk !== jj) {\n\t\t\t\trmthis[rkey]=\"trash\";\n\t\t\t\tiinew=kk;\n\t\t\t    }\n\t\t\t}\n\t\t    } else if (rm[key]  === \"self\") {\n\t\t\trmthis[key]=\"path\";\n\t\t\tjjnew=jj;\n\t\t    }\n\t\t}\n\t\tif (iinew !== -1 && jjnew !== -1) {\n\t\t    iinew=-1;\n\t\t    jjnew=-1;\n\t\t}\n\t\t//console.log(\"Rm:\",JSON.stringify(rmthis),JSON.stringify(rm));\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    if (rmthis[key] !== undefined) {\n\t\t\tbdone=false;\n\t\t\tvar sin=state.Path.keys.other.indexOf(key);\n\t\t\tif (sin !== -1) {\n\t\t\t    if (jj  === 0) {\n\t\t\t\t// flipTable\n\t\t\t\t//console.log(\"Flipped table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n\t\t\t    } else {\n\t\t\t\t//console.log(\"Not Flipping table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n\t\t\t    };\n\t\t\t    var src=state.Path.keys.other.splice(sin, 1); // remove from path\n\t\t\t    if (rmthis[key]  === \"trash\") {// trash key\n\t\t\t\t//console.log(\"### Trashing:\",key);\n\t\t\t\tstate.Path.trash=state.Path.trash.concat(src); // last path position\n\t\t\t\tret=ret.concat(src);\n\t\t\t    } else if (rmthis[key]  === \"path\") {// add to path\n\t\t\t\t// add to path...\n\t\t\t\tval=kval[key];\n\t\t\t\t//console.log(\"### Pathing:\",key,val);\n\t\t\t\tstate.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t\t\t\tstate.Path.select.val[key]=[val];\n\t\t\t\tstate.Path.where[key]=key+'=\"'+val+'\"'\n\t\t\t\tthis.order[key]=order;\n\t\t\t\t//this.last.flip[key]=this.getFlip(state);\n\t\t\t    };\n\t\t\t}\n\t\t    }\n\t\t}\n\t\tif (! bdone) {state.Path.exportAllKeys(state);}\n\t    };\n\t} while (! bdone);\n\t//console.log(\"this.checkTableKeys Done.\",JSON.stringify(state.Path.other.table));\n\treturn ret;\n    };\n    // get X-priority, {colx,coly1,coly2...)\n    this.sortTableKeys=function(state){\n\t// make priority index\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\t// sort the array according to priority\n\tthis.other.table=arr.sort(function(a,b){\n\t    if (a  === \"\") { \n\t\treturn 1;\n\t    } else if (b  === \"\") {\n\t\treturn -1;\n\t    } else if (pri[a]<pri[b]) { \n\t\treturn 1;\n\t    } else if (pri[a]>pri[b]) {\n\t\treturn -1;\n\t    } else {\n\t\treturn 0;\n\t    }\n\t});\n\t//console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n\t//\t\" Pri:\",JSON.stringify(state.Layout.priority),\n\t//\t\" P:\",JSON.stringify(pri));\n\treturn\n    };\n    this.keyVal=function(state,key) {\n\tif (this.select.val[key] !== undefined &&\n\t    this.select.val[key] !== null &&\n\t    this.select.val[key] !== \"\") {\n\t    return this.select.val[key];\n\t} else {\n\t    return;\n\t}\n    }    \n    \n    this.keyValOk=function(state,val) {\n\tvar ok=true;\n\tif (this.hidden.level === undefined) { // no level threshold defined, val is ok\n\t} else if (state.Matrix.levCnt[val]  === undefined) { // val does not occur, how strange...\n\t    ok=false;\n\t    //console.log(\"keyValOk -- no levcnt or level\",val);\n\t} else { // val occurs and level threshold defined...\n\t    ok=false;\n\t    for (var lev in state.Matrix.levCnt[val]) {\n\t\tif (this.hidden.level  === null && lev !== null) {\n\t\t    ok=true;\n\t\t} else if (this.hidden.level  === -1 && (lev !== null && lev !== -1)) {\n\t\t    ok=true;\n\t\t} else if (this.hidden.level >= 0 && (lev !== null && lev !== -1 && lev < this.hidden.level )) {\n\t\t    ok=true;\n\t\t}\n\t\t//console.log(\"Checking \",val,lev,this.hidden.level,\"=>\",ok);\n\t    }\n\t    //if (! ok) {\n\t    //\tconsole.log(\"keyValOk -- no valid level\",val,JSON.stringify(state.Matrix.levCnt[val]),this.hidden.level);\n\t    //}\n\t}\n\treturn ok;\n    };\n    this.makeOrder=function(state,typ,order) { // rearrange setup according to order...\n\tif (order !== undefined) {\n\t    var buff=[];\n\t    for (var kk=0; kk < order.length ;kk++){\n\t\tif (order[kk] !== \"\") {\n\t\t    var sin=this.keys[typ].indexOf(order[kk]);\n\t\t    if (sin !== -1) {\n\t\t\tvar src=this.keys[typ].splice(sin, 1); // remove from path\n\t\t\tbuff=buff.concat(src);\n\t\t    }\n\t\t}\n\t    }\n\t    state.Utils.spliceArray(this.keys[typ],0,0,buff);\n\t}\n    };\n    this.moveKey=function(state,styp,skey,ttyp,tid) {\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid, 1);    // remove from path\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKeys=function(state,styp,skeys,ttyp,tid) {\n\tvar len=skeys.length\n\tfor (var ss=0;ss<len;ss++) {\n\t    var skey=skeys[ss];\n\t    var sid=this.keys[styp].indexOf(skey);\n\t    if (sid !== -1) {\n\t\tvar src=this.keys[styp].splice(sid, 1);    // remove from path\n\t\tif (tid  === undefined || tid  === -1) {\n\t\t    this.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t\t} else {\n\t\t    state.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t\t}\n\t    }\n\t}\n    };\n    this.swapTableKey=function(state,skey,tkey) {\n\tvar sid=this.other.table.indexOf(skey);\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== sid && this.other.table.length > 1) {\n\t    var tin2=this.keys.other.indexOf(this.other.table[1]);\n\t    var tkey2=this.keys.other.splice(tin2, 1);    // remove from array\n\t    state.Utils.spliceArray(this.keys.other,0, 0, tkey2);\n\t    //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.delTableKey=function(state,key) {\n\tvar secondkey;\n\tvar secondind;\n\tvar sid=this.keys.other.indexOf(key);\n\tif (sid !== -1) {\n\t    var sin=this.other.table.indexOf(key);\n\t    var save=(sin  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    }\n\t    this.pullKey(state,\"other\",key);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return sin;\n\t}\n    };\n    this.moveTableKey=function(state,skey,ttyp,tid) {\n\tvar sid=this.keys.other.indexOf(skey);\n\tif (sid !== -1) {\n\t    //var sin=\n\t    this.delTableKey(state,skey);\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(skey);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, skey);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKey2Table=function(state,styp,skey,tkey) {\n\t//console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n\tvar tid=this.keys.other.indexOf(tkey);\n\tvar sid=this.keys[styp].indexOf(skey)\n\tif (tid !== -1 && sid !== -1 && skey !== tkey) { // exists and is not the same\n\t    this.keys[styp][sid]=tkey\n\t    this.keys.other[tid]=skey\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash2Table=function(state,tkey) {\n\tvar secondkey;\n\tvar secondind;\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== -1) {\n\t    var save=(tid  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    };\n\t    var tin=this.keys.other.indexOf(tkey);\n\t    this.moveTrash(state,\"other\",tin+1);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash=function(state,ttyp,tin) {\n\tstate.Utils.spliceArray(this.keys[ttyp],tin, 0, this.trash);\n\tthis.trash=[];\n    };\n    this.moveAllKey=function(state,styp,skey,ttyp,tid) {\n\tvar lenp=this.keys[styp].length;\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid,lenp-sid);\n\t    state.Utils.spliceArray(this.keys[ttyp],tid,0,src);\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveAllFirst=function(state,ttyp,tin) {\n\tvar tlen=this.keys[ttyp].length;\n\tvar src=this.keys[ttyp].splice(tin,tlen-tin);\n\tstate.Utils.spliceArray(this.keys[ttyp],0, 0,src);\n    };\n    this.filterKeys=function(state,arr) {\n\tvar out=[];\n\tvar alen=arr.length;\n\tfor(var ii=0; ii<alen; ii++) {\n\t    var val=arr[ii];\n\t    if (this.keyValOk(state,val)) {\n\t\tout.push(val);\n\t    }\n\t}\n\t//console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\treturn out;\n    };\n    this.pullArrayKey=function(state,array,key) {\n\tvar sin=array.indexOf(key);\n\tif (sin !== -1) {\n\t    //var src=\n\t    array.splice(sin, 1);    // remove from path\n\t};\n\treturn sin;\n    };\n    //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n    this.getColKey=function(state) {\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\tif (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n\t    return \"_lon\";\n\t} else if (pri[this.other.table[0]] >= pri[this.other.table[1]]) {\n\t    return this.other.table[0];\n\t} else {\n\t    return this.other.table[1];\n\t}\n    };\n    this.getRowKey=function(state) {\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\tif (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n\t    return \"_lat\";\n\t} else if (pri[this.other.table[0]] >= pri[this.other.table[1]]) {\n\t    return this.other.table[1];\n\t} else {\n\t    return this.other.table[0];\n\t}\n    };\n    this.pushKey=function(state,typ,key,ind) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n\t}\n    };\n    this.pullKey=function(state,typ,key) {\n\tvar sin=this.keys[typ].indexOf(key);\n\tif (sin !== -1) {\n\t    var src=this.keys[typ].splice(sin, 1);    // remove from path\n\t    if (src !== key) {console.log(\"System error:\",src,key);}\n\t    return sin;\n\t};\n    };\n    this.pushColKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,0, 0, key);\n\t}\n    };\n    this.pushRowKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,1, 0, key);\n\t}\n    };\n    this.checkNewPath=function(state,styp,skey) { // check if values are defined for path\n\tvar ok,ii;\n\tvar sid=this.keys.path.indexOf(skey);\n\tif (styp  === this.type.table.ptyp) {\n\t    ok=true;\n\t    var lent=this.other.table.length-1;\n\t    if (sid !== undefined) {lent=sid+1;};\n\t    for (ii = 0; ii <= lent; ii++) {\n\t\tvar key=this.other.table[ii];\n\t\tif (this.keyVal(state,key)  === undefined) {\n\t\t    ok=false;\n\t\t}\n\t    }\n\t} else if (styp  === this.type.rest.ptyp) {\n\t    ok=this.checkNewPath(state,this.type.table.ptyp);\n\t    if (ok) {\n\t\tvar lenr=this.other.rest.length-1;\n\t\tif (sid !== undefined) {lenr=sid+1;};\n\t\tfor (ii = 0; ii <= lenr; ii++) {\n\t\t    key=this.other.rest[ii];\n\t\t    if (this.keyVal(state,key)  === undefined) {\n\t\t\tok=false;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\treturn ok;\n    };\n    //values[key]=values[key].filter(this.Unique);\n    this.Unique=function(value, index, self) { \n\treturn self.indexOf(value)  === index;\n    }\n};\nexport default Path;\n"]},"metadata":{},"sourceType":"module"}