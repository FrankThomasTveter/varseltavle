{"ast":null,"code":"//console.log(\"Loading ThresholdLib.js\");\nfunction Threshold() {\n  this.thrs = undefined; // threshold parameter levels, set by Default\n\n  this.imax = 0; // threshold item types\n\n  this.ithr = 1;\n  this.ikey = 2;\n  this.ilev = 3;\n  this.ival = 4;\n\n  this.init = function (state) {\n    var par = \"Threshold\";\n    state.Utils.init(par, this);\n  };\n\n  this.setThresholds = function (doc, thrs) {\n    if (doc._thr !== undefined) {\n      return [];\n    } else {\n      doc._thr = {};\n\n      if (thrs === undefined) {\n        thrs = this.thrs;\n      }\n\n      ;\n\n      for (var trgkey in thrs) {\n        // loop over thresholds\n        if (doc[trgkey] !== undefined) {\n          var trgval = doc[trgkey]; // trgval-value\n\n          if (thrs[trgkey][trgval] !== undefined) {\n            var mlen, jj, res;\n\n            if (thrs[trgkey][trgval].par === undefined) {\n              // there is another level\n              return this.setThresholds(doc, thrs[trgkey][trgval]);\n            } else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n              var thr = thrs[trgkey][trgval]; //doc.threshold=thr;\n\n              var val = doc[thr[\"par\"]];\n              var maxs = thr[\">\"];\n              var mins = thr[\"<\"];\n              var doclev = -1; // found thresholds, but will we find a valid level?\n\n              if (maxs !== undefined) {\n                // above thresholds\n                var docmax = Number(val);\n                mlen = maxs.length; // get new level\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmax >= Number(maxs[jj])) {\n                    //console.log(\"Hit:\",jj,docmax,tmax[jj],docmax>=tmax[jj],doclev);\n                    doclev = jj;\n                  }\n                }\n\n                doc.level = doclev;\n                doc._thr.level = doclev;\n                doc._thr.val = docmax;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.max = maxs;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"max\"];\n              } else if (mins !== undefined) {\n                // below thresholds\n                var docmin = Number(val); // get new level\n\n                mlen = mins.length;\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmin <= Number(mins[jj])) {\n                    doclev = jj;\n                  }\n                }\n\n                doc.level = doclev;\n                doc._thr.level = doclev;\n                doc._thr.val = docmin;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.min = mins;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"min\"];\n              }\n            }\n          }\n        }\n      }\n\n      doc.level = -2; // no thresholds found...\n    }\n\n    return [];\n  }; // call after this.setThresholds\n\n\n  this.getLevel = function (state, doc) {\n    //console.log(\"GetLevel:\",JSON.stringify(doc));\n    if (doc._thr !== undefined) {\n      return doc._thr.level;\n    } else {\n      return -1;\n    }\n  };\n\n  this.getLat = function (state, doc) {\n    return doc._thr.lat;\n  };\n\n  this.getLon = function (state, doc) {\n    return doc._thr.lon;\n  };\n}\n\n;\nexport default Threshold;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/ThresholdLib.js"],"names":["Threshold","thrs","undefined","imax","ithr","ikey","ilev","ival","init","state","par","Utils","setThresholds","doc","_thr","trgkey","trgval","mlen","jj","res","thr","val","maxs","mins","doclev","docmax","Number","length","level","lat","lon","max","docmin","min","getLevel","getLat","getLon"],"mappings":"AAAA;AAEA,SAASA,SAAT,GAAqB;AACjB,OAAKC,IAAL,GAAUC,SAAV,CADiB,CACI;;AACrB,OAAKC,IAAL,GAAU,CAAV,CAFiB,CAEG;;AACpB,OAAKC,IAAL,GAAU,CAAV;AACA,OAAKC,IAAL,GAAU,CAAV;AACA,OAAKC,IAAL,GAAU,CAAV;AACA,OAAKC,IAAL,GAAU,CAAV;;AACA,OAAKC,IAAL,GAAU,UAASC,KAAT,EAAe;AAC5B,QAAIC,GAAG,GAAC,WAAR;AACAD,IAAAA,KAAK,CAACE,KAAN,CAAYH,IAAZ,CAAiBE,GAAjB,EAAqB,IAArB;AACI,GAHD;;AAIA,OAAKE,aAAL,GAAmB,UAASC,GAAT,EAAaZ,IAAb,EAAmB;AACzC,QAAIY,GAAG,CAACC,IAAJ,KAAaZ,SAAjB,EAA4B;AACxB,aAAO,EAAP;AACH,KAFD,MAEO;AACHW,MAAAA,GAAG,CAACC,IAAJ,GAAS,EAAT;;AACA,UAAIb,IAAI,KAAKC,SAAb,EAAwB;AAC3BD,QAAAA,IAAI,GAAC,KAAKA,IAAV;AACI;;AAAA;;AACD,WAAK,IAAIc,MAAT,IAAmBd,IAAnB,EAAyB;AAAE;AAC9B,YAAIY,GAAG,CAACE,MAAD,CAAH,KAAgBb,SAApB,EAA+B;AAC3B,cAAIc,MAAM,GAACH,GAAG,CAACE,MAAD,CAAd,CAD2B,CACH;;AACxB,cAAId,IAAI,CAACc,MAAD,CAAJ,CAAaC,MAAb,MAAyBd,SAA7B,EAAwC;AAC3C,gBAAIe,IAAJ,EAASC,EAAT,EAAYC,GAAZ;;AACA,gBAAIlB,IAAI,CAACc,MAAD,CAAJ,CAAaC,MAAb,EAAqBN,GAArB,KAA6BR,SAAjC,EAA4C;AAAE;AAC1C,qBAAO,KAAKU,aAAL,CAAmBC,GAAnB,EAAuBZ,IAAI,CAACc,MAAD,CAAJ,CAAaC,MAAb,CAAvB,CAAP;AACH,aAFD,MAEO,IAAIH,GAAG,CAACZ,IAAI,CAACc,MAAD,CAAJ,CAAaC,MAAb,EAAqBN,GAAtB,CAAH,KAAkCR,SAAtC,EAAiD;AACpD,kBAAIkB,GAAG,GAAGnB,IAAI,CAACc,MAAD,CAAJ,CAAaC,MAAb,CAAV,CADoD,CAEpD;;AACA,kBAAIK,GAAG,GAAGR,GAAG,CAACO,GAAG,CAAC,KAAD,CAAJ,CAAb;AACA,kBAAIE,IAAI,GAAGF,GAAG,CAAC,GAAD,CAAd;AACA,kBAAIG,IAAI,GAAGH,GAAG,CAAC,GAAD,CAAd;AACA,kBAAII,MAAM,GAAC,CAAC,CAAZ,CANoD,CAMrC;;AACf,kBAAIF,IAAI,KAAKpB,SAAb,EAAwB;AAAE;AAC7B,oBAAIuB,MAAM,GAACC,MAAM,CAACL,GAAD,CAAjB;AACAJ,gBAAAA,IAAI,GAACK,IAAI,CAACK,MAAV,CAF2B,CAG3B;;AACA,qBAAKT,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGD,IAAlB,EAAwBC,EAAE,EAA1B,EAA8B;AAC1B,sBAAIO,MAAM,IAAIC,MAAM,CAACJ,IAAI,CAACJ,EAAD,CAAL,CAApB,EAAgC;AACnC;AACAM,oBAAAA,MAAM,GAACN,EAAP;AACI;AACJ;;AACDL,gBAAAA,GAAG,CAACe,KAAJ,GAAUJ,MAAV;AACAX,gBAAAA,GAAG,CAACC,IAAJ,CAASc,KAAT,GAAeJ,MAAf;AACAX,gBAAAA,GAAG,CAACC,IAAJ,CAASO,GAAT,GAAaI,MAAb;AACAZ,gBAAAA,GAAG,CAACC,IAAJ,CAASe,GAAT,GAAahB,GAAG,CAACO,GAAG,CAAC,KAAD,CAAJ,CAAhB;AACAP,gBAAAA,GAAG,CAACC,IAAJ,CAASgB,GAAT,GAAajB,GAAG,CAACO,GAAG,CAAC,KAAD,CAAJ,CAAhB;AACAP,gBAAAA,GAAG,CAACC,IAAJ,CAASiB,GAAT,GAAaT,IAAb;AACA,uBAAO,CAAC,OAAD,EAAS,KAAT,EAAe,KAAf,EAAqB,KAArB,EAA2B,KAA3B,CAAP;AACI,eAjBD,MAiBO,IAAIC,IAAI,KAAKrB,SAAb,EAAwB;AAAE;AACpC,oBAAI8B,MAAM,GAACN,MAAM,CAACL,GAAD,CAAjB,CADkC,CAElC;;AACAJ,gBAAAA,IAAI,GAACM,IAAI,CAACI,MAAV;;AACA,qBAAKT,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGD,IAAlB,EAAwBC,EAAE,EAA1B,EAA8B;AAC1B,sBAAIc,MAAM,IAAIN,MAAM,CAACH,IAAI,CAACL,EAAD,CAAL,CAApB,EAAgC;AACnCM,oBAAAA,MAAM,GAACN,EAAP;AACI;AACJ;;AACDL,gBAAAA,GAAG,CAACe,KAAJ,GAAUJ,MAAV;AACAX,gBAAAA,GAAG,CAACC,IAAJ,CAASc,KAAT,GAAeJ,MAAf;AACAX,gBAAAA,GAAG,CAACC,IAAJ,CAASO,GAAT,GAAaW,MAAb;AACAnB,gBAAAA,GAAG,CAACC,IAAJ,CAASe,GAAT,GAAahB,GAAG,CAACO,GAAG,CAAC,KAAD,CAAJ,CAAhB;AACAP,gBAAAA,GAAG,CAACC,IAAJ,CAASgB,GAAT,GAAajB,GAAG,CAACO,GAAG,CAAC,KAAD,CAAJ,CAAhB;AACAP,gBAAAA,GAAG,CAACC,IAAJ,CAASmB,GAAT,GAAaV,IAAb;AACA,uBAAO,CAAC,OAAD,EAAS,KAAT,EAAe,KAAf,EAAqB,KAArB,EAA2B,KAA3B,CAAP;AACI;AACJ;AACG;AACJ;AACG;;AACDV,MAAAA,GAAG,CAACe,KAAJ,GAAU,CAAC,CAAX,CAzDG,CAyDY;AAClB;;AACD,WAAO,EAAP;AACI,GA/DD,CAXiB,CA2EjB;;;AACA,OAAKM,QAAL,GAAc,UAASzB,KAAT,EAAeI,GAAf,EAAoB;AACrC;AACA,QAAIA,GAAG,CAACC,IAAJ,KAAaZ,SAAjB,EAA4B;AACxB,aAAOW,GAAG,CAACC,IAAJ,CAASc,KAAhB;AACH,KAFD,MAEO;AACH,aAAO,CAAC,CAAR;AACH;AACG,GAPD;;AAQA,OAAKO,MAAL,GAAY,UAAS1B,KAAT,EAAeI,GAAf,EAAoB;AACnC,WAAOA,GAAG,CAACC,IAAJ,CAASe,GAAhB;AACI,GAFD;;AAGA,OAAKO,MAAL,GAAY,UAAS3B,KAAT,EAAeI,GAAf,EAAoB;AACnC,WAAOA,GAAG,CAACC,IAAJ,CAASgB,GAAhB;AACI,GAFD;AAGH;;AAAA;AACD,eAAe9B,SAAf","sourcesContent":["//console.log(\"Loading ThresholdLib.js\");\n\nfunction Threshold() {\n    this.thrs=undefined; // threshold parameter levels, set by Default\n    this.imax=0;        // threshold item types\n    this.ithr=1;\n    this.ikey=2;\n    this.ilev=3;\n    this.ival=4;\n    this.init=function(state){\n\tvar par=\"Threshold\";\n\tstate.Utils.init(par,this);\n    };\n    this.setThresholds=function(doc,thrs) {\n\tif (doc._thr !== undefined) {\n\t    return [];\n\t} else {\n\t    doc._thr={};\n\t    if (thrs === undefined) {\n\t\tthrs=this.thrs;\n\t    };\n\t    for (var trgkey in thrs) { // loop over thresholds\n\t\tif (doc[trgkey] !== undefined) {\n\t\t    var trgval=doc[trgkey]; // trgval-value\n\t\t    if (thrs[trgkey][trgval] !== undefined) {\n\t\t\tvar mlen,jj,res;\n\t\t\tif (thrs[trgkey][trgval].par === undefined) { // there is another level\n\t\t\t    return this.setThresholds(doc,thrs[trgkey][trgval]);\n\t\t\t} else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n\t\t\t    var thr = thrs[trgkey][trgval]\n\t\t\t    //doc.threshold=thr;\n\t\t\t    var val = doc[thr[\"par\"]];\n\t\t\t    var maxs = thr[\">\"];\n\t\t\t    var mins = thr[\"<\"];\n\t\t\t    var doclev=-1; // found thresholds, but will we find a valid level?\n\t\t\t    if (maxs !== undefined) { // above thresholds\n\t\t\t\tvar docmax=Number(val);\n\t\t\t\tmlen=maxs.length;\n\t\t\t\t// get new level\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmax >= Number(maxs[jj])) {\n\t\t\t\t\t//console.log(\"Hit:\",jj,docmax,tmax[jj],docmax>=tmax[jj],doclev);\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmax\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.max=maxs;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"max\"];\n\t\t\t    } else if (mins !== undefined) { // below thresholds\n\t\t\t\tvar docmin=Number(val);\n\t\t\t\t// get new level\n\t\t\t\tmlen=mins.length;\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmin <= Number(mins[jj])) {\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmin\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.min=mins;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"min\"];\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t    doc.level=-2;  // no thresholds found...\n\t}\n\treturn [];\n    };\n    // call after this.setThresholds\n    this.getLevel=function(state,doc) {\n\t//console.log(\"GetLevel:\",JSON.stringify(doc));\n\tif (doc._thr !== undefined) {\n\t    return doc._thr.level;\n\t} else {\n\t    return -1;\n\t}\n    }\n    this.getLat=function(state,doc) {\n\treturn doc._thr.lat;\n    }\n    this.getLon=function(state,doc) {\n\treturn doc._thr.lon;\n    };\n};\nexport default Threshold;\n"]},"metadata":{},"sourceType":"module"}