{"ast":null,"code":"//console.log(\"Loading Series2DLib.js\");\nfunction Series2D() {\n  this.Show = function (state, matrix, item, skeys, colkey, colvalues, rowkey, rowvalues, step) {\n    // make header row\n    var row = document.createElement(\"TR\"); //console.log(\"Col=\",colkey,\" row=\",rowkey);\n\n    this.appendHeaderRow2D(state, matrix, row, rowkey, colkey, colvalues, step);\n    item.appendChild(row); // make data rows\n\n    var rlen = rowvalues.length;\n\n    for (var ii = 0; ii < rlen; ii++) {\n      var rel = ii === 0 ? \"first\" : (state, ii === rlen - 1 ? \"last\" : \"middle\"); // make \"header\" column\n\n      row = document.createElement(\"TR\");\n      this.appendDataRow2D(state, matrix, row, colkey, colvalues, rowkey, rowvalues[ii], rel, step);\n      item.appendChild(row);\n    }\n  };\n\n  this.appendHeaderRow2D = function (state, matrix, row, rowkey, colkey, colvalues, step) {\n    state.Html.appendRotateElement(state, row, rowkey, colkey); // add rotation-element\n\n    var clen = colvalues.length;\n\n    for (var ii = 0; ii < clen; ii = ii + step) {\n      var rel = ii === 0 ? \"first\" : (state, ii === clen - 1 ? \"last\" : \"middle\");\n      var rotate = (state.Layout.rotate || {})[colkey] || \"\";\n      var colval = colvalues[ii];\n      var where = \"\";\n      var cnt = 0;\n\n      for (var kk = ii; kk < Math.min(clen, ii + step); kk++) {\n        if (where !== \"\") {\n          where = where + \" or \";\n        }\n\n        where = where + state.Database.getWhereDetail(colkey, colvalues[kk]);\n        cnt = cnt + 1;\n      }\n\n      ; // make \"header\" column\n\n      row.appendChild(state.Html.makeHeaderElement(state, colkey, // pkey\n      colval || \"\", // pval\n      rel, // prel\n      \"Col\", // ptyp\n      \"state.Layout.selectKey(state,'\" + colkey + \"','\" + (colval || \"\") + \"','\" + where + \"','\" + cnt + \"');\", where, rotate));\n    }\n  };\n\n  this.appendDataRow2D = function (state, matrix, row, colkey, colvalues, rowkey, rowval, rel, step) {\n    if (rowkey === \"\") {\n      state.Html.appendEmptyHeader(state, row); // add empty element\n    } else {\n      var where = state.Database.getWhereDetail(rowkey, rowval || \"\");\n      row.appendChild(state.Html.makeHeaderElement(state, rowkey, // pkey\n      rowval || \"\", // pval\n      rel, // prel\n      \"row\", // ptyp\n      \"state.Layout.selectKey(state,'\" + rowkey + \"','\" + (rowval || \"\") + \"','\" + where + \"','1');\", where, \"\" // never rotate\n      ));\n    }\n\n    ;\n    var range = state.Matrix.getRange(state, matrix, colvalues, [rowval]);\n    var clen = colvalues.length;\n\n    for (var jj = 0; jj < clen; jj = jj + step) {\n      var colwhere = \"\";\n      var cnt = 0;\n      var elements = undefined;\n\n      for (var kk = jj; kk < jj + step; kk++) {\n        var element = state.Matrix.getMatrixElement(colvalues[kk], rowval, matrix);\n\n        if (element === undefined) {} else {\n          //console.log(\"Found:\",kk,colvalues[kk],rowval);\n          if (elements === undefined) {\n            elements = [];\n          }\n\n          ;\n          elements.push(element);\n        }\n\n        if (colwhere !== \"\") {\n          colwhere = colwhere + \" or \";\n        }\n\n        colwhere = colwhere + state.Database.getWhereDetail(colkey, colvalues[kk]);\n        cnt = cnt + 1;\n      } //console.log(\"Canvas element:\",rowval,\n      //\t    JSON.stringify(elements),\" values=\",\n      //\t    JSON.stringify(colvalues.slice(state,jj,jj+step)));\n\n\n      if (elements === undefined) {\n        state.Html.appendEmptyData(state, row); // add empty element\n      } else {\n        if (elements !== undefined) {\n          var rowwhere = state.Database.getWhereDetail(rowkey, rowval || \"\");\n          row.appendChild(state.Html.makeCanvasElement(state, elements, colkey, colvalues.slice(state, jj, jj + step), range, \"state.Layout.selectItem(state,'\" + colkey + \"','\" + rowkey + \"','\" + colvalues[jj] + \"','\" + rowval + \"','\" + colwhere + \"','\" + rowwhere + \"','\" + cnt + \"','1');\", \"(state,\" + colwhere + \") AND (\" + rowwhere + \")\", step)); //} else {\n          //\tconsole.log(\"No elements found.\");\n        }\n\n        ;\n      }\n\n      ;\n    }\n  };\n}\n\n;\nexport default Series2D;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/js/Series2DLib.js"],"names":["Series2D","Show","state","matrix","item","skeys","colkey","colvalues","rowkey","rowvalues","step","row","document","createElement","appendHeaderRow2D","appendChild","rlen","length","ii","rel","appendDataRow2D","Html","appendRotateElement","clen","rotate","Layout","colval","where","cnt","kk","Math","min","Database","getWhereDetail","makeHeaderElement","rowval","appendEmptyHeader","range","Matrix","getRange","jj","colwhere","elements","undefined","element","getMatrixElement","push","appendEmptyData","rowwhere","makeCanvasElement","slice"],"mappings":"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","sourcesContent":["//console.log(\"Loading Series2DLib.js\");\n\nfunction Series2D() {\n    this.Show=function(state,matrix,item,skeys,colkey,colvalues,rowkey,rowvalues,step){\n\t// make header row\n\tvar row = document.createElement(\"TR\");\n\t//console.log(\"Col=\",colkey,\" row=\",rowkey);\n\tthis.appendHeaderRow2D(state,matrix,row,rowkey,colkey,colvalues,step);\n\titem.appendChild(row);\n\t// make data rows\n\tvar rlen=rowvalues.length;\n\tfor(var ii=0; ii<rlen; ii++) {\n\t    var rel = (ii === 0?\"first\":(state,ii === rlen-1?\"last\":\"middle\"));\n\t    // make \"header\" column\n\t    row = document.createElement(\"TR\");\n\t    this.appendDataRow2D(state,matrix,row,colkey,colvalues,rowkey,rowvalues[ii],rel,step);\n\t    item.appendChild(row);\n\t}\n    };\n    this.appendHeaderRow2D=function(state,matrix,row,rowkey,colkey,colvalues,step) {\n\tstate.Html.appendRotateElement(state,row,rowkey,colkey); // add rotation-element\n\tvar clen=colvalues.length;\n\tfor(var ii=0; ii<clen; ii=ii+step) {\n\t    var rel = (ii === 0?\"first\":(state,ii === clen-1?\"last\":\"middle\"));\n\t    var rotate=(state.Layout.rotate||{})[colkey]||\"\";\n\t    var colval = colvalues[ii];\n\t    var where = \"\";\n\t    var cnt=0;\n\t    for (var kk=ii;kk<Math.min(clen,ii+step);kk++) {\n\t\tif (where !== \"\") {where=where + \" or \";}\n\t\twhere=where + state.Database.getWhereDetail(colkey,colvalues[kk]);\n\t\tcnt=cnt+1;\n\t    };\n\t    // make \"header\" column\n\t    row.appendChild(\n\t\tstate.Html.makeHeaderElement(state,\n\t\t    colkey,         // pkey\n\t\t    colval||\"\",         // pval\n\t\t    rel,          // prel\n\t\t    \"Col\",        // ptyp\n\t\t    \"state.Layout.selectKey(state,'\"+colkey+\"','\"+(colval||\"\")+\"','\"+where+\"','\"+cnt+\"');\",\n\t\t    where,\n\t\t    rotate\n\t\t)\n\t    );\n\t}\n    };\n    this.appendDataRow2D=function(state,matrix,row,colkey,colvalues,rowkey,rowval,rel,step) {\n\tif (rowkey === \"\") {\n\t    state.Html.appendEmptyHeader(state,row);// add empty element\n\t} else {\n\t    var where=state.Database.getWhereDetail(rowkey,(rowval||\"\"));\n\t    row.appendChild(\n\t\tstate.Html.makeHeaderElement(state,\n\t\t    rowkey,         // pkey\n\t\t    rowval||\"\",     // pval\n\t\t    rel,          // prel\n\t\t    \"row\",        // ptyp\n\t\t    \"state.Layout.selectKey(state,'\"+rowkey+\"','\"+(rowval||\"\")+\"','\"+where+\"','1');\",\n\t\t    where,\n\t\t    \"\" // never rotate\n\t\t));\n\t};\n\tvar range=state.Matrix.getRange(state,matrix,colvalues,[rowval]);\n\tvar clen=colvalues.length;\n\tfor(var jj=0; jj<clen; jj=jj+step) {\n\t    var colwhere = \"\";\n\t    var cnt=0;\n\t    var elements=undefined\n\t    for (var kk=jj;kk<jj+step;kk++) {\n\t\tvar element=state.Matrix.getMatrixElement(colvalues[kk],rowval,matrix);\n\t\tif (element  === undefined) {\n\t\t} else {\n\t\t    //console.log(\"Found:\",kk,colvalues[kk],rowval);\n\t\t    if (elements === undefined) {elements=[];};\n\t\t    elements.push(element);\n\t\t}\n\t\tif (colwhere !== \"\") {colwhere=colwhere + \" or \";}\n\t\tcolwhere=colwhere + state.Database.getWhereDetail(colkey,colvalues[kk]);\n\t\tcnt=cnt+1;\n\t    }\n\t    //console.log(\"Canvas element:\",rowval,\n\t    //\t    JSON.stringify(elements),\" values=\",\n\t    //\t    JSON.stringify(colvalues.slice(state,jj,jj+step)));\n\t    if (elements  === undefined) {\n\t\tstate.Html.appendEmptyData(state,row);// add empty element\n\t    } else {\n\t\tif (elements !== undefined) {\n\t\t    var rowwhere=state.Database.getWhereDetail(rowkey,(rowval||\"\"));\n\t\t    row.appendChild(\n\t\t\tstate.Html.makeCanvasElement(state,\n\t\t\t    elements,\n\t\t\t    colkey,\n\t\t\t    colvalues.slice(state,jj,jj+step),\n\t\t\t    range,\n\t\t\t    \"state.Layout.selectItem(state,'\"+colkey+\"','\"+rowkey+\"','\"+colvalues[jj]+\"','\"+rowval+\"','\"+\n\t\t\t\tcolwhere+\"','\"+rowwhere+\"','\"+cnt+\"','1');\",\n\t\t\t    \"(state,\"+colwhere+\") AND (\"+rowwhere+\")\",step)\n\t\t    );\n\t\t    //} else {\n\t\t    //\tconsole.log(\"No elements found.\");\n\t\t};\n\t    };\n\t}\n    }\n};\nexport default Series2D;\n"]},"metadata":{},"sourceType":"module"}