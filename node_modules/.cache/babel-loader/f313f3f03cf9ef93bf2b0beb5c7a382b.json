{"ast":null,"code":"//console.log(\"Loading LayoutLib.js\");\nfunction Layout(){this.rotate=undefined;// should labels on x-axis be rotated?\nthis.priority=undefined;// which key should be on the abscissa\nthis.init=function(state){state.Utils.init(\"Layout\",this);};this.fullscreen=false;this.fonts=[\"12px Fixed\",\"18px Fixed\",\"24px Fixed\",\"36px Fixed\",\"48px Fixed\"];//\nthis.state={viewMode:0,// should we show trash contents?\ncellMode:0,// sum, series, item\nlayoutMode:0,// table, list, map\ncfont:0,tooltip:1};this.modes={view:{nopath:0,path:1},cell:{Sum:0,Series:1},layout:{Table:0,List:1,Map:2}};this.toggleTooltip=function(state){this.state.tooltip=(this.state.tooltip+1)%3;//console.log(\"Tooltip:\",this.state.tooltip);\nstate.Utils.pushUrl(state);state.Show.show(state,true);};this.changeFont=function(state){this.state.cfont=(this.state.cfont+1)%this.fonts.length;state.Utils.pushUrl(state);state.Show.show(state,false);};this.toggleView=function(state){//console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\nif(this.state.viewMode===this.modes.view.nopath){this.state.viewMode=this.modes.view.path;}else if(this.state.viewMode===this.modes.view.path){this.state.viewMode=this.modes.view.nopath;};//console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\nstate.Show.showPath(state);state.Show.showConfig(state);};this.toggleMode=function(state,layoutMode,cellMode){console.log(\"Mode:\",layoutMode,cellMode);//var reload=(layoutMode !== state.Layout.state.layoutMode);\nvar reload=state.Layout.state.layoutMode===state.Layout.modes.layout.Map&&layoutMode!==state.Layout.modes.layout.Map||state.Layout.state.layoutMode!==state.Layout.modes.layout.Map&&layoutMode===state.Layout.modes.layout.Map;state.Layout.state.layoutMode=layoutMode;state.Layout.state.cellMode=cellMode;//state.Show.showConfig(state);\nstate.Show.showAll(state,reload);};this.getDim=function(state){//console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\nvar colkey=state.Path.getColKey(state);var rowkey=state.Path.getRowKey(state);if(colkey!==undefined&&rowkey!==undefined){return 2;}else if(colkey!==undefined||rowkey!==undefined){return 1;}else{return 0;}};this.setLayoutMode=function(state,mode){var om=this.state.layoutMode;var o=this.getLayoutMode(state);this.state.layoutMode=mode;var n=this.getLayoutMode(state);//console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\nif(o!==n){state.Show.showAll(state);}else if(om!==mode){state.Show.showMode(state);}};this.setCellMode=function(state,mode){var om=this.state.cellMode;var o=this.getCellMode(state);this.state.cellMode=mode;var n=this.getCellMode(state);//console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\nif(o!==n){state.Show.showAll(state);}else if(om!==mode){state.Show.showMode(state);}};this.getLayoutMode=function(state){//console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\nvar mode=this.state.layoutMode;if(mode===this.modes.layout.List&&state.Matrix.cnt>state.Matrix.popSeries){mode=this.modes.layout.Table;}return mode;};this.getCellMode=function(state){var mode=this.state.cellMode;if(mode===this.modes.cell.Single&&state.Matrix.cnt>state.Matrix.popSingle){mode=this.modes.cell.Series;}if(mode===this.modes.cell.Series&&state.Matrix.cnt>state.Matrix.popSeries){mode=this.modes.cell.Sum;}return mode;};this.toggleFullScreen=function(state){//var pos=0;\nif(!document.fullscreenElement&&// alternative standard method\n!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){// current working methods\nif(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen();//pos=1;\n}else if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen();//pos=2;\n}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen();//pos=3;\n}else if(document.webkitRequestFullscreen){document.webkitRequestFullscreen();//pos=4;\n}else{//pos=5;\n}this.fullscreen=true;}else{if(document.exitFullscreen){document.exitFullscreen();//pos=6;\n}else if(document.msExitFullscreen){document.msExitFullscreen();//pos=7;\n}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();//pos=8;\n}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();//pos=9;\n}else{//pos=10;\n}this.fullscreen=false;}state.Show.showConfig(state);console.log(\"Toggle fullscreen:\",this.fullscreen);};// adjust keys so that rows/cols have more than on entry...\nthis.getPriorityKeys=function(state){if(state.Layout.priority===undefined){state.Layout.priority=state.Database.keyCnt.keys();}else{var keys=Object.keys(state.Database.keyCnt);;var plen=keys;for(var ii=0;ii<plen;ii++){var key=keys[ii];if(state.Layout.priority.indexOf(key)===-1){state.Layout.priority.push(key);}};};return state.Layout.priority;//state.Utils.invertedArray()\n};this.increaseSelect=function(state,key){var kid=state.Path.keys.path.indexOf(key);console.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));if(kid!==-1&&kid>0){var src=state.Path.keys.path.splice(kid,1);// remove from array   \nstate.Utils.spliceArray(state.Path.keys.path,kid-1,0,src);}state.Show.showConfig(state);state.Show.showPath(state);};this.increasePriority=function(state,key){var kid=state.Layout.priority.indexOf(key);console.log(\"Bumping:\",key,kid,JSON.stringify(state.Layout.priority));if(kid!==-1&&kid>0){var src=state.Layout.priority.splice(kid,1);// remove from array   \nstate.Utils.spliceArray(state.Layout.priority,kid-1,0,src);}state.Show.showConfig(state);};this.getPriorityIndex=function(state,arr){var len,ii;var pri={};len=arr.length;for(ii=0;ii<len;ii++){pri[arr[ii]]=0;};if(this.priority!==undefined){len=this.priority.length;for(ii=0;ii<len;ii++){var key=this.priority[ii];pri[key]=len+1-ii;};};return pri;};this.changePriority=function(state,key,trg){// key -> trg\nif(key===undefined||trg===undefined){return;}console.log(\"Priority:\",key,\"->\",trg,JSON.stringify(this.priority));//if (typeof trg  === \"undefined\") {\nvar col=state.Path.other.table[0];var row=state.Path.other.table[1];//var icol=0;\n//var irow=0;\nvar ikey=0;var itrg=0;var len=this.priority.length;for(var ii=0;ii<len;ii++){if(this.priority[ii]===col){//icol=len+1-ii;\n};if(this.priority[ii]===row){//irow=len+1-ii;\n};if(this.priority[ii]===key){ikey=len+1-ii;}if(this.priority[ii]===trg){itrg=len+1-ii;}}if(itrg<ikey){// demote existing key\nif(itrg>0){// key exists on priority list\nstate.Utils.spliceArray(this.priority,len+2-itrg,0,key);// add after\nconsole.log(\"Added:\",JSON.stringify(this.priority),ikey,itrg,key);//var src=\nthis.priority.splice(len+1-ikey,1);// remove\n}else{// key exists, target does not\n//var src=\nthis.priority.splice(len+1-ikey,1);// remove\nthis.priority.concat(key);}}else if(itrg>ikey){// demote, key may not exist on priority list\nif(ikey>0){// key exists on priority list\n//var src=\nthis.priority.splice(len+1-ikey,1);// remove\nstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);// add before\n}else{// key is not on priority list\nstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);// add before\n}}else if(itrg===0){// key and target not on the priority list\nthis.priority.concat(key);}console.log(\"Changed priority:\",JSON.stringify(this.priority),ikey,itrg);return true;};//this.flipTable=function(state) {\n//    var bb=this.colrow[0];\n//    this.colrow[0]=this.colrow[1];\n//    this.colrow[1]=bb;\n//    //console.log(\"Setup:\",JSON.stringify(setup));\n//};\nthis.getPriority=function(state){return state.Utils.cp(this.priority);};this.setPriority=function(state,priority){this.priority=priority;};this.getDescription=function(state,element,skeys){if(element.cnt===1){var s=\"\";var docs=element.docs;var doc=docs[0];var klen=skeys.length;for(var jj=0;jj<klen;jj++){var d=skeys[jj]+\"=\"+doc[skeys[jj]];;if(s!==\"\"){s=s+\" \"+d;}else{s=d;}}return s;}else{return element.cnt;}};this.setPlan=function(plan,set){var keys=Object.keys(set);var lenk=keys.length;for(var ii=0;ii<lenk;ii++){var key=keys[ii];var val=set[key];plan[key]=val;};};this.getTextWidth=function(txt,fontname,fontsize){if(this.getTextWidth.c===undefined){this.getTextWidth.c=document.createElement('canvas');this.getTextWidth.ctx=this.getTextWidth.c.getContext('2d');}if(fontname!==undefined){this.getTextWidth.ctx.font=fontsize+' '+fontname;}else{this.getTextWidth.ctx.font=this.fonts[this.state.cfont];}return this.getTextWidth.ctx.measureText(txt).width;};this.getTextHeight=function(fontname,fontsize){if(this.getTextHeight.c===undefined){this.getTextHeight.c=document.createElement('canvas');this.getTextHeight.ctx=this.getTextHeight.c.getContext('2d');}if(fontname!==undefined){this.getTextHeight.ctx.font=fontsize+' '+fontname;}else{this.getTextHeight.ctx.font=this.fonts[this.state.cfont];}return this.getTextHeight.ctx.measureText('M').width;};this.getDescender=function(fontname,fontsize){return this.getTextHeight(fontname,fontsize)*0.3;};this.maxWidth=function(values,border){var swidth=0;var mwidth=0;var lenv=values.length;for(var ii=0;ii<lenv;ii++){var cwidth=this.getTextWidth(values[ii])+2*border;if(cwidth>mwidth){mwidth=cwidth;}swidth=swidth+cwidth;}return{max:mwidth,sum:swidth};};this.makeDocTitle=function(state,doc){var title=\"\";var len=state.Path.tooltip.keys.length;for(var ii=0;ii<len;ii++){var key=state.Path.tooltip.keys[ii];if(doc[key]!==undefined){if(title!==\"\"){title=title+\", \";};title=title+key+\"=\"+doc[key];};}return title;};this.makeCntTitle=function(state,docs){var title=\"\";if(this.state.title===1){var dlen=docs.length;for(var ii=0;ii<dlen;ii++){var doc=docs[ii];if(doc._title!==undefined){if(title!==\"\"){title=title+\"|\";};title=title+doc._title;}}}return title;};this.makePlans=function(colkey,rowkey,colvalues,rowvalues,iwidth,iheight,border){var descender=this.getDescender();if(border===null){border=0;}border=border+descender+1;// text boundaries\nvar mheight=this.getTextHeight()+2*(descender+1);//props.theme.spacing.unit;\nvar plans={cell:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},hdr:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},hd1:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},hd2:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},row:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},col:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]}};if(colkey!==undefined){if(iwidth<=0){return plans;};var wh=this.maxWidth(rowvalues,border);var ww=this.maxWidth(colvalues,border);var zwidth1=colkey===\"\"?0:this.getTextWidth(colkey)+2*border;//props.theme.spacing.unit;\nvar zwidth2=rowkey===\"\"?0:this.getTextWidth(rowkey)+2*border;//props.theme.spacing.unit;\n// var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n// table boundaries\nvar hwidth=Math.max(wh.max,zwidth1+zwidth2)+mheight;var width=iwidth-hwidth;// calculate cell width...\nvar mwidth=ww.max;//var swidth=ww.sum;\nvar lenc=colvalues.length;var lenr=rowvalues.length;var hh,hw,ch,cw,hx,rot,stp;//console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\nif(mwidth*lenc<width){// horisontal\nrot=false;stp=1;cw=width/lenc;hh=mheight;hx=(cw-mwidth)/2;//console.log(\"Plan (normal):\",JSON.stringify(plans));\n}else if(mheight*lenc<width){// rotate\nrot=true;stp=1;cw=width/lenc;hh=mwidth;hx=(cw-mheight)/2;//console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cw*lenc);\n}else{// rotate and use steps\nrot=true;stp=Math.ceil(lenc*mheight/width);cw=stp*width/lenc;hh=mwidth;hx=(cw-mheight)/2;//console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cw,hh,hx);\n}// calculate cell height\nvar height=iheight-hh;if(mheight*lenr<height){// \nch=Math.min(mheight*10,height/lenr)-border;}else{ch=mheight-border;}hw=hwidth;//console.log(\"Cells:\",hh,ch,height,lenr,mheight);\nvar dw=(hw-zwidth1-zwidth2)/2;this.setPlan(plans.cell,{width:cw,height:ch,step:stp,font:this.fonts[this.state.cfont]});this.setPlan(plans.hdr,{width:hw,height:hh,font:this.fonts[this.state.cfont]});this.setPlan(plans.hd1,{width:zwidth1+dw,height:hh,align:\"right\",font:this.fonts[this.state.cfont]});this.setPlan(plans.hd2,{width:zwidth2+dw,height:hh,font:this.fonts[this.state.cfont]});this.setPlan(plans.col,{width:cw,height:hh,xoffset:hx,step:stp,rotate:rot,font:this.fonts[this.state.cfont]});this.setPlan(plans.row,{width:hw,height:ch,font:this.fonts[this.state.cfont]});//console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n}return plans;};};export default Layout;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/LayoutLib.js"],"names":["Layout","rotate","undefined","priority","init","state","Utils","fullscreen","fonts","viewMode","cellMode","layoutMode","cfont","tooltip","modes","view","nopath","path","cell","Sum","Series","layout","Table","List","Map","toggleTooltip","pushUrl","Show","show","changeFont","length","toggleView","showPath","showConfig","toggleMode","console","log","reload","showAll","getDim","colkey","Path","getColKey","rowkey","getRowKey","setLayoutMode","mode","om","o","getLayoutMode","n","showMode","setCellMode","getCellMode","Matrix","cnt","popSeries","Single","popSingle","toggleFullScreen","document","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","documentElement","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","getPriorityKeys","Database","keyCnt","keys","Object","plen","ii","key","indexOf","push","increaseSelect","kid","JSON","stringify","src","splice","spliceArray","increasePriority","getPriorityIndex","arr","len","pri","changePriority","trg","col","other","table","row","ikey","itrg","concat","getPriority","cp","setPriority","getDescription","element","skeys","s","docs","doc","klen","jj","d","setPlan","plan","set","lenk","val","getTextWidth","txt","fontname","fontsize","c","createElement","ctx","getContext","font","measureText","width","getTextHeight","getDescender","maxWidth","values","border","swidth","mwidth","lenv","cwidth","max","sum","makeDocTitle","title","makeCntTitle","dlen","_title","makePlans","colvalues","rowvalues","iwidth","iheight","descender","mheight","plans","step","height","xoffset","yoffset","hdr","hd1","hd2","wh","ww","zwidth1","zwidth2","hwidth","Math","lenc","lenr","hh","hw","ch","cw","hx","rot","stp","ceil","min","dw","align"],"mappings":"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","sourcesContent":["//console.log(\"Loading LayoutLib.js\");\n\nfunction Layout() {\n    this.rotate=undefined;  // should labels on x-axis be rotated?\n    this.priority=undefined;// which key should be on the abscissa\n    this.init=function(state){\n\tstate.Utils.init(\"Layout\",this);\n    };\n    this.fullscreen=false;\n    this.fonts=[\"12px Fixed\",\"18px Fixed\",\"24px Fixed\",\"36px Fixed\",\"48px Fixed\"\n\t       ];\n    //\n    this.state={viewMode:0,       // should we show trash contents?\n\t\tcellMode:0,       // sum, series, item\n\t\tlayoutMode:0,     // table, list, map\n\t\tcfont:0,\n\t\ttooltip:1,\n\t       };\n    this.modes={view:{nopath:0,\n\t\t      path:1,\n\t\t     },\n\t\tcell:{Sum:0,\n\t\t      Series:1,\n\t\t     },\n\t\tlayout:{Table:0,\n\t\t\tList:1,\n\t\t\tMap:2,\n\t\t       }\n\t       };\n    this.toggleTooltip=function(state) {\n\tthis.state.tooltip=(this.state.tooltip+1)%3;\n\t//console.log(\"Tooltip:\",this.state.tooltip);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,true);\n    };\n    this.changeFont=function(state) {\n\tthis.state.cfont=((this.state.cfont +1) % this.fonts.length);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,false);\n    };\n    this.toggleView=function(state) {\n\t//console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\n\tif (this.state.viewMode === this.modes.view.nopath) {\n\t    this.state.viewMode=this.modes.view.path;\n\t} else if (this.state.viewMode === this.modes.view.path) {\n\t    this.state.viewMode=this.modes.view.nopath;\n\t};\n\t//console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\n\tstate.Show.showPath(state);\n\tstate.Show.showConfig(state);\n    };\n    this.toggleMode=function(state,layoutMode,cellMode) {\n\tconsole.log(\"Mode:\",layoutMode,cellMode);\n\t//var reload=(layoutMode !== state.Layout.state.layoutMode);\n\tvar reload=((state.Layout.state.layoutMode===state.Layout.modes.layout.Map &&\n\t\t    layoutMode!==state.Layout.modes.layout.Map) ||\n\t\t    (state.Layout.state.layoutMode!==state.Layout.modes.layout.Map &&\n\t\t    layoutMode===state.Layout.modes.layout.Map));\n\tstate.Layout.state.layoutMode=layoutMode;\n\tstate.Layout.state.cellMode=cellMode;\n\t//state.Show.showConfig(state);\n\tstate.Show.showAll(state,reload);\n    };\n    this.getDim=function(state) {\n\t//console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\n        var colkey=state.Path.getColKey(state);\n        var rowkey=state.Path.getRowKey(state);\n\tif (colkey !== undefined && rowkey !== undefined) {\n\t    return 2;\n\t} else if (colkey !== undefined || rowkey !== undefined) {\n\t    return 1;\n\t} else {\n\t    return 0;\n\t}\n    };\n    this.setLayoutMode=function(state,mode) {\n\tvar om=this.state.layoutMode;\n\tvar o=this.getLayoutMode(state);\n\tthis.state.layoutMode=mode;\n\tvar n=this.getLayoutMode(state);\n\t//console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.setCellMode=function(state,mode) {\n\tvar om=this.state.cellMode;\n\tvar o=this.getCellMode(state);\n\tthis.state.cellMode=mode;\n\tvar n=this.getCellMode(state);\n\t//console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.getLayoutMode=function(state) {\n\t//console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\n\tvar mode=this.state.layoutMode;\n\tif (mode  === this.modes.layout.List && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.layout.Table;\n\t}\n\treturn mode;\n    };\n    this.getCellMode=function(state) {\n\tvar mode=this.state.cellMode;\n\tif (mode  === this.modes.cell.Single && state.Matrix.cnt > state.Matrix.popSingle) {\n\t    mode=this.modes.cell.Series;\n\t}\n\tif (mode  === this.modes.cell.Series && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.cell.Sum;\n\t}\n\treturn mode;\n    };\n    this.toggleFullScreen=function(state) {\n\t//var pos=0;\n\tif (!document.fullscreenElement &&    // alternative standard method\n\t    !document.mozFullScreenElement && \n\t    !document.webkitFullscreenElement && \n\t    !document.msFullscreenElement ) {  // current working methods\n\t    if (document.documentElement.requestFullscreen) {\n\t\tdocument.documentElement.requestFullscreen();\n\t\t//pos=1;\n\t    } else if (document.documentElement.msRequestFullscreen) {\n\t\tdocument.documentElement.msRequestFullscreen();\n\t\t//pos=2;\n\t    } else if (document.documentElement.mozRequestFullScreen) {\n\t\tdocument.documentElement.mozRequestFullScreen();\n\t\t//pos=3;\n\t    } else if (document.webkitRequestFullscreen) {\n\t\tdocument.webkitRequestFullscreen();\n\t\t//pos=4;\n\t    } else {\n\t\t//pos=5;\n\t    }\n\t    this.fullscreen=true;\n\t} else {\n\t    if (document.exitFullscreen) {\n\t\tdocument.exitFullscreen();\n\t\t//pos=6;\n\t    } else if (document.msExitFullscreen) {\n\t\tdocument.msExitFullscreen();\n\t\t//pos=7;\n\t    } else if (document.mozCancelFullScreen) {\n\t\tdocument.mozCancelFullScreen();\n\t\t//pos=8;\n\t    } else if (document.webkitExitFullscreen) {\n\t\tdocument.webkitExitFullscreen();\n\t\t//pos=9;\n\t    } else {\n\t\t//pos=10;\n\t    }\n\t    this.fullscreen=false;\n\t}\n\tstate.Show.showConfig(state);\n\tconsole.log(\"Toggle fullscreen:\",this.fullscreen);\n    };\n    // adjust keys so that rows/cols have more than on entry...\n    this.getPriorityKeys=function(state){\n        if (state.Layout.priority === undefined) {\n            state.Layout.priority=state.Database.keyCnt.keys();\n        } else {\n\t    var keys = Object.keys(state.Database.keyCnt);;\n\t    var plen = keys;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar key=keys[ii];\n\t\tif (state.Layout.priority.indexOf(key)===-1) {\n\t\t    state.Layout.priority.push(key);\n\t\t}\n\t    };\n\t};\n\treturn state.Layout.priority; //state.Utils.invertedArray()\n    };\n    this.increaseSelect=function(state,key){\n\tvar kid=state.Path.keys.path.indexOf(key);\n\tconsole.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\tif (kid !== -1 && kid > 0) {\n\t    var src=state.Path.keys.path.splice(kid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Path.keys.path,kid-1,0,src);\n\t}\n\tstate.Show.showConfig(state);\n\tstate.Show.showPath(state);\n    };\n    this.increasePriority=function(state,key){\n\tvar kid=state.Layout.priority.indexOf(key);\n\tconsole.log(\"Bumping:\",key,kid,JSON.stringify(state.Layout.priority));\n\tif (kid !== -1 && kid > 0) {\n\t    var src=state.Layout.priority.splice(kid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Layout.priority,kid-1,0,src);\n\t}\n\tstate.Show.showConfig(state);\n    };\n    this.getPriorityIndex=function(state,arr) {\n\tvar len,ii;\n\tvar pri={};\n\tlen=arr.length;\n\tfor (ii=0;ii<len;ii++) {\n\t    pri[arr[ii]]=0;\n\t};\n\tif (this.priority !== undefined) {\n\t    len=this.priority.length\n\t    for (ii=0;ii<len;ii++) {\n\t\tvar key=this.priority[ii]\n\t\tpri[key]=len+1-ii\n\t    };\n\t};\n\treturn pri;\n    };\n    this.changePriority=function(state,key,trg) {  // key -> trg\n\tif (key  === undefined || trg  === undefined) { return;}\n\tconsole.log(\"Priority:\",key,\"->\",trg,JSON.stringify(this.priority));\n\t//if (typeof trg  === \"undefined\") {\n\tvar col=state.Path.other.table[0];\n\tvar row=state.Path.other.table[1];\n\t//var icol=0;\n\t//var irow=0;\n\tvar ikey=0;\n\tvar itrg=0;\n\tvar len=this.priority.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    if (this.priority[ii]  === col) {\n\t\t//icol=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === row) {\n\t\t//irow=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === key) {\n\t\tikey=len+1-ii;\n\t    }\n\t    if  (this.priority[ii]  === trg) {\n\t\titrg=len+1-ii;\n\t    }\n\t}\n\tif (itrg < ikey) {        // demote existing key\n\t    if (itrg > 0) {       // key exists on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+2-itrg,0,key);  // add after\n\n\t\tconsole.log(\"Added:\",JSON.stringify(this.priority),ikey,itrg,key);\n\t\t\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t    } else {              // key exists, target does not\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tthis.priority.concat(key)\t    \n\t    }\n\t} else if (itrg > ikey) { // demote, key may not exist on priority list\n\t    if (ikey>0) {         // key exists on priority list\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    } else {              // key is not on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    }\n\t} else if (itrg === 0) { // key and target not on the priority list\n\t    this.priority.concat(key)\n\t}\n\tconsole.log(\"Changed priority:\",JSON.stringify(this.priority),ikey,itrg);\n\treturn true;\n    }\n    //this.flipTable=function(state) {\n    //    var bb=this.colrow[0];\n    //    this.colrow[0]=this.colrow[1];\n    //    this.colrow[1]=bb;\n    //    //console.log(\"Setup:\",JSON.stringify(setup));\n    //};\n    this.getPriority=function(state) {\n\treturn state.Utils.cp(this.priority);\n    };\n    this.setPriority=function(state,priority) {\n\tthis.priority=priority;\n    }\n    this.getDescription=function(state,element,skeys) {\n\tif (element.cnt  === 1) {\n\t    var s=\"\";\n\t    var docs=element.docs;\n\t    var doc=docs[0];\n\t    var klen=skeys.length;\n\t    for (var jj = 0; jj < klen; jj++) {\n\t\tvar d=skeys[jj]+\"=\"+doc[skeys[jj]];;\n\t\tif (s !== \"\") {\n\t\t    s=s+\" \"+d\n\t\t} else {\n\t\t    s=d;\n\t\t}\n\t    }\n\t    return s;\n\t} else {\n\t    return element.cnt;\n\t}\n    };\n    this.setPlan=function(plan,set) {\n\tvar keys=Object.keys(set);\n\tvar lenk=keys.length;\n\tfor (var ii=0; ii<lenk; ii++) {\n\t    var key=keys[ii];\n\t    var val=set[key];\n\t    plan[key]=val;\n\t};\n    };\n    this.getTextWidth=function(txt, fontname, fontsize){\n\tif(this.getTextWidth.c === undefined){\n            this.getTextWidth.c=document.createElement('canvas');\n            this.getTextWidth.ctx=this.getTextWidth.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextWidth.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextWidth.ctx.font = this.fonts[this.state.cfont];\n\t}\n\treturn this.getTextWidth.ctx.measureText(txt).width;\n    };\n    this.getTextHeight=function(fontname, fontsize){\n\tif(this.getTextHeight.c === undefined){\n            this.getTextHeight.c=document.createElement('canvas');\n            this.getTextHeight.ctx=this.getTextHeight.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextHeight.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextHeight.ctx.font = this.fonts[this.state.cfont];\n\t}\n\treturn this.getTextHeight.ctx.measureText('M').width;\n    };\n    this.getDescender=function(fontname,fontsize) {\n\treturn this.getTextHeight(fontname,fontsize)*0.3;\n    }\n    this.maxWidth=function(values,border) {\n\tvar swidth=0;\n\tvar mwidth=0;\n\tvar lenv=values.length;\n\tfor (var ii=0;ii<lenv;ii++) {\n\t    var cwidth = this.getTextWidth(values[ii])+2*border;\n\t    if (cwidth > mwidth) {\n\t\tmwidth=cwidth;\n\t    }\n\t    swidth=swidth+cwidth;\n\t}\n\treturn {max:mwidth,sum:swidth};\n    }\n    this.makeDocTitle=function(state,doc) {\n\tvar title=\"\";\n\tvar len=state.Path.tooltip.keys.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    var key=state.Path.tooltip.keys[ii];\n\t    if (doc[key] !== undefined) {\n\t\tif (title !== \"\") { title=title+\", \";};\n\t\ttitle=title+key+\"=\"+doc[key];\n\t    };\n\t}\n\treturn title;\n    };\n    this.makeCntTitle=function(state,docs) {\n\tvar title=\"\"\n\tif (this.state.title === 1) {\n\t    var dlen=docs.length;\n\t    for (var ii = 0; ii < dlen; ii++) {\n    \t\tvar doc=docs[ii];\n\t\tif (doc._title !== undefined) {\n\t\t    if (title !== \"\") { title=title+\"|\";};\n\t\t    title=title+doc._title;\n\t\t}\n\t    }\n\t}\n\treturn title;\n    };\n    this.makePlans=function(colkey,rowkey,colvalues,rowvalues,iwidth,iheight,border) {\n\tvar descender=this.getDescender();\n\tif (border===null) {border=0;}\n\tborder=border+descender+1;\n\t// text boundaries\n\tvar mheight=this.getTextHeight() + 2 * (descender+1);       //props.theme.spacing.unit;\n\tvar plans={cell:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]}, \n\t\t   hdr:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t   hd1:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t   hd2:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t   row:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t   col:{rotate:false,step:1,border:border,width:mheight*2,height:mheight,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]}};\n\tif (colkey!==undefined) {\n\t    if (iwidth <= 0) { return plans;};\n\t    var wh=this.maxWidth(rowvalues,border);\n\t    var ww=this.maxWidth(colvalues,border);\n\t    var zwidth1 =(colkey===\"\"?0:this.getTextWidth(colkey) + 2 * border);   //props.theme.spacing.unit;\n\t    \n\t    var zwidth2 =(rowkey===\"\"?0:this.getTextWidth(rowkey) + 2 * border);   //props.theme.spacing.unit;\n\t    // var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n\t    // table boundaries\n\t    var hwidth=Math.max(wh.max,zwidth1+zwidth2) + mheight;\n\t    var width=iwidth-hwidth;\n\t    // calculate cell width...\n\t    var mwidth=ww.max;\n\t    //var swidth=ww.sum;\n\t    var lenc=colvalues.length;\n\t    var lenr=rowvalues.length;\n\t    var hh, hw, ch, cw, hx, rot, stp;\n\t    //console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\n\t    if (mwidth*lenc < width) { // horisontal\n\t\trot=false;\n\t\tstp=1\n\t\tcw=width/lenc;\n\t\thh=mheight;\n\t\thx=(cw-mwidth)/2;\n\t\t//console.log(\"Plan (normal):\",JSON.stringify(plans));\n\t    } else if (mheight*lenc < width) { // rotate\n\t\trot=true;\n\t\tstp=1\n\t\tcw=width/lenc;\n\t\thh=mwidth;\n\t\thx=(cw-mheight)/2;\n\t\t//console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cw*lenc);\n\t    } else { // rotate and use steps\n\t\trot=true;\n\t\tstp=Math.ceil(lenc*mheight/width);\n\t\tcw=stp*width/lenc;\n\t\thh=mwidth;\n\t\thx=(cw-mheight)/2;\n\t\t//console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cw,hh,hx);\n\t    }\n\t    // calculate cell height\n\t    var height=iheight-hh;\n\t    if (mheight*lenr < height) { // \n\t\tch=Math.min(mheight*10,height/lenr) - border;\n\t    } else {\n\t\tch=mheight - border;\n\t    }\n\t    hw=hwidth;\n\t    //console.log(\"Cells:\",hh,ch,height,lenr,mheight);\n\t    var dw=(hw-zwidth1-zwidth2)/2;\n\t    this.setPlan(plans.cell,{width:cw,height:ch,step:stp,font:this.fonts[this.state.cfont]});\n\t    this.setPlan(plans.hdr, {width:hw,height:hh,font:this.fonts[this.state.cfont]});\n\t    this.setPlan(plans.hd1, {width:zwidth1+dw,height:hh,align:\"right\",font:this.fonts[this.state.cfont]});\n\t    this.setPlan(plans.hd2, {width:zwidth2+dw,height:hh,font:this.fonts[this.state.cfont]});\n\t    this.setPlan(plans.col, {width:cw,height:hh,xoffset:hx,step:stp,rotate:rot,font:this.fonts[this.state.cfont]});\n\t    this.setPlan(plans.row, {width:hw,height:ch,font:this.fonts[this.state.cfont]});\n\t    //console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n\t}\n\treturn plans;\n    }\n};\nexport default Layout;\n"]},"metadata":{},"sourceType":"module"}