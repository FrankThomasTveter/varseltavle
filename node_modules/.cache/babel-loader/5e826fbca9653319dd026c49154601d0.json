{"ast":null,"code":"//console.log(\"Loading NavigateLib.js\");\nfunction Navigate() {\n  this.history = {\n    pos: 0,\n    // position of next snapshot\n    track: []\n  };\n\n  this.store = function (state) {\n    // store state\n    if (state.history.track.length > state.history.pos) {\n      state.history.track = state.history.track.splice(0, state.history.pos);\n    }\n\n    ;\n    var snapshot = state.Path.getSnapshot(state);\n    state.history.track.push(snapshot);\n    state.history.pos = state.history.track.length;\n  };\n\n  this.undo = function (state) {\n    if (state.history.pos > 0) {\n      state.history.pos = state.history.pos - 1;\n      var snapshot = state.history.track[state.history.pos];\n      state.path.setSnapshot(state, snapshot);\n    }\n  };\n\n  this.redo = function (state) {\n    if (state.history.pos < state.history.track.length - 1) {\n      state.history.pos = state.history.pos + 1;\n      var snapshot = state.history.track[state.history.pos];\n      state.path.setSnapshot(state, snapshot);\n    }\n  };\n\n  this.onClickPath = function (state, ttyp, tkey) {\n    var reload = false; // matrix changed?\n\n    var tid, tin, src, sec;\n    console.log(\"Clicked:\", ttyp, tkey, JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other));\n\n    if (ttyp === \"path\") {\n      // path -> table\n      tid = state.Path.keys.path.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.path.splice(tid, 1); // remove from path\n\n        state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n\n        reload = true;\n      }\n    } else if (ttyp === \"table\") {\n      // table -> path/other\n      tid = state.Path.keys.other.indexOf(tkey);\n      tin = state.Path.other.table.indexOf(tkey);\n      console.log(\"Tin:\", tin, \" tid:\", tid);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        if (tin === 0) {\n          sec = state.Path.keys.other.splice(tid, 1); // remove from path\n        }\n\n        if (state.Path.values[tkey]) {\n          // table -> path\n          state.Path.keys.path = state.Path.keys.path.concat(src); // last path position\n        } else {\n          // table -> other\n          state.Path.keys.other = state.Path.keys.other.concat(src); // last position\n        }\n\n        if (tin === 0) {\n          src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n          state.Utils.spliceArray(state.Path.keys.other, 0, 0, sec); // first position (table)\n\n          state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n        }\n\n        reload = true;\n      }\n    } else if (ttyp === \"rest\") {\n      // rest -> table\n      tid = state.Path.keys.other.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n\n        reload = true;\n      }\n\n      ;\n    } else if (ttyp === \"trash\") {\n      tid = state.Path.keys.trash.indexOf(tkey);\n      tin = state.Path.keys.other.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.trash.splice(tid, 1); // trash => other\n\n        state.Path.keys.other = state.Path.keys.other.concat(src); // last position\n\n        state.Path.values[src] = undefined;\n      } else if (tin !== -1) {\n        src = state.Path.keys.other.splice(tin, 1); // other => trash\n\n        state.Path.keys.trash = state.Path.keys.trash.concat(src);\n      }\n\n      ;\n    }\n\n    state.Html.setFootnote(state, \"Extracting data.\");\n    setTimeout(function () {\n      state.Show.showAll(state, reload);\n    }.bind(this), 0);\n  };\n}\n\n;\nexport default Navigate;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/NavigateLib.js"],"names":["Navigate","history","pos","track","store","state","length","splice","snapshot","Path","getSnapshot","push","undo","path","setSnapshot","redo","onClickPath","ttyp","tkey","reload","tid","tin","src","sec","console","log","JSON","stringify","keys","other","indexOf","Utils","spliceArray","table","values","concat","trash","undefined","Html","setFootnote","setTimeout","Show","showAll","bind"],"mappings":"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","sourcesContent":["//console.log(\"Loading NavigateLib.js\");\n    \nfunction Navigate() {\n    this.history={pos:0, // position of next snapshot\n\t\t  track:[]\n\t\t };\n    this.store=function(state) { // store state\n\tif (state.history.track.length>state.history.pos) {\n\t    state.history.track=state.history.track.splice(0,state.history.pos)\n\t};\n\tvar snapshot=state.Path.getSnapshot(state)\n\tstate.history.track.push(snapshot);\n\tstate.history.pos=state.history.track.length;\n    };\n    this.undo=function(state) {\n\tif (state.history.pos > 0) {\n\t    state.history.pos=state.history.pos-1;\t\n\t    var snapshot=state.history.track[state.history.pos]\n\t    state.path.setSnapshot(state,snapshot);\n\t}\n    };\n    this.redo=function(state) {\n\tif (state.history.pos < state.history.track.length-1) {\n\t    state.history.pos=state.history.pos+1;\t\n\t    var snapshot=state.history.track[state.history.pos]\n\t    state.path.setSnapshot(state,snapshot);\n\t}\n    };\n    this.onClickPath=function(state,ttyp,tkey) {\n\tvar reload=false; // matrix changed?\n\tvar tid,tin,src,sec;\n\tconsole.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\tif (ttyp  === \"path\") { // path -> table\n\t    tid=state.Path.keys.path.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.path.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\treload=true;\n\t    }\n\t} else if (ttyp  === \"table\") { // table -> path/other\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    tin=state.Path.other.table.indexOf(tkey);\n\t    console.log(\"Tin:\",tin,\" tid:\",tid);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tif (tin===0) {\n\t\t    sec=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\t}\n\t\tif (state.Path.values[tkey]) { // table -> path\n\t\t    state.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t\t} else {                       // table -> other\n\t\t    state.Path.keys.other=state.Path.keys.other.concat(src); // last position\n\t\t}\n\t\tif (tin===0) {\n\t\t    src=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\t    state.Utils.spliceArray(state.Path.keys.other,0,0,sec); // first position (table)\n\t\t    state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\t}\n\t\treload=true;\n\t    }\n\t} else if (ttyp === \"rest\") { // rest -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\treload=true;\n\t    };\n\t} else if (ttyp === \"trash\") {\n\t    tid=state.Path.keys.trash.indexOf(tkey);\n\t    tin=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.trash.splice(tid, 1);                 // trash => other\n\t\tstate.Path.keys.other=state.Path.keys.other.concat(src); // last position\n\t\tstate.Path.values[src]=undefined;\n\t    } else if (tin !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tin, 1);                 // other => trash\n\t\tstate.Path.keys.trash=state.Path.keys.trash.concat(src);\n\t    };\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tsetTimeout(function() {\n\t    state.Show.showAll(state,reload);\n\t}.bind(this),0);\n    };\n};\nexport default Navigate;\n"]},"metadata":{},"sourceType":"module"}