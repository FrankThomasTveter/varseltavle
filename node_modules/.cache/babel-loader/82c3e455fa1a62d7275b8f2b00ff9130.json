{"ast":null,"code":"//console.log(\"Loading ThresholdLib.js\");\nfunction Threshold() {\n  this.thrs = undefined; // threshold parameter levels, set by Default\n\n  this.imax = 0; // threshold item types\n\n  this.ithr = 1;\n  this.ikey = 2;\n  this.ilev = 3;\n  this.ival = 4;\n\n  this.init = function (state) {\n    var par = \"Threshold\";\n    state.Utils.init(par, this);\n  };\n\n  this.setThresholds = function (doc, ithrs) {\n    var debug = doc.Phenomenon === \"Regn\" && doc.Duration === \"12t\" && doc.Region === \"Innlandet\" && doc.dtg === \"2019-06-26_11\";\n\n    if (doc._thr !== undefined) {\n      return [];\n    } else {\n      var thrs;\n\n      if (ithrs === undefined) {\n        thrs = this.thrs;\n      } else {\n        thrs = ithrs;\n      }\n\n      ; //if (debug) {console.log(\"Entering with:\",JSON.stringify(doc));};\n      //if (debug) {console.log(\"     --> with:\",JSON.stringify(ithrs));};\n      //if (debug) {console.log(\"      -> with:\",JSON.stringify(thrs));};\n\n      for (var trgkey in thrs) {\n        // loop over thresholds\n        if (doc[trgkey] !== undefined) {\n          var trgval = doc[trgkey]; // trgval-value\n\n          if (thrs[trgkey][trgval] !== undefined) {\n            //if (debug) {console.log(\"Found:\",trgkey,trgval,JSON.stringify(thrs[trgkey][trgval]));};\n            var mlen, jj, res;\n\n            if (thrs[trgkey][trgval].par === undefined) {\n              // there is another level\n              //if (debug) {console.log(\"   Iterating with:\",JSON.stringify(thrs[trgkey][trgval]));};\n              return this.setThresholds(doc, thrs[trgkey][trgval]);\n            } else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n              var thr = thrs[trgkey][trgval]; //doc.threshold=thr;\n\n              var val = doc[thr[\"par\"]];\n              var maxs = thr[\">\"];\n              var mins = thr[\"<\"];\n              var doclev = -1; // found thresholds, but will we find a valid level?\n\n              if (maxs !== undefined) {\n                // above thresholds\n                //if (debug) {console.log(\"Thresholds:\",JSON.stringify(maxs),val);};\n                var docmax = Number(val);\n                mlen = maxs.length; // get new level\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmax >= Number(maxs[jj])) {\n                    //if (debug) {console.log(\"Hit:\",docmax,jj,maxs[jj],docmax>=maxs[jj],doclev);}\n                    doclev = jj;\n                  }\n                }\n\n                if (debug) {\n                  console.log(\"Level:\", docmax, doclev, JSON.stringify(maxs));\n                }\n\n                doc.level = doclev;\n                doc._thr = {};\n                doc._thr.level = doclev;\n                doc._thr.val = docmax;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.max = maxs;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"max\"];\n              } else if (mins !== undefined) {\n                // below thresholds\n                //if (debug) {console.log(\"Thresholds:\",JSON.stringify(mins),val);};\n                var docmin = Number(val); // get new level\n\n                mlen = mins.length;\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmin <= Number(mins[jj])) {\n                    doclev = jj;\n                  }\n                }\n\n                doc.level = doclev;\n                doc._thr = {};\n                doc._thr.level = doclev;\n                doc._thr.val = docmin;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.min = mins;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"min\"];\n              } else {//if (debug) {console.log(\"No Thresholds:\",JSON.stringify(thrs),val);};\n              }\n            }\n          }\n        }\n      }\n\n      doc._thr = {};\n      doc.level = -2; // no thresholds found...\n    }\n\n    return [];\n  }; // call after this.setThresholds\n\n\n  this.getLevel = function (state, doc) {\n    //console.log(\"GetLevel:\",JSON.stringify(doc));\n    if (doc._thr !== undefined) {\n      return doc._thr.level;\n    } else {\n      return -1;\n    }\n  };\n\n  this.getLat = function (state, doc) {\n    return doc._thr.lat;\n  };\n\n  this.getLon = function (state, doc) {\n    return doc._thr.lon;\n  };\n}\n\n;\nexport default Threshold;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/ThresholdLib.js"],"names":["Threshold","thrs","undefined","imax","ithr","ikey","ilev","ival","init","state","par","Utils","setThresholds","doc","ithrs","debug","Phenomenon","Duration","Region","dtg","_thr","trgkey","trgval","mlen","jj","res","thr","val","maxs","mins","doclev","docmax","Number","length","console","log","JSON","stringify","level","lat","lon","max","docmin","min","getLevel","getLat","getLon"],"mappings":"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","sourcesContent":["//console.log(\"Loading ThresholdLib.js\");\n\nfunction Threshold() {\n    this.thrs=undefined; // threshold parameter levels, set by Default\n    this.imax=0;        // threshold item types\n    this.ithr=1;\n    this.ikey=2;\n    this.ilev=3;\n    this.ival=4;\n    this.init=function(state){\n\tvar par=\"Threshold\";\n\tstate.Utils.init(par,this);\n    };\n    this.setThresholds=function(doc,ithrs) {\n\tvar debug = (doc.Phenomenon===\"Regn\" && doc.Duration===\"12t\" && doc.Region===\"Innlandet\" && doc.dtg===\"2019-06-26_11\");\n\tif (doc._thr !== undefined) {\n\t    return [];\n\t} else {\n\t    var thrs;\n\t    if (ithrs === undefined) {\n\t\tthrs=this.thrs;\n\t    } else {\n\t\tthrs=ithrs;\n\t    };\n\t    //if (debug) {console.log(\"Entering with:\",JSON.stringify(doc));};\n\t    //if (debug) {console.log(\"     --> with:\",JSON.stringify(ithrs));};\n\t    //if (debug) {console.log(\"      -> with:\",JSON.stringify(thrs));};\n\t    for (var trgkey in thrs) { // loop over thresholds\n\t\tif (doc[trgkey] !== undefined) {\n\t\t    var trgval=doc[trgkey]; // trgval-value\n\t\t    if (thrs[trgkey][trgval] !== undefined) {\n\t\t\t//if (debug) {console.log(\"Found:\",trgkey,trgval,JSON.stringify(thrs[trgkey][trgval]));};\n\t\t\tvar mlen,jj,res;\n\t\t\tif (thrs[trgkey][trgval].par === undefined) { // there is another level\n\t\t\t    //if (debug) {console.log(\"   Iterating with:\",JSON.stringify(thrs[trgkey][trgval]));};\n\t\t\t    return this.setThresholds(doc,thrs[trgkey][trgval]);\n\t\t\t} else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n\t\t\t    var thr = thrs[trgkey][trgval]\n\t\t\t    //doc.threshold=thr;\n\t\t\t    var val = doc[thr[\"par\"]];\n\t\t\t    var maxs = thr[\">\"];\n\t\t\t    var mins = thr[\"<\"];\n\t\t\t    var doclev=-1; // found thresholds, but will we find a valid level?\n\t\t\t    if (maxs !== undefined) { // above thresholds\n\t\t\t\t//if (debug) {console.log(\"Thresholds:\",JSON.stringify(maxs),val);};\n\t\t\t\tvar docmax=Number(val);\n\t\t\t\tmlen=maxs.length;\n\t\t\t\t// get new level\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmax >= Number(maxs[jj])) {\n\t\t\t\t\t//if (debug) {console.log(\"Hit:\",docmax,jj,maxs[jj],docmax>=maxs[jj],doclev);}\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tif (debug) {console.log(\"Level:\",docmax,doclev,JSON.stringify(maxs));}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr={};\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmax\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.max=maxs;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"max\"];\n\t\t\t    } else if (mins !== undefined) { // below thresholds\n\t\t\t\t//if (debug) {console.log(\"Thresholds:\",JSON.stringify(mins),val);};\n\t\t\t\tvar docmin=Number(val);\n\t\t\t\t// get new level\n\t\t\t\tmlen=mins.length;\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmin <= Number(mins[jj])) {\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr={};\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmin\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.min=mins;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"min\"];\n\t\t\t    } else {\n\t\t\t\t//if (debug) {console.log(\"No Thresholds:\",JSON.stringify(thrs),val);};\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t    doc._thr={};\n\t    doc.level=-2;  // no thresholds found...\n\t}\n\treturn [];\n    };\n    // call after this.setThresholds\n    this.getLevel=function(state,doc) {\n\t//console.log(\"GetLevel:\",JSON.stringify(doc));\n\tif (doc._thr !== undefined) {\n\t    return doc._thr.level;\n\t} else {\n\t    return -1;\n\t}\n    }\n    this.getLat=function(state,doc) {\n\treturn doc._thr.lat;\n    }\n    this.getLon=function(state,doc) {\n\treturn doc._thr.lon;\n    };\n};\nexport default Threshold;\n"]},"metadata":{},"sourceType":"module"}