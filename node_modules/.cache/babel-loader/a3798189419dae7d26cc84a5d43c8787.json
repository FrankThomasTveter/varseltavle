{"ast":null,"code":"//console.log(\"Loading NavigateLib.js\");\nfunction Navigate(){this.history={pos:0,// position of next snapshot\ntrack:[]};this.home=undefined;this.rank={};// key rank\nthis.trash={};// key trash\nthis.maxStore=1000;// max number of states stored\nthis.reset=function(state){// store state\nstate.Navigate.history={pos:0,track:[]};this.store(state);};this.store=function(state){// store state\nvar snapshot=state.Path.getSnapshot(state);// remove old data...\nif(state.Navigate.history.track.length>state.Navigate.history.pos+1){state.Navigate.history.track.length=state.Navigate.history.pos+1;}else if(state.Navigate.history.track.length>this.maxStore){var keep=this.maxStore;state.Navigate.history.track=state.Navigate.history.track.splice(-keep,keep);};if(state.Navigate.history.track.length>0){var old=state.Navigate.history.track[state.Navigate.history.track.length-1];if(JSON.stringify(snapshot)===JSON.stringify(old)){//console.log(\"History:\",JSON.stringify(snapshot),JSON.stringify(state.Navigate.history.track));\nconsole.log(\"Ignoring old image.\");return false;}}state.Navigate.history.track.push(snapshot);state.Navigate.history.pos=state.Navigate.history.track.length-1;//console.log(\">>>>>> Stored state...\",JSON.stringify(state.Navigate.history),\n//\t    this.canUndo(state),this.canRedo(state),\n//\t    state.Navigate.history.pos,state.Navigate.history.track.length);\n//console.log(\">>>>> stored state.\",this.snapshotToString(state,snapshot));\n//this.printSnapshot(state);\nthis.refreshHistory(state);};this.refreshHistory=function(state){if(state.React.Config!==undefined){state.React.Config.show();};};this.canUndo=function(state){return state.Navigate.history.pos>0;};this.canRedo=function(state){return state.Navigate.history.pos<state.Navigate.history.track.length-1;};this.undo=function(state){//console.log(\">>>>>> Undo:\",this.canUndo(state));\nif(this.canUndo(state)){state.Navigate.history.pos=state.Navigate.history.pos-1;var snapshot=state.Navigate.history.track[state.Navigate.history.pos];//console.log(\"Setting snapshot:\",this.snapshotToString(state,snapshot));\nstate.Path.setSnapshot(state,snapshot);this.refreshHistory(state);state.Show.show(state);};};this.redo=function(state){//console.log(\">>>>>> Redo:\",this.canRedo(state),state.Navigate.history.pos,JSON.stringify(state.Navigate.history.track));\nif(this.canRedo(state)){state.Navigate.history.pos=state.Navigate.history.pos+1;var snapshot=state.Navigate.history.track[state.Navigate.history.pos];//console.log(\"Setting snapshot:\",this.snapshotToString(state,snapshot));\nstate.Path.setSnapshot(state,snapshot);this.refreshHistory(state);state.Show.show(state);}};this.onClickTablePath=function(state,skey,tkey){var reload=false;var sid=state.Path.keys.other.indexOf(skey);var tid=state.Path.keys.other.indexOf(tkey);//console.log(\"Table path: Sid:\",sid,\" tid:\",tid,skey,tkey);\nif(sid!==-1&&tid!==-1){if(sid>tid){var src=state.Path.keys.other.splice(sid,1);// remove from path\nvar trg=state.Path.keys.other.splice(tid,1);// remove from path\nstate.Utils.pushKey(state.Path.keys.other,src,tid);state.Utils.pushKey(state.Path.keys.other,trg,sid);//state.Utils.spliceArray(state.Path.keys.other,tid,0,src); // first position (table)\n//state.Utils.spliceArray(state.Path.keys.other,sid,0,trg); // first position (table)\nstate.Path.exportAllKeys(state);reload=true;}}state.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state,reload);};this.onClickRestValue=function(state,val,key,where){//console.log(\"onClickRestValue:\",val,key,JSON.stringify(state.Path.keys));\nif(state.Auto.selectTableKey(state,key,val,where,1)){state.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state);};console.log(\"onClickRestValue done:\",val,key,JSON.stringify(state.Path.keys));};this.onClickPath=function(state,ttyp,tkey){var reload=false;// matrix changed?\nvar tid,tin,sin,src,tib;//console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\nif(ttyp===\"path\"){// path -> table\ntid=state.Path.keys.path.indexOf(tkey);if(tid!==-1){src=state.Path.keys.path.splice(tid,1);// remove from path\nstate.Utils.pushKey(state.Path.keys.other,src,2);//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\nstate.Path.cleanSelect(state);state.Navigate.store(state);reload=true;}}else if(ttyp===\"table\"){// other -> table\ntid=state.Path.keys.other.indexOf(tkey);//console.log(\"Tin:\",tin,\" tid:\",tid);\nif(tid!==-1){src=state.Path.keys.other.splice(tid,1);// remove from path\nstate.Utils.pushKey(state.Path.keys.other,src,0);//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\nstate.Path.exportAllKeys(state);state.Navigate.store(state);reload=true;}}else if(ttyp===\"rest\"){// rest -> table\ntid=state.Path.keys.other.indexOf(tkey);if(tid!==-1){src=state.Path.keys.other.splice(tid,1);// remove from path\nstate.Utils.pushKey(state.Path.trash,src);//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\nstate.Navigate.store(state);reload=true;};}else if(ttyp===\"trash\"){tid=state.Path.trash.indexOf(tkey);tin=state.Path.keys.other.indexOf(tkey);sin=state.Path.keys.path.indexOf(tkey);tib=state.Path.other.table.indexOf(tkey);console.log(\"Trashing start:\",JSON.stringify(state.Path.trash),tkey,tid,tin,sin,tib);if(tid!==-1){// trash => other\nsrc=state.Path.trash.splice(tid,1);state.Utils.pushKey(state.Path.keys.other,src);//if ( tin === -1 ) {\n//    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n//};\n}else if(tin!==-1&&tib!==-1){// table => trash\nsrc=state.Path.keys.other.splice(tin,1);state.Utils.pushKey(state.Path.trash,src);reload=true;//state.Path.trash=state.Path.trash.concat(src);            // last position\n}else if(sin!==-1&&tin===-1){// select => other\nstate.Utils.pushKey(state.Path.keys.other,tkey);//state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n}else if(sin!==-1&&tin!==-1){// other => select\nsrc=state.Path.keys.other.splice(tin,1);}else if(sin===-1&&tin!==-1){// other => trash\nsrc=state.Path.keys.other.splice(tin,1);state.Utils.pushKey(state.Path.trash,src);//state.Path.trash=state.Path.trash.concat(src);            // last position\n};state.Path.exportAllKeys(state);state.Navigate.store(state);//console.log(\"Trashed:\",JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\n}state.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);//console.log(\"Showing:\",JSON.stringify(state.Path.other));\nstate.Show.show(state,reload);};this.onClickAddOther=function(state,ttyp,tkey,active){// add key to other\nvar ntab=state.Path.other.table.length;var reload=ntab!==2;// matrix changed?\nvar tid,tin,sin,src;//console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n//ttyp \"select\", \"rest\", \"trash\"\n//console.log(\"Adding start:\",tkey,JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\ntid=state.Path.trash.indexOf(tkey);tin=state.Path.keys.other.indexOf(tkey);sin=state.Path.keys.path.indexOf(tkey);if(tin===-1){// add if not already in state.Path.keys.other\nif(tid!==-1){// trash => other\nsrc=state.Path.trash.splice(tid,1);state.Utils.pushKey(state.Path.keys.other,src);//if ( tin === -1 ) {\n//    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n//};\n}else if(sin!==-1){// select => other\nstate.Utils.pushKey(state.Path.keys.other,tkey);//state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n}else{// not in trash,select or other, how strange\nconsole.log(\"Strange key:\",tkey,JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));};}else{// remove if in state.Path.keys.other\nif(sin!==-1){// is already in selected list\nsrc=state.Path.keys.other.splice(tin,1);}else if(tid===-1){// move to trash if its not already there\nsrc=state.Path.keys.other.splice(tin,1);state.Utils.pushKey(state.Path.trash,src);}else{// its already in trash, just delete it\nsrc=state.Path.keys.other.splice(tin,1);}};state.Path.exportAllKeys(state);state.Navigate.store(state);//console.log(\"Keys:\",reload,JSON.stringify(state.Path.keys));\n//console.log(\"Trash:\",reload,JSON.stringify(state.Path.trash));\n//console.log(\"Other:\",JSON.stringify(state.Path.other));\nstate.Show.show(state,reload);};this.switchTableKey=function(state,key){var tid=state.Path.keys.other.indexOf(key);if(tid!==-1){var src=state.Path.keys.other.splice(tid,1);// remove from path\nstate.Path.keys.other=state.Path.keys.other.concat(src);// last position\n//state.Utils.pushKey(state.Path.keys.other,src,0);       // first position\n//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\nstate.Path.exportAllKeys(state);var colkey=state.Path.getColKey(state);var rowkey=state.Path.getRowKey(state);state.Navigate.store(state);var reload=src[0]!==colkey&&src[0]!==rowkey;//console.log(\"Switched:\",JSON.stringify(src[0]),colkey,rowkey,reload);\nstate.Show.show(state,reload);}};this.selectItem=function(state,colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt){//console.log(\"Selectitem:\",colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt);\n//var colkey=state.Path.getColKey(state);\n//var rowkey=state.Path.getRowKey(state);\nvar rank=state.Utils.cp(state.Path.keys.other);//console.log(\"SelectItem:\",colkey,\"=\",colval,\"  \",rowkey,\"=\",rowval);\nif(state.Layout.getLayoutMode(state)===state.Layout.modes.layout.Map){if(this.selectMapKey(state,colkey,colval,colwhere,colcnt)){this.rank[colkey]=state.Utils.cp(rank);//this.flip[colkey]=this.getFlip(state);\nif(this.selectMapKey(state,rowkey,rowval,rowwhere,rowcnt)){this.rank[rowkey]=state.Utils.cp(rank);//this.last.flip[rowkey]=this.getFlip(state);\n}//this.trash[colkey]=state.Path.checkTableKeys(state);\n//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n};//console.log(\"Path:\",JSON.stringify(state.Path))\nstate.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state);}else{var changed=false;if(state.Auto.selectTableKey(state,colkey,colval,colwhere,colcnt)){//console.log(\"Selected:\",colkey,colval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\nthis.rank[colkey]=state.Utils.cp(rank);changed=true;}else{console.log(\"Unable to select:\",colkey);};if(state.Auto.selectTableKey(state,rowkey,rowval,rowwhere,rowcnt)){//console.log(\"Selected:\",rowkey,rowval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\nthis.rank[rowkey]=state.Utils.cp(rank);changed=true;}else{console.log(\"Unable to select:\",rowkey);}if(changed){//this.trash[colkey]=state.Path.checkTableKeys(state);\n//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\nstate.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state);}//console.log(\"Selectitem Done:\",rowwhere,colwhere);\n};};this.selectMapKey=function(state,key,val,where,cnt){// keep abscissa\n//console.log(\"Table.Selecting:\",key,\"=\",val,\", where=\",where);\nstate.Path.select.val[key]=[val];state.Path.where[key]=where;if(state.Utils.missing(state.Path.keys.path,key)){//console.log(\"Adding to path:\",key);\nstate.Utils.pushKey(state.Path.keys.path,key);//state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n};return true;};this.selectKey=function(state,key,val,where,cnt){var rank=state.Utils.cp(state.Path.keys.other);//console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n//console.log(\"SelectKey:\",key,val,where,cnt);\nif(state.Layout.getLayoutMode(state)===state.Layout.modes.layout.Map){if(this.selectMapKey(state,key,val,where,cnt)){this.rank[key]=state.Utils.cp(rank);}state.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state);}else if(state.Auto.selectTableKey(state,key,val,where,cnt)){this.rank[key]=rank;//this.trash[key]=state.Path.checkTableKeys(state);\n//console.log(\"state.Path.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\nstate.Html.setFootnote(state,\"Extracting data.\");state.Html.setProgress(state,true);state.Navigate.store(state);state.Show.show(state);}else{console.log(\"Unable to select:\",key);}//console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n};this.snapshotToString=function(state,snapshot){return\"Snapshot: \"+JSON.stringify(snapshot.keys.path);};this.printSnapshot=function(state){var lenv=state.Navigate.history.track.length;for(var ii=0;ii<lenv;ii++){var snapshot=state.Navigate.history.track[ii];if(ii===state.Navigate.history.pos){console.log(\"@@@@\",ii,\" => \",this.snapshotToString(state,snapshot));}else{console.log(\"    \",ii,\" => \",this.snapshotToString(state,snapshot));}};};};export default Navigate;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/NavigateLib.js"],"names":["Navigate","history","pos","track","home","undefined","rank","trash","maxStore","reset","state","store","snapshot","Path","getSnapshot","length","keep","splice","old","JSON","stringify","console","log","push","refreshHistory","React","Config","show","canUndo","canRedo","undo","setSnapshot","Show","redo","onClickTablePath","skey","tkey","reload","sid","keys","other","indexOf","tid","src","trg","Utils","pushKey","exportAllKeys","Html","setFootnote","setProgress","onClickRestValue","val","key","where","Auto","selectTableKey","onClickPath","ttyp","tin","sin","tib","path","cleanSelect","table","onClickAddOther","active","ntab","switchTableKey","concat","colkey","getColKey","rowkey","getRowKey","selectItem","colval","rowval","colwhere","rowwhere","colcnt","rowcnt","cp","Layout","getLayoutMode","modes","layout","Map","selectMapKey","changed","cnt","select","missing","selectKey","snapshotToString","printSnapshot","lenv","ii"],"mappings":"AAAA;AAEA,QAASA,CAAAA,QAAT,EAAoB,CAChB,KAAKC,OAAL,CAAa,CAACC,GAAG,CAAC,CAAL,CAAQ;AACrBC,KAAK,CAAC,EADO,CAAb,CAGA,KAAKC,IAAL,CAAUC,SAAV,CACA,KAAKC,IAAL,CAAU,EAAV,CAAuB;AACvB,KAAKC,KAAL,CAAW,EAAX,CAAwB;AACxB,KAAKC,QAAL,CAAc,IAAd,CAA0B;AAC1B,KAAKC,KAAL,CAAW,SAASC,KAAT,CAAgB,CAAE;AAChCA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuB,CAACC,GAAG,CAAC,CAAL,CAAOC,KAAK,CAAC,EAAb,CAAvB,CACA,KAAKQ,KAAL,CAAWD,KAAX,EACI,CAHD,CAIA,KAAKC,KAAL,CAAW,SAASD,KAAT,CAAgB,CAAE;AAChC,GAAIE,CAAAA,QAAQ,CAACF,KAAK,CAACG,IAAN,CAAWC,WAAX,CAAuBJ,KAAvB,CAAb,CACA;AACA,GAAIA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoCL,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2B,CAAnE,CAAsE,CAClEQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoCL,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2B,CAA/D,CACH,CAFD,IAEO,IAAIQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAsC,KAAKP,QAA/C,CAAyD,CAC5D,GAAIQ,CAAAA,IAAI,CAAC,KAAKR,QAAd,CACAE,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BO,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6Bc,MAA7B,CAAoC,CAACD,IAArC,CAA0CA,IAA1C,CAA7B,CACH,EACD,GAAIN,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoC,CAAxC,CAA2C,CACvC,GAAIG,CAAAA,GAAG,CAACR,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BO,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoC,CAAjE,CAAR,CACA,GAAII,IAAI,CAACC,SAAL,CAAeR,QAAf,IAA2BO,IAAI,CAACC,SAAL,CAAeF,GAAf,CAA/B,CAAoD,CACvD;AACAG,OAAO,CAACC,GAAR,CAAY,qBAAZ,EACA,MAAO,MAAP,CACI,CACJ,CACDZ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BoB,IAA7B,CAAkCX,QAAlC,EACAF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2BQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoC,CAA/D,CACA;AACA;AACA;AACA;AACA;AACA,KAAKS,cAAL,CAAoBd,KAApB,EACI,CAzBD,CA0BA,KAAKc,cAAL,CAAoB,SAASd,KAAT,CAAgB,CACvC,GAAIA,KAAK,CAACe,KAAN,CAAYC,MAAZ,GAAuBrB,SAA3B,CAAsC,CAClCK,KAAK,CAACe,KAAN,CAAYC,MAAZ,CAAmBC,IAAnB,GACH,EACG,CAJD,CAKA,KAAKC,OAAL,CAAa,SAASlB,KAAT,CAAgB,CAChC,MAAQA,CAAAA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA6B,CAArC,CACI,CAFD,CAGA,KAAK2B,OAAL,CAAa,SAASnB,KAAT,CAAgB,CAChC,MAAQA,CAAAA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA6BQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAA7B,CAAoC,CAAzE,CACI,CAFD,CAGA,KAAKe,IAAL,CAAU,SAASpB,KAAT,CAAgB,CAC7B;AACA,GAAI,KAAKkB,OAAL,CAAalB,KAAb,CAAJ,CAAyB,CACrBA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2BQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2B,CAAtD,CACA,GAAIU,CAAAA,QAAQ,CAACF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BO,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAApD,CAAb,CACA;AACAQ,KAAK,CAACG,IAAN,CAAWkB,WAAX,CAAuBrB,KAAvB,CAA6BE,QAA7B,EACA,KAAKY,cAAL,CAAoBd,KAApB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,EACG,CAVD,CAWA,KAAKuB,IAAL,CAAU,SAASvB,KAAT,CAAgB,CAC7B;AACA,GAAI,KAAKmB,OAAL,CAAanB,KAAb,CAAJ,CAAyB,CACrBA,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2BQ,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,CAA2B,CAAtD,CACA,GAAIU,CAAAA,QAAQ,CAACF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BO,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAApD,CAAb,CACA;AACAQ,KAAK,CAACG,IAAN,CAAWkB,WAAX,CAAuBrB,KAAvB,CAA6BE,QAA7B,EACA,KAAKY,cAAL,CAAoBd,KAApB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,CACG,CAVD,CAWA,KAAKwB,gBAAL,CAAsB,SAASxB,KAAT,CAAeyB,IAAf,CAAoBC,IAApB,CAA0B,CACnD,GAAIC,CAAAA,MAAM,CAAC,KAAX,CACA,GAAIC,CAAAA,GAAG,CAAC5B,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BN,IAA9B,CAAR,CACA,GAAIO,CAAAA,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BL,IAA9B,CAAR,CACA;AACA,GAAIE,GAAG,GAAK,CAAC,CAAT,EAAcI,GAAG,GAAK,CAAC,CAA3B,CAA8B,CAC1B,GAAIJ,GAAG,CAAGI,GAAV,CAAe,CAClB,GAAIC,CAAAA,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6BqB,GAA7B,CAAkC,CAAlC,CAAR,CAA8D;AAC9D,GAAIM,CAAAA,GAAG,CAAClC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6ByB,GAA7B,CAAkC,CAAlC,CAAR,CAA8D;AAC9DhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CG,GAA1C,CAA8CD,GAA9C,EACAhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CI,GAA1C,CAA8CN,GAA9C,EACA;AACA;AACA5B,KAAK,CAACG,IAAN,CAAWkC,aAAX,CAAyBrC,KAAzB,EACA2B,MAAM,CAAC,IAAP,CACI,CACJ,CACD3B,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,CAAsB2B,MAAtB,EACI,CArBD,CAsBA,KAAKc,gBAAL,CAAsB,SAASzC,KAAT,CAAe0C,GAAf,CAAmBC,GAAnB,CAAuBC,KAAvB,CAA8B,CACvD;AACA,GAAI5C,KAAK,CAAC6C,IAAN,CAAWC,cAAX,CAA0B9C,KAA1B,CAAgC2C,GAAhC,CAAoCD,GAApC,CAAwCE,KAAxC,CAA8C,CAA9C,CAAJ,CAAsD,CAClD5C,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,EACDW,OAAO,CAACC,GAAR,CAAY,wBAAZ,CAAqC8B,GAArC,CAAyCC,GAAzC,CAA6ClC,IAAI,CAACC,SAAL,CAAeV,KAAK,CAACG,IAAN,CAAW0B,IAA1B,CAA7C,EACI,CATD,CAUA,KAAKkB,WAAL,CAAiB,SAAS/C,KAAT,CAAegD,IAAf,CAAoBtB,IAApB,CAA0B,CAC9C,GAAIC,CAAAA,MAAM,CAAC,KAAX,CAAkB;AAClB,GAAIK,CAAAA,GAAJ,CAAQiB,GAAR,CAAYC,GAAZ,CAAgBjB,GAAhB,CAAoBkB,GAApB,CACA;AACA,GAAIH,IAAI,GAAM,MAAd,CAAsB,CAAE;AACpBhB,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAAhB,CAAqBrB,OAArB,CAA6BL,IAA7B,CAAJ,CACA,GAAIM,GAAG,GAAK,CAAC,CAAb,CAAgB,CACnBC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAAhB,CAAqB7C,MAArB,CAA4ByB,GAA5B,CAAiC,CAAjC,CAAJ,CAAyD;AACzDhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CG,GAA1C,CAA8C,CAA9C,EACA;AACAjC,KAAK,CAACG,IAAN,CAAWkD,WAAX,CAAuBrD,KAAvB,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA2B,MAAM,CAAC,IAAP,CACI,CACJ,CAVD,IAUO,IAAIqB,IAAI,GAAM,OAAd,CAAuB,CAAE;AAC5BhB,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BL,IAA9B,CAAJ,CACA;AACA,GAAIM,GAAG,GAAK,CAAC,CAAb,CAAgB,CACnBC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6ByB,GAA7B,CAAkC,CAAlC,CAAJ,CAA0D;AAC1DhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CG,GAA1C,CAA8C,CAA9C,EACA;AACAjC,KAAK,CAACG,IAAN,CAAWkC,aAAX,CAAyBrC,KAAzB,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA2B,MAAM,CAAC,IAAP,CACI,CACJ,CAXM,IAWA,IAAIqB,IAAI,GAAK,MAAb,CAAqB,CAAE;AAC1BhB,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BL,IAA9B,CAAJ,CACA,GAAIM,GAAG,GAAK,CAAC,CAAb,CAAgB,CACnBC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6ByB,GAA7B,CAAkC,CAAlC,CAAJ,CAA0D;AAC1DhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAWN,KAA/B,CAAqCoC,GAArC,EACA;AACAjC,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA2B,MAAM,CAAC,IAAP,CACI,EACJ,CATM,IASA,IAAIqB,IAAI,GAAK,OAAb,CAAsB,CACzBhB,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAWN,KAAX,CAAiBkC,OAAjB,CAAyBL,IAAzB,CAAJ,CACAuB,GAAG,CAACjD,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BL,IAA9B,CAAJ,CACAwB,GAAG,CAAClD,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAAhB,CAAqBrB,OAArB,CAA6BL,IAA7B,CAAJ,CACAyB,GAAG,CAACnD,KAAK,CAACG,IAAN,CAAW2B,KAAX,CAAiBwB,KAAjB,CAAuBvB,OAAvB,CAA+BL,IAA/B,CAAJ,CACAf,OAAO,CAACC,GAAR,CAAY,iBAAZ,CAA8BH,IAAI,CAACC,SAAL,CAAeV,KAAK,CAACG,IAAN,CAAWN,KAA1B,CAA9B,CAA+D6B,IAA/D,CAAoEM,GAApE,CAAwEiB,GAAxE,CAA4EC,GAA5E,CAAgFC,GAAhF,EACA,GAAInB,GAAG,GAAK,CAAC,CAAb,CAAgB,CAA8C;AACjEC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAWN,KAAX,CAAiBU,MAAjB,CAAwByB,GAAxB,CAA6B,CAA7B,CAAJ,CACAhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CG,GAA1C,EACA;AACA;AACA;AACI,CAND,IAMO,IAAIgB,GAAG,GAAK,CAAC,CAAT,EAAcE,GAAG,GAAK,CAAC,CAA3B,CAA8B,CAAyB;AACjElB,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACAjD,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAWN,KAA/B,CAAqCoC,GAArC,EACAN,MAAM,CAAC,IAAP,CACA;AACI,CALM,IAKA,IAAIuB,GAAG,GAAK,CAAC,CAAT,EAAcD,GAAG,GAAK,CAAC,CAA3B,CAA8B,CAA0B;AAClEjD,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CJ,IAA1C,EACA;AACI,CAHM,IAGA,IAAIwB,GAAG,GAAK,CAAC,CAAT,EAAcD,GAAG,GAAK,CAAC,CAA3B,CAA8B,CAAyB;AACjEhB,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACI,CAFM,IAEA,IAAIC,GAAG,GAAK,CAAC,CAAT,EAAcD,GAAG,GAAK,CAAC,CAA3B,CAA8B,CAAyB;AACjEhB,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACAjD,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAWN,KAA/B,CAAqCoC,GAArC,EACA;AACI,EACDjC,KAAK,CAACG,IAAN,CAAWkC,aAAX,CAAyBrC,KAAzB,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA;AACH,CACDA,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACA;AACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,CAAsB2B,MAAtB,EACI,CArED,CAsEA,KAAK4B,eAAL,CAAqB,SAASvD,KAAT,CAAegD,IAAf,CAAoBtB,IAApB,CAAyB8B,MAAzB,CAAiC,CAAE;AAC3D,GAAIC,CAAAA,IAAI,CAACzD,KAAK,CAACG,IAAN,CAAW2B,KAAX,CAAiBwB,KAAjB,CAAuBjD,MAAhC,CACA,GAAIsB,CAAAA,MAAM,CAAE8B,IAAI,GAAG,CAAnB,CAAuB;AACvB,GAAIzB,CAAAA,GAAJ,CAAQiB,GAAR,CAAYC,GAAZ,CAAgBjB,GAAhB,CACA;AACA;AACA;AACAD,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAWN,KAAX,CAAiBkC,OAAjB,CAAyBL,IAAzB,CAAJ,CACAuB,GAAG,CAACjD,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BL,IAA9B,CAAJ,CACAwB,GAAG,CAAClD,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAAhB,CAAqBrB,OAArB,CAA6BL,IAA7B,CAAJ,CACA,GAAIuB,GAAG,GAAK,CAAC,CAAb,CAAgB,CAAE;AACd,GAAIjB,GAAG,GAAK,CAAC,CAAb,CAAgB,CAAiC;AACpDC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAWN,KAAX,CAAiBU,MAAjB,CAAwByB,GAAxB,CAA6B,CAA7B,CAAJ,CACAhC,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CG,GAA1C,EACA;AACA;AACA;AACI,CAND,IAMO,IAAIiB,GAAG,GAAK,CAAC,CAAb,CAAgB,CAA0B;AACpDlD,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAApC,CAA0CJ,IAA1C,EACA;AACI,CAHM,IAGA,CAAE;AACZf,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA2Bc,IAA3B,CACKjB,IAAI,CAACC,SAAL,CAAeV,KAAK,CAACG,IAAN,CAAWN,KAA1B,CADL,CAEKY,IAAI,CAACC,SAAL,CAAeV,KAAK,CAACG,IAAN,CAAW0B,IAA1B,CAFL,EAGI,EACJ,CAfD,IAeO,CAAE;AACL,GAAIqB,GAAG,GAAK,CAAC,CAAb,CAAgB,CAAE;AACrBjB,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACI,CAFD,IAEO,IAAKjB,GAAG,GAAK,CAAC,CAAd,CAAiB,CAAE;AAC7BC,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACAjD,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAWN,KAA/B,CAAqCoC,GAArC,EACI,CAHM,IAGA,CAAE;AACZA,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6B0C,GAA7B,CAAkC,CAAlC,CAAJ,CACI,CACJ,EACDjD,KAAK,CAACG,IAAN,CAAWkC,aAAX,CAAyBrC,KAAzB,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA;AACA;AACA;AACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,CAAsB2B,MAAtB,EACI,CAzCD,CA0CA,KAAK+B,cAAL,CAAoB,SAAS1D,KAAT,CAAe2C,GAAf,CAAoB,CAC3C,GAAIX,CAAAA,GAAG,CAAChC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BY,GAA9B,CAAR,CACA,GAAIX,GAAG,GAAK,CAAC,CAAb,CAAgB,CACZ,GAAIC,CAAAA,GAAG,CAACjC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsBvB,MAAtB,CAA6ByB,GAA7B,CAAkC,CAAlC,CAAR,CAA8D;AAC9DhC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsB9B,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAAhB,CAAsB6B,MAAtB,CAA6B1B,GAA7B,CAAtB,CAA0D;AAC1D;AACA;AACAjC,KAAK,CAACG,IAAN,CAAWkC,aAAX,CAAyBrC,KAAzB,EACA,GAAI4D,CAAAA,MAAM,CAAC5D,KAAK,CAACG,IAAN,CAAW0D,SAAX,CAAqB7D,KAArB,CAAX,CACA,GAAI8D,CAAAA,MAAM,CAAC9D,KAAK,CAACG,IAAN,CAAW4D,SAAX,CAAqB/D,KAArB,CAAX,CACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACA,GAAI2B,CAAAA,MAAM,CAAEM,GAAG,CAAC,CAAD,CAAH,GAAS2B,MAAT,EAAmB3B,GAAG,CAAC,CAAD,CAAH,GAAS6B,MAAxC,CACA;AACA9D,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,CAAsB2B,MAAtB,EACH,CACG,CAfD,CAgBA,KAAKqC,UAAL,CAAgB,SAAShE,KAAT,CAAe4D,MAAf,CAAsBE,MAAtB,CAA6BG,MAA7B,CAAoCC,MAApC,CAA2CC,QAA3C,CAAoDC,QAApD,CAA6DC,MAA7D,CAAoEC,MAApE,CAA4E,CAC/F;AACA;AACA;AACA,GAAI1E,CAAAA,IAAI,CAACI,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAevE,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAA/B,CAAT,CACA;AACA,GAAI9B,KAAK,CAACwE,MAAN,CAAaC,aAAb,CAA2BzE,KAA3B,IAAuCA,KAAK,CAACwE,MAAN,CAAaE,KAAb,CAAmBC,MAAnB,CAA0BC,GAArE,CAA0E,CACtE,GAAI,KAAKC,YAAL,CAAkB7E,KAAlB,CAAwB4D,MAAxB,CAA+BK,MAA/B,CAAsCE,QAAtC,CAA+CE,MAA/C,CAAJ,CAA4D,CAC/D,KAAKzE,IAAL,CAAUgE,MAAV,EAAkB5D,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAe3E,IAAf,CAAlB,CACA;AACA,GAAI,KAAKiF,YAAL,CAAkB7E,KAAlB,CAAwB8D,MAAxB,CAA+BI,MAA/B,CAAsCE,QAAtC,CAA+CE,MAA/C,CAAJ,CAA4D,CACxD,KAAK1E,IAAL,CAAUkE,MAAV,EAAkB9D,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAe3E,IAAf,CAAlB,CACA;AACH,CACD;AACA;AACI,EACD;AACAI,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,CAhBD,IAgBO,CACH,GAAI8E,CAAAA,OAAO,CAAC,KAAZ,CACA,GAAI9E,KAAK,CAAC6C,IAAN,CAAWC,cAAX,CAA0B9C,KAA1B,CAAgC4D,MAAhC,CAAuCK,MAAvC,CAA8CE,QAA9C,CAAuDE,MAAvD,CAAJ,CAAoE,CACvE;AACA,KAAKzE,IAAL,CAAUgE,MAAV,EAAkB5D,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAe3E,IAAf,CAAlB,CACAkF,OAAO,CAAC,IAAR,CACI,CAJD,IAIO,CACVnE,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAgCgD,MAAhC,EACI,EACD,GAAI5D,KAAK,CAAC6C,IAAN,CAAWC,cAAX,CAA0B9C,KAA1B,CAAgC8D,MAAhC,CAAuCI,MAAvC,CAA8CE,QAA9C,CAAuDE,MAAvD,CAAJ,CAAoE,CACvE;AACA,KAAK1E,IAAL,CAAUkE,MAAV,EAAkB9D,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAe3E,IAAf,CAAlB,CACAkF,OAAO,CAAC,IAAR,CACI,CAJD,IAIO,CACVnE,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAgCkD,MAAhC,EACI,CACD,GAAIgB,OAAJ,CAAa,CAChB;AACA;AACA9E,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACI,CACD;AACH,EACG,CAhDD,CAiDA,KAAK6E,YAAL,CAAkB,SAAS7E,KAAT,CAAe2C,GAAf,CAAmBD,GAAnB,CAAuBE,KAAvB,CAA6BmC,GAA7B,CAAkC,CAAE;AACzD;AACA/E,KAAK,CAACG,IAAN,CAAW6E,MAAX,CAAkBtC,GAAlB,CAAsBC,GAAtB,EAA2B,CAACD,GAAD,CAA3B,CACA1C,KAAK,CAACG,IAAN,CAAWyC,KAAX,CAAiBD,GAAjB,EAAsBC,KAAtB,CACA,GAAI5C,KAAK,CAACmC,KAAN,CAAY8C,OAAZ,CAAoBjF,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAApC,CAAyCT,GAAzC,CAAJ,CAAmD,CAC/C;AACA3C,KAAK,CAACmC,KAAN,CAAYC,OAAZ,CAAoBpC,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBuB,IAApC,CAAyCT,GAAzC,EACA;AACH,EACD,MAAO,KAAP,CACI,CAVD,CAWA,KAAKuC,SAAL,CAAe,SAASlF,KAAT,CAAe2C,GAAf,CAAmBD,GAAnB,CAAuBE,KAAvB,CAA6BmC,GAA7B,CAAkC,CACpD,GAAInF,CAAAA,IAAI,CAACI,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAevE,KAAK,CAACG,IAAN,CAAW0B,IAAX,CAAgBC,KAA/B,CAAT,CACA;AACA;AACA,GAAI9B,KAAK,CAACwE,MAAN,CAAaC,aAAb,CAA2BzE,KAA3B,IAAuCA,KAAK,CAACwE,MAAN,CAAaE,KAAb,CAAmBC,MAAnB,CAA0BC,GAArE,CAA0E,CACtE,GAAI,KAAKC,YAAL,CAAkB7E,KAAlB,CAAwB2C,GAAxB,CAA4BD,GAA5B,CAAgCE,KAAhC,CAAsCmC,GAAtC,CAAJ,CAAgD,CACnD,KAAKnF,IAAL,CAAU+C,GAAV,EAAe3C,KAAK,CAACmC,KAAN,CAAYoC,EAAZ,CAAe3E,IAAf,CAAf,CACI,CACDI,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,CARD,IAQO,IAAIA,KAAK,CAAC6C,IAAN,CAAWC,cAAX,CAA0B9C,KAA1B,CAAgC2C,GAAhC,CAAoCD,GAApC,CAAwCE,KAAxC,CAA8CmC,GAA9C,CAAJ,CAAwD,CAC3D,KAAKnF,IAAL,CAAU+C,GAAV,EAAe/C,IAAf,CACA;AACA;AACAI,KAAK,CAACsC,IAAN,CAAWC,WAAX,CAAuBvC,KAAvB,CAA6B,kBAA7B,EACAA,KAAK,CAACsC,IAAN,CAAWE,WAAX,CAAuBxC,KAAvB,CAA8B,IAA9B,EACAA,KAAK,CAACV,QAAN,CAAeW,KAAf,CAAqBD,KAArB,EACAA,KAAK,CAACsB,IAAN,CAAWL,IAAX,CAAgBjB,KAAhB,EACH,CARM,IAQA,CACHW,OAAO,CAACC,GAAR,CAAY,mBAAZ,CAAgC+B,GAAhC,EACH,CACD;AACI,CAxBD,CAyBA,KAAKwC,gBAAL,CAAsB,SAASnF,KAAT,CAAeE,QAAf,CAAyB,CAClD,MAAQ,aAAeO,IAAI,CAACC,SAAL,CAAeR,QAAQ,CAAC2B,IAAT,CAAcuB,IAA7B,CAAvB,CACI,CAFD,CAGA,KAAKgC,aAAL,CAAmB,SAASpF,KAAT,CAAgB,CACtC,GAAIqF,CAAAA,IAAI,CAACrF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BY,MAAtC,CACA,IAAK,GAAIiF,CAAAA,EAAE,CAAC,CAAZ,CAAcA,EAAE,CAACD,IAAjB,CAAsBC,EAAE,EAAxB,CAA4B,CACxB,GAAIpF,CAAAA,QAAQ,CAACF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6B6F,EAA7B,CAAb,CACA,GAAIA,EAAE,GAAGtF,KAAK,CAACV,QAAN,CAAeC,OAAf,CAAuBC,GAAhC,CAAqC,CACxCmB,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAmB0E,EAAnB,CAAsB,MAAtB,CAA6B,KAAKH,gBAAL,CAAsBnF,KAAtB,CAA4BE,QAA5B,CAA7B,EACI,CAFD,IAEO,CACVS,OAAO,CAACC,GAAR,CAAY,MAAZ,CAAmB0E,EAAnB,CAAsB,MAAtB,CAA6B,KAAKH,gBAAL,CAAsBnF,KAAtB,CAA4BE,QAA5B,CAA7B,EACI,CACJ,EACG,CAVD,CAWH,EACD,cAAeZ,CAAAA,QAAf","sourcesContent":["//console.log(\"Loading NavigateLib.js\");\n\nfunction Navigate() {\n    this.history={pos:0, // position of next snapshot\n\t\t  track:[]\n\t\t };\n    this.home=undefined;\n    this.rank={};          // key rank\n    this.trash={};          // key trash\n    this.maxStore=1000;       // max number of states stored\n    this.reset=function(state) { // store state\n\tstate.Navigate.history={pos:0,track:[]};\n\tthis.store(state);\n    };\n    this.store=function(state) { // store state\n\tvar snapshot=state.Path.getSnapshot(state)\n\t// remove old data...\n\tif (state.Navigate.history.track.length>state.Navigate.history.pos+1) {\n\t    state.Navigate.history.track.length=state.Navigate.history.pos+1;\n\t} else if (state.Navigate.history.track.length > this.maxStore) {\n\t    var keep=this.maxStore;\n\t    state.Navigate.history.track=state.Navigate.history.track.splice(-keep,keep);\n\t};\n\tif (state.Navigate.history.track.length>0) {\n\t    var old=state.Navigate.history.track[state.Navigate.history.track.length-1];\n\t    if (JSON.stringify(snapshot)===JSON.stringify(old)) {\n\t\t//console.log(\"History:\",JSON.stringify(snapshot),JSON.stringify(state.Navigate.history.track));\n\t\tconsole.log(\"Ignoring old image.\");\n\t\treturn false;\n\t    }\n\t}\n\tstate.Navigate.history.track.push(snapshot);\n\tstate.Navigate.history.pos=state.Navigate.history.track.length-1;\n\t//console.log(\">>>>>> Stored state...\",JSON.stringify(state.Navigate.history),\n\t//\t    this.canUndo(state),this.canRedo(state),\n\t//\t    state.Navigate.history.pos,state.Navigate.history.track.length);\n\t//console.log(\">>>>> stored state.\",this.snapshotToString(state,snapshot));\n\t//this.printSnapshot(state);\n\tthis.refreshHistory(state);\n    };\n    this.refreshHistory=function(state) {\n\tif (state.React.Config !== undefined) {\n\t    state.React.Config.show();\n\t};\n    };\n    this.canUndo=function(state) {\n\treturn (state.Navigate.history.pos > 0);\n    };\n    this.canRedo=function(state) {\n\treturn (state.Navigate.history.pos < state.Navigate.history.track.length-1);\n    };\n    this.undo=function(state) {\n\t//console.log(\">>>>>> Undo:\",this.canUndo(state));\n\tif (this.canUndo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos-1;\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    //console.log(\"Setting snapshot:\",this.snapshotToString(state,snapshot));\n\t    state.Path.setSnapshot(state,snapshot);\n\t    this.refreshHistory(state);\n\t    state.Show.show(state);\n\t};\n    };\n    this.redo=function(state) {\n\t//console.log(\">>>>>> Redo:\",this.canRedo(state),state.Navigate.history.pos,JSON.stringify(state.Navigate.history.track));\n\tif (this.canRedo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos+1;\t\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    //console.log(\"Setting snapshot:\",this.snapshotToString(state,snapshot));\n\t    state.Path.setSnapshot(state,snapshot);\n\t    this.refreshHistory(state);\n\t    state.Show.show(state);\n\t}\n    };\n    this.onClickTablePath=function(state,skey,tkey) {\n\tvar reload=false;\n\tvar sid=state.Path.keys.other.indexOf(skey);\n\tvar tid=state.Path.keys.other.indexOf(tkey);\n\t//console.log(\"Table path: Sid:\",sid,\" tid:\",tid,skey,tkey);\n\tif (sid !== -1 && tid !== -1) {\n\t    if (sid > tid) {\n\t\tvar src=state.Path.keys.other.splice(sid, 1);                 // remove from path\n\t\tvar trg=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,tid);\n\t\tstate.Utils.pushKey(state.Path.keys.other,trg,sid);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,tid,0,src); // first position (table)\n\t\t//state.Utils.spliceArray(state.Path.keys.other,sid,0,trg); // first position (table)\n\t\tstate.Path.exportAllKeys(state);\n\t\treload=true;\n\t    }\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tstate.Html.setProgress(state, true);\n\tstate.Navigate.store(state);\n\tstate.Show.show(state,reload);\n    };\n    this.onClickRestValue=function(state,val,key,where) {\n\t//console.log(\"onClickRestValue:\",val,key,JSON.stringify(state.Path.keys));\n\tif (state.Auto.selectTableKey(state,key,val,where,1)) {\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t};\n\tconsole.log(\"onClickRestValue done:\",val,key,JSON.stringify(state.Path.keys));\n    };\n    this.onClickPath=function(state,ttyp,tkey) {\n\tvar reload=false; // matrix changed?\n\tvar tid,tin,sin,src,tib;\n\t//console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\tif (ttyp  === \"path\") { // path -> table\n\t    tid=state.Path.keys.path.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.path.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,2);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Path.cleanSelect(state);\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    }\n\t} else if (ttyp  === \"table\") { // other -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    //console.log(\"Tin:\",tin,\" tid:\",tid);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,0);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Path.exportAllKeys(state);\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    }\n\t} else if (ttyp === \"rest\") { // rest -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    };\n\t} else if (ttyp === \"trash\") {\n\t    tid=state.Path.trash.indexOf(tkey);\n\t    tin=state.Path.keys.other.indexOf(tkey);\n\t    sin=state.Path.keys.path.indexOf(tkey);\n\t    tib=state.Path.other.table.indexOf(tkey);\n\t    console.log(\"Trashing start:\",JSON.stringify(state.Path.trash),tkey,tid,tin,sin,tib);\n\t    if (tid !== -1) {                                             // trash => other\n\t\tsrc=state.Path.trash.splice(tid, 1);\n\t\tstate.Utils.pushKey(state.Path.keys.other,src);\n\t\t//if ( tin === -1 ) {\n\t\t//    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n\t\t//};\n\t    } else if (tin !== -1 && tib !== -1) {                        // table => trash\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t\treload=true;\n\t\t//state.Path.trash=state.Path.trash.concat(src);            // last position\n\t    } else if (sin !== -1 && tin === -1) {                         // select => other\n\t\tstate.Utils.pushKey(state.Path.keys.other,tkey);\n\t\t//state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n\t    } else if (sin !== -1 && tin !== -1) {                        // other => select\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t    } else if (sin === -1 && tin !== -1) {                        // other => trash\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t\t//state.Path.trash=state.Path.trash.concat(src);            // last position\n\t    };\n\t    state.Path.exportAllKeys(state);\n\t    state.Navigate.store(state);\n\t    //console.log(\"Trashed:\",JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tstate.Html.setProgress(state, true);\n\t//console.log(\"Showing:\",JSON.stringify(state.Path.other));\n\tstate.Show.show(state,reload);\n    };\n    this.onClickAddOther=function(state,ttyp,tkey,active) { // add key to other\n\tvar ntab=state.Path.other.table.length;\n\tvar reload=(ntab!==2); // matrix changed?\n\tvar tid,tin,sin,src;\n\t//console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\t//ttyp \"select\", \"rest\", \"trash\"\n\t//console.log(\"Adding start:\",tkey,JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\n\ttid=state.Path.trash.indexOf(tkey);\n\ttin=state.Path.keys.other.indexOf(tkey);\n\tsin=state.Path.keys.path.indexOf(tkey);\n\tif (tin === -1) { // add if not already in state.Path.keys.other\n\t    if (tid !== -1) {                                // trash => other\n\t\tsrc=state.Path.trash.splice(tid, 1);\n\t\tstate.Utils.pushKey(state.Path.keys.other,src);\n\t\t//if ( tin === -1 ) {\n\t\t//    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n\t\t//};\n\t    } else if (sin !== -1) {                         // select => other\n\t\tstate.Utils.pushKey(state.Path.keys.other,tkey);\n\t\t//state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n\t    } else { // not in trash,select or other, how strange\n\t\tconsole.log(\"Strange key:\",tkey,\n\t\t\t    JSON.stringify(state.Path.trash),\n\t\t\t    JSON.stringify(state.Path.keys));\n\t    };\n\t} else { // remove if in state.Path.keys.other\n\t    if (sin !== -1) { // is already in selected list\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t    } else if ( tid === -1) { // move to trash if its not already there\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t    } else { // its already in trash, just delete it\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t    }\n\t};\n\tstate.Path.exportAllKeys(state);\n\tstate.Navigate.store(state);\n\t//console.log(\"Keys:\",reload,JSON.stringify(state.Path.keys));\n\t//console.log(\"Trash:\",reload,JSON.stringify(state.Path.trash));\n\t//console.log(\"Other:\",JSON.stringify(state.Path.other));\n\tstate.Show.show(state,reload);\n    };\n    this.switchTableKey=function(state,key) {\n\tvar tid=state.Path.keys.other.indexOf(key);\n\tif (tid !== -1) {\n\t    var src=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n\t    //state.Utils.pushKey(state.Path.keys.other,src,0);       // first position\n\t    //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t    state.Path.exportAllKeys(state);\n\t    var colkey=state.Path.getColKey(state);\n\t    var rowkey=state.Path.getRowKey(state);\n\t    state.Navigate.store(state);\n\t    var reload=(src[0]!==colkey && src[0]!==rowkey);\n\t    //console.log(\"Switched:\",JSON.stringify(src[0]),colkey,rowkey,reload);\n\t    state.Show.show(state,reload);\n\t}\t\n    };\n    this.selectItem=function(state,colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt) {\n\t//console.log(\"Selectitem:\",colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt);\n\t//var colkey=state.Path.getColKey(state);\n\t//var rowkey=state.Path.getRowKey(state);\n\tvar rank=state.Utils.cp(state.Path.keys.other);\n\t//console.log(\"SelectItem:\",colkey,\"=\",colval,\"  \",rowkey,\"=\",rowval);\n\tif (state.Layout.getLayoutMode(state)  === state.Layout.modes.layout.Map) {\n\t    if (this.selectMapKey(state,colkey,colval,colwhere,colcnt)) {\n\t\tthis.rank[colkey]=state.Utils.cp(rank);\n\t\t//this.flip[colkey]=this.getFlip(state);\n\t\tif (this.selectMapKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\t    this.rank[rowkey]=state.Utils.cp(rank);\n\t\t    //this.last.flip[rowkey]=this.getFlip(state);\n\t\t}\n\t\t//this.trash[colkey]=state.Path.checkTableKeys(state);\n\t\t//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t    };\n\t    //console.log(\"Path:\",JSON.stringify(state.Path))\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\t\n\t} else {\n\t    var changed=false;\n\t    if (state.Auto.selectTableKey(state,colkey,colval,colwhere,colcnt)) {\n\t\t//console.log(\"Selected:\",colkey,colval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\t\tthis.rank[colkey]=state.Utils.cp(rank);\n\t\tchanged=true;\n\t    } else {\n\t\tconsole.log(\"Unable to select:\",colkey);\n\t    };\n\t    if (state.Auto.selectTableKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\t//console.log(\"Selected:\",rowkey,rowval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\t\tthis.rank[rowkey]=state.Utils.cp(rank);\n\t\tchanged=true;\n\t    } else {\n\t\tconsole.log(\"Unable to select:\",rowkey);\n\t    }\n\t    if (changed) {\n\t\t//this.trash[colkey]=state.Path.checkTableKeys(state);\n\t\t//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t\tstate.Html.setFootnote(state,\"Extracting data.\");\n\t\tstate.Html.setProgress(state, true);\n\t\tstate.Navigate.store(state);\n\t\tstate.Show.show(state);\n\t    }\n\t    //console.log(\"Selectitem Done:\",rowwhere,colwhere);\n\t};\n    };\n    this.selectMapKey=function(state,key,val,where,cnt) { // keep abscissa\n\t//console.log(\"Table.Selecting:\",key,\"=\",val,\", where=\",where);\n\tstate.Path.select.val[key]=[val];\n\tstate.Path.where[key]=where;\n\tif (state.Utils.missing(state.Path.keys.path,key)) {\n\t    //console.log(\"Adding to path:\",key);\n\t    state.Utils.pushKey(state.Path.keys.path,key);\n\t    //state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n\t};\n\treturn true;\n    };\n    this.selectKey=function(state,key,val,where,cnt) {\n\tvar rank=state.Utils.cp(state.Path.keys.other);\n\t//console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n\t//console.log(\"SelectKey:\",key,val,where,cnt);\n\tif (state.Layout.getLayoutMode(state)  === state.Layout.modes.layout.Map) {\n\t    if (this.selectMapKey(state,key,val,where,cnt)) {\n\t\tthis.rank[key]=state.Utils.cp(rank);\n\t    }\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t} else if (state.Auto.selectTableKey(state,key,val,where,cnt)) {\n\t    this.rank[key]=rank;\n\t    //this.trash[key]=state.Path.checkTableKeys(state);\n\t    //console.log(\"state.Path.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t} else {\n\t    console.log(\"Unable to select:\",key);\n\t}\n\t//console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n    };\n    this.snapshotToString=function(state,snapshot) {\n\treturn (\"Snapshot: \" + JSON.stringify(snapshot.keys.path));\n    };\n    this.printSnapshot=function(state) {\n\tvar lenv=state.Navigate.history.track.length;\n\tfor (var ii=0;ii<lenv;ii++) {\n\t    var snapshot=state.Navigate.history.track[ii];\n\t    if (ii===state.Navigate.history.pos) {\n\t\tconsole.log(\"@@@@\",ii,\" => \",this.snapshotToString(state,snapshot));\n\t    } else {\n\t\tconsole.log(\"    \",ii,\" => \",this.snapshotToString(state,snapshot));\n\t    }\n\t};\n    };\n};\nexport default Navigate;\n"]},"metadata":{},"sourceType":"module"}