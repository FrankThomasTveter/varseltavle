{"ast":null,"code":"import _classCallCheck from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _objectWithoutProperties from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"/home/franktt/react/varseltavle/src/react/Table2DComponent.js\";\nimport React, { Component } from \"react\";\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\nimport { teal_palette } from '../mui/metMuiThemes';\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\nimport SummaryCell from './SummaryCell';\nimport SeriesCell from './SeriesCell';\nimport CanvasText from './CanvasTextComponent';\n\nvar styles = function styles(theme) {\n  return {\n    root: {\n      height: '100%'\n    },\n    paper: {\n      overflow: 'hidden',\n      tableLayout: 'fixed',\n      padding: 0,\n      margin: 0\n    },\n    divTable: {\n      display: 'table',\n      width: '100%'\n    },\n    divTableRow: {\n      display: 'table-row'\n    },\n    divTableCell: {\n      border: '0px solid #999999',\n      display: 'table-cell',\n      padding: '0px 0px'\n    },\n    divTableCellCursor: {\n      cursor: \"pointer\",\n      border: '0px solid #999999',\n      display: 'table-cell',\n      padding: '0px 0px'\n    },\n    divTableHead: {\n      border: '0px solid #999999',\n      display: 'table-cell',\n      padding: '0px 0px'\n    },\n    divTableHeading: {\n      display: 'table-header-group'\n    },\n    divTableHeadingCenter: {\n      display: 'flex',\n      justifyContent: 'center'\n    },\n    divTableFoot: {\n      backgroundColor: '#DDD',\n      display: 'table-footer-group',\n      fontWeight: 'bold'\n    },\n    divTableBody: {\n      display: 'table-row-group'\n    }\n  };\n}; //const mui = createTheme({palette:teal_palette});\n\n\nfunction getTextWidth(txt, fontname, fontsize) {\n  if (getTextWidth.c === undefined) {\n    getTextWidth.c = document.createElement('canvas');\n    getTextWidth.ctx = getTextWidth.c.getContext('2d');\n  }\n\n  if (fontname !== undefined) {\n    getTextWidth.ctx.font = fontsize + ' ' + fontname;\n  }\n\n  return getTextWidth.ctx.measureText(txt).width;\n}\n\n;\n\nfunction getTextHeight(fontname, fontsize) {\n  if (getTextHeight.c === undefined) {\n    getTextHeight.c = document.createElement('canvas');\n    getTextHeight.ctx = getTextHeight.c.getContext('2d');\n  }\n\n  if (fontname !== undefined) {\n    getTextHeight.ctx.font = fontsize + ' ' + fontname;\n  }\n\n  return getTextHeight.ctx.measureText('M').width;\n}\n\nfunction maxWidth(values, border) {\n  var swidth = 0;\n  var mwidth = 0;\n  var lenv = values.length;\n\n  for (var ii = 0; ii < lenv; ii++) {\n    var cwidth = getTextWidth(values[ii]) + 2 * border;\n\n    if (cwidth > mwidth) {\n      mwidth = cwidth;\n    }\n\n    swidth = swidth + cwidth;\n  }\n\n  return {\n    max: mwidth,\n    sum: swidth\n  };\n} // ---------------- DATA\n\n\nfunction FirstDataCell(props) {\n  var classes = props.classes,\n      rowval = props.rowval,\n      onclick = props.onclick,\n      title = props.title,\n      plan = props.plan,\n      rowindex = props.rowindex;\n  var cursor = classes.divTableCell;\n\n  if (onclick !== undefined) {\n    cursor = classes.divTableCellCursor;\n  }\n\n  if (rowindex % 2 === 1) {\n    return React.createElement(\"div\", {\n      className: cursor,\n      onClick: onclick,\n      style: {\n        backgroundColor: '#DDD'\n      },\n      title: title,\n      width: plan.width,\n      height: plan.height,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111\n      },\n      __self: this\n    }, rowval);\n  } else {\n    return React.createElement(\"div\", {\n      className: cursor,\n      onClick: onclick,\n      style: {\n        backgroundColor: '#EEE'\n      },\n      title: title,\n      width: plan.width,\n      height: plan.height,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, rowval);\n  }\n}\n\nfunction DataCell(props) {\n  var classes = props.classes,\n      state = props.state,\n      elements = props.elements,\n      mode = props.mode,\n      plan = props.plan,\n      rowindex = props.rowindex,\n      other = _objectWithoutProperties(props, [\"classes\", \"state\", \"elements\", \"mode\", \"plan\", \"rowindex\"]);\n\n  if (elements === undefined) {\n    if (rowindex % 2 === 1) {\n      return React.createElement(\"div\", {\n        className: classes.divTableCell,\n        style: {\n          backgroundColor: '#EEE'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      });\n    } else {\n      return React.createElement(\"div\", {\n        className: classes.divTableCell,\n        style: {\n          backgroundColor: '#FFF'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      });\n    }\n  } else if (mode === state.Show.code.cell.Sum) {\n    return React.createElement(SummaryCell, Object.assign({}, other, {\n      state: state,\n      elements: elements,\n      plan: plan,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    })); //return null;\n  } else {\n    return React.createElement(SeriesCell, Object.assign({}, other, {\n      state: state,\n      elements: elements,\n      plan: plan,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    })); //return null;\n  }\n}\n\nfunction renderDataCell(classes, state, colkey, colvalues, rowkey, rowval, rowindex, rowwhere, range, mode, plan, val, index) {\n  var title = state.Database.getWhereDetail(colkey, colvalues[index]); //console.log(\"Making data cell:\",rowval,val,index,plan,JSON.stringify(colvalues));\n\n  if ((index - 1) % plan.step === 0) {\n    // get elements and range\n    //console.log(\"Processing:\",val,colvalues[index],plan.step);\n    var elements = state.Matrix.getMatrixElements(colvalues, rowval, state.React.matrix, index, plan.step); // get count and colwhere\n\n    var cnt = Math.min(colvalues.length, index + plan.step) - index;\n    var colwhere = state.Database.getColWhere(colkey, colvalues, index, plan.step); // make onclick and title\n\n    var onclick = function onclick() {\n      return state.Navigate.selectItem(state, colkey, rowkey, colvalues[index], rowval, colwhere, rowwhere, cnt, 1);\n    };\n\n    return React.createElement(DataCell, {\n      classes: classes,\n      state: state,\n      key: \"col-\".concat(index),\n      rowindex: rowindex,\n      index: index,\n      onclick: onclick,\n      title: title,\n      colkey: colkey,\n      rowkey: rowkey,\n      colvalues: colvalues,\n      colval: val,\n      rowval: rowval,\n      colwhere: colwhere,\n      rowwhere: rowwhere,\n      elements: elements,\n      mode: mode,\n      plan: plan,\n      range: range,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    });\n  } else {\n    return null;\n  }\n}\n\nfunction dataRow(classes, state, colkey, rowkey, colvalues, mode, plans, rowval, rowindex) {\n  var rowwhere = state.Database.getWhereDetail(rowkey, rowval);\n\n  var onclick = function onclick() {\n    return state.Navigate.selectKey(state, rowkey, rowval, rowwhere, 1);\n  };\n\n  var range = [undefined, undefined];\n\n  if (state.React.matrix !== undefined) {\n    range = state.Matrix.getRange(state, state.React.matrix, colvalues, [rowval]);\n  }\n\n  ; //console.log(\"Making data cols.\",rowval,colkey,JSON.stringify(colvalues));\n  //console.log(\"We have a matrix(\",rowval,\") with range:\",JSON.stringify(range));\n\n  var mapFunction = function mapFunction(val, index) {\n    return renderDataCell(classes, state, colkey, colvalues, rowkey, rowval, rowindex, rowwhere, range, mode, plan.cell, val, index);\n  };\n\n  return React.createElement(\"div\", {\n    className: classes.divTableRow,\n    key: rowindex.toString(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, React.createElement(FirstDataCell, {\n    classes: classes,\n    key: '0',\n    rowval: rowval,\n    onclick: onclick,\n    title: rowwhere,\n    plan: plans.row,\n    rowindex: rowindex,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }), colvalues.map(mapFunction));\n}\n\n;\n\nfunction renderZeroRow(classes, state, colkey, colvalues, plans) {\n  return React.createElement(\"div\", {\n    className: classes.divTableRow,\n    key: 1,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: classes.divTableCell,\n    width: plans.cell.width,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, \"No data available\"));\n}\n\n;\n\nfunction DataRows(props) {\n  var classes = props.classes,\n      state = props.state,\n      plans = props.plans,\n      colkey = props.colkey,\n      colvalues = props.colvalues,\n      rowkey = props.rowkey,\n      rowvalues = props.rowvalues,\n      mode = props.mode; //console.log(\"Making data cols.\",colkey,JSON.stringify(colvalues));\n\n  var mapFunction = function mapFunction(val, index) {\n    return dataRow(classes, state, colkey, rowkey, colvalues, mode, plans, val, index);\n  };\n\n  if (rowvalues.length === 0) {\n    return renderZeroRow(classes, state, colkey, colvalues, plans);\n  } else {\n    return rowvalues.map(mapFunction);\n  }\n} // ---------------- HDR\n\n\nfunction FirstHdrCell(props) {\n  var classes = props.classes,\n      state = props.state,\n      label = props.label,\n      plan = props.plan; // plan\n  //var width=plan.width;\n  //var height=plan.height;\n  //teal_palette\n\n  console.log(\"Making first header cell.\", label, plan.width, plan.height);\n  return React.createElement(\"div\", {\n    style: {\n      height: '100%',\n      backgroundColor: teal_palette.main\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192\n    },\n    __self: this\n  }, React.createElement(CanvasText, {\n    state: state,\n    label: label,\n    plan: plan,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }));\n} //\n\n\nfunction renderHdrCell(classes, state, colkey, colvalues, rowkey, plan, val, index) {\n  if ((index - 1) % plan.step === 0) {\n    //console.log(\"HdrCell:\",index,plan.step);\n    var cnt = Math.min(colvalues.length, index + plan.step) - index;\n    var colwhere = state.Database.getColWhere(colkey, colvalues, index, plan.step);\n\n    var onclick = function onclick() {\n      return state.Navigate.selectKey(state, colkey, colvalues[index], colwhere, cnt);\n    };\n\n    var title = colwhere;\n    var cursor = classes.divTableCell;\n\n    if (onclick !== undefined) {\n      cursor = classes.divTableCellCursor;\n    }\n\n    console.log(\"Plan:\", JSON.stringify(plan));\n    return React.createElement(\"div\", {\n      className: cursor,\n      onClick: onclick,\n      style: {\n        backgroundColor: '#DDD'\n      },\n      title: title,\n      key: \"col-\".concat(index),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }, React.createElement(CanvasText, {\n      state: state,\n      index: index,\n      plan: plan,\n      label: val,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }));\n  } else {\n    return null;\n  }\n}\n\nfunction HdrRow(props) {\n  var classes = props.classes,\n      state = props.state,\n      plans = props.plans,\n      colkey = props.colkey,\n      colvalues = props.colvalues,\n      rowkey = props.rowkey,\n      label = props.label; //, rowvalues\n  //console.log(\"Making header row.\",colkey,JSON.stringify(colvalues));\n\n  var mapFunction = function mapFunction(val, index) {\n    return renderHdrCell(classes, state, colkey, colvalues, rowkey, plan.col, val, index);\n  };\n\n  return React.createElement(\"div\", {\n    className: classes.divTableRow,\n    key: 0,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }, React.createElement(FirstHdrCell, {\n    classes: classes,\n    state: state,\n    label: label,\n    plan: plans.hdr,\n    style: {\n      height: \"100%\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222\n    },\n    __self: this\n  }), colvalues.map(mapFunction));\n} // ---------------- Details\n\n\nfunction Details(props) {\n  var classes = props.classes,\n      state = props.state; // classes, element\n\n  var colkey = state.Path.getColKey(state) || \"\";\n  var rowkey = state.Path.getRowKey(state) || \"\";\n  var colvalues = state.Path.filterKeys(state, state.Matrix.values[colkey] || [\"\"]);\n  var rowvalues = state.Path.filterKeys(state, state.Matrix.values[rowkey] || [\"\"]);\n  var cellMode = state.Show.getCellMode(state); //var ncol=colvalues.length + 1;\n  //var nrow=rowvalues.length + 1;\n  //DOM.style.font\n\n  var border = 2;\n  var label = rowkey + \"\\\\\" + colkey;\n  var width = 0.8 * window.innerWidth;\n  var height = 0.8 * (window.innerHeight - 200);\n  var plans = state.Layout.makePlans(label, colvalues, rowvalues, width, height, border); //console.log(\"Details => Width/Height:\",window.innerWidth,window.innerHeight,plan.cell.width,plan.hdr.height)\n  //console.log(\"Colkey:\",colkey,\" colval:\",JSON.stringify(colvalues));\n  //console.log(\"Rowkey:\",rowkey,\" rowval:\",JSON.stringify(rowvalues));\n\n  return React.createElement(\"div\", {\n    className: classes.divTable,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: classes.divTableBody,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247\n    },\n    __self: this\n  }, React.createElement(HdrRow, {\n    classes: classes,\n    state: state,\n    plans: plans,\n    colkey: colkey,\n    colvalues: colvalues,\n    rowkey: rowkey,\n    rowvalues: rowvalues,\n    label: label,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248\n    },\n    __self: this\n  }), React.createElement(DataRows, {\n    classes: classes,\n    state: state,\n    plans: plans,\n    colkey: colkey,\n    colvalues: colvalues,\n    rowkey: rowkey,\n    rowvalues: rowvalues,\n    mode: cellMode,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249\n    },\n    __self: this\n  })));\n}\n\nvar Table2D =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Table2D, _Component);\n\n  function Table2D() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Table2D);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Table2D)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _this.updateWindowDimensions = function () {\n      _this.width = window.innerWidth;\n      _this.height = window.innerHeight;\n      _this.bbx = _this.el.getBoundingClientRect(); //console.log(\"Width/Height:\",this.width,this.height,this.bbx.width,this.bbx.height)\n    };\n\n    return _this;\n  }\n\n  _createClass(Table2D, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.addEventListener(\"resize\", this.updateWindowDimensions);\n    }\n  }, {\n    key: \"element\",\n    value: function element(el) {\n      if (el !== undefined && el !== null) {\n        this.el = el;\n        this.bbx = this.el.getBoundingClientRect(); //console.log(\"BBX width/height:\",this.bbx.width,this.bbx.height);\n      }\n\n      ;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          state = _this$props.state; //console.log(\"##### Rendering Table2D.\");\n\n      return React.createElement(\"div\", {\n        ref: function ref(el) {\n          _this2.element(el);\n        },\n        className: classes.root,\n        style: {\n          width: '100%',\n          height: '100%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 273\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        container: true,\n        spacing: 24,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 274\n        },\n        __self: this\n      }, React.createElement(Grid, {\n        item: true,\n        xs: 12,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 275\n        },\n        __self: this\n      }, React.createElement(Paper, {\n        className: classes.paper,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 276\n        },\n        __self: this\n      }, React.createElement(Details, {\n        state: state,\n        classes: classes,\n        element: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      })))));\n    }\n  }]);\n\n  return Table2D;\n}(Component);\n\nTable2D.propTypes = {\n  classes: PropTypes.object.isRequired\n};\nexport default withStyles(styles)(Table2D);","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/react/Table2DComponent.js"],"names":["React","Component","PropTypes","withStyles","teal_palette","Paper","Grid","SummaryCell","SeriesCell","CanvasText","styles","theme","root","height","paper","overflow","tableLayout","padding","margin","divTable","display","width","divTableRow","divTableCell","border","divTableCellCursor","cursor","divTableHead","divTableHeading","divTableHeadingCenter","justifyContent","divTableFoot","backgroundColor","fontWeight","divTableBody","getTextWidth","txt","fontname","fontsize","c","undefined","document","createElement","ctx","getContext","font","measureText","getTextHeight","maxWidth","values","swidth","mwidth","lenv","length","ii","cwidth","max","sum","FirstDataCell","props","classes","rowval","onclick","title","plan","rowindex","DataCell","state","elements","mode","other","Show","code","cell","Sum","renderDataCell","colkey","colvalues","rowkey","rowwhere","range","val","index","Database","getWhereDetail","step","Matrix","getMatrixElements","matrix","cnt","Math","min","colwhere","getColWhere","Navigate","selectItem","dataRow","plans","selectKey","getRange","mapFunction","toString","row","map","renderZeroRow","DataRows","rowvalues","FirstHdrCell","label","console","log","main","renderHdrCell","JSON","stringify","HdrRow","col","hdr","Details","Path","getColKey","getRowKey","filterKeys","cellMode","getCellMode","window","innerWidth","innerHeight","Layout","makePlans","Table2D","updateWindowDimensions","bbx","el","getBoundingClientRect","addEventListener","element","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport {teal_palette} from '../mui/metMuiThemes';\n\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\n\nimport SummaryCell from './SummaryCell';\nimport SeriesCell  from './SeriesCell';\nimport CanvasText  from './CanvasTextComponent';\n\nconst styles = theme => ({\n    root: {\n\theight: '100%',\n    },\n    paper: {\n\toverflow: 'hidden',\n\ttableLayout: 'fixed',\n\tpadding:0,\n\tmargin:0,\n    },\n    divTable :{\n\tdisplay: 'table',\n\twidth: '100%',\n    },\n    divTableRow:  {\n\tdisplay: 'table-row',\n    },\n    divTableCell:{\n\tborder: '0px solid #999999',\n\tdisplay: 'table-cell',\n\tpadding: '0px 0px',\n    },\n    divTableCellCursor:{\n\tcursor: \"pointer\",\n\tborder: '0px solid #999999',\n\tdisplay: 'table-cell',\n\tpadding: '0px 0px',\n    },\n    divTableHead : {\n\tborder: '0px solid #999999',\n\tdisplay: 'table-cell',\n\tpadding: '0px 0px',\n    },\n    divTableHeading : {\n\tdisplay: 'table-header-group',\n    },\n    divTableHeadingCenter : {\n\tdisplay: 'flex',\n\tjustifyContent: 'center',\n    },\n    divTableFoot : {\n\tbackgroundColor: '#DDD',\n\tdisplay: 'table-footer-group',\n\tfontWeight: 'bold',\n    },\n    divTableBody : {\n\tdisplay: 'table-row-group',\n    }\n});\n\n//const mui = createTheme({palette:teal_palette});\n\nfunction getTextWidth(txt, fontname, fontsize){\n    if(getTextWidth.c === undefined){\n        getTextWidth.c=document.createElement('canvas');\n        getTextWidth.ctx=getTextWidth.c.getContext('2d');\n    }\n    if (fontname !== undefined) {\n\tgetTextWidth.ctx.font = fontsize + ' ' + fontname;\n    }\n    return getTextWidth.ctx.measureText(txt).width;\n};\nfunction getTextHeight(fontname, fontsize){\n    if(getTextHeight.c === undefined){\n        getTextHeight.c=document.createElement('canvas');\n        getTextHeight.ctx=getTextHeight.c.getContext('2d');\n    }\n    if (fontname !== undefined) {\n\tgetTextHeight.ctx.font = fontsize + ' ' + fontname;\n    }\n    return getTextHeight.ctx.measureText('M').width;\n}\nfunction maxWidth(values,border) {\n    var swidth=0;\n    var mwidth=0;\n    var lenv=values.length;\n    for (var ii=0;ii<lenv;ii++) {\n\tvar cwidth = getTextWidth(values[ii])+2*border;\n\tif (cwidth > mwidth) {\n\t    mwidth=cwidth;\n\t}\n\tswidth=swidth+cwidth;\n    }\n    return {max:mwidth,sum:swidth};\n}\n\n\n\n\n// ---------------- DATA\nfunction FirstDataCell (props) {\n    const { classes, rowval, onclick, title, plan, rowindex } = props;\n    var cursor=classes.divTableCell;\n    if (onclick !== undefined) {\n\tcursor=classes.divTableCellCursor;\n    }\n    if (rowindex%2 === 1) {\n\treturn (<div className={cursor} onClick={onclick} style={{backgroundColor:'#DDD'}}\n\t\ttitle={title} width={plan.width} height={plan.height}>{rowval}</div>);\n    } else {\n\treturn (<div className={cursor} onClick={onclick} style={{backgroundColor:'#EEE'}}\n\t\ttitle={title} width={plan.width} height={plan.height}>{rowval}</div>);\n    }\n}\nfunction DataCell(props) {\n    const {classes,state,elements,mode,plan,rowindex,...other}=props;\n    if (elements===undefined) {\n\tif (rowindex%2===1) {\n\t    return <div className={classes.divTableCell} style={{backgroundColor:'#EEE'}}/>\n\t} else {\n\t    return <div className={classes.divTableCell} style={{backgroundColor:'#FFF'}}/>\n\t}\n    } else if (mode===state.Show.code.cell.Sum) {\n\treturn <SummaryCell {...other} state={state} elements={elements} plan={plan}/>\n\t//return null;\n    } else {\n\treturn <SeriesCell {...other} state={state} elements={elements} plan={plan}/>\n\t//return null;\n    }\n}\nfunction renderDataCell(classes,state,colkey,colvalues,rowkey,rowval,rowindex,rowwhere,range,mode,plan,val,index) {\n    var title=state.Database.getWhereDetail(colkey,colvalues[index]);\n    //console.log(\"Making data cell:\",rowval,val,index,plan,JSON.stringify(colvalues));\n    if ((index-1)%plan.step === 0) {\n\t// get elements and range\n\t//console.log(\"Processing:\",val,colvalues[index],plan.step);\n\tvar elements=state.Matrix.getMatrixElements(colvalues,rowval,state.React.matrix,index,plan.step);\n\t// get count and colwhere\n        var cnt = Math.min(colvalues.length,index+plan.step)-index;\n        var colwhere = state.Database.getColWhere(colkey,colvalues,index,plan.step);\n\t// make onclick and title\n\tvar onclick=() => state.Navigate.selectItem(state,colkey,rowkey,colvalues[index],rowval,colwhere,rowwhere,cnt,1);\n\treturn (<DataCell classes={classes} state={state} key={`col-${index}`} rowindex={rowindex} index={index} onclick={onclick} title={title} \n\t\tcolkey={colkey} rowkey={rowkey} colvalues={colvalues} colval={val} rowval={rowval} colwhere={colwhere} rowwhere={rowwhere} \n\t\telements={elements} mode={mode} plan={plan} range={range}/>);\n    } else {\n\treturn null;\n    }\n}\nfunction dataRow(classes,state,colkey,rowkey,colvalues,mode,plans,rowval,rowindex) {\n    var rowwhere=state.Database.getWhereDetail(rowkey,rowval);\n    var onclick=() => state.Navigate.selectKey(state,rowkey,rowval,rowwhere,1);\n    var range=[undefined,undefined];\n    if (state.React.matrix!==undefined) {\n\trange=state.Matrix.getRange(state,state.React.matrix,colvalues,[rowval]);\n    };\n    //console.log(\"Making data cols.\",rowval,colkey,JSON.stringify(colvalues));\n    //console.log(\"We have a matrix(\",rowval,\") with range:\",JSON.stringify(range));\n    var mapFunction= (val,index)=>renderDataCell(classes,state,colkey,colvalues,rowkey,rowval,rowindex,rowwhere,range,mode,plan.cell,val,index);\n    return (<div className={classes.divTableRow} key={rowindex.toString()}>\n\t    <FirstDataCell classes={classes} key={'0'} rowval={rowval} onclick={onclick} \n\t                   title={rowwhere} plan={plans.row} rowindex={rowindex}/>\n\t       {colvalues.map(mapFunction)}\n\t    </div>);\n};\n\nfunction renderZeroRow(classes,state,colkey,colvalues,plans) {\n    return (<div className={classes.divTableRow} key={1}>\n\t       <div className={classes.divTableCell} width={plans.cell.width}>No data available</div>\n\t    </div>);\n};\nfunction DataRows(props) {\n    const { classes, state, plans, colkey, colvalues, rowkey, rowvalues, mode } = props;\n    //console.log(\"Making data cols.\",colkey,JSON.stringify(colvalues));\n    var mapFunction= (val,index)=>dataRow(classes,state,colkey,rowkey,colvalues,mode,plans,val,index);\n    if (rowvalues.length===0) {\n\treturn renderZeroRow(classes,state,colkey,colvalues,plans);\n    } else {\n\treturn (rowvalues.map(mapFunction));\n    }\n}\n// ---------------- HDR\nfunction FirstHdrCell (props) {\n    const { classes, state, label, plan } = props; // plan\n    //var width=plan.width;\n    //var height=plan.height;\n    //teal_palette\n    console.log(\"Making first header cell.\",label,plan.width,plan.height);\n    return (<div style={{height:'100%',backgroundColor:teal_palette.main}}>\n\t         <CanvasText state={state} label={label} plan={plan}/>\n\t    </div>);\n}\n//\n\nfunction renderHdrCell(classes,state,colkey,colvalues,rowkey,plan,val,index) {\n    if ((index-1)%plan.step === 0) {\n\t//console.log(\"HdrCell:\",index,plan.step);\n        var cnt = Math.min(colvalues.length,index+plan.step)-index;\n        var colwhere = state.Database.getColWhere(colkey,colvalues,index,plan.step);\n\tvar onclick=() => state.Navigate.selectKey(state,colkey,colvalues[index],colwhere,cnt);\n\tvar title=colwhere;\n\tvar cursor=classes.divTableCell;\n\tif (onclick !== undefined) {\n\t    cursor=classes.divTableCellCursor;\n\t}\n\tconsole.log(\"Plan:\",JSON.stringify(plan));\n\treturn (<div className={cursor} onClick={onclick} style={{backgroundColor:'#DDD'}} title={title} key={`col-${index}`} >\n\t\t   <CanvasText state={state} index={index} plan={plan} label={val}/>\n \t        </div> );\n     } else {\n\treturn null;\n    }\n}\nfunction HdrRow(props) {\n    const { classes, state, plans, colkey, colvalues, rowkey, label } = props; //, rowvalues\n    //console.log(\"Making header row.\",colkey,JSON.stringify(colvalues));\n    var mapFunction= (val,index)=>renderHdrCell(classes,state,colkey,colvalues,rowkey,plan.col,val,index);\n    return (<div className={classes.divTableRow} key={0}>\n\t       <FirstHdrCell classes={classes} state={state} label={label} plan={plans.hdr} style={{height:\"100%\"}}/>\n\t       {colvalues.map(mapFunction)}\n\t    </div>);\n}\n// ---------------- Details\nfunction Details(props) {\n    const { classes, state } = props; // classes, element\n    var colkey = state.Path.getColKey(state)||\"\";\n    var rowkey = state.Path.getRowKey(state)||\"\";\n    var colvalues = state.Path.filterKeys(state,state.Matrix.values[colkey]||[\"\"]);\n    var rowvalues = state.Path.filterKeys(state,state.Matrix.values[rowkey]||[\"\"]);\n    var cellMode  = state.Show.getCellMode(state);\n    //var ncol=colvalues.length + 1;\n    //var nrow=rowvalues.length + 1;\n    //DOM.style.font\n    var border=2;\n    var label=rowkey + \"\\\\\" + colkey;\n    var width=0.8*window.innerWidth;\n    var height=0.8*(window.innerHeight-200);\n    var plans=state.Layout.makePlans(label,colvalues,rowvalues,width,height,border);\n    //console.log(\"Details => Width/Height:\",window.innerWidth,window.innerHeight,plan.cell.width,plan.hdr.height)\n    //console.log(\"Colkey:\",colkey,\" colval:\",JSON.stringify(colvalues));\n    //console.log(\"Rowkey:\",rowkey,\" rowval:\",JSON.stringify(rowvalues));\n\n    return (<div className={classes.divTable}>\n\t       <div className={classes.divTableBody}>\n\t          <HdrRow classes={classes} state={state} plans={plans} colkey={colkey} colvalues={colvalues} rowkey={rowkey} rowvalues={rowvalues} label={label}/>\n\t          <DataRows classes={classes} state={state} plans={plans} colkey={colkey} colvalues={colvalues} rowkey={rowkey} rowvalues={rowvalues} mode={cellMode}/>\n\t       </div>\n            </div>);\n }\nclass Table2D extends Component {\n    componentDidMount() {\n        window.addEventListener(\"resize\", this.updateWindowDimensions);\n    } \n    updateWindowDimensions = () => {\n        this.width= window.innerWidth;\n\tthis.height=window.innerHeight;\n\tthis.bbx=this.el.getBoundingClientRect();\n\t//console.log(\"Width/Height:\",this.width,this.height,this.bbx.width,this.bbx.height)\n    };\n    element(el) {\n\tif (el !== undefined && el !== null) {\n\t    this.el=el;\n\t    this.bbx=this.el.getBoundingClientRect();\n\t    //console.log(\"BBX width/height:\",this.bbx.width,this.bbx.height);\n\t};\n    };\n    render() {\n\tconst { classes, state } = this.props;\n\t//console.log(\"##### Rendering Table2D.\");\n\treturn (<div ref={el=>{this.element(el)}} className={classes.root}  style={{width: '100%', height: '100%'}}>\n\t\t   <Grid container spacing={24}>\n\t\t      <Grid item xs={12} > \n                         { <Paper className={classes.paper}>\n\t\t              <Details state={state} classes={classes} element={this}/>\n                           </Paper>}\n                      </Grid>\n                   </Grid>\n\t        </div>);\n    }\n}\n\nTable2D.propTypes = {\n    classes: PropTypes.object.isRequired,\n};\n\nexport default withStyles(styles)(Table2D);\n"]},"metadata":{},"sourceType":"module"}