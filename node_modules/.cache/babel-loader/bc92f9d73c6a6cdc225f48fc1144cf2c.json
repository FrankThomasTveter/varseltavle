{"ast":null,"code":"//console.log(\"Loading Table1DLib.js\");\nfunction Table1D() {\n  this.Show = function (state, matrix, item, skeys, key, values, cellMode) {\n    var step = 1;\n\n    if (cellMode === state.Show.code.mSeries) {\n      step = Math.max(1, Math.ceil(state, values.length / 20));\n    } // make header row\n\n\n    var row = document.createElement(\"TR\");\n\n    if (cellMode === state.Show.code.mSum) {\n      this.appendSumHeaderRow1D(state, matrix, row, key, skeys);\n      item.appendChild(row); // make data rows\n\n      var rlen = values.length;\n\n      for (var ii = 0; ii < rlen; ii++) {\n        var element = state.Matrix.getMatrixElement(values[ii], \"\", matrix);\n\n        if (element === undefined || element.cnt === 0) {\n          state.Html.appendEmptyData(state, row); // add empty element\n        } else {\n          //console.log(\"Adding row:\",ii);\n          var docs = element.docs;\n          var dlen = docs.length;\n\n          for (var jj = 0; jj < dlen; jj++) {\n            var rel = jj === 0 ? \"first\" : (state, jj === dlen - 1 ? \"last\" : \"middle\");\n            var doc = docs[jj];\n            row = document.createElement(\"TR\");\n            this.appendSumDataRow1D(state, row, doc, skeys, key, values[ii], rel);\n            item.appendChild(row);\n          }\n\n          if (element.cnt > state.Matrix.limit) {\n            // some docs were omitted...\n            row = document.createElement(\"TR\");\n            state.Html.appendDataLine(state, row, \"Too much data...(state,\" + element.cnt + \")\", \"lightgray\", 100);\n            item.appendChild(row);\n            break;\n          }\n        }\n\n        ;\n      }\n    } else {\n      var dir = \"col\"; //console.log(\"Key=\",key,\" dir=\",dir);\n\n      state.Series1D.appendSeriesHeaderRow1D(state, matrix, row, key, values, step, dir);\n      item.appendChild(row); // make data row\n\n      row = document.createElement(\"TR\");\n      state.Series1D.appendSeriesDataRow1D(state, matrix, row, key, values, step, dir);\n      item.appendChild(row);\n    }\n  };\n\n  this.appendSumHeaderRow1D = function (state, m, row, rowkey, skeys) {\n    //console.log(\"addSingle Found keys\",JSON.stringify(setup),JSON.stringify(state.Matrix.keyCnt));\n    state.Html.appendRotateElement(state, row, rowkey, \"\"); // add rotation-element\n    // make header\n\n    var klen = skeys.length;\n\n    for (var jj = 0; jj < klen; jj++) {\n      var key = skeys[jj];\n      state.Html.appendHeaderElement(state, row, key);\n    }\n  };\n\n  this.appendSumDataRow1D = function (state, row, doc, skeys, rowkey, rowval, rel) {\n    var rowwhere = state.Database.getWhereDetail(rowkey, rowval || \"\");\n    var onclick = \"state.Layout.selectKey(state,'\" + rowkey + \"','\" + (rowval || \"\") + \"','\" + rowwhere + \"','1');\";\n    var title = \"select \" + (rowval || \"\");\n\n    if (rowkey === \"\") {\n      state.Html.appendEmptyHeader(state, row); // add empty element\n    } else {\n      row.appendChild(state.Html.makeHeaderElement(state, rowkey, // pkey\n      rowval || \"\", // pval\n      rel, // prel\n      \"row\", // ptyp\n      \"state.Layout.selectKey(state,'\" + rowkey + \"','\" + (rowval || \"\") + \"','\" + rowwhere + \"','1');\", rowwhere, \"\" // never rotate\n      ));\n    }\n\n    ;\n    var level = state.Threshold.getLevel(state, doc);\n    var color = state.Colors.getLevelColor(state, level);\n    var klen = skeys.length;\n\n    for (var jj = 0; jj < klen; jj++) {\n      state.Html.appendDataElement(state, row, doc[skeys[jj]], color, onclick, title);\n    }\n  };\n\n  this.appendSeriesHeaderRow1D = function (state, matrix, row, key, values, step, dir) {\n    var clen = values.length;\n\n    for (var ii = 0; ii < clen; ii = ii + step) {\n      //console.log(\"HDR Looping:\",ii,values[ii],clen,step);\n      var rotate = (state.Layout.rotate || {})[key] || \"\";\n      var val = values[ii];\n      var where = \"\";\n      var cnt = 0;\n\n      for (var kk = ii; kk < Math.min(clen, ii + step); kk++) {\n        if (where !== \"\") {\n          where = where + \" or \";\n        }\n\n        where = where + state.Database.getWhereDetail(key, values[kk]);\n        cnt = cnt + 1;\n        console.log(\"Where detail:\", key, where);\n      }\n\n      ; // make \"header\" column\n\n      row.appendChild(state.Html.makeHeaderElement(state, key, // pkey\n      val, // pval\n      \"\", // prel\n      dir, // ptyp\n      \"state.Layout.select\" + dir + \"(state,'\" + (val || \"\") + \"','\" + where + \"','\" + cnt + \"');\", where, rotate));\n    }\n  };\n\n  this.appendSeriesDataRow1D = function (state, matrix, row, key, values, step, dir) {\n    var range;\n\n    if (dir === \"Col\") {\n      range = state.Matrix.getRange(state, matrix, values, [\"\"]);\n    } else {\n      range = state.Matrix.getRange(state, matrix, [\"\"], values);\n    }\n\n    var clen = values.length;\n\n    for (var jj = 0; jj < clen; jj = jj + step) {\n      //console.log(\"DAT Looping:\",jj,values[jj],clen,step);\n      var where = \"\";\n      var elements = undefined;\n\n      for (var kk = jj; kk < Math.min(clen, jj + step); kk++) {\n        if (dir === \"Col\") {\n          var element = state.Matrix.getMatrixElement(values[kk], \"\", matrix);\n        } else {\n          var element = state.Matrix.getMatrixElement(\"\", values[kk], matrix);\n        }\n\n        if (element === undefined) {} else {\n          //console.log(\"Found:\",values[kk],\"\");\n          if (elements === undefined) {\n            elements = [];\n          }\n\n          ;\n          elements.push(element);\n        }\n\n        if (where !== \"\") {\n          where = where + \" or \";\n        }\n\n        where = where + state.Database.getWhereDetail(key, values[kk]);\n      } //console.log(\"Elements:\",values[jj],JSON.stringify(elements));\n\n\n      if (elements === undefined) {\n        state.Html.appendEmptyData(state, row); // add empty element\n\n        console.log(\"Empty element.\", jj, key, values[jj]);\n      } else {\n        //console.log(\"Calling makeCanvas.\",jj,key,values[jj]);\n        row.appendChild(state.Html.makeCanvasElement(state, elements, key, values.slice(state, jj, jj + step), range, \"state.Layout.selectItem(state,'\" + key + \"','','\" + values[jj] + \"','','\" + where + \"','','1','1');\", where, step));\n      }\n\n      ;\n    }\n  };\n}\n\n;\nexport default Table1D;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/Table1DLib.js"],"names":["Table1D","Show","state","matrix","item","skeys","key","values","cellMode","step","code","mSeries","Math","max","ceil","length","row","document","createElement","mSum","appendSumHeaderRow1D","appendChild","rlen","ii","element","Matrix","getMatrixElement","undefined","cnt","Html","appendEmptyData","docs","dlen","jj","rel","doc","appendSumDataRow1D","limit","appendDataLine","dir","Series1D","appendSeriesHeaderRow1D","appendSeriesDataRow1D","m","rowkey","appendRotateElement","klen","appendHeaderElement","rowval","rowwhere","Database","getWhereDetail","onclick","title","appendEmptyHeader","makeHeaderElement","level","Threshold","getLevel","color","Colors","getLevelColor","appendDataElement","clen","rotate","Layout","val","where","kk","min","console","log","range","getRange","elements","push","makeCanvasElement","slice"],"mappings":"AAAA;AAEA,SAASA,OAAT,GAAmB;AACf,OAAKC,IAAL,GAAU,UAASC,KAAT,EAAeC,MAAf,EAAsBC,IAAtB,EAA2BC,KAA3B,EAAiCC,GAAjC,EAAqCC,MAArC,EAA4CC,QAA5C,EAAqD;AAClE,QAAIC,IAAI,GAAC,CAAT;;AACA,QAAID,QAAQ,KAAKN,KAAK,CAACD,IAAN,CAAWS,IAAX,CAAgBC,OAAjC,EAA0C;AAACF,MAAAA,IAAI,GAACG,IAAI,CAACC,GAAL,CAAS,CAAT,EAAWD,IAAI,CAACE,IAAL,CAAUZ,KAAV,EAAgBK,MAAM,CAACQ,MAAP,GAAc,EAA9B,CAAX,CAAL;AAAoD,KAF7B,CAGlE;;;AACA,QAAIC,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAV;;AACA,QAAIV,QAAQ,KAAMN,KAAK,CAACD,IAAN,CAAWS,IAAX,CAAgBS,IAAlC,EAAwC;AACpC,WAAKC,oBAAL,CAA0BlB,KAA1B,EAAgCC,MAAhC,EAAuCa,GAAvC,EAA2CV,GAA3C,EAA+CD,KAA/C;AACAD,MAAAA,IAAI,CAACiB,WAAL,CAAiBL,GAAjB,EAFoC,CAGpC;;AACA,UAAIM,IAAI,GAACf,MAAM,CAACQ,MAAhB;;AACA,WAAI,IAAIQ,EAAE,GAAC,CAAX,EAAcA,EAAE,GAACD,IAAjB,EAAuBC,EAAE,EAAzB,EAA6B;AAChC,YAAIC,OAAO,GAACtB,KAAK,CAACuB,MAAN,CAAaC,gBAAb,CAA8BnB,MAAM,CAACgB,EAAD,CAApC,EAAyC,EAAzC,EAA4CpB,MAA5C,CAAZ;;AACA,YAAIqB,OAAO,KAAMG,SAAb,IAA0BH,OAAO,CAACI,GAAR,KAAiB,CAA/C,EAAkD;AAC9C1B,UAAAA,KAAK,CAAC2B,IAAN,CAAWC,eAAX,CAA2B5B,KAA3B,EAAiCc,GAAjC,EAD8C,CACR;AACzC,SAFD,MAEO;AACH;AACA,cAAIe,IAAI,GAACP,OAAO,CAACO,IAAjB;AACA,cAAIC,IAAI,GAACD,IAAI,CAAChB,MAAd;;AACA,eAAK,IAAIkB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGD,IAAtB,EAA4BC,EAAE,EAA9B,EAAkC;AACrC,gBAAIC,GAAG,GAAID,EAAE,KAAK,CAAP,GAAS,OAAT,IAAkB/B,KAAK,EAAC+B,EAAE,KAAKD,IAAI,GAAC,CAAZ,GAAc,MAAd,GAAqB,QAA7C,CAAX;AACI,gBAAIG,GAAG,GAACJ,IAAI,CAACE,EAAD,CAAZ;AACJjB,YAAAA,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAN;AACA,iBAAKkB,kBAAL,CAAwBlC,KAAxB,EAA8Bc,GAA9B,EAAkCmB,GAAlC,EAAsC9B,KAAtC,EAA4CC,GAA5C,EAAgDC,MAAM,CAACgB,EAAD,CAAtD,EAA2DW,GAA3D;AACA9B,YAAAA,IAAI,CAACiB,WAAL,CAAiBL,GAAjB;AACI;;AACD,cAAIQ,OAAO,CAACI,GAAR,GAAc1B,KAAK,CAACuB,MAAN,CAAaY,KAA/B,EAAsC;AAAE;AAC3CrB,YAAAA,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAN;AACAhB,YAAAA,KAAK,CAAC2B,IAAN,CAAWS,cAAX,CAA0BpC,KAA1B,EAAgCc,GAAhC,EAAoC,4BAA0BQ,OAAO,CAACI,GAAlC,GAAsC,GAA1E,EAA8E,WAA9E,EAA0F,GAA1F;AACAxB,YAAAA,IAAI,CAACiB,WAAL,CAAiBL,GAAjB;AACA;AACI;AACJ;;AAAA;AACG;AACJ,KA5BD,MA4BO;AACH,UAAIuB,GAAG,GAAC,KAAR,CADG,CAEH;;AACArC,MAAAA,KAAK,CAACsC,QAAN,CAAeC,uBAAf,CAAuCvC,KAAvC,EAA6CC,MAA7C,EAAoDa,GAApD,EAAwDV,GAAxD,EAA4DC,MAA5D,EAAmEE,IAAnE,EAAwE8B,GAAxE;AACAnC,MAAAA,IAAI,CAACiB,WAAL,CAAiBL,GAAjB,EAJG,CAKH;;AACAA,MAAAA,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,IAAvB,CAAN;AACAhB,MAAAA,KAAK,CAACsC,QAAN,CAAeE,qBAAf,CAAqCxC,KAArC,EAA2CC,MAA3C,EAAkDa,GAAlD,EAAsDV,GAAtD,EAA0DC,MAA1D,EAAiEE,IAAjE,EAAsE8B,GAAtE;AACAnC,MAAAA,IAAI,CAACiB,WAAL,CAAiBL,GAAjB;AACH;AACG,GA3CD;;AA6CA,OAAKI,oBAAL,GAA0B,UAASlB,KAAT,EAAeyC,CAAf,EAAiB3B,GAAjB,EAAqB4B,MAArB,EAA4BvC,KAA5B,EAAmC;AAChE;AACAH,IAAAA,KAAK,CAAC2B,IAAN,CAAWgB,mBAAX,CAA+B3C,KAA/B,EAAqCc,GAArC,EAAyC4B,MAAzC,EAAgD,EAAhD,EAFgE,CAEX;AACrD;;AACA,QAAIE,IAAI,GAACzC,KAAK,CAACU,MAAf;;AACA,SAAK,IAAIkB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGa,IAAtB,EAA4Bb,EAAE,EAA9B,EAAkC;AAC9B,UAAI3B,GAAG,GAACD,KAAK,CAAC4B,EAAD,CAAb;AACA/B,MAAAA,KAAK,CAAC2B,IAAN,CAAWkB,mBAAX,CAA+B7C,KAA/B,EAAqCc,GAArC,EAAyCV,GAAzC;AACH;AACG,GATD;;AAUA,OAAK8B,kBAAL,GAAwB,UAASlC,KAAT,EAAec,GAAf,EAAmBmB,GAAnB,EAAuB9B,KAAvB,EAA6BuC,MAA7B,EAAoCI,MAApC,EAA2Cd,GAA3C,EAAgD;AAC3E,QAAIe,QAAQ,GAAC/C,KAAK,CAACgD,QAAN,CAAeC,cAAf,CAA8BP,MAA9B,EAAsCI,MAAM,IAAE,EAA9C,CAAb;AACA,QAAII,OAAO,GAAC,mCAAiCR,MAAjC,GAAwC,KAAxC,IAA+CI,MAAM,IAAE,EAAvD,IAA2D,KAA3D,GAAiEC,QAAjE,GAA0E,SAAtF;AACA,QAAII,KAAK,GAAC,aAAWL,MAAM,IAAE,EAAnB,CAAV;;AACA,QAAIJ,MAAM,KAAK,EAAf,EAAmB;AACf1C,MAAAA,KAAK,CAAC2B,IAAN,CAAWyB,iBAAX,CAA6BpD,KAA7B,EAAmCc,GAAnC,EADe,CACyB;AAC3C,KAFD,MAEO;AACHA,MAAAA,GAAG,CAACK,WAAJ,CACHnB,KAAK,CAAC2B,IAAN,CAAW0B,iBAAX,CAA6BrD,KAA7B,EACI0C,MADJ,EACoB;AAChBI,MAAAA,MAAM,IAAE,EAFZ,EAEoB;AAChBd,MAAAA,GAHJ,EAGkB;AACd,WAJJ,EAIkB;AACd,yCAAiCU,MAAjC,GAAwC,KAAxC,IAA+CI,MAAM,IAAE,EAAvD,IAA2D,KAA3D,GAAiEC,QAAjE,GAA0E,SAL9E,EAMIA,QANJ,EAOI,EAPJ,CAOO;AAPP,OADG;AAUH;;AAAA;AACD,QAAIO,KAAK,GAACtD,KAAK,CAACuD,SAAN,CAAgBC,QAAhB,CAAyBxD,KAAzB,EAA+BiC,GAA/B,CAAV;AACA,QAAIwB,KAAK,GAACzD,KAAK,CAAC0D,MAAN,CAAaC,aAAb,CAA2B3D,KAA3B,EAAiCsD,KAAjC,CAAV;AACA,QAAIV,IAAI,GAACzC,KAAK,CAACU,MAAf;;AACA,SAAK,IAAIkB,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGa,IAAtB,EAA4Bb,EAAE,EAA9B,EAAkC;AAC9B/B,MAAAA,KAAK,CAAC2B,IAAN,CAAWiC,iBAAX,CAA6B5D,KAA7B,EAAmCc,GAAnC,EAAuCmB,GAAG,CAAC9B,KAAK,CAAC4B,EAAD,CAAN,CAA1C,EAAsD0B,KAAtD,EAA4DP,OAA5D,EAAoEC,KAApE;AACH;AACG,GAxBD;;AAyBA,OAAKZ,uBAAL,GAA6B,UAASvC,KAAT,EAAeC,MAAf,EAAsBa,GAAtB,EAA0BV,GAA1B,EAA8BC,MAA9B,EAAqCE,IAArC,EAA0C8B,GAA1C,EAA+C;AAC/E,QAAIwB,IAAI,GAACxD,MAAM,CAACQ,MAAhB;;AACA,SAAI,IAAIQ,EAAE,GAAC,CAAX,EAAcA,EAAE,GAACwC,IAAjB,EAAuBxC,EAAE,GAACA,EAAE,GAACd,IAA7B,EAAmC;AAC/B;AACA,UAAIuD,MAAM,GAAC,CAAC9D,KAAK,CAAC+D,MAAN,CAAaD,MAAb,IAAqB,EAAtB,EAA0B1D,GAA1B,KAAgC,EAA3C;AACA,UAAI4D,GAAG,GAAG3D,MAAM,CAACgB,EAAD,CAAhB;AACA,UAAI4C,KAAK,GAAG,EAAZ;AACA,UAAIvC,GAAG,GAAC,CAAR;;AACA,WAAK,IAAIwC,EAAE,GAAC7C,EAAZ,EAAe6C,EAAE,GAACxD,IAAI,CAACyD,GAAL,CAASN,IAAT,EAAcxC,EAAE,GAACd,IAAjB,CAAlB,EAAyC2D,EAAE,EAA3C,EAA+C;AAClD,YAAID,KAAK,KAAK,EAAd,EAAkB;AAACA,UAAAA,KAAK,GAACA,KAAK,GAAG,MAAd;AAAsB;;AACzCA,QAAAA,KAAK,GAACA,KAAK,GAAGjE,KAAK,CAACgD,QAAN,CAAeC,cAAf,CAA8B7C,GAA9B,EAAkCC,MAAM,CAAC6D,EAAD,CAAxC,CAAd;AACAxC,QAAAA,GAAG,GAACA,GAAG,GAAC,CAAR;AACA0C,QAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4BjE,GAA5B,EAAgC6D,KAAhC;AACI;;AAAA,OAX8B,CAY/B;;AACAnD,MAAAA,GAAG,CAACK,WAAJ,CACHnB,KAAK,CAAC2B,IAAN,CAAW0B,iBAAX,CAA6BrD,KAA7B,EACII,GADJ,EACiB;AACb4D,MAAAA,GAFJ,EAEiB;AACb,QAHJ,EAGiB;AACb3B,MAAAA,GAJJ,EAIiB;AACb,8BAAsBA,GAAtB,GAA0B,UAA1B,IAAsC2B,GAAG,IAAE,EAA3C,IAA+C,KAA/C,GAAqDC,KAArD,GAA2D,KAA3D,GAAiEvC,GAAjE,GAAqE,KALzE,EAMIuC,KANJ,EAOIH,MAPJ,CADG;AAWH;AACG,GA3BD;;AA4BA,OAAKtB,qBAAL,GAA2B,UAASxC,KAAT,EAAeC,MAAf,EAAsBa,GAAtB,EAA0BV,GAA1B,EAA8BC,MAA9B,EAAqCE,IAArC,EAA0C8B,GAA1C,EAA+C;AAC7E,QAAIiC,KAAJ;;AACA,QAAIjC,GAAG,KAAK,KAAZ,EAAmB;AACfiC,MAAAA,KAAK,GAACtE,KAAK,CAACuB,MAAN,CAAagD,QAAb,CAAsBvE,KAAtB,EAA4BC,MAA5B,EAAmCI,MAAnC,EAA0C,CAAC,EAAD,CAA1C,CAAN;AACH,KAFD,MAEO;AACHiE,MAAAA,KAAK,GAACtE,KAAK,CAACuB,MAAN,CAAagD,QAAb,CAAsBvE,KAAtB,EAA4BC,MAA5B,EAAmC,CAAC,EAAD,CAAnC,EAAwCI,MAAxC,CAAN;AACH;;AACD,QAAIwD,IAAI,GAACxD,MAAM,CAACQ,MAAhB;;AACA,SAAI,IAAIkB,EAAE,GAAC,CAAX,EAAcA,EAAE,GAAC8B,IAAjB,EAAuB9B,EAAE,GAACA,EAAE,GAACxB,IAA7B,EAAmC;AAC/B;AACA,UAAI0D,KAAK,GAAC,EAAV;AACA,UAAIO,QAAQ,GAAC/C,SAAb;;AACA,WAAK,IAAIyC,EAAE,GAACnC,EAAZ,EAAemC,EAAE,GAACxD,IAAI,CAACyD,GAAL,CAASN,IAAT,EAAc9B,EAAE,GAACxB,IAAjB,CAAlB,EAAyC2D,EAAE,EAA3C,EAA+C;AAClD,YAAI7B,GAAG,KAAK,KAAZ,EAAmB;AACf,cAAIf,OAAO,GAACtB,KAAK,CAACuB,MAAN,CAAaC,gBAAb,CAA8BnB,MAAM,CAAC6D,EAAD,CAApC,EAAyC,EAAzC,EAA4CjE,MAA5C,CAAZ;AACH,SAFD,MAEO;AACH,cAAIqB,OAAO,GAACtB,KAAK,CAACuB,MAAN,CAAaC,gBAAb,CAA8B,EAA9B,EAAiCnB,MAAM,CAAC6D,EAAD,CAAvC,EAA4CjE,MAA5C,CAAZ;AACH;;AACD,YAAIqB,OAAO,KAAMG,SAAjB,EAA4B,CAC3B,CADD,MACO;AACH;AACA,cAAI+C,QAAQ,KAAK/C,SAAjB,EAA4B;AAAC+C,YAAAA,QAAQ,GAAC,EAAT;AAAa;;AAAA;AAC1CA,UAAAA,QAAQ,CAACC,IAAT,CAAcnD,OAAd;AACH;;AACD,YAAI2C,KAAK,KAAK,EAAd,EAAkB;AAACA,UAAAA,KAAK,GAACA,KAAK,GAAG,MAAd;AAAsB;;AACzCA,QAAAA,KAAK,GAACA,KAAK,GAAGjE,KAAK,CAACgD,QAAN,CAAeC,cAAf,CAA8B7C,GAA9B,EAAkCC,MAAM,CAAC6D,EAAD,CAAxC,CAAd;AACI,OAlB8B,CAmB/B;;;AACA,UAAIM,QAAQ,KAAM/C,SAAlB,EAA6B;AAChCzB,QAAAA,KAAK,CAAC2B,IAAN,CAAWC,eAAX,CAA2B5B,KAA3B,EAAiCc,GAAjC,EADgC,CACM;;AACtCsD,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ,EAA6BtC,EAA7B,EAAgC3B,GAAhC,EAAoCC,MAAM,CAAC0B,EAAD,CAA1C;AACI,OAHD,MAGO;AACV;AACAjB,QAAAA,GAAG,CAACK,WAAJ,CACInB,KAAK,CAAC2B,IAAN,CAAW+C,iBAAX,CAA6B1E,KAA7B,EACHwE,QADG,EAEHpE,GAFG,EAGHC,MAAM,CAACsE,KAAP,CAAa3E,KAAb,EAAmB+B,EAAnB,EAAsBA,EAAE,GAACxB,IAAzB,CAHG,EAIH+D,KAJG,EAKH,oCAAkClE,GAAlC,GAAsC,QAAtC,GAA+CC,MAAM,CAAC0B,EAAD,CAArD,GAA0D,QAA1D,GAAmEkC,KAAnE,GAAyE,gBALtE,EAMHA,KANG,EAMG1D,IANH,CADJ;AASI;;AAAA;AACJ;AACG,GA5CD;AA6CH;;AAAA;AACD,eAAeT,OAAf","sourcesContent":["//console.log(\"Loading Table1DLib.js\");\n\nfunction Table1D() {\n    this.Show=function(state,matrix,item,skeys,key,values,cellMode){\n\tvar step=1\n\tif (cellMode === state.Show.code.mSeries) {step=Math.max(1,Math.ceil(state,values.length/20));}\n\t// make header row\n\tvar row = document.createElement(\"TR\");\n\tif (cellMode  === state.Show.code.mSum) {\n\t    this.appendSumHeaderRow1D(state,matrix,row,key,skeys);\n\t    item.appendChild(row);\n\t    // make data rows\n\t    var rlen=values.length;\n\t    for(var ii=0; ii<rlen; ii++) {\n\t\tvar element=state.Matrix.getMatrixElement(values[ii],\"\",matrix);\n\t\tif (element  === undefined || element.cnt  === 0) {\n\t\t    state.Html.appendEmptyData(state,row);// add empty element\n\t\t} else {\n\t\t    //console.log(\"Adding row:\",ii);\n\t\t    var docs=element.docs;\n\t\t    var dlen=docs.length;\n\t\t    for (var jj = 0; jj < dlen; jj++) {\n\t\t\tvar rel = (jj === 0?\"first\":(state,jj === dlen-1?\"last\":\"middle\"));\n    \t\t\tvar doc=docs[jj];\n\t\t\trow = document.createElement(\"TR\");\n\t\t\tthis.appendSumDataRow1D(state,row,doc,skeys,key,values[ii],rel);\n\t\t\titem.appendChild(row);\n\t\t    }\n\t\t    if (element.cnt > state.Matrix.limit) { // some docs were omitted...\n\t\t\trow = document.createElement(\"TR\");\n\t\t\tstate.Html.appendDataLine(state,row,\"Too much data...(state,\"+element.cnt+\")\",\"lightgray\",100);\n\t\t\titem.appendChild(row);\n\t\t\tbreak;\n\t\t    }\n\t\t};\n\t    }\n\t} else {\n\t    var dir=\"col\";\n\t    //console.log(\"Key=\",key,\" dir=\",dir);\n\t    state.Series1D.appendSeriesHeaderRow1D(state,matrix,row,key,values,step,dir);\n\t    item.appendChild(row);\n\t    // make data row\n\t    row = document.createElement(\"TR\");\n\t    state.Series1D.appendSeriesDataRow1D(state,matrix,row,key,values,step,dir);\n\t    item.appendChild(row);\n\t}\n    }\n    \n    this.appendSumHeaderRow1D=function(state,m,row,rowkey,skeys) {\n\t//console.log(\"addSingle Found keys\",JSON.stringify(setup),JSON.stringify(state.Matrix.keyCnt));\n\tstate.Html.appendRotateElement(state,row,rowkey,\"\"); // add rotation-element\n\t// make header\n\tvar klen=skeys.length;\n\tfor (var jj = 0; jj < klen; jj++) {\n\t    var key=skeys[jj];\n\t    state.Html.appendHeaderElement(state,row,key);\n\t}\n    };\n    this.appendSumDataRow1D=function(state,row,doc,skeys,rowkey,rowval,rel) {\n\tvar rowwhere=state.Database.getWhereDetail(rowkey,(rowval||\"\"));\n\tvar onclick=\"state.Layout.selectKey(state,'\"+rowkey+\"','\"+(rowval||\"\")+\"','\"+rowwhere+\"','1');\";\n\tvar title=\"select \"+(rowval||\"\");\n\tif (rowkey === \"\") {\n\t    state.Html.appendEmptyHeader(state,row);// add empty element\n\t} else {\n\t    row.appendChild(\n\t\tstate.Html.makeHeaderElement(state,\n\t\t    rowkey,         // pkey\n\t\t    rowval||\"\",     // pval\n\t\t    rel,          // prel\n\t\t    \"row\",        // ptyp\n\t\t    \"state.Layout.selectKey(state,'\"+rowkey+\"','\"+(rowval||\"\")+\"','\"+rowwhere+\"','1');\",\n\t\t    rowwhere,\n\t\t    \"\" // never rotate\n\t\t));\n\t};\n\tvar level=state.Threshold.getLevel(state,doc);\n\tvar color=state.Colors.getLevelColor(state,level);\n\tvar klen=skeys.length;\n\tfor (var jj = 0; jj < klen; jj++) {\n\t    state.Html.appendDataElement(state,row,doc[skeys[jj]],color,onclick,title);\n\t}\n    };\n    this.appendSeriesHeaderRow1D=function(state,matrix,row,key,values,step,dir) {\n\tvar clen=values.length;\n\tfor(var ii=0; ii<clen; ii=ii+step) {\n\t    //console.log(\"HDR Looping:\",ii,values[ii],clen,step);\n\t    var rotate=(state.Layout.rotate||{})[key]||\"\";\n\t    var val = values[ii];\n\t    var where = \"\";\n\t    var cnt=0;\n\t    for (var kk=ii;kk<Math.min(clen,ii+step);kk++) {\n\t\tif (where !== \"\") {where=where + \" or \";}\n\t\twhere=where + state.Database.getWhereDetail(key,values[kk]);\n\t\tcnt=cnt+1;\n\t\tconsole.log(\"Where detail:\",key,where)\n\t    };\n\t    // make \"header\" column\n\t    row.appendChild(\n\t\tstate.Html.makeHeaderElement(state,\n\t\t    key,         // pkey\n\t\t    val,         // pval\n\t\t    \"\",          // prel\n\t\t    dir,         // ptyp\n\t\t    \"state.Layout.select\"+dir+\"(state,'\"+(val||\"\")+\"','\"+where+\"','\"+cnt+\"');\",\n\t\t    where,\n\t\t    rotate\n\t\t)\n\t    );\n\t}\n    };\n    this.appendSeriesDataRow1D=function(state,matrix,row,key,values,step,dir) {\n\tvar range;\n\tif (dir === \"Col\") {\n\t    range=state.Matrix.getRange(state,matrix,values,[\"\"]);\n\t} else {\n\t    range=state.Matrix.getRange(state,matrix,[\"\"],values);\n\t}\n\tvar clen=values.length;\n\tfor(var jj=0; jj<clen; jj=jj+step) {\n\t    //console.log(\"DAT Looping:\",jj,values[jj],clen,step);\n\t    var where=\"\";\n\t    var elements=undefined\n\t    for (var kk=jj;kk<Math.min(clen,jj+step);kk++) {\n\t\tif (dir === \"Col\") {\n\t\t    var element=state.Matrix.getMatrixElement(values[kk],\"\",matrix);\n\t\t} else {\n\t\t    var element=state.Matrix.getMatrixElement(\"\",values[kk],matrix);\n\t\t}\n\t\tif (element  === undefined) {\n\t\t} else {\n\t\t    //console.log(\"Found:\",values[kk],\"\");\n\t\t    if (elements === undefined) {elements=[];};\n\t\t    elements.push(element);\n\t\t}\n\t\tif (where !== \"\") {where=where + \" or \";}\n\t\twhere=where + state.Database.getWhereDetail(key,values[kk]);\n\t    }\n\t    //console.log(\"Elements:\",values[jj],JSON.stringify(elements));\n\t    if (elements  === undefined) {\n\t\tstate.Html.appendEmptyData(state,row);// add empty element\n\t\tconsole.log(\"Empty element.\",jj,key,values[jj]);\n\t    } else {\n\t\t//console.log(\"Calling makeCanvas.\",jj,key,values[jj]);\n\t\trow.appendChild(\n\t\t    state.Html.makeCanvasElement(state,\n\t\t\telements,\n\t\t\tkey,\n\t\t\tvalues.slice(state,jj,jj+step),\n\t\t\trange,\n\t\t\t\"state.Layout.selectItem(state,'\"+key+\"','','\"+values[jj]+\"','','\"+where+\"','','1','1');\",\n\t\t\twhere,step)\n\t\t);\n\t    };\n\t}\n    }\n};\nexport default Table1D;\n"]},"metadata":{},"sourceType":"module"}