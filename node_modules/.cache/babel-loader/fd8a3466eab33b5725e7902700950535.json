{"ast":null,"code":"//console.log(\"Loading LayoutLib.js\");\nfunction Layout() {\n  this.rotate = undefined; // should labels on x-axis be rotated?\n\n  this.priority = undefined; // which key should be on the abscissa\n\n  this.init = function (state) {\n    state.Utils.init(\"Layout\", this);\n  };\n\n  this.fullscreen = false;\n  this.fonts = [\"12px Fixed\", \"18px Fixed\", \"24px Fixed\", \"36px Fixed\", \"48px Fixed\"]; //\n\n  this.state = {\n    viewMode: 0,\n    // should we show trash contents?\n    cellMode: 0,\n    // sum, series, item\n    layoutMode: 0,\n    // table, list, map\n    cfont: 0,\n    tooltip: 1\n  };\n  this.modes = {\n    view: {\n      nopath: 0,\n      path: 1\n    },\n    cell: {\n      Sum: 0,\n      Series: 1\n    },\n    layout: {\n      Table: 0,\n      List: 1,\n      Map: 2\n    }\n  };\n\n  this.toggleTooltip = function (state) {\n    this.state.tooltip = (this.state.tooltip + 1) % 3; //console.log(\"Tooltip:\",this.state.tooltip);\n\n    state.Utils.pushUrl(state);\n    state.Show.show(state, true);\n  };\n\n  this.changeFont = function (state) {\n    this.state.cfont = (this.state.cfont + 1) % this.fonts.length;\n    state.Utils.pushUrl(state);\n    state.Show.show(state, false);\n  };\n\n  this.toggleView = function (state) {\n    //console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\n    if (this.state.viewMode === this.modes.view.nopath) {\n      this.state.viewMode = this.modes.view.path;\n    } else if (this.state.viewMode === this.modes.view.path) {\n      this.state.viewMode = this.modes.view.nopath;\n    }\n\n    ; //console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\n\n    state.Show.showPath(state);\n    state.Show.showConfig(state);\n  };\n\n  this.toggleMode = function (state, layoutMode, cellMode) {\n    console.log(\"Mode:\", layoutMode, cellMode); //var reload=(layoutMode !== state.Layout.state.layoutMode);\n\n    var reload = state.Layout.state.layoutMode === state.Layout.modes.layout.Map && layoutMode !== state.Layout.modes.layout.Map || state.Layout.state.layoutMode !== state.Layout.modes.layout.Map && layoutMode === state.Layout.modes.layout.Map;\n    state.Layout.state.layoutMode = layoutMode;\n    state.Layout.state.cellMode = cellMode; //state.Show.showConfig(state);\n\n    state.Show.showAll(state, reload);\n  };\n\n  this.getDim = function (state) {\n    //console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\n    var colkey = state.Path.getColKey(state);\n    var rowkey = state.Path.getRowKey(state);\n\n    if (colkey !== undefined && rowkey !== undefined) {\n      return 2;\n    } else if (colkey !== undefined || rowkey !== undefined) {\n      return 1;\n    } else {\n      return 0;\n    }\n  };\n\n  this.setLayoutMode = function (state, mode) {\n    var om = this.state.layoutMode;\n    var o = this.getLayoutMode(state);\n    this.state.layoutMode = mode;\n    var n = this.getLayoutMode(state); //console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\n\n    if (o !== n) {\n      state.Show.showAll(state);\n    } else if (om !== mode) {\n      state.Show.showMode(state);\n    }\n  };\n\n  this.setCellMode = function (state, mode) {\n    var om = this.state.cellMode;\n    var o = this.getCellMode(state);\n    this.state.cellMode = mode;\n    var n = this.getCellMode(state); //console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\n\n    if (o !== n) {\n      state.Show.showAll(state);\n    } else if (om !== mode) {\n      state.Show.showMode(state);\n    }\n  };\n\n  this.getLayoutMode = function (state) {\n    //console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\n    var mode = this.state.layoutMode;\n\n    if (mode === this.modes.layout.List && state.Matrix.cnt > state.Matrix.popSeries) {\n      mode = this.modes.layout.Table;\n    } else if (mode === this.modes.layout.Map && state.Matrix.cnt > state.Matrix.popSeries) {\n      mode = this.modes.layout.Table;\n    }\n\n    return mode;\n  };\n\n  this.getCellMode = function (state) {\n    var mode = this.state.cellMode;\n\n    if (mode === this.modes.cell.Single && state.Matrix.cnt > state.Matrix.popSingle) {\n      mode = this.modes.cell.Series;\n    }\n\n    if (mode === this.modes.cell.Series && state.Matrix.cnt > state.Matrix.popSeries) {\n      mode = this.modes.cell.Sum;\n    }\n\n    return mode;\n  };\n\n  this.toggleFullScreen = function (state) {\n    //var pos=0;\n    if (!document.fullscreenElement && // alternative standard method\n    !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {\n      // current working methods\n      if (document.documentElement.requestFullscreen) {\n        document.documentElement.requestFullscreen(); //pos=1;\n      } else if (document.documentElement.msRequestFullscreen) {\n        document.documentElement.msRequestFullscreen(); //pos=2;\n      } else if (document.documentElement.mozRequestFullScreen) {\n        document.documentElement.mozRequestFullScreen(); //pos=3;\n      } else if (document.webkitRequestFullscreen) {\n        document.webkitRequestFullscreen(); //pos=4;\n      } else {//pos=5;\n        }\n\n      this.fullscreen = true;\n    } else {\n      if (document.exitFullscreen) {\n        document.exitFullscreen(); //pos=6;\n      } else if (document.msExitFullscreen) {\n        document.msExitFullscreen(); //pos=7;\n      } else if (document.mozCancelFullScreen) {\n        document.mozCancelFullScreen(); //pos=8;\n      } else if (document.webkitExitFullscreen) {\n        document.webkitExitFullscreen(); //pos=9;\n      } else {//pos=10;\n        }\n\n      this.fullscreen = false;\n    }\n\n    state.Show.showConfig(state);\n    console.log(\"Toggle fullscreen:\", this.fullscreen);\n  }; // adjust keys so that rows/cols have more than on entry...\n\n\n  this.getPriorityKeys = function (state) {\n    if (state.Layout.priority === undefined) {\n      state.Layout.priority = state.Database.keyCnt.keys();\n    } else {\n      var keys = Object.keys(state.Database.keyCnt);\n      ;\n      var plen = keys;\n\n      for (var ii = 0; ii < plen; ii++) {\n        var key = keys[ii];\n\n        if (state.Layout.priority.indexOf(key) === -1) {\n          state.Layout.priority.push(key);\n        }\n      }\n\n      ;\n    }\n\n    ;\n    return state.Layout.priority; //state.Utils.invertedArray()\n  };\n\n  this.increaseSelect = function (state, key) {\n    var kid = state.Path.keys.path.indexOf(key);\n    console.log(\"Bumping:\", key, kid, JSON.stringify(state.Path.keys.path));\n\n    if (kid !== -1 && kid > 0) {\n      var src = state.Path.keys.path.splice(kid, 1); // remove from array   \n\n      state.Utils.spliceArray(state.Path.keys.path, kid - 1, 0, src);\n    }\n\n    state.Show.showConfig(state);\n    state.Show.showPath(state);\n  };\n\n  this.increasePriority = function (state, key) {\n    var kid = state.Layout.priority.indexOf(key);\n    console.log(\"Bumping:\", key, kid, JSON.stringify(state.Layout.priority));\n\n    if (kid !== -1 && kid > 0) {\n      var src = state.Layout.priority.splice(kid, 1); // remove from array   \n\n      state.Utils.spliceArray(state.Layout.priority, kid - 1, 0, src);\n    }\n\n    state.Show.showConfig(state);\n  };\n\n  this.getPriorityIndex = function (state, arr) {\n    var len, ii;\n    var pri = {};\n    len = arr.length;\n\n    for (ii = 0; ii < len; ii++) {\n      pri[arr[ii]] = 0;\n    }\n\n    ;\n\n    if (this.priority !== undefined) {\n      len = this.priority.length;\n\n      for (ii = 0; ii < len; ii++) {\n        var key = this.priority[ii];\n        pri[key] = len + 1 - ii;\n      }\n\n      ;\n    }\n\n    ;\n    return pri;\n  };\n\n  this.changePriority = function (state, key, trg) {\n    // key -> trg\n    if (key === undefined || trg === undefined) {\n      return;\n    }\n\n    console.log(\"Priority:\", key, \"->\", trg, JSON.stringify(this.priority)); //if (typeof trg  === \"undefined\") {\n\n    var col = state.Path.other.table[0];\n    var row = state.Path.other.table[1]; //var icol=0;\n    //var irow=0;\n\n    var ikey = 0;\n    var itrg = 0;\n    var len = this.priority.length;\n\n    for (var ii = 0; ii < len; ii++) {\n      if (this.priority[ii] === col) {//icol=len+1-ii;\n      }\n\n      ;\n\n      if (this.priority[ii] === row) {//irow=len+1-ii;\n      }\n\n      ;\n\n      if (this.priority[ii] === key) {\n        ikey = len + 1 - ii;\n      }\n\n      if (this.priority[ii] === trg) {\n        itrg = len + 1 - ii;\n      }\n    }\n\n    if (itrg < ikey) {\n      // demote existing key\n      if (itrg > 0) {\n        // key exists on priority list\n        state.Utils.spliceArray(this.priority, len + 2 - itrg, 0, key); // add after\n\n        console.log(\"Added:\", JSON.stringify(this.priority), ikey, itrg, key); //var src=\n\n        this.priority.splice(len + 1 - ikey, 1); // remove\n      } else {\n        // key exists, target does not\n        //var src=\n        this.priority.splice(len + 1 - ikey, 1); // remove\n\n        this.priority.concat(key);\n      }\n    } else if (itrg > ikey) {\n      // demote, key may not exist on priority list\n      if (ikey > 0) {\n        // key exists on priority list\n        //var src=\n        this.priority.splice(len + 1 - ikey, 1); // remove\n\n        state.Utils.spliceArray(this.priority, len + 1 - itrg, 0, key); // add before\n      } else {\n        // key is not on priority list\n        state.Utils.spliceArray(this.priority, len + 1 - itrg, 0, key); // add before\n      }\n    } else if (itrg === 0) {\n      // key and target not on the priority list\n      this.priority.concat(key);\n    }\n\n    console.log(\"Changed priority:\", JSON.stringify(this.priority), ikey, itrg);\n    return true;\n  }; //this.flipTable=function(state) {\n  //    var bb=this.colrow[0];\n  //    this.colrow[0]=this.colrow[1];\n  //    this.colrow[1]=bb;\n  //    //console.log(\"Setup:\",JSON.stringify(setup));\n  //};\n\n\n  this.getPriority = function (state) {\n    return state.Utils.cp(this.priority);\n  };\n\n  this.setPriority = function (state, priority) {\n    this.priority = priority;\n  };\n\n  this.getDescription = function (state, element, skeys) {\n    if (element.cnt === 1) {\n      var s = \"\";\n      var docs = element.docs;\n      var doc = docs[0];\n      var klen = skeys.length;\n\n      for (var jj = 0; jj < klen; jj++) {\n        var d = skeys[jj] + \"=\" + doc[skeys[jj]];\n        ;\n\n        if (s !== \"\") {\n          s = s + \" \" + d;\n        } else {\n          s = d;\n        }\n      }\n\n      return s;\n    } else {\n      return element.cnt;\n    }\n  };\n\n  this.setPlan = function (plan, set) {\n    var keys = Object.keys(set);\n    var lenk = keys.length;\n\n    for (var ii = 0; ii < lenk; ii++) {\n      var key = keys[ii];\n      var val = set[key];\n      plan[key] = val;\n    }\n\n    ;\n  };\n\n  this.getTextWidth = function (txt, fontname, fontsize) {\n    if (this.getTextWidth.c === undefined) {\n      this.getTextWidth.c = document.createElement('canvas');\n      this.getTextWidth.ctx = this.getTextWidth.c.getContext('2d');\n    }\n\n    if (fontname !== undefined) {\n      this.getTextWidth.ctx.font = fontsize + ' ' + fontname;\n    } else {\n      this.getTextWidth.ctx.font = this.fonts[this.state.cfont];\n    }\n\n    return this.getTextWidth.ctx.measureText(txt).width;\n  };\n\n  this.getTextHeight = function (fontname, fontsize) {\n    if (this.getTextHeight.c === undefined) {\n      this.getTextHeight.c = document.createElement('canvas');\n      this.getTextHeight.ctx = this.getTextHeight.c.getContext('2d');\n    }\n\n    if (fontname !== undefined) {\n      this.getTextHeight.ctx.font = fontsize + ' ' + fontname;\n    } else {\n      this.getTextHeight.ctx.font = this.fonts[this.state.cfont];\n    }\n\n    return this.getTextHeight.ctx.measureText('M').width;\n  };\n\n  this.getDescender = function (fontname, fontsize) {\n    return this.getTextHeight(fontname, fontsize) * 0.3;\n  };\n\n  this.maxWidth = function (values, border) {\n    var swidth = 0;\n    var mwidth = 0;\n    var lenv = values.length;\n\n    for (var ii = 0; ii < lenv; ii++) {\n      var cwidth = this.getTextWidth(values[ii]) + 2 * border;\n\n      if (cwidth > mwidth) {\n        mwidth = cwidth;\n      }\n\n      swidth = swidth + cwidth;\n    }\n\n    return {\n      max: mwidth,\n      sum: swidth\n    };\n  };\n\n  this.makeDocTitle = function (state, doc) {\n    var title = \"\";\n    var len = state.Path.tooltip.keys.length;\n\n    for (var ii = 0; ii < len; ii++) {\n      var key = state.Path.tooltip.keys[ii];\n\n      if (doc[key] !== undefined) {\n        if (title !== \"\") {\n          title = title + \", \";\n        }\n\n        ;\n        title = title + key + \"=\" + doc[key];\n      }\n\n      ;\n    }\n\n    return title;\n  };\n\n  this.makeCntTitle = function (state, docs) {\n    var title = \"\";\n\n    if (this.state.title === 1) {\n      var dlen = docs.length;\n\n      for (var ii = 0; ii < dlen; ii++) {\n        var doc = docs[ii];\n\n        if (doc._title !== undefined) {\n          if (title !== \"\") {\n            title = title + \"|\";\n          }\n\n          ;\n          title = title + doc._title;\n        }\n      }\n    }\n\n    return title;\n  };\n\n  this.makePlans = function (colkey, rowkey, colvalues, rowvalues, iwidth, iheight, border) {\n    var descender = this.getDescender();\n    border = border + descender + 1;\n    var plans = {\n      cell: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      },\n      hdr: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      },\n      hd1: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      },\n      hd2: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      },\n      row: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      },\n      col: {\n        rotate: false,\n        step: 1,\n        border: border,\n        width: 100,\n        height: 100,\n        xoffset: 0,\n        yoffset: 0,\n        font: this.fonts[this.state.cfont]\n      }\n    };\n\n    if (iwidth <= 0) {\n      return plans;\n    }\n\n    ; // text boundaries\n\n    var wh = this.maxWidth(rowvalues, border);\n    var ww = this.maxWidth(colvalues, border);\n    var zwidth1 = colkey === \"\" ? 0 : this.getTextWidth(colkey) + 2 * border; //props.theme.spacing.unit;\n\n    var zwidth2 = rowkey === \"\" ? 0 : this.getTextWidth(rowkey) + 2 * border; //props.theme.spacing.unit;\n    // var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n    // table boundaries\n\n    var mheight = this.getTextHeight() + 2 * (descender + 1); //props.theme.spacing.unit;\n\n    var hwidth = Math.max(wh.max, zwidth1 + zwidth2) + mheight;\n    var width = iwidth - hwidth; // calculate cell width...\n\n    var mwidth = ww.max; //var swidth=ww.sum;\n\n    var lenc = colvalues.length;\n    var lenr = rowvalues.length;\n    var hh, hw, ch, cw, hx, rot, stp; //console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\n\n    if (mwidth * lenc < width) {\n      // horisontal\n      rot = false;\n      stp = 1;\n      cw = width / lenc;\n      hh = mheight;\n      hx = (cw - mwidth) / 2; //console.log(\"Plan (normal):\",JSON.stringify(plans));\n    } else if (mheight * lenc < width) {\n      // rotate\n      rot = true;\n      stp = 1;\n      cw = width / lenc;\n      hh = mwidth;\n      hx = (cw - mheight) / 2; //console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cw*lenc);\n    } else {\n      // rotate and use steps\n      rot = true;\n      stp = Math.ceil(lenc * mheight / width);\n      cw = stp * width / lenc;\n      hh = mwidth;\n      hx = (cw - mheight) / 2; //console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cw,hh,hx);\n    } // calculate cell height\n\n\n    var height = iheight - hh;\n\n    if (mheight * lenr < height) {\n      // \n      ch = Math.min(mheight * 10, height / lenr) - border;\n    } else {\n      ch = mheight - border;\n    }\n\n    hw = hwidth; //console.log(\"Cells:\",hh,ch,height,lenr,mheight);\n\n    var dw = (hw - zwidth1 - zwidth2) / 2;\n    this.setPlan(plans.cell, {\n      width: cw,\n      height: ch,\n      step: stp,\n      font: this.fonts[this.state.cfont]\n    });\n    this.setPlan(plans.hdr, {\n      width: hw,\n      height: hh,\n      font: this.fonts[this.state.cfont]\n    });\n    this.setPlan(plans.hd1, {\n      width: zwidth1 + dw,\n      height: hh,\n      align: \"right\",\n      font: this.fonts[this.state.cfont]\n    });\n    this.setPlan(plans.hd2, {\n      width: zwidth2 + dw,\n      height: hh,\n      font: this.fonts[this.state.cfont]\n    });\n    this.setPlan(plans.col, {\n      width: cw,\n      height: hh,\n      xoffset: hx,\n      step: stp,\n      rotate: rot,\n      font: this.fonts[this.state.cfont]\n    });\n    this.setPlan(plans.row, {\n      width: hw,\n      height: ch,\n      font: this.fonts[this.state.cfont]\n    }); //console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n\n    return plans;\n  };\n}\n\n;\nexport default Layout;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/LayoutLib.js"],"names":["Layout","rotate","undefined","priority","init","state","Utils","fullscreen","fonts","viewMode","cellMode","layoutMode","cfont","tooltip","modes","view","nopath","path","cell","Sum","Series","layout","Table","List","Map","toggleTooltip","pushUrl","Show","show","changeFont","length","toggleView","showPath","showConfig","toggleMode","console","log","reload","showAll","getDim","colkey","Path","getColKey","rowkey","getRowKey","setLayoutMode","mode","om","o","getLayoutMode","n","showMode","setCellMode","getCellMode","Matrix","cnt","popSeries","Single","popSingle","toggleFullScreen","document","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","documentElement","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","getPriorityKeys","Database","keyCnt","keys","Object","plen","ii","key","indexOf","push","increaseSelect","kid","JSON","stringify","src","splice","spliceArray","increasePriority","getPriorityIndex","arr","len","pri","changePriority","trg","col","other","table","row","ikey","itrg","concat","getPriority","cp","setPriority","getDescription","element","skeys","s","docs","doc","klen","jj","d","setPlan","plan","set","lenk","val","getTextWidth","txt","fontname","fontsize","c","createElement","ctx","getContext","font","measureText","width","getTextHeight","getDescender","maxWidth","values","border","swidth","mwidth","lenv","cwidth","max","sum","makeDocTitle","title","makeCntTitle","dlen","_title","makePlans","colvalues","rowvalues","iwidth","iheight","descender","plans","step","height","xoffset","yoffset","hdr","hd1","hd2","wh","ww","zwidth1","zwidth2","mheight","hwidth","Math","lenc","lenr","hh","hw","ch","cw","hx","rot","stp","ceil","min","dw","align"],"mappings":"AAAA;AAEA,SAASA,MAAT,GAAkB;AACd,OAAKC,MAAL,GAAYC,SAAZ,CADc,CACU;;AACxB,OAAKC,QAAL,GAAcD,SAAd,CAFc,CAEU;;AACxB,OAAKE,IAAL,GAAU,UAASC,KAAT,EAAe;AAC5BA,IAAAA,KAAK,CAACC,KAAN,CAAYF,IAAZ,CAAiB,QAAjB,EAA0B,IAA1B;AACI,GAFD;;AAGA,OAAKG,UAAL,GAAgB,KAAhB;AACA,OAAKC,KAAL,GAAW,CAAC,YAAD,EAAc,YAAd,EAA2B,YAA3B,EAAwC,YAAxC,EAAqD,YAArD,CAAX,CAPc,CASd;;AACA,OAAKH,KAAL,GAAW;AAACI,IAAAA,QAAQ,EAAC,CAAV;AAAmB;AAChCC,IAAAA,QAAQ,EAAC,CADI;AACK;AAClBC,IAAAA,UAAU,EAAC,CAFE;AAEK;AAClBC,IAAAA,KAAK,EAAC,CAHO;AAIbC,IAAAA,OAAO,EAAC;AAJK,GAAX;AAMA,OAAKC,KAAL,GAAW;AAACC,IAAAA,IAAI,EAAC;AAACC,MAAAA,MAAM,EAAC,CAAR;AACbC,MAAAA,IAAI,EAAC;AADQ,KAAN;AAGbC,IAAAA,IAAI,EAAC;AAACC,MAAAA,GAAG,EAAC,CAAL;AACCC,MAAAA,MAAM,EAAC;AADR,KAHQ;AAMbC,IAAAA,MAAM,EAAC;AAACC,MAAAA,KAAK,EAAC,CAAP;AACNC,MAAAA,IAAI,EAAC,CADC;AAENC,MAAAA,GAAG,EAAC;AAFE;AANM,GAAX;;AAWA,OAAKC,aAAL,GAAmB,UAASpB,KAAT,EAAgB;AACtC,SAAKA,KAAL,CAAWQ,OAAX,GAAmB,CAAC,KAAKR,KAAL,CAAWQ,OAAX,GAAmB,CAApB,IAAuB,CAA1C,CADsC,CAEtC;;AACAR,IAAAA,KAAK,CAACC,KAAN,CAAYoB,OAAZ,CAAoBrB,KAApB;AACAA,IAAAA,KAAK,CAACsB,IAAN,CAAWC,IAAX,CAAgBvB,KAAhB,EAAsB,IAAtB;AACI,GALD;;AAMA,OAAKwB,UAAL,GAAgB,UAASxB,KAAT,EAAgB;AACnC,SAAKA,KAAL,CAAWO,KAAX,GAAkB,CAAC,KAAKP,KAAL,CAAWO,KAAX,GAAkB,CAAnB,IAAwB,KAAKJ,KAAL,CAAWsB,MAArD;AACAzB,IAAAA,KAAK,CAACC,KAAN,CAAYoB,OAAZ,CAAoBrB,KAApB;AACAA,IAAAA,KAAK,CAACsB,IAAN,CAAWC,IAAX,CAAgBvB,KAAhB,EAAsB,KAAtB;AACI,GAJD;;AAKA,OAAK0B,UAAL,GAAgB,UAAS1B,KAAT,EAAgB;AACnC;AACA,QAAI,KAAKA,KAAL,CAAWI,QAAX,KAAwB,KAAKK,KAAL,CAAWC,IAAX,CAAgBC,MAA5C,EAAoD;AAChD,WAAKX,KAAL,CAAWI,QAAX,GAAoB,KAAKK,KAAL,CAAWC,IAAX,CAAgBE,IAApC;AACH,KAFD,MAEO,IAAI,KAAKZ,KAAL,CAAWI,QAAX,KAAwB,KAAKK,KAAL,CAAWC,IAAX,CAAgBE,IAA5C,EAAkD;AACrD,WAAKZ,KAAL,CAAWI,QAAX,GAAoB,KAAKK,KAAL,CAAWC,IAAX,CAAgBC,MAApC;AACH;;AAAA,KANkC,CAOnC;;AACAX,IAAAA,KAAK,CAACsB,IAAN,CAAWK,QAAX,CAAoB3B,KAApB;AACAA,IAAAA,KAAK,CAACsB,IAAN,CAAWM,UAAX,CAAsB5B,KAAtB;AACI,GAVD;;AAWA,OAAK6B,UAAL,GAAgB,UAAS7B,KAAT,EAAeM,UAAf,EAA0BD,QAA1B,EAAoC;AACvDyB,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBzB,UAApB,EAA+BD,QAA/B,EADuD,CAEvD;;AACA,QAAI2B,MAAM,GAAGhC,KAAK,CAACL,MAAN,CAAaK,KAAb,CAAmBM,UAAnB,KAAgCN,KAAK,CAACL,MAAN,CAAac,KAAb,CAAmBO,MAAnB,CAA0BG,GAA1D,IACRb,UAAU,KAAGN,KAAK,CAACL,MAAN,CAAac,KAAb,CAAmBO,MAAnB,CAA0BG,GADhC,IAENnB,KAAK,CAACL,MAAN,CAAaK,KAAb,CAAmBM,UAAnB,KAAgCN,KAAK,CAACL,MAAN,CAAac,KAAb,CAAmBO,MAAnB,CAA0BG,GAA1D,IACDb,UAAU,KAAGN,KAAK,CAACL,MAAN,CAAac,KAAb,CAAmBO,MAAnB,CAA0BG,GAH5C;AAIAnB,IAAAA,KAAK,CAACL,MAAN,CAAaK,KAAb,CAAmBM,UAAnB,GAA8BA,UAA9B;AACAN,IAAAA,KAAK,CAACL,MAAN,CAAaK,KAAb,CAAmBK,QAAnB,GAA4BA,QAA5B,CARuD,CASvD;;AACAL,IAAAA,KAAK,CAACsB,IAAN,CAAWW,OAAX,CAAmBjC,KAAnB,EAAyBgC,MAAzB;AACI,GAXD;;AAYA,OAAKE,MAAL,GAAY,UAASlC,KAAT,EAAgB;AAC/B;AACO,QAAImC,MAAM,GAACnC,KAAK,CAACoC,IAAN,CAAWC,SAAX,CAAqBrC,KAArB,CAAX;AACA,QAAIsC,MAAM,GAACtC,KAAK,CAACoC,IAAN,CAAWG,SAAX,CAAqBvC,KAArB,CAAX;;AACP,QAAImC,MAAM,KAAKtC,SAAX,IAAwByC,MAAM,KAAKzC,SAAvC,EAAkD;AAC9C,aAAO,CAAP;AACH,KAFD,MAEO,IAAIsC,MAAM,KAAKtC,SAAX,IAAwByC,MAAM,KAAKzC,SAAvC,EAAkD;AACrD,aAAO,CAAP;AACH,KAFM,MAEA;AACH,aAAO,CAAP;AACH;AACG,GAXD;;AAYA,OAAK2C,aAAL,GAAmB,UAASxC,KAAT,EAAeyC,IAAf,EAAqB;AAC3C,QAAIC,EAAE,GAAC,KAAK1C,KAAL,CAAWM,UAAlB;AACA,QAAIqC,CAAC,GAAC,KAAKC,aAAL,CAAmB5C,KAAnB,CAAN;AACA,SAAKA,KAAL,CAAWM,UAAX,GAAsBmC,IAAtB;AACA,QAAII,CAAC,GAAC,KAAKD,aAAL,CAAmB5C,KAAnB,CAAN,CAJ2C,CAK3C;;AACA,QAAI2C,CAAC,KAAKE,CAAV,EAAa;AACT7C,MAAAA,KAAK,CAACsB,IAAN,CAAWW,OAAX,CAAmBjC,KAAnB;AACH,KAFD,MAEO,IAAI0C,EAAE,KAAKD,IAAX,EAAiB;AACpBzC,MAAAA,KAAK,CAACsB,IAAN,CAAWwB,QAAX,CAAoB9C,KAApB;AACH;AACG,GAXD;;AAYA,OAAK+C,WAAL,GAAiB,UAAS/C,KAAT,EAAeyC,IAAf,EAAqB;AACzC,QAAIC,EAAE,GAAC,KAAK1C,KAAL,CAAWK,QAAlB;AACA,QAAIsC,CAAC,GAAC,KAAKK,WAAL,CAAiBhD,KAAjB,CAAN;AACA,SAAKA,KAAL,CAAWK,QAAX,GAAoBoC,IAApB;AACA,QAAII,CAAC,GAAC,KAAKG,WAAL,CAAiBhD,KAAjB,CAAN,CAJyC,CAKzC;;AACA,QAAI2C,CAAC,KAAKE,CAAV,EAAa;AACT7C,MAAAA,KAAK,CAACsB,IAAN,CAAWW,OAAX,CAAmBjC,KAAnB;AACH,KAFD,MAEO,IAAI0C,EAAE,KAAKD,IAAX,EAAiB;AACpBzC,MAAAA,KAAK,CAACsB,IAAN,CAAWwB,QAAX,CAAoB9C,KAApB;AACH;AACG,GAXD;;AAYA,OAAK4C,aAAL,GAAmB,UAAS5C,KAAT,EAAgB;AACtC;AACA,QAAIyC,IAAI,GAAC,KAAKzC,KAAL,CAAWM,UAApB;;AACA,QAAImC,IAAI,KAAM,KAAKhC,KAAL,CAAWO,MAAX,CAAkBE,IAA5B,IAAoClB,KAAK,CAACiD,MAAN,CAAaC,GAAb,GAAmBlD,KAAK,CAACiD,MAAN,CAAaE,SAAxE,EAAmF;AAC/EV,MAAAA,IAAI,GAAC,KAAKhC,KAAL,CAAWO,MAAX,CAAkBC,KAAvB;AACH,KAFD,MAEO,IAAIwB,IAAI,KAAM,KAAKhC,KAAL,CAAWO,MAAX,CAAkBG,GAA5B,IAAmCnB,KAAK,CAACiD,MAAN,CAAaC,GAAb,GAAmBlD,KAAK,CAACiD,MAAN,CAAaE,SAAvE,EAAkF;AACrFV,MAAAA,IAAI,GAAC,KAAKhC,KAAL,CAAWO,MAAX,CAAkBC,KAAvB;AACH;;AACD,WAAOwB,IAAP;AACI,GATD;;AAUA,OAAKO,WAAL,GAAiB,UAAShD,KAAT,EAAgB;AACpC,QAAIyC,IAAI,GAAC,KAAKzC,KAAL,CAAWK,QAApB;;AACA,QAAIoC,IAAI,KAAM,KAAKhC,KAAL,CAAWI,IAAX,CAAgBuC,MAA1B,IAAoCpD,KAAK,CAACiD,MAAN,CAAaC,GAAb,GAAmBlD,KAAK,CAACiD,MAAN,CAAaI,SAAxE,EAAmF;AAC/EZ,MAAAA,IAAI,GAAC,KAAKhC,KAAL,CAAWI,IAAX,CAAgBE,MAArB;AACH;;AACD,QAAI0B,IAAI,KAAM,KAAKhC,KAAL,CAAWI,IAAX,CAAgBE,MAA1B,IAAoCf,KAAK,CAACiD,MAAN,CAAaC,GAAb,GAAmBlD,KAAK,CAACiD,MAAN,CAAaE,SAAxE,EAAmF;AAC/EV,MAAAA,IAAI,GAAC,KAAKhC,KAAL,CAAWI,IAAX,CAAgBC,GAArB;AACH;;AACD,WAAO2B,IAAP;AACI,GATD;;AAUA,OAAKa,gBAAL,GAAsB,UAAStD,KAAT,EAAgB;AACzC;AACA,QAAI,CAACuD,QAAQ,CAACC,iBAAV,IAAkC;AAClC,KAACD,QAAQ,CAACE,oBADV,IAEA,CAACF,QAAQ,CAACG,uBAFV,IAGA,CAACH,QAAQ,CAACI,mBAHd,EAGoC;AAAG;AACnC,UAAIJ,QAAQ,CAACK,eAAT,CAAyBC,iBAA7B,EAAgD;AACnDN,QAAAA,QAAQ,CAACK,eAAT,CAAyBC,iBAAzB,GADmD,CAEnD;AACI,OAHD,MAGO,IAAIN,QAAQ,CAACK,eAAT,CAAyBE,mBAA7B,EAAkD;AAC5DP,QAAAA,QAAQ,CAACK,eAAT,CAAyBE,mBAAzB,GAD4D,CAE5D;AACI,OAHM,MAGA,IAAIP,QAAQ,CAACK,eAAT,CAAyBG,oBAA7B,EAAmD;AAC7DR,QAAAA,QAAQ,CAACK,eAAT,CAAyBG,oBAAzB,GAD6D,CAE7D;AACI,OAHM,MAGA,IAAIR,QAAQ,CAACS,uBAAb,EAAsC;AAChDT,QAAAA,QAAQ,CAACS,uBAAT,GADgD,CAEhD;AACI,OAHM,MAGA,CACV;AACI;;AACD,WAAK9D,UAAL,GAAgB,IAAhB;AACH,KApBD,MAoBO;AACH,UAAIqD,QAAQ,CAACU,cAAb,EAA6B;AAChCV,QAAAA,QAAQ,CAACU,cAAT,GADgC,CAEhC;AACI,OAHD,MAGO,IAAIV,QAAQ,CAACW,gBAAb,EAA+B;AACzCX,QAAAA,QAAQ,CAACW,gBAAT,GADyC,CAEzC;AACI,OAHM,MAGA,IAAIX,QAAQ,CAACY,mBAAb,EAAkC;AAC5CZ,QAAAA,QAAQ,CAACY,mBAAT,GAD4C,CAE5C;AACI,OAHM,MAGA,IAAIZ,QAAQ,CAACa,oBAAb,EAAmC;AAC7Cb,QAAAA,QAAQ,CAACa,oBAAT,GAD6C,CAE7C;AACI,OAHM,MAGA,CACV;AACI;;AACD,WAAKlE,UAAL,GAAgB,KAAhB;AACH;;AACDF,IAAAA,KAAK,CAACsB,IAAN,CAAWM,UAAX,CAAsB5B,KAAtB;AACA8B,IAAAA,OAAO,CAACC,GAAR,CAAY,oBAAZ,EAAiC,KAAK7B,UAAtC;AACI,GA1CD,CArHc,CAgKd;;;AACA,OAAKmE,eAAL,GAAqB,UAASrE,KAAT,EAAe;AAChC,QAAIA,KAAK,CAACL,MAAN,CAAaG,QAAb,KAA0BD,SAA9B,EAAyC;AACrCG,MAAAA,KAAK,CAACL,MAAN,CAAaG,QAAb,GAAsBE,KAAK,CAACsE,QAAN,CAAeC,MAAf,CAAsBC,IAAtB,EAAtB;AACH,KAFD,MAEO;AACV,UAAIA,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYxE,KAAK,CAACsE,QAAN,CAAeC,MAA3B,CAAX;AAA8C;AAC9C,UAAIG,IAAI,GAAGF,IAAX;;AACA,WAAK,IAAIG,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGD,IAAtB,EAA4BC,EAAE,EAA9B,EAAkC;AACrC,YAAIC,GAAG,GAACJ,IAAI,CAACG,EAAD,CAAZ;;AACA,YAAI3E,KAAK,CAACL,MAAN,CAAaG,QAAb,CAAsB+E,OAAtB,CAA8BD,GAA9B,MAAqC,CAAC,CAA1C,EAA6C;AACzC5E,UAAAA,KAAK,CAACL,MAAN,CAAaG,QAAb,CAAsBgF,IAAtB,CAA2BF,GAA3B;AACH;AACG;;AAAA;AACJ;;AAAA;AACD,WAAO5E,KAAK,CAACL,MAAN,CAAaG,QAApB,CAbuC,CAaT;AAC1B,GAdD;;AAeA,OAAKiF,cAAL,GAAoB,UAAS/E,KAAT,EAAe4E,GAAf,EAAmB;AAC1C,QAAII,GAAG,GAAChF,KAAK,CAACoC,IAAN,CAAWoC,IAAX,CAAgB5D,IAAhB,CAAqBiE,OAArB,CAA6BD,GAA7B,CAAR;AACA9C,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuB6C,GAAvB,EAA2BI,GAA3B,EAA+BC,IAAI,CAACC,SAAL,CAAelF,KAAK,CAACoC,IAAN,CAAWoC,IAAX,CAAgB5D,IAA/B,CAA/B;;AACA,QAAIoE,GAAG,KAAK,CAAC,CAAT,IAAcA,GAAG,GAAG,CAAxB,EAA2B;AACvB,UAAIG,GAAG,GAACnF,KAAK,CAACoC,IAAN,CAAWoC,IAAX,CAAgB5D,IAAhB,CAAqBwE,MAArB,CAA4BJ,GAA5B,EAAiC,CAAjC,CAAR,CADuB,CACsB;;AAC7ChF,MAAAA,KAAK,CAACC,KAAN,CAAYoF,WAAZ,CAAwBrF,KAAK,CAACoC,IAAN,CAAWoC,IAAX,CAAgB5D,IAAxC,EAA6CoE,GAAG,GAAC,CAAjD,EAAmD,CAAnD,EAAqDG,GAArD;AACH;;AACDnF,IAAAA,KAAK,CAACsB,IAAN,CAAWM,UAAX,CAAsB5B,KAAtB;AACAA,IAAAA,KAAK,CAACsB,IAAN,CAAWK,QAAX,CAAoB3B,KAApB;AACI,GATD;;AAUA,OAAKsF,gBAAL,GAAsB,UAAStF,KAAT,EAAe4E,GAAf,EAAmB;AAC5C,QAAII,GAAG,GAAChF,KAAK,CAACL,MAAN,CAAaG,QAAb,CAAsB+E,OAAtB,CAA8BD,GAA9B,CAAR;AACA9C,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuB6C,GAAvB,EAA2BI,GAA3B,EAA+BC,IAAI,CAACC,SAAL,CAAelF,KAAK,CAACL,MAAN,CAAaG,QAA5B,CAA/B;;AACA,QAAIkF,GAAG,KAAK,CAAC,CAAT,IAAcA,GAAG,GAAG,CAAxB,EAA2B;AACvB,UAAIG,GAAG,GAACnF,KAAK,CAACL,MAAN,CAAaG,QAAb,CAAsBsF,MAAtB,CAA6BJ,GAA7B,EAAkC,CAAlC,CAAR,CADuB,CACuB;;AAC9ChF,MAAAA,KAAK,CAACC,KAAN,CAAYoF,WAAZ,CAAwBrF,KAAK,CAACL,MAAN,CAAaG,QAArC,EAA8CkF,GAAG,GAAC,CAAlD,EAAoD,CAApD,EAAsDG,GAAtD;AACH;;AACDnF,IAAAA,KAAK,CAACsB,IAAN,CAAWM,UAAX,CAAsB5B,KAAtB;AACI,GARD;;AASA,OAAKuF,gBAAL,GAAsB,UAASvF,KAAT,EAAewF,GAAf,EAAoB;AAC7C,QAAIC,GAAJ,EAAQd,EAAR;AACA,QAAIe,GAAG,GAAC,EAAR;AACAD,IAAAA,GAAG,GAACD,GAAG,CAAC/D,MAAR;;AACA,SAAKkD,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACc,GAAb,EAAiBd,EAAE,EAAnB,EAAuB;AACnBe,MAAAA,GAAG,CAACF,GAAG,CAACb,EAAD,CAAJ,CAAH,GAAa,CAAb;AACH;;AAAA;;AACD,QAAI,KAAK7E,QAAL,KAAkBD,SAAtB,EAAiC;AAC7B4F,MAAAA,GAAG,GAAC,KAAK3F,QAAL,CAAc2B,MAAlB;;AACA,WAAKkD,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACc,GAAb,EAAiBd,EAAE,EAAnB,EAAuB;AAC1B,YAAIC,GAAG,GAAC,KAAK9E,QAAL,CAAc6E,EAAd,CAAR;AACAe,QAAAA,GAAG,CAACd,GAAD,CAAH,GAASa,GAAG,GAAC,CAAJ,GAAMd,EAAf;AACI;;AAAA;AACJ;;AAAA;AACD,WAAOe,GAAP;AACI,GAfD;;AAgBA,OAAKC,cAAL,GAAoB,UAAS3F,KAAT,EAAe4E,GAAf,EAAmBgB,GAAnB,EAAwB;AAAG;AAClD,QAAIhB,GAAG,KAAM/E,SAAT,IAAsB+F,GAAG,KAAM/F,SAAnC,EAA8C;AAAE;AAAQ;;AACxDiC,IAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAwB6C,GAAxB,EAA4B,IAA5B,EAAiCgB,GAAjC,EAAqCX,IAAI,CAACC,SAAL,CAAe,KAAKpF,QAApB,CAArC,EAF+C,CAG/C;;AACA,QAAI+F,GAAG,GAAC7F,KAAK,CAACoC,IAAN,CAAW0D,KAAX,CAAiBC,KAAjB,CAAuB,CAAvB,CAAR;AACA,QAAIC,GAAG,GAAChG,KAAK,CAACoC,IAAN,CAAW0D,KAAX,CAAiBC,KAAjB,CAAuB,CAAvB,CAAR,CAL+C,CAM/C;AACA;;AACA,QAAIE,IAAI,GAAC,CAAT;AACA,QAAIC,IAAI,GAAC,CAAT;AACA,QAAIT,GAAG,GAAC,KAAK3F,QAAL,CAAc2B,MAAtB;;AACA,SAAK,IAAIkD,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACc,GAAjB,EAAqBd,EAAE,EAAvB,EAA2B;AACvB,UAAI,KAAK7E,QAAL,CAAc6E,EAAd,MAAuBkB,GAA3B,EAAgC,CACnC;AACI;;AAAA;;AACD,UAAK,KAAK/F,QAAL,CAAc6E,EAAd,MAAuBqB,GAA5B,EAAiC,CACpC;AACI;;AAAA;;AACD,UAAK,KAAKlG,QAAL,CAAc6E,EAAd,MAAuBC,GAA5B,EAAiC;AACpCqB,QAAAA,IAAI,GAACR,GAAG,GAAC,CAAJ,GAAMd,EAAX;AACI;;AACD,UAAK,KAAK7E,QAAL,CAAc6E,EAAd,MAAuBiB,GAA5B,EAAiC;AACpCM,QAAAA,IAAI,GAACT,GAAG,GAAC,CAAJ,GAAMd,EAAX;AACI;AACJ;;AACD,QAAIuB,IAAI,GAAGD,IAAX,EAAiB;AAAS;AACtB,UAAIC,IAAI,GAAG,CAAX,EAAc;AAAQ;AACzBlG,QAAAA,KAAK,CAACC,KAAN,CAAYoF,WAAZ,CAAwB,KAAKvF,QAA7B,EAAsC2F,GAAG,GAAC,CAAJ,GAAMS,IAA5C,EAAiD,CAAjD,EAAmDtB,GAAnD,EADiB,CACyC;;AAE1D9C,QAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAqBkD,IAAI,CAACC,SAAL,CAAe,KAAKpF,QAApB,CAArB,EAAmDmG,IAAnD,EAAwDC,IAAxD,EAA6DtB,GAA7D,EAHiB,CAKjB;;AACA,aAAK9E,QAAL,CAAcsF,MAAd,CAAqBK,GAAG,GAAC,CAAJ,GAAMQ,IAA3B,EAAiC,CAAjC,EANiB,CAM2B;AACxC,OAPD,MAOO;AAAe;AACzB;AACA,aAAKnG,QAAL,CAAcsF,MAAd,CAAqBK,GAAG,GAAC,CAAJ,GAAMQ,IAA3B,EAAiC,CAAjC,EAFU,CAEkC;;AAC5C,aAAKnG,QAAL,CAAcqG,MAAd,CAAqBvB,GAArB;AACI;AACJ,KAbD,MAaO,IAAIsB,IAAI,GAAGD,IAAX,EAAiB;AAAE;AACtB,UAAIA,IAAI,GAAC,CAAT,EAAY;AAAU;AACzB;AACA,aAAKnG,QAAL,CAAcsF,MAAd,CAAqBK,GAAG,GAAC,CAAJ,GAAMQ,IAA3B,EAAiC,CAAjC,EAFe,CAE6B;;AAC5CjG,QAAAA,KAAK,CAACC,KAAN,CAAYoF,WAAZ,CAAwB,KAAKvF,QAA7B,EAAsC2F,GAAG,GAAC,CAAJ,GAAMS,IAA5C,EAAiD,CAAjD,EAAmDtB,GAAnD,EAHe,CAG2C;AACtD,OAJD,MAIO;AAAe;AACzB5E,QAAAA,KAAK,CAACC,KAAN,CAAYoF,WAAZ,CAAwB,KAAKvF,QAA7B,EAAsC2F,GAAG,GAAC,CAAJ,GAAMS,IAA5C,EAAiD,CAAjD,EAAmDtB,GAAnD,EADU,CACgD;AACtD;AACJ,KARM,MAQA,IAAIsB,IAAI,KAAK,CAAb,EAAgB;AAAE;AACrB,WAAKpG,QAAL,CAAcqG,MAAd,CAAqBvB,GAArB;AACH;;AACD9C,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgCkD,IAAI,CAACC,SAAL,CAAe,KAAKpF,QAApB,CAAhC,EAA8DmG,IAA9D,EAAmEC,IAAnE;AACA,WAAO,IAAP;AACI,GAnDD,CAnNc,CAuQd;AACA;AACA;AACA;AACA;AACA;;;AACA,OAAKE,WAAL,GAAiB,UAASpG,KAAT,EAAgB;AACpC,WAAOA,KAAK,CAACC,KAAN,CAAYoG,EAAZ,CAAe,KAAKvG,QAApB,CAAP;AACI,GAFD;;AAGA,OAAKwG,WAAL,GAAiB,UAAStG,KAAT,EAAeF,QAAf,EAAyB;AAC7C,SAAKA,QAAL,GAAcA,QAAd;AACI,GAFD;;AAGA,OAAKyG,cAAL,GAAoB,UAASvG,KAAT,EAAewG,OAAf,EAAuBC,KAAvB,EAA8B;AACrD,QAAID,OAAO,CAACtD,GAAR,KAAiB,CAArB,EAAwB;AACpB,UAAIwD,CAAC,GAAC,EAAN;AACA,UAAIC,IAAI,GAACH,OAAO,CAACG,IAAjB;AACA,UAAIC,GAAG,GAACD,IAAI,CAAC,CAAD,CAAZ;AACA,UAAIE,IAAI,GAACJ,KAAK,CAAChF,MAAf;;AACA,WAAK,IAAIqF,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGD,IAAtB,EAA4BC,EAAE,EAA9B,EAAkC;AACrC,YAAIC,CAAC,GAACN,KAAK,CAACK,EAAD,CAAL,GAAU,GAAV,GAAcF,GAAG,CAACH,KAAK,CAACK,EAAD,CAAN,CAAvB;AAAmC;;AACnC,YAAIJ,CAAC,KAAK,EAAV,EAAc;AACVA,UAAAA,CAAC,GAACA,CAAC,GAAC,GAAF,GAAMK,CAAR;AACH,SAFD,MAEO;AACHL,UAAAA,CAAC,GAACK,CAAF;AACH;AACG;;AACD,aAAOL,CAAP;AACH,KAdD,MAcO;AACH,aAAOF,OAAO,CAACtD,GAAf;AACH;AACG,GAlBD;;AAmBA,OAAK8D,OAAL,GAAa,UAASC,IAAT,EAAcC,GAAd,EAAmB;AACnC,QAAI1C,IAAI,GAACC,MAAM,CAACD,IAAP,CAAY0C,GAAZ,CAAT;AACA,QAAIC,IAAI,GAAC3C,IAAI,CAAC/C,MAAd;;AACA,SAAK,IAAIkD,EAAE,GAAC,CAAZ,EAAeA,EAAE,GAACwC,IAAlB,EAAwBxC,EAAE,EAA1B,EAA8B;AAC1B,UAAIC,GAAG,GAACJ,IAAI,CAACG,EAAD,CAAZ;AACA,UAAIyC,GAAG,GAACF,GAAG,CAACtC,GAAD,CAAX;AACAqC,MAAAA,IAAI,CAACrC,GAAD,CAAJ,GAAUwC,GAAV;AACH;;AAAA;AACG,GARD;;AASA,OAAKC,YAAL,GAAkB,UAASC,GAAT,EAAcC,QAAd,EAAwBC,QAAxB,EAAiC;AACtD,QAAG,KAAKH,YAAL,CAAkBI,CAAlB,KAAwB5H,SAA3B,EAAqC;AAC1B,WAAKwH,YAAL,CAAkBI,CAAlB,GAAoBlE,QAAQ,CAACmE,aAAT,CAAuB,QAAvB,CAApB;AACA,WAAKL,YAAL,CAAkBM,GAAlB,GAAsB,KAAKN,YAAL,CAAkBI,CAAlB,CAAoBG,UAApB,CAA+B,IAA/B,CAAtB;AACV;;AACD,QAAIL,QAAQ,KAAK1H,SAAjB,EAA4B;AACxB,WAAKwH,YAAL,CAAkBM,GAAlB,CAAsBE,IAAtB,GAA6BL,QAAQ,GAAG,GAAX,GAAiBD,QAA9C;AACH,KAFD,MAEO;AACH,WAAKF,YAAL,CAAkBM,GAAlB,CAAsBE,IAAtB,GAA6B,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB,CAA7B;AACH;;AACD,WAAO,KAAK8G,YAAL,CAAkBM,GAAlB,CAAsBG,WAAtB,CAAkCR,GAAlC,EAAuCS,KAA9C;AACI,GAXD;;AAYA,OAAKC,aAAL,GAAmB,UAAST,QAAT,EAAmBC,QAAnB,EAA4B;AAClD,QAAG,KAAKQ,aAAL,CAAmBP,CAAnB,KAAyB5H,SAA5B,EAAsC;AAC3B,WAAKmI,aAAL,CAAmBP,CAAnB,GAAqBlE,QAAQ,CAACmE,aAAT,CAAuB,QAAvB,CAArB;AACA,WAAKM,aAAL,CAAmBL,GAAnB,GAAuB,KAAKK,aAAL,CAAmBP,CAAnB,CAAqBG,UAArB,CAAgC,IAAhC,CAAvB;AACV;;AACD,QAAIL,QAAQ,KAAK1H,SAAjB,EAA4B;AACxB,WAAKmI,aAAL,CAAmBL,GAAnB,CAAuBE,IAAvB,GAA8BL,QAAQ,GAAG,GAAX,GAAiBD,QAA/C;AACH,KAFD,MAEO;AACH,WAAKS,aAAL,CAAmBL,GAAnB,CAAuBE,IAAvB,GAA8B,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB,CAA9B;AACH;;AACD,WAAO,KAAKyH,aAAL,CAAmBL,GAAnB,CAAuBG,WAAvB,CAAmC,GAAnC,EAAwCC,KAA/C;AACI,GAXD;;AAYA,OAAKE,YAAL,GAAkB,UAASV,QAAT,EAAkBC,QAAlB,EAA4B;AACjD,WAAO,KAAKQ,aAAL,CAAmBT,QAAnB,EAA4BC,QAA5B,IAAsC,GAA7C;AACI,GAFD;;AAGA,OAAKU,QAAL,GAAc,UAASC,MAAT,EAAgBC,MAAhB,EAAwB;AACzC,QAAIC,MAAM,GAAC,CAAX;AACA,QAAIC,MAAM,GAAC,CAAX;AACA,QAAIC,IAAI,GAACJ,MAAM,CAAC1G,MAAhB;;AACA,SAAK,IAAIkD,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAAC4D,IAAjB,EAAsB5D,EAAE,EAAxB,EAA4B;AACxB,UAAI6D,MAAM,GAAG,KAAKnB,YAAL,CAAkBc,MAAM,CAACxD,EAAD,CAAxB,IAA8B,IAAEyD,MAA7C;;AACA,UAAII,MAAM,GAAGF,MAAb,EAAqB;AACxBA,QAAAA,MAAM,GAACE,MAAP;AACI;;AACDH,MAAAA,MAAM,GAACA,MAAM,GAACG,MAAd;AACH;;AACD,WAAO;AAACC,MAAAA,GAAG,EAACH,MAAL;AAAYI,MAAAA,GAAG,EAACL;AAAhB,KAAP;AACI,GAZD;;AAaA,OAAKM,YAAL,GAAkB,UAAS3I,KAAT,EAAe4G,GAAf,EAAoB;AACzC,QAAIgC,KAAK,GAAC,EAAV;AACA,QAAInD,GAAG,GAACzF,KAAK,CAACoC,IAAN,CAAW5B,OAAX,CAAmBgE,IAAnB,CAAwB/C,MAAhC;;AACA,SAAK,IAAIkD,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACc,GAAjB,EAAqBd,EAAE,EAAvB,EAA2B;AACvB,UAAIC,GAAG,GAAC5E,KAAK,CAACoC,IAAN,CAAW5B,OAAX,CAAmBgE,IAAnB,CAAwBG,EAAxB,CAAR;;AACA,UAAIiC,GAAG,CAAChC,GAAD,CAAH,KAAa/E,SAAjB,EAA4B;AAC/B,YAAI+I,KAAK,KAAK,EAAd,EAAkB;AAAEA,UAAAA,KAAK,GAACA,KAAK,GAAC,IAAZ;AAAkB;;AAAA;AACtCA,QAAAA,KAAK,GAACA,KAAK,GAAChE,GAAN,GAAU,GAAV,GAAcgC,GAAG,CAAChC,GAAD,CAAvB;AACI;;AAAA;AACJ;;AACD,WAAOgE,KAAP;AACI,GAXD;;AAYA,OAAKC,YAAL,GAAkB,UAAS7I,KAAT,EAAe2G,IAAf,EAAqB;AAC1C,QAAIiC,KAAK,GAAC,EAAV;;AACA,QAAI,KAAK5I,KAAL,CAAW4I,KAAX,KAAqB,CAAzB,EAA4B;AACxB,UAAIE,IAAI,GAACnC,IAAI,CAAClF,MAAd;;AACA,WAAK,IAAIkD,EAAE,GAAG,CAAd,EAAiBA,EAAE,GAAGmE,IAAtB,EAA4BnE,EAAE,EAA9B,EAAkC;AACjC,YAAIiC,GAAG,GAACD,IAAI,CAAChC,EAAD,CAAZ;;AACJ,YAAIiC,GAAG,CAACmC,MAAJ,KAAelJ,SAAnB,EAA8B;AAC1B,cAAI+I,KAAK,KAAK,EAAd,EAAkB;AAAEA,YAAAA,KAAK,GAACA,KAAK,GAAC,GAAZ;AAAiB;;AAAA;AACrCA,UAAAA,KAAK,GAACA,KAAK,GAAChC,GAAG,CAACmC,MAAhB;AACH;AACG;AACJ;;AACD,WAAOH,KAAP;AACI,GAbD;;AAcA,OAAKI,SAAL,GAAe,UAAS7G,MAAT,EAAgBG,MAAhB,EAAuB2G,SAAvB,EAAiCC,SAAjC,EAA2CC,MAA3C,EAAkDC,OAAlD,EAA0DhB,MAA1D,EAAkE;AACpF,QAAIiB,SAAS,GAAC,KAAKpB,YAAL,EAAd;AACAG,IAAAA,MAAM,GAACA,MAAM,GAACiB,SAAP,GAAiB,CAAxB;AACA,QAAIC,KAAK,GAAC;AAACzI,MAAAA,IAAI,EAAC;AAACjB,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF,OAAN;AACPoJ,MAAAA,GAAG,EAAC;AAAC/J,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF,OADG;AAEPqJ,MAAAA,GAAG,EAAC;AAAChK,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF,OAFG;AAGPsJ,MAAAA,GAAG,EAAC;AAACjK,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF,OAHG;AAIPyF,MAAAA,GAAG,EAAC;AAACpG,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF,OAJG;AAKPsF,MAAAA,GAAG,EAAC;AAACjG,QAAAA,MAAM,EAAC,KAAR;AAAc2J,QAAAA,IAAI,EAAC,CAAnB;AAAqBnB,QAAAA,MAAM,EAACA,MAA5B;AAAmCL,QAAAA,KAAK,EAAC,GAAzC;AAA6CyB,QAAAA,MAAM,EAAC,GAApD;AAAwDC,QAAAA,OAAO,EAAC,CAAhE;AAAkEC,QAAAA,OAAO,EAAC,CAA1E;AAA4E7B,QAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjF;AALG,KAAV;;AAMA,QAAI4I,MAAM,IAAI,CAAd,EAAiB;AAAE,aAAOG,KAAP;AAAc;;AAAA,KATmD,CAUpF;;AACA,QAAIQ,EAAE,GAAC,KAAK5B,QAAL,CAAcgB,SAAd,EAAwBd,MAAxB,CAAP;AACA,QAAI2B,EAAE,GAAC,KAAK7B,QAAL,CAAce,SAAd,EAAwBb,MAAxB,CAAP;AACA,QAAI4B,OAAO,GAAG7H,MAAM,KAAG,EAAT,GAAY,CAAZ,GAAc,KAAKkF,YAAL,CAAkBlF,MAAlB,IAA4B,IAAIiG,MAA5D,CAboF,CAab;;AAEvE,QAAI6B,OAAO,GAAG3H,MAAM,KAAG,EAAT,GAAY,CAAZ,GAAc,KAAK+E,YAAL,CAAkB/E,MAAlB,IAA4B,IAAI8F,MAA5D,CAfoF,CAeb;AACvE;AACA;;AACA,QAAI8B,OAAO,GAAC,KAAKlC,aAAL,KAAuB,KAAKqB,SAAS,GAAC,CAAf,CAAnC,CAlBoF,CAkBxB;;AAC5D,QAAIc,MAAM,GAACC,IAAI,CAAC3B,GAAL,CAASqB,EAAE,CAACrB,GAAZ,EAAgBuB,OAAO,GAACC,OAAxB,IAAmCC,OAA9C;AACA,QAAInC,KAAK,GAACoB,MAAM,GAACgB,MAAjB,CApBoF,CAqBpF;;AACA,QAAI7B,MAAM,GAACyB,EAAE,CAACtB,GAAd,CAtBoF,CAuBpF;;AACA,QAAI4B,IAAI,GAACpB,SAAS,CAACxH,MAAnB;AACA,QAAI6I,IAAI,GAACpB,SAAS,CAACzH,MAAnB;AACA,QAAI8I,EAAJ,EAAQC,EAAR,EAAYC,EAAZ,EAAgBC,EAAhB,EAAoBC,EAApB,EAAwBC,GAAxB,EAA6BC,GAA7B,CA1BoF,CA2BpF;;AACA,QAAIvC,MAAM,GAAC+B,IAAP,GAActC,KAAlB,EAAyB;AAAE;AACvB6C,MAAAA,GAAG,GAAC,KAAJ;AACAC,MAAAA,GAAG,GAAC,CAAJ;AACAH,MAAAA,EAAE,GAAC3C,KAAK,GAACsC,IAAT;AACAE,MAAAA,EAAE,GAACL,OAAH;AACAS,MAAAA,EAAE,GAAC,CAACD,EAAE,GAACpC,MAAJ,IAAY,CAAf,CALqB,CAMrB;AACH,KAPD,MAOO,IAAI4B,OAAO,GAACG,IAAR,GAAetC,KAAnB,EAA0B;AAAE;AAC/B6C,MAAAA,GAAG,GAAC,IAAJ;AACAC,MAAAA,GAAG,GAAC,CAAJ;AACAH,MAAAA,EAAE,GAAC3C,KAAK,GAACsC,IAAT;AACAE,MAAAA,EAAE,GAACjC,MAAH;AACAqC,MAAAA,EAAE,GAAC,CAACD,EAAE,GAACR,OAAJ,IAAa,CAAhB,CAL6B,CAM7B;AACH,KAPM,MAOA;AAAE;AACLU,MAAAA,GAAG,GAAC,IAAJ;AACAC,MAAAA,GAAG,GAACT,IAAI,CAACU,IAAL,CAAUT,IAAI,GAACH,OAAL,GAAanC,KAAvB,CAAJ;AACA2C,MAAAA,EAAE,GAACG,GAAG,GAAC9C,KAAJ,GAAUsC,IAAb;AACAE,MAAAA,EAAE,GAACjC,MAAH;AACAqC,MAAAA,EAAE,GAAC,CAACD,EAAE,GAACR,OAAJ,IAAa,CAAhB,CALG,CAMH;AACH,KAjDmF,CAkDpF;;;AACA,QAAIV,MAAM,GAACJ,OAAO,GAACmB,EAAnB;;AACA,QAAIL,OAAO,GAACI,IAAR,GAAed,MAAnB,EAA2B;AAAE;AACzBiB,MAAAA,EAAE,GAACL,IAAI,CAACW,GAAL,CAASb,OAAO,GAAC,EAAjB,EAAoBV,MAAM,GAACc,IAA3B,IAAmClC,MAAtC;AACH,KAFD,MAEO;AACHqC,MAAAA,EAAE,GAACP,OAAO,GAAG9B,MAAb;AACH;;AACDoC,IAAAA,EAAE,GAACL,MAAH,CAzDoF,CA0DpF;;AACA,QAAIa,EAAE,GAAC,CAACR,EAAE,GAACR,OAAH,GAAWC,OAAZ,IAAqB,CAA5B;AACA,SAAKjD,OAAL,CAAasC,KAAK,CAACzI,IAAnB,EAAwB;AAACkH,MAAAA,KAAK,EAAC2C,EAAP;AAAUlB,MAAAA,MAAM,EAACiB,EAAjB;AAAoBlB,MAAAA,IAAI,EAACsB,GAAzB;AAA6BhD,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAlC,KAAxB;AACA,SAAKyG,OAAL,CAAasC,KAAK,CAACK,GAAnB,EAAwB;AAAC5B,MAAAA,KAAK,EAACyC,EAAP;AAAUhB,MAAAA,MAAM,EAACe,EAAjB;AAAoB1C,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAzB,KAAxB;AACA,SAAKyG,OAAL,CAAasC,KAAK,CAACM,GAAnB,EAAwB;AAAC7B,MAAAA,KAAK,EAACiC,OAAO,GAACgB,EAAf;AAAkBxB,MAAAA,MAAM,EAACe,EAAzB;AAA4BU,MAAAA,KAAK,EAAC,OAAlC;AAA0CpD,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAA/C,KAAxB;AACA,SAAKyG,OAAL,CAAasC,KAAK,CAACO,GAAnB,EAAwB;AAAC9B,MAAAA,KAAK,EAACkC,OAAO,GAACe,EAAf;AAAkBxB,MAAAA,MAAM,EAACe,EAAzB;AAA4B1C,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAjC,KAAxB;AACA,SAAKyG,OAAL,CAAasC,KAAK,CAACzD,GAAnB,EAAwB;AAACkC,MAAAA,KAAK,EAAC2C,EAAP;AAAUlB,MAAAA,MAAM,EAACe,EAAjB;AAAoBd,MAAAA,OAAO,EAACkB,EAA5B;AAA+BpB,MAAAA,IAAI,EAACsB,GAApC;AAAwCjL,MAAAA,MAAM,EAACgL,GAA/C;AAAmD/C,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAxD,KAAxB;AACA,SAAKyG,OAAL,CAAasC,KAAK,CAACtD,GAAnB,EAAwB;AAAC+B,MAAAA,KAAK,EAACyC,EAAP;AAAUhB,MAAAA,MAAM,EAACiB,EAAjB;AAAoB5C,MAAAA,IAAI,EAAC,KAAK1H,KAAL,CAAW,KAAKH,KAAL,CAAWO,KAAtB;AAAzB,KAAxB,EAjEoF,CAkEpF;;AACA,WAAO+I,KAAP;AACI,GApED;AAqEH;;AAAA;AACD,eAAe3J,MAAf","sourcesContent":["//console.log(\"Loading LayoutLib.js\");\n\nfunction Layout() {\n    this.rotate=undefined;  // should labels on x-axis be rotated?\n    this.priority=undefined;// which key should be on the abscissa\n    this.init=function(state){\n\tstate.Utils.init(\"Layout\",this);\n    };\n    this.fullscreen=false;\n    this.fonts=[\"12px Fixed\",\"18px Fixed\",\"24px Fixed\",\"36px Fixed\",\"48px Fixed\"\n\t       ];\n    //\n    this.state={viewMode:0,       // should we show trash contents?\n\t\tcellMode:0,       // sum, series, item\n\t\tlayoutMode:0,     // table, list, map\n\t\tcfont:0,\n\t\ttooltip:1,\n\t       };\n    this.modes={view:{nopath:0,\n\t\t      path:1,\n\t\t     },\n\t\tcell:{Sum:0,\n\t\t      Series:1,\n\t\t     },\n\t\tlayout:{Table:0,\n\t\t\tList:1,\n\t\t\tMap:2,\n\t\t       }\n\t       };\n    this.toggleTooltip=function(state) {\n\tthis.state.tooltip=(this.state.tooltip+1)%3;\n\t//console.log(\"Tooltip:\",this.state.tooltip);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,true);\n    };\n    this.changeFont=function(state) {\n\tthis.state.cfont=((this.state.cfont +1) % this.fonts.length);\n\tstate.Utils.pushUrl(state);\n\tstate.Show.show(state,false);\n    };\n    this.toggleView=function(state) {\n\t//console.log(\"Show.view before:\",this.state.viewMode,JSON.stringify(this.state),JSON.stringify(this.modes));\n\tif (this.state.viewMode === this.modes.view.nopath) {\n\t    this.state.viewMode=this.modes.view.path;\n\t} else if (this.state.viewMode === this.modes.view.path) {\n\t    this.state.viewMode=this.modes.view.nopath;\n\t};\n\t//console.log(\"Show.view after:\",this.state.viewMode,JSON.stringify(this.state));\n\tstate.Show.showPath(state);\n\tstate.Show.showConfig(state);\n    };\n    this.toggleMode=function(state,layoutMode,cellMode) {\n\tconsole.log(\"Mode:\",layoutMode,cellMode);\n\t//var reload=(layoutMode !== state.Layout.state.layoutMode);\n\tvar reload=((state.Layout.state.layoutMode===state.Layout.modes.layout.Map &&\n\t\t    layoutMode!==state.Layout.modes.layout.Map) ||\n\t\t    (state.Layout.state.layoutMode!==state.Layout.modes.layout.Map &&\n\t\t    layoutMode===state.Layout.modes.layout.Map));\n\tstate.Layout.state.layoutMode=layoutMode;\n\tstate.Layout.state.cellMode=cellMode;\n\t//state.Show.showConfig(state);\n\tstate.Show.showAll(state,reload);\n    };\n    this.getDim=function(state) {\n\t//console.log(\"Dimension:\",state.Path.other.table.length,JSON.stringify(state.Path.other.table.length));\n        var colkey=state.Path.getColKey(state);\n        var rowkey=state.Path.getRowKey(state);\n\tif (colkey !== undefined && rowkey !== undefined) {\n\t    return 2;\n\t} else if (colkey !== undefined || rowkey !== undefined) {\n\t    return 1;\n\t} else {\n\t    return 0;\n\t}\n    };\n    this.setLayoutMode=function(state,mode) {\n\tvar om=this.state.layoutMode;\n\tvar o=this.getLayoutMode(state);\n\tthis.state.layoutMode=mode;\n\tvar n=this.getLayoutMode(state);\n\t//console.log(\"Setting layout mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.setCellMode=function(state,mode) {\n\tvar om=this.state.cellMode;\n\tvar o=this.getCellMode(state);\n\tthis.state.cellMode=mode;\n\tvar n=this.getCellMode(state);\n\t//console.log(\"Setting cell mode:\",mode,\":\",o,\"->\",n);\n\tif (o !== n) {\n\t    state.Show.showAll(state);\n\t} else if (om !== mode) {\n\t    state.Show.showMode(state);\n\t}\n    };\n    this.getLayoutMode=function(state) {\n\t//console.log(\"Getmode init:\",this.state.layoutMode,state.Matrix.cnt);\n\tvar mode=this.state.layoutMode;\n\tif (mode  === this.modes.layout.List && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.layout.Table;\n\t} else if (mode  === this.modes.layout.Map && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.layout.Table;\n\t}\n\treturn mode;\n    };\n    this.getCellMode=function(state) {\n\tvar mode=this.state.cellMode;\n\tif (mode  === this.modes.cell.Single && state.Matrix.cnt > state.Matrix.popSingle) {\n\t    mode=this.modes.cell.Series;\n\t}\n\tif (mode  === this.modes.cell.Series && state.Matrix.cnt > state.Matrix.popSeries) {\n\t    mode=this.modes.cell.Sum;\n\t}\n\treturn mode;\n    };\n    this.toggleFullScreen=function(state) {\n\t//var pos=0;\n\tif (!document.fullscreenElement &&    // alternative standard method\n\t    !document.mozFullScreenElement && \n\t    !document.webkitFullscreenElement && \n\t    !document.msFullscreenElement ) {  // current working methods\n\t    if (document.documentElement.requestFullscreen) {\n\t\tdocument.documentElement.requestFullscreen();\n\t\t//pos=1;\n\t    } else if (document.documentElement.msRequestFullscreen) {\n\t\tdocument.documentElement.msRequestFullscreen();\n\t\t//pos=2;\n\t    } else if (document.documentElement.mozRequestFullScreen) {\n\t\tdocument.documentElement.mozRequestFullScreen();\n\t\t//pos=3;\n\t    } else if (document.webkitRequestFullscreen) {\n\t\tdocument.webkitRequestFullscreen();\n\t\t//pos=4;\n\t    } else {\n\t\t//pos=5;\n\t    }\n\t    this.fullscreen=true;\n\t} else {\n\t    if (document.exitFullscreen) {\n\t\tdocument.exitFullscreen();\n\t\t//pos=6;\n\t    } else if (document.msExitFullscreen) {\n\t\tdocument.msExitFullscreen();\n\t\t//pos=7;\n\t    } else if (document.mozCancelFullScreen) {\n\t\tdocument.mozCancelFullScreen();\n\t\t//pos=8;\n\t    } else if (document.webkitExitFullscreen) {\n\t\tdocument.webkitExitFullscreen();\n\t\t//pos=9;\n\t    } else {\n\t\t//pos=10;\n\t    }\n\t    this.fullscreen=false;\n\t}\n\tstate.Show.showConfig(state);\n\tconsole.log(\"Toggle fullscreen:\",this.fullscreen);\n    };\n    // adjust keys so that rows/cols have more than on entry...\n    this.getPriorityKeys=function(state){\n        if (state.Layout.priority === undefined) {\n            state.Layout.priority=state.Database.keyCnt.keys();\n        } else {\n\t    var keys = Object.keys(state.Database.keyCnt);;\n\t    var plen = keys;\n\t    for (var ii = 0; ii < plen; ii++) {\n\t\tvar key=keys[ii];\n\t\tif (state.Layout.priority.indexOf(key)===-1) {\n\t\t    state.Layout.priority.push(key);\n\t\t}\n\t    };\n\t};\n\treturn state.Layout.priority; //state.Utils.invertedArray()\n    };\n    this.increaseSelect=function(state,key){\n\tvar kid=state.Path.keys.path.indexOf(key);\n\tconsole.log(\"Bumping:\",key,kid,JSON.stringify(state.Path.keys.path));\n\tif (kid !== -1 && kid > 0) {\n\t    var src=state.Path.keys.path.splice(kid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Path.keys.path,kid-1,0,src);\n\t}\n\tstate.Show.showConfig(state);\n\tstate.Show.showPath(state);\n    };\n    this.increasePriority=function(state,key){\n\tvar kid=state.Layout.priority.indexOf(key);\n\tconsole.log(\"Bumping:\",key,kid,JSON.stringify(state.Layout.priority));\n\tif (kid !== -1 && kid > 0) {\n\t    var src=state.Layout.priority.splice(kid, 1); // remove from array   \n\t    state.Utils.spliceArray(state.Layout.priority,kid-1,0,src);\n\t}\n\tstate.Show.showConfig(state);\n    };\n    this.getPriorityIndex=function(state,arr) {\n\tvar len,ii;\n\tvar pri={};\n\tlen=arr.length;\n\tfor (ii=0;ii<len;ii++) {\n\t    pri[arr[ii]]=0;\n\t};\n\tif (this.priority !== undefined) {\n\t    len=this.priority.length\n\t    for (ii=0;ii<len;ii++) {\n\t\tvar key=this.priority[ii]\n\t\tpri[key]=len+1-ii\n\t    };\n\t};\n\treturn pri;\n    };\n    this.changePriority=function(state,key,trg) {  // key -> trg\n\tif (key  === undefined || trg  === undefined) { return;}\n\tconsole.log(\"Priority:\",key,\"->\",trg,JSON.stringify(this.priority));\n\t//if (typeof trg  === \"undefined\") {\n\tvar col=state.Path.other.table[0];\n\tvar row=state.Path.other.table[1];\n\t//var icol=0;\n\t//var irow=0;\n\tvar ikey=0;\n\tvar itrg=0;\n\tvar len=this.priority.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    if (this.priority[ii]  === col) {\n\t\t//icol=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === row) {\n\t\t//irow=len+1-ii;\n\t    };\n\t    if  (this.priority[ii]  === key) {\n\t\tikey=len+1-ii;\n\t    }\n\t    if  (this.priority[ii]  === trg) {\n\t\titrg=len+1-ii;\n\t    }\n\t}\n\tif (itrg < ikey) {        // demote existing key\n\t    if (itrg > 0) {       // key exists on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+2-itrg,0,key);  // add after\n\n\t\tconsole.log(\"Added:\",JSON.stringify(this.priority),ikey,itrg,key);\n\t\t\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t    } else {              // key exists, target does not\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tthis.priority.concat(key)\t    \n\t    }\n\t} else if (itrg > ikey) { // demote, key may not exist on priority list\n\t    if (ikey>0) {         // key exists on priority list\n\t\t//var src=\n\t\tthis.priority.splice(len+1-ikey, 1);        // remove\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    } else {              // key is not on priority list\n\t\tstate.Utils.spliceArray(this.priority,len+1-itrg,0,key);  // add before\n\t    }\n\t} else if (itrg === 0) { // key and target not on the priority list\n\t    this.priority.concat(key)\n\t}\n\tconsole.log(\"Changed priority:\",JSON.stringify(this.priority),ikey,itrg);\n\treturn true;\n    }\n    //this.flipTable=function(state) {\n    //    var bb=this.colrow[0];\n    //    this.colrow[0]=this.colrow[1];\n    //    this.colrow[1]=bb;\n    //    //console.log(\"Setup:\",JSON.stringify(setup));\n    //};\n    this.getPriority=function(state) {\n\treturn state.Utils.cp(this.priority);\n    };\n    this.setPriority=function(state,priority) {\n\tthis.priority=priority;\n    }\n    this.getDescription=function(state,element,skeys) {\n\tif (element.cnt  === 1) {\n\t    var s=\"\";\n\t    var docs=element.docs;\n\t    var doc=docs[0];\n\t    var klen=skeys.length;\n\t    for (var jj = 0; jj < klen; jj++) {\n\t\tvar d=skeys[jj]+\"=\"+doc[skeys[jj]];;\n\t\tif (s !== \"\") {\n\t\t    s=s+\" \"+d\n\t\t} else {\n\t\t    s=d;\n\t\t}\n\t    }\n\t    return s;\n\t} else {\n\t    return element.cnt;\n\t}\n    };\n    this.setPlan=function(plan,set) {\n\tvar keys=Object.keys(set);\n\tvar lenk=keys.length;\n\tfor (var ii=0; ii<lenk; ii++) {\n\t    var key=keys[ii];\n\t    var val=set[key];\n\t    plan[key]=val;\n\t};\n    };\n    this.getTextWidth=function(txt, fontname, fontsize){\n\tif(this.getTextWidth.c === undefined){\n            this.getTextWidth.c=document.createElement('canvas');\n            this.getTextWidth.ctx=this.getTextWidth.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextWidth.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextWidth.ctx.font = this.fonts[this.state.cfont];\n\t}\n\treturn this.getTextWidth.ctx.measureText(txt).width;\n    };\n    this.getTextHeight=function(fontname, fontsize){\n\tif(this.getTextHeight.c === undefined){\n            this.getTextHeight.c=document.createElement('canvas');\n            this.getTextHeight.ctx=this.getTextHeight.c.getContext('2d');\n\t}\n\tif (fontname !== undefined) {\n\t    this.getTextHeight.ctx.font = fontsize + ' ' + fontname;\n\t} else {\n\t    this.getTextHeight.ctx.font = this.fonts[this.state.cfont];\n\t}\n\treturn this.getTextHeight.ctx.measureText('M').width;\n    };\n    this.getDescender=function(fontname,fontsize) {\n\treturn this.getTextHeight(fontname,fontsize)*0.3;\n    }\n    this.maxWidth=function(values,border) {\n\tvar swidth=0;\n\tvar mwidth=0;\n\tvar lenv=values.length;\n\tfor (var ii=0;ii<lenv;ii++) {\n\t    var cwidth = this.getTextWidth(values[ii])+2*border;\n\t    if (cwidth > mwidth) {\n\t\tmwidth=cwidth;\n\t    }\n\t    swidth=swidth+cwidth;\n\t}\n\treturn {max:mwidth,sum:swidth};\n    }\n    this.makeDocTitle=function(state,doc) {\n\tvar title=\"\";\n\tvar len=state.Path.tooltip.keys.length;\n\tfor (var ii=0;ii<len;ii++) {\n\t    var key=state.Path.tooltip.keys[ii];\n\t    if (doc[key] !== undefined) {\n\t\tif (title !== \"\") { title=title+\", \";};\n\t\ttitle=title+key+\"=\"+doc[key];\n\t    };\n\t}\n\treturn title;\n    };\n    this.makeCntTitle=function(state,docs) {\n\tvar title=\"\"\n\tif (this.state.title === 1) {\n\t    var dlen=docs.length;\n\t    for (var ii = 0; ii < dlen; ii++) {\n    \t\tvar doc=docs[ii];\n\t\tif (doc._title !== undefined) {\n\t\t    if (title !== \"\") { title=title+\"|\";};\n\t\t    title=title+doc._title;\n\t\t}\n\t    }\n\t}\n\treturn title;\n    };\n    this.makePlans=function(colkey,rowkey,colvalues,rowvalues,iwidth,iheight,border) {\n\tvar descender=this.getDescender();\n\tborder=border+descender+1;\n\tvar plans={cell:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]}, \n\t\t  hdr:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t  hd1:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t  hd2:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t  row:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]},\n\t\t  col:{rotate:false,step:1,border:border,width:100,height:100,xoffset:0,yoffset:0,font:this.fonts[this.state.cfont]}};\n\tif (iwidth <= 0) { return plans;};\n\t// text boundaries\n\tvar wh=this.maxWidth(rowvalues,border);\n\tvar ww=this.maxWidth(colvalues,border);\n\tvar zwidth1 =(colkey===\"\"?0:this.getTextWidth(colkey) + 2 * border);   //props.theme.spacing.unit;\n\n\tvar zwidth2 =(rowkey===\"\"?0:this.getTextWidth(rowkey) + 2 * border);   //props.theme.spacing.unit;\n\t// var zheight=getTextHeight() + 2 * border;  //props.theme.spacing.unit;\n\t// table boundaries\n\tvar mheight=this.getTextHeight() + 2 * (descender+1);       //props.theme.spacing.unit;\n\tvar hwidth=Math.max(wh.max,zwidth1+zwidth2) + mheight;\n\tvar width=iwidth-hwidth;\n\t// calculate cell width...\n\tvar mwidth=ww.max;\n\t//var swidth=ww.sum;\n\tvar lenc=colvalues.length;\n\tvar lenr=rowvalues.length;\n\tvar hh, hw, ch, cw, hx, rot, stp;\n\t//console.log(\"HdrW:\",mwidth,\" HdrH=\",mheight,\" cnt=\",lenc,\" totW=\",width);\n\tif (mwidth*lenc < width) { // horisontal\n\t    rot=false;\n\t    stp=1\n\t    cw=width/lenc;\n\t    hh=mheight;\n\t    hx=(cw-mwidth)/2;\n\t    //console.log(\"Plan (normal):\",JSON.stringify(plans));\n\t} else if (mheight*lenc < width) { // rotate\n\t    rot=true;\n\t    stp=1\n\t    cw=width/lenc;\n\t    hh=mwidth;\n\t    hx=(cw-mheight)/2;\n\t    //console.log(\"Plan (rot):\",JSON.stringify(plans),lenc,cw*lenc);\n\t} else { // rotate and use steps\n\t    rot=true;\n\t    stp=Math.ceil(lenc*mheight/width);\n\t    cw=stp*width/lenc;\n\t    hh=mwidth;\n\t    hx=(cw-mheight)/2;\n\t    //console.log(\"Plan (rot+step):\",JSON.stringify(plans),stp,cw,hh,hx);\n\t}\n\t// calculate cell height\n\tvar height=iheight-hh;\n\tif (mheight*lenr < height) { // \n\t    ch=Math.min(mheight*10,height/lenr) - border;\n\t} else {\n\t    ch=mheight - border;\n\t}\n\thw=hwidth;\n\t//console.log(\"Cells:\",hh,ch,height,lenr,mheight);\n\tvar dw=(hw-zwidth1-zwidth2)/2;\n\tthis.setPlan(plans.cell,{width:cw,height:ch,step:stp,font:this.fonts[this.state.cfont]});\n\tthis.setPlan(plans.hdr, {width:hw,height:hh,font:this.fonts[this.state.cfont]});\n\tthis.setPlan(plans.hd1, {width:zwidth1+dw,height:hh,align:\"right\",font:this.fonts[this.state.cfont]});\n\tthis.setPlan(plans.hd2, {width:zwidth2+dw,height:hh,font:this.fonts[this.state.cfont]});\n\tthis.setPlan(plans.col, {width:cw,height:hh,xoffset:hx,step:stp,rotate:rot,font:this.fonts[this.state.cfont]});\n\tthis.setPlan(plans.row, {width:hw,height:ch,font:this.fonts[this.state.cfont]});\n\t//console.log(\"Plan (finally):\",JSON.stringify(plans),mheight,mwidth,height,width,lenr);\n\treturn plans;\n    }\n};\nexport default Layout;\n"]},"metadata":{},"sourceType":"module"}