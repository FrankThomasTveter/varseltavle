{"ast":null,"code":"//console.log(\"Loading ThresholdLib.js\");\nfunction Threshold() {\n  this.thrs = undefined; // threshold parameter levels, set by Default\n\n  this.imax = 0; // threshold item types\n\n  this.ithr = 1;\n  this.ikey = 2;\n  this.ilev = 3;\n  this.ival = 4;\n\n  this.init = function (state) {\n    var par = \"Threshold\";\n    state.Utils.init(par, this);\n  };\n\n  this.setThresholds = function (doc, ithrs) {\n    var debug = doc.Phenomenon === \"Regn\" && doc.Duration === \"12t\" && doc.Region === \"Agder\" && doc.dtg === \"2019-06-24_12\";\n\n    if (doc._thr !== undefined) {\n      return [];\n    } else {\n      var thrs;\n      doc._thr = {};\n\n      if (ithrs === undefined) {\n        thrs = this.thrs;\n      } else {\n        thrs = ithrs;\n      }\n\n      ;\n\n      if (debug) {\n        console.log(\"Entering with:\", JSON.stringify(doc));\n      }\n\n      ;\n\n      if (debug) {\n        console.log(\"     --> with:\", JSON.stringify(ithrs));\n      }\n\n      ;\n\n      if (debug) {\n        console.log(\"      -> with:\", JSON.stringify(thrs));\n      }\n\n      ;\n\n      for (var trgkey in thrs) {\n        // loop over thresholds\n        if (doc[trgkey] !== undefined) {\n          var trgval = doc[trgkey]; // trgval-value\n\n          if (thrs[trgkey][trgval] !== undefined) {\n            if (debug) {\n              console.log(\"Found:\", trgkey, trgval, JSON.stringify(thrs[trgkey][trgval]));\n            }\n\n            ;\n            var mlen, jj, res;\n\n            if (thrs[trgkey][trgval].par === undefined) {\n              // there is another level\n              return this.setThresholds(doc, thrs[trgkey][trgval]);\n            } else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n              var thr = thrs[trgkey][trgval]; //doc.threshold=thr;\n\n              var val = doc[thr[\"par\"]];\n              var maxs = thr[\">\"];\n              var mins = thr[\"<\"];\n              var doclev = -1; // found thresholds, but will we find a valid level?\n\n              if (maxs !== undefined) {\n                // above thresholds\n                if (debug) {\n                  console.log(\"Thresholds:\", JSON.stringify(maxs), val);\n                }\n\n                ;\n                var docmax = Number(val);\n                mlen = maxs.length; // get new level\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmax >= Number(maxs[jj])) {\n                    //console.log(\"Hit:\",jj,docmax,tmax[jj],docmax>=tmax[jj],doclev);\n                    doclev = jj;\n                  }\n                }\n\n                doc.level = doclev;\n                doc._thr.level = doclev;\n                doc._thr.val = docmax;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.max = maxs;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"max\"];\n              } else if (mins !== undefined) {\n                // below thresholds\n                if (debug) {\n                  console.log(\"Thresholds:\", JSON.stringify(mins), val);\n                }\n\n                ;\n                var docmin = Number(val); // get new level\n\n                mlen = mins.length;\n\n                for (jj = 0; jj < mlen; jj++) {\n                  if (docmin <= Number(mins[jj])) {\n                    doclev = jj;\n                  }\n                }\n\n                doc.level = doclev;\n                doc._thr.level = doclev;\n                doc._thr.val = docmin;\n                doc._thr.lat = doc[thr[\"lat\"]];\n                doc._thr.lon = doc[thr[\"lon\"]];\n                doc._thr.min = mins;\n                return [\"level\", \"val\", \"lat\", \"lon\", \"min\"];\n              } else {\n                if (debug) {\n                  console.log(\"No Thresholds:\", JSON.stringify(thrs), val);\n                }\n\n                ;\n              }\n            }\n          }\n        }\n      }\n\n      doc.level = -2; // no thresholds found...\n    }\n\n    return [];\n  }; // call after this.setThresholds\n\n\n  this.getLevel = function (state, doc) {\n    //console.log(\"GetLevel:\",JSON.stringify(doc));\n    if (doc._thr !== undefined) {\n      return doc._thr.level;\n    } else {\n      return -1;\n    }\n  };\n\n  this.getLat = function (state, doc) {\n    return doc._thr.lat;\n  };\n\n  this.getLon = function (state, doc) {\n    return doc._thr.lon;\n  };\n}\n\n;\nexport default Threshold;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/ThresholdLib.js"],"names":["Threshold","thrs","undefined","imax","ithr","ikey","ilev","ival","init","state","par","Utils","setThresholds","doc","ithrs","debug","Phenomenon","Duration","Region","dtg","_thr","console","log","JSON","stringify","trgkey","trgval","mlen","jj","res","thr","val","maxs","mins","doclev","docmax","Number","length","level","lat","lon","max","docmin","min","getLevel","getLat","getLon"],"mappings":"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","sourcesContent":["//console.log(\"Loading ThresholdLib.js\");\n\nfunction Threshold() {\n    this.thrs=undefined; // threshold parameter levels, set by Default\n    this.imax=0;        // threshold item types\n    this.ithr=1;\n    this.ikey=2;\n    this.ilev=3;\n    this.ival=4;\n    this.init=function(state){\n\tvar par=\"Threshold\";\n\tstate.Utils.init(par,this);\n    };\n    this.setThresholds=function(doc,ithrs) {\n\tvar debug = (doc.Phenomenon===\"Regn\" && doc.Duration===\"12t\" && doc.Region===\"Agder\" && doc.dtg===\"2019-06-24_12\");\n\tif (doc._thr !== undefined) {\n\t    return [];\n\t} else {\n\t    var thrs;\n\t    doc._thr={};\n\t    if (ithrs === undefined) {\n\t\tthrs=this.thrs;\n\t    } else {\n\t\tthrs=ithrs;\n\t    };\n\t    \n\t    if (debug) {console.log(\"Entering with:\",JSON.stringify(doc));};\n\t    if (debug) {console.log(\"     --> with:\",JSON.stringify(ithrs));};\n\t    if (debug) {console.log(\"      -> with:\",JSON.stringify(thrs));};\n\n\t    for (var trgkey in thrs) { // loop over thresholds\n\t\tif (doc[trgkey] !== undefined) {\n\t\t    var trgval=doc[trgkey]; // trgval-value\n\t\t    if (thrs[trgkey][trgval] !== undefined) {\n\n\t\t\tif (debug) {console.log(\"Found:\",trgkey,trgval,JSON.stringify(thrs[trgkey][trgval]));};\n\n\t\t\tvar mlen,jj,res;\n\t\t\tif (thrs[trgkey][trgval].par === undefined) { // there is another level\n\t\t\t    return this.setThresholds(doc,thrs[trgkey][trgval]);\n\t\t\t} else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n\t\t\t    var thr = thrs[trgkey][trgval]\n\t\t\t    //doc.threshold=thr;\n\t\t\t    var val = doc[thr[\"par\"]];\n\t\t\t    var maxs = thr[\">\"];\n\t\t\t    var mins = thr[\"<\"];\n\t\t\t    var doclev=-1; // found thresholds, but will we find a valid level?\n\t\t\t    if (maxs !== undefined) { // above thresholds\n\n\t\t\t\tif (debug) {console.log(\"Thresholds:\",JSON.stringify(maxs),val);};\n\n\t\t\t\tvar docmax=Number(val);\n\t\t\t\tmlen=maxs.length;\n\t\t\t\t// get new level\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmax >= Number(maxs[jj])) {\n\t\t\t\t\t//console.log(\"Hit:\",jj,docmax,tmax[jj],docmax>=tmax[jj],doclev);\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmax\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.max=maxs;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"max\"];\n\t\t\t    } else if (mins !== undefined) { // below thresholds\n\n\t\t\t\tif (debug) {console.log(\"Thresholds:\",JSON.stringify(mins),val);};\n\n\t\t\t\tvar docmin=Number(val);\n\t\t\t\t// get new level\n\t\t\t\tmlen=mins.length;\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmin <= Number(mins[jj])) {\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmin\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.min=mins;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"min\"];\n\t\t\t    } else {\n\n\t\t\t\tif (debug) {console.log(\"No Thresholds:\",JSON.stringify(thrs),val);};\n\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t    doc.level=-2;  // no thresholds found...\n\t}\n\treturn [];\n    };\n    // call after this.setThresholds\n    this.getLevel=function(state,doc) {\n\t//console.log(\"GetLevel:\",JSON.stringify(doc));\n\tif (doc._thr !== undefined) {\n\t    return doc._thr.level;\n\t} else {\n\t    return -1;\n\t}\n    }\n    this.getLat=function(state,doc) {\n\treturn doc._thr.lat;\n    }\n    this.getLon=function(state,doc) {\n\treturn doc._thr.lon;\n    };\n};\nexport default Threshold;\n"]},"metadata":{},"sourceType":"module"}