{"ast":null,"code":"//console.log(\"Loading ThresholdLib.js\");\nfunction Threshold(){this.thrs=undefined;// threshold parameter levels, set by Default\n//this.imax=0;        // threshold item types\n//this.ithr=1;\n//this.ikey=2;\n//this.ilev=3;\n//this.ival=4;\nthis.init=function(state){state.Utils.init(\"Threshold\",this);};this.getMaxLevel=function(doc){if(doc._thr!==undefined){if(doc._thr.max!==undefined){return doc._thr.max.length;}else if(doc._thr.min!==undefined){return doc._thr.min.length;}}else{return-1;}};this.setThresholds=function(doc,ithrs){//var debug = (doc.Phenomenon===\"Regn\" && doc.Duration===\"12t\" && doc.Region===\"Innlandet\" && doc.dtg===\"2019-06-26_11\");\nif(doc._thr!==undefined){return[];}else{var thrs;if(ithrs===undefined){thrs=this.thrs;}else{thrs=ithrs;};//if (debug) {console.log(\"Entering with:\",JSON.stringify(doc));};\n//if (debug) {console.log(\"     --> with:\",JSON.stringify(ithrs));};\n//if (debug) {console.log(\"      -> with:\",JSON.stringify(thrs));};\nfor(var trgkey in thrs){// loop over thresholds\nif(doc[trgkey]!==undefined){var trgval=doc[trgkey];// trgval-value\nif(thrs[trgkey][trgval]!==undefined){//if (debug) {console.log(\"Found:\",trgkey,trgval,JSON.stringify(thrs[trgkey][trgval]));};\nvar mlen,jj;if(thrs[trgkey][trgval].par===undefined){// there is another level\n//if (debug) {console.log(\"   Iterating with:\",JSON.stringify(thrs[trgkey][trgval]));};\nreturn this.setThresholds(doc,thrs[trgkey][trgval]);}else if(doc[thrs[trgkey][trgval].par]!==undefined){var thr=thrs[trgkey][trgval];//doc.threshold=thr;\nvar rank;var val=doc[thr[\"par\"]];var maxs=thr[\">\"];var mins=thr[\"<\"];var doclev=-1;// found thresholds, but will we find a valid level?\nif(maxs!==undefined){// above thresholds\n//if (debug) {console.log(\"Thresholds:\",JSON.stringify(maxs),val);};\nvar docmax=Number(val);mlen=maxs.length;// get new level\nfor(jj=0;jj<mlen;jj++){if(docmax>=Number(maxs[jj])){//if (debug) {console.log(\"Hit:\",docmax,jj,maxs[jj],docmax>=maxs[jj],doclev);}\ndoclev=jj;}};rank=0;// universal rank\nif(doclev>-1){rank=(docmax-Number(maxs[0]))/(Number(maxs[mlen-1])-Number(maxs[0]));};//if (debug) {console.log(\"Level:\",docmax,doclev,JSON.stringify(maxs));}\ndoc.level=doclev;doc._rank=rank;doc.lat=doc[thr[\"lat\"]];doc.lon=doc[thr[\"lon\"]];doc._thr={};doc._thr.level=doclev;doc._thr.val=docmax;doc._thr.lat=doc[thr[\"lat\"]];doc._thr.lon=doc[thr[\"lon\"]];doc._thr.max=maxs;return[\"level\",\"val\",\"lat\",\"lon\",\"max\"];}else if(mins!==undefined){// below thresholds\n//if (debug) {console.log(\"Thresholds:\",JSON.stringify(mins),val);};\nvar docmin=Number(val);// get new level\nmlen=mins.length;for(jj=0;jj<mlen;jj++){if(docmin<=Number(mins[jj])){doclev=jj;}}rank=0;// universal rank\nif(doclev>0){rank=(Number(mins[0])-docmin)/(Number(mins[0])-Number(mins[mlen-1]));};doc.level=doclev;doc._rank=rank;doc.lat=doc[thr[\"lat\"]];doc.lon=doc[thr[\"lon\"]];doc._thr={};doc._thr.level=doclev;doc._thr.val=docmin;doc._thr.lat=doc[thr[\"lat\"]];doc._thr.lon=doc[thr[\"lon\"]];doc._thr.min=mins;return[\"level\",\"val\",\"lat\",\"lon\",\"min\"];}else{//if (debug) {console.log(\"No Thresholds:\",JSON.stringify(thrs),val);};\n}}}}}doc._thr={};doc.level=-2;// no thresholds found...\n}return[];};// call after this.setThresholds\nthis.getLevel=function(state,doc){//console.log(\"GetLevel:\",JSON.stringify(doc));\nif(doc._thr!==undefined){return doc._thr.level;}else{return-1;}};this.getRank=function(state,doc){return doc._rank;};this.getLat=function(state,doc){return doc._thr.lat;};this.getLon=function(state,doc){return doc._thr.lon;};};export default Threshold;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/ThresholdLib.js"],"names":["Threshold","thrs","undefined","init","state","Utils","getMaxLevel","doc","_thr","max","length","min","setThresholds","ithrs","trgkey","trgval","mlen","jj","par","thr","rank","val","maxs","mins","doclev","docmax","Number","level","_rank","lat","lon","docmin","getLevel","getRank","getLat","getLon"],"mappings":"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","sourcesContent":["//console.log(\"Loading ThresholdLib.js\");\n\nfunction Threshold() {\n    this.thrs=undefined; // threshold parameter levels, set by Default\n    //this.imax=0;        // threshold item types\n    //this.ithr=1;\n    //this.ikey=2;\n    //this.ilev=3;\n    //this.ival=4;\n    this.init=function(state){\n\tstate.Utils.init(\"Threshold\",this);\n    };\n    this.getMaxLevel=function(doc) {\n\tif (doc._thr !== undefined) {\n\t    if (doc._thr.max !== undefined) {\n\t\treturn doc._thr.max.length;\n\t    } else if (doc._thr.min !== undefined) {\n\t\treturn doc._thr.min.length;\n\t    }\n\t} else {\n\t    return -1;\n\t}\n    };\n    this.setThresholds=function(doc,ithrs) {\n\t//var debug = (doc.Phenomenon===\"Regn\" && doc.Duration===\"12t\" && doc.Region===\"Innlandet\" && doc.dtg===\"2019-06-26_11\");\n\tif (doc._thr !== undefined) {\n\t    return [];\n\t} else {\n\t    var thrs;\n\t    if (ithrs === undefined) {\n\t\tthrs=this.thrs;\n\t    } else {\n\t\tthrs=ithrs;\n\t    };\n\t    //if (debug) {console.log(\"Entering with:\",JSON.stringify(doc));};\n\t    //if (debug) {console.log(\"     --> with:\",JSON.stringify(ithrs));};\n\t    //if (debug) {console.log(\"      -> with:\",JSON.stringify(thrs));};\n\t    for (var trgkey in thrs) { // loop over thresholds\n\t\tif (doc[trgkey] !== undefined) {\n\t\t    var trgval=doc[trgkey]; // trgval-value\n\t\t    if (thrs[trgkey][trgval] !== undefined) {\n\t\t\t//if (debug) {console.log(\"Found:\",trgkey,trgval,JSON.stringify(thrs[trgkey][trgval]));};\n\t\t\tvar mlen,jj;\n\t\t\tif (thrs[trgkey][trgval].par === undefined) { // there is another level\n\t\t\t    //if (debug) {console.log(\"   Iterating with:\",JSON.stringify(thrs[trgkey][trgval]));};\n\t\t\t    return this.setThresholds(doc,thrs[trgkey][trgval]);\n\t\t\t} else if (doc[thrs[trgkey][trgval].par] !== undefined) {\n\t\t\t    var thr = thrs[trgkey][trgval]\n\t\t\t    //doc.threshold=thr;\n\t\t\t    var rank;\n\t\t\t    var val = doc[thr[\"par\"]];\n\t\t\t    var maxs = thr[\">\"];\n\t\t\t    var mins = thr[\"<\"];\n\t\t\t    var doclev=-1; // found thresholds, but will we find a valid level?\n\t\t\t    if (maxs !== undefined) { // above thresholds\n\t\t\t\t//if (debug) {console.log(\"Thresholds:\",JSON.stringify(maxs),val);};\n\t\t\t\tvar docmax=Number(val);\n\t\t\t\tmlen=maxs.length;\n\t\t\t\t// get new level\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmax >= Number(maxs[jj])) {\n\t\t\t\t\t//if (debug) {console.log(\"Hit:\",docmax,jj,maxs[jj],docmax>=maxs[jj],doclev);}\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t};\n\t\t\t\trank=0; // universal rank\n\t\t\t\tif (doclev > -1) {rank= (docmax-Number(maxs[0]))/(Number(maxs[mlen-1])-Number(maxs[0]));};\n\t\t\t\t//if (debug) {console.log(\"Level:\",docmax,doclev,JSON.stringify(maxs));}\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._rank=rank;\n\t\t\t\tdoc.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr={};\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmax\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.max=maxs;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"max\"];\n\t\t\t    } else if (mins !== undefined) { // below thresholds\n\t\t\t\t//if (debug) {console.log(\"Thresholds:\",JSON.stringify(mins),val);};\n\t\t\t\tvar docmin=Number(val);\n\t\t\t\t// get new level\n\t\t\t\tmlen=mins.length;\n\t\t\t\tfor (jj = 0; jj < mlen; jj++) {\n\t\t\t\t    if (docmin <= Number(mins[jj])) {\n\t\t\t\t\tdoclev=jj;\n\t\t\t\t    }\n\t\t\t\t}\n\t\t\t\trank=0; // universal rank\n\t\t\t\tif (doclev > 0) {rank=(Number(mins[0])-docmin)/(Number(mins[0])-Number(mins[mlen-1]));};\n\t\t\t\tdoc.level=doclev;\n\t\t\t\tdoc._rank=rank;\n\t\t\t\tdoc.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr={};\n\t\t\t\tdoc._thr.level=doclev;\n\t\t\t\tdoc._thr.val=docmin\n\t\t\t\tdoc._thr.lat=doc[thr[\"lat\"]];\n\t\t\t\tdoc._thr.lon=doc[thr[\"lon\"]];\n\t\t\t\tdoc._thr.min=mins;\n\t\t\t\treturn [\"level\",\"val\",\"lat\",\"lon\",\"min\"];\n\t\t\t    } else {\n\t\t\t\t//if (debug) {console.log(\"No Thresholds:\",JSON.stringify(thrs),val);};\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t    doc._thr={};\n\t    doc.level=-2;  // no thresholds found...\n\t}\n\treturn [];\n    };\n    // call after this.setThresholds\n    this.getLevel=function(state,doc) {\n\t//console.log(\"GetLevel:\",JSON.stringify(doc));\n\tif (doc._thr !== undefined) {\n\t    return doc._thr.level;\n\t} else {\n\t    return -1;\n\t}\n    }\n    this.getRank=function(state,doc) {\n\treturn doc._rank;\n    }\n    this.getLat=function(state,doc) {\n\treturn doc._thr.lat;\n    }\n    this.getLon=function(state,doc) {\n\treturn doc._thr.lon;\n    };\n};\nexport default Threshold;\n"]},"metadata":{},"sourceType":"module"}