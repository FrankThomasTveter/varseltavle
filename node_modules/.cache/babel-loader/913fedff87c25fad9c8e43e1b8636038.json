{"ast":null,"code":"//console.log(\"Loading NavigateLib.js\");\nfunction Navigate() {\n  this.history = {\n    pos: 0,\n    // position of next snapshot\n    track: []\n  };\n  this.home = undefined;\n  this.rank = {}; // key rank\n\n  this.trash = {}; // key trash\n\n  this.maxStore = 1000; // max number of states stored\n\n  this.reset = function (state) {\n    // store state\n    state.Navigate.history = {\n      pos: 0,\n      track: []\n    };\n    this.store(state);\n  };\n\n  this.store = function (state) {\n    // store state\n    var snapshot = state.Path.getSnapshot(state);\n\n    if (state.Navigate.history.track.length > 0) {\n      var old = state.Navigate.history.track[state.Navigate.history.track.length - 1];\n\n      if (JSON.stringify(snapshot) === JSON.stringify(old)) {\n        console.log(\"Ignoring old image.\");\n        return false;\n      }\n    } // remove old data...\n\n\n    if (state.Navigate.history.track.length > state.Navigate.history.pos + 1) {\n      var keep = state.Navigate.history.pos + 1;\n      state.Navigate.history.track = state.Navigate.history.track.splice(-keep, keep);\n    } else if (state.Navigate.history.track.length > this.maxStore) {\n      var keep = this.maxStore;\n      state.Navigate.history.track = state.Navigate.history.track.splice(-keep, keep);\n    }\n\n    ;\n    state.Navigate.history.track.push(snapshot);\n    state.Navigate.history.pos = state.Navigate.history.track.length - 1; //console.log(\">>>>>> Stored state...\",JSON.stringify(state.Navigate.history),\n    //\t    this.canUndo(state),this.canRedo(state),\n    //\t    state.Navigate.history.pos,state.Navigate.history.track.length);\n    //console.log(\">>>>> stored state.\",JSON.stringify(state.Path.keys));\n\n    this.refreshHistory(state);\n  };\n\n  this.refreshHistory = function (state) {\n    if (state.React.Config !== undefined) {\n      state.React.Config.show();\n    }\n\n    ;\n  };\n\n  this.canUndo = function (state) {\n    return state.Navigate.history.pos > 0;\n  };\n\n  this.canRedo = function (state) {\n    return state.Navigate.history.pos < state.Navigate.history.track.length - 1;\n  };\n\n  this.undo = function (state) {\n    //console.log(\">>>>>> Undo:\",this.canUndo(state));\n    if (this.canUndo(state)) {\n      state.Navigate.history.pos = state.Navigate.history.pos - 1;\n      var snapshot = state.Navigate.history.track[state.Navigate.history.pos]; //console.log(\"Setting snapshot:\",JSON.stringify(snapshot));\n\n      state.Path.setSnapshot(state, snapshot);\n      this.refreshHistory(state);\n      state.Show.show(state);\n    }\n\n    ;\n  };\n\n  this.redo = function (state) {\n    //console.log(\">>>>>> Redo:\",this.canRedo(state),state.Navigate.history.pos,JSON.stringify(state.Navigate.history.track));\n    if (this.canRedo(state)) {\n      state.Navigate.history.pos = state.Navigate.history.pos + 1;\n      var snapshot = state.Navigate.history.track[state.Navigate.history.pos]; //console.log(\"Setting snapshot:\",JSON.stringify(snapshot));\n\n      state.Path.setSnapshot(state, snapshot);\n      this.refreshHistory(state);\n      state.Show.show(state);\n    }\n  };\n\n  this.onClickTablePath = function (state, skey, tkey) {\n    var reload = false;\n    var sid = state.Path.keys.other.indexOf(skey);\n    var tid = state.Path.keys.other.indexOf(tkey); //console.log(\"Table path: Sid:\",sid,\" tid:\",tid,skey,tkey);\n\n    if (sid !== -1 && tid !== -1) {\n      if (sid > tid) {\n        var src = state.Path.keys.other.splice(sid, 1); // remove from path\n\n        var trg = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        state.Utils.pushKey(state.Path.keys.other, src, tid);\n        state.Utils.pushKey(state.Path.keys.other, trg, sid); //state.Utils.spliceArray(state.Path.keys.other,tid,0,src); // first position (table)\n        //state.Utils.spliceArray(state.Path.keys.other,sid,0,trg); // first position (table)\n\n        state.Path.exportAllKeys(state);\n        reload = true;\n      }\n    }\n\n    state.Html.setFootnote(state, \"Extracting data.\");\n    state.Html.setProgress(state, true);\n    state.Navigate.store(state);\n    state.Show.show(state, reload);\n  };\n\n  this.onClickRestValue = function (state, val, key, where) {\n    //console.log(\"onClickRestValue:\",val,key,JSON.stringify(state.Path.keys));\n    if (state.Path.selectTableKey(state, key, val, where, 1)) {\n      state.Html.setFootnote(state, \"Extracting data.\");\n      state.Html.setProgress(state, true);\n      state.Navigate.store(state);\n      state.Show.show(state);\n    }\n\n    ;\n    console.log(\"onClickRestValue done:\", val, key, JSON.stringify(state.Path.keys));\n  };\n\n  this.onClickPath = function (state, ttyp, tkey) {\n    var reload = false; // matrix changed?\n\n    var tid, tin, sin, src; //console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\n    if (ttyp === \"path\") {\n      // path -> table\n      tid = state.Path.keys.path.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.path.splice(tid, 1); // remove from path\n\n        state.Utils.pushKey(state.Path.keys.other, src, 2); //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\n        state.Path.cleanSelect(state);\n        state.Navigate.store(state);\n        reload = true;\n      }\n    } else if (ttyp === \"table\") {\n      // other -> table\n      tid = state.Path.keys.other.indexOf(tkey); //console.log(\"Tin:\",tin,\" tid:\",tid);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        state.Utils.pushKey(state.Path.keys.other, src, 0); //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\n        state.Path.exportAllKeys(state);\n        state.Navigate.store(state);\n        reload = true;\n      }\n    } else if (ttyp === \"rest\") {\n      // rest -> table\n      tid = state.Path.keys.other.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        state.Utils.pushKey(state.Path.trash, src); //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\n        state.Navigate.store(state);\n        reload = true;\n      }\n\n      ;\n    } else if (ttyp === \"trash\") {\n      console.log(\"Trashing start:\", JSON.stringify(state.Path.trash), tkey);\n      tid = state.Path.trash.indexOf(tkey);\n      tin = state.Path.keys.other.indexOf(tkey);\n      sin = state.Path.keys.path.indexOf(tkey);\n\n      if (tid !== -1) {\n        // trash => other\n        src = state.Path.trash.splice(tid, 1);\n        state.Utils.pushKey(state.Path.keys.other, src); //if ( tin === -1 ) {\n        //    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n        //};\n      } else if (sin !== -1 && tin === -1) {\n        // select => other\n        state.Utils.pushKey(state.Path.keys.other, tkey); //state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n      } else if (sin !== -1 && tin !== -1) {\n        // other => select\n        src = state.Path.keys.other.splice(tin, 1);\n      } else if (sin === -1 && tin !== -1) {\n        // other => trash\n        src = state.Path.keys.other.splice(tin, 1);\n        state.Utils.pushKey(state.Path.trash, src); //state.Path.trash=state.Path.trash.concat(src);            // last position\n      }\n\n      ;\n      state.Path.exportAllKeys(state);\n      state.Navigate.store(state); //console.log(\"Trashed:\",JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\n    }\n\n    state.Html.setFootnote(state, \"Extracting data.\");\n    state.Html.setProgress(state, true); //console.log(\"Showing:\",JSON.stringify(state.Path.other));\n\n    state.Show.show(state, reload);\n  };\n\n  this.switchTableKey = function (state, key) {\n    var tid = state.Path.keys.other.indexOf(key);\n\n    if (tid !== -1) {\n      var src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n      state.Path.keys.other = state.Path.keys.other.concat(src); // last position\n      //state.Utils.pushKey(state.Path.keys.other,src,0);       // first position\n      //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\n      state.Path.exportAllKeys(state);\n      var colkey = state.Path.getColKey(state);\n      var rowkey = state.Path.getRowKey(state);\n      state.Navigate.store(state);\n      var reload = src[0] !== colkey && src[0] !== rowkey; //console.log(\"Switched:\",JSON.stringify(src[0]),colkey,rowkey,reload);\n\n      state.Show.show(state, reload);\n    }\n  };\n\n  this.selectItem = function (state, colkey, rowkey, colval, rowval, colwhere, rowwhere, colcnt, rowcnt) {\n    //console.log(\"Selectitem:\",colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt);\n    //var colkey=state.Path.getColKey(state);\n    //var rowkey=state.Path.getRowKey(state);\n    var rank = state.Utils.cp(state.Path.keys.other); //console.log(\"SelectItem:\",colkey,\"=\",colval,\"  \",rowkey,\"=\",rowval);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      if (this.selectMapKey(state, colkey, colval, colwhere, colcnt)) {\n        this.rank[colkey] = state.Utils.cp(rank); //this.flip[colkey]=this.getFlip(state);\n\n        if (this.selectMapKey(state, rowkey, rowval, rowwhere, rowcnt)) {\n          this.rank[rowkey] = state.Utils.cp(rank); //this.last.flip[rowkey]=this.getFlip(state);\n        } //this.trash[colkey]=state.Path.checkTableKeys(state);\n        //console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\n      }\n\n      ; //console.log(\"Path:\",JSON.stringify(state.Path))\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      state.Html.setProgress(state, true);\n      state.Navigate.store(state);\n      state.Show.show(state);\n    } else {\n      var changed = false;\n\n      if (state.Path.selectTableKey(state, colkey, colval, colwhere, colcnt)) {\n        state.Path.exportAllKeys(state); //console.log(\"Selected:\",colkey,colval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\n        this.rank[colkey] = state.Utils.cp(rank);\n        changed = true;\n      } else {\n        console.log(\"Unable to select:\", colkey);\n      }\n\n      ;\n\n      if (state.Path.selectTableKey(state, rowkey, rowval, rowwhere, rowcnt)) {\n        state.Path.exportAllKeys(state); //console.log(\"Selected:\",rowkey,rowval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\n        this.rank[rowkey] = state.Utils.cp(rank);\n        changed = true;\n      } else {\n        console.log(\"Unable to select:\", rowkey);\n      }\n\n      if (changed) {\n        //this.trash[colkey]=state.Path.checkTableKeys(state);\n        //console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n        state.Html.setFootnote(state, \"Extracting data.\");\n        state.Html.setProgress(state, true);\n        state.Navigate.store(state);\n        state.Show.show(state);\n      } //console.log(\"Selectitem Done:\",rowwhere,colwhere);\n\n    }\n\n    ;\n  };\n\n  this.selectMapKey = function (state, key, val, where, cnt) {\n    // keep abscissa\n    //console.log(\"Table.Selecting:\",key,\"=\",val,\", where=\",where);\n    state.Path.select.val[key] = [val];\n    state.Path.where[key] = where;\n\n    if (state.Utils.missing(state.Path.keys.path, key)) {\n      //console.log(\"Adding to path:\",key);\n      state.Utils.pushKey(state.Path.keys.path, key); //state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n    }\n\n    ;\n    return true;\n  };\n\n  this.selectKey = function (state, key, val, where, cnt) {\n    var rank = state.Utils.cp(state.Path.keys.other); //console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n    //console.log(\"SelectKey:\",key,val,where,cnt);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      if (this.selectMapKey(state, key, val, where, cnt)) {\n        this.rank[key] = state.Utils.cp(rank);\n      }\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      state.Html.setProgress(state, true);\n      state.Navigate.store(state);\n      state.Show.show(state);\n    } else if (state.Path.selectTableKey(state, key, val, where, cnt)) {\n      this.rank[key] = rank; //this.trash[key]=state.Path.checkTableKeys(state);\n      //console.log(\"state.Path.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      state.Html.setProgress(state, true);\n      state.Navigate.store(state);\n      state.Show.show(state);\n    } else {\n      console.log(\"Unable to select:\", key);\n    } //console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n\n  };\n}\n\n;\nexport default Navigate;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/NavigateLib.js"],"names":["Navigate","history","pos","track","home","undefined","rank","trash","maxStore","reset","state","store","snapshot","Path","getSnapshot","length","old","JSON","stringify","console","log","keep","splice","push","refreshHistory","React","Config","show","canUndo","canRedo","undo","setSnapshot","Show","redo","onClickTablePath","skey","tkey","reload","sid","keys","other","indexOf","tid","src","trg","Utils","pushKey","exportAllKeys","Html","setFootnote","setProgress","onClickRestValue","val","key","where","selectTableKey","onClickPath","ttyp","tin","sin","path","cleanSelect","switchTableKey","concat","colkey","getColKey","rowkey","getRowKey","selectItem","colval","rowval","colwhere","rowwhere","colcnt","rowcnt","cp","getLayoutMode","code","layout","Map","selectMapKey","changed","cnt","select","missing","selectKey"],"mappings":"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","sourcesContent":["//console.log(\"Loading NavigateLib.js\");\n\nfunction Navigate() {\n    this.history={pos:0, // position of next snapshot\n\t\t  track:[]\n\t\t };\n    this.home=undefined;\n    this.rank={};          // key rank\n    this.trash={};          // key trash\n    this.maxStore=1000;       // max number of states stored\n    this.reset=function(state) { // store state\n\tstate.Navigate.history={pos:0,track:[]};\n\tthis.store(state);\n    };\n    this.store=function(state) { // store state\n\tvar snapshot=state.Path.getSnapshot(state)\n\tif (state.Navigate.history.track.length>0) {\n\t    var old=state.Navigate.history.track[state.Navigate.history.track.length-1];\n\t    if (JSON.stringify(snapshot)===JSON.stringify(old)) {\n\t\tconsole.log(\"Ignoring old image.\");\n\t\treturn false;\n\t    }\n\t}\n\t// remove old data...\n\tif (state.Navigate.history.track.length>state.Navigate.history.pos+1) {\n\t    var keep=state.Navigate.history.pos+1;\n\t    state.Navigate.history.track=state.Navigate.history.track.splice(-keep,keep);\n\t} else if (state.Navigate.history.track.length > this.maxStore) {\n\t    var keep=this.maxStore;\n\t   state.Navigate.history.track=state.Navigate.history.track.splice(-keep,keep);\n\t};\n\tstate.Navigate.history.track.push(snapshot);\n\tstate.Navigate.history.pos=state.Navigate.history.track.length-1;\n\t//console.log(\">>>>>> Stored state...\",JSON.stringify(state.Navigate.history),\n\t//\t    this.canUndo(state),this.canRedo(state),\n\t//\t    state.Navigate.history.pos,state.Navigate.history.track.length);\n\t//console.log(\">>>>> stored state.\",JSON.stringify(state.Path.keys));\n\tthis.refreshHistory(state);\n    };\n    this.refreshHistory=function(state) {\n\tif (state.React.Config !== undefined) {\n\t    state.React.Config.show();\n\t};\n    };\n    this.canUndo=function(state) {\n\treturn (state.Navigate.history.pos > 0);\n    };\n    this.canRedo=function(state) {\n\treturn (state.Navigate.history.pos < state.Navigate.history.track.length-1);\n    };\n    this.undo=function(state) {\n\t//console.log(\">>>>>> Undo:\",this.canUndo(state));\n\tif (this.canUndo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos-1;\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    //console.log(\"Setting snapshot:\",JSON.stringify(snapshot));\n\t    state.Path.setSnapshot(state,snapshot);\n\t    this.refreshHistory(state);\n\t    state.Show.show(state);\n\t};\n    };\n    this.redo=function(state) {\n\t//console.log(\">>>>>> Redo:\",this.canRedo(state),state.Navigate.history.pos,JSON.stringify(state.Navigate.history.track));\n\tif (this.canRedo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos+1;\t\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    //console.log(\"Setting snapshot:\",JSON.stringify(snapshot));\n\t    state.Path.setSnapshot(state,snapshot);\n\t    this.refreshHistory(state);\n\t    state.Show.show(state);\n\t}\n    };\n    this.onClickTablePath=function(state,skey,tkey) {\n\tvar reload=false;\n\tvar sid=state.Path.keys.other.indexOf(skey);\n\tvar tid=state.Path.keys.other.indexOf(tkey);\n\t//console.log(\"Table path: Sid:\",sid,\" tid:\",tid,skey,tkey);\n\tif (sid !== -1 && tid !== -1) {\n\t    if (sid > tid) {\n\t\tvar src=state.Path.keys.other.splice(sid, 1);                 // remove from path\n\t\tvar trg=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,tid);\n\t\tstate.Utils.pushKey(state.Path.keys.other,trg,sid);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,tid,0,src); // first position (table)\n\t\t//state.Utils.spliceArray(state.Path.keys.other,sid,0,trg); // first position (table)\n\t\tstate.Path.exportAllKeys(state);\n\t\treload=true;\n\t    }\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tstate.Html.setProgress(state, true);\n\tstate.Navigate.store(state);\n\tstate.Show.show(state,reload);\n    };\n    this.onClickRestValue=function(state,val,key,where) {\n\t//console.log(\"onClickRestValue:\",val,key,JSON.stringify(state.Path.keys));\n\tif (state.Path.selectTableKey(state,key,val,where,1)) {\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t};\n\tconsole.log(\"onClickRestValue done:\",val,key,JSON.stringify(state.Path.keys));\n    };\n    this.onClickPath=function(state,ttyp,tkey) {\n\tvar reload=false; // matrix changed?\n\tvar tid,tin,sin,src;\n\t//console.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\tif (ttyp  === \"path\") { // path -> table\n\t    tid=state.Path.keys.path.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.path.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,2);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Path.cleanSelect(state);\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    }\n\t} else if (ttyp  === \"table\") { // other -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    //console.log(\"Tin:\",tin,\" tid:\",tid);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.keys.other,src,0);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Path.exportAllKeys(state);\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    }\n\t} else if (ttyp === \"rest\") { // rest -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t\t//state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\tstate.Navigate.store(state);\n\t\treload=true;\n\t    };\n\t} else if (ttyp === \"trash\") {\n\t    console.log(\"Trashing start:\",JSON.stringify(state.Path.trash),tkey);\n\t    tid=state.Path.trash.indexOf(tkey);\n\t    tin=state.Path.keys.other.indexOf(tkey);\n\t    sin=state.Path.keys.path.indexOf(tkey);\n\t    if (tid !== -1) {                                             // trash => other\n\t\tsrc=state.Path.trash.splice(tid, 1);\n\t\tstate.Utils.pushKey(state.Path.keys.other,src);\n\t\t//if ( tin === -1 ) {\n\t\t//    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n\t\t//};\n\t    } else if (sin !== -1 && tin === -1) {                         // select => other\n\t\tstate.Utils.pushKey(state.Path.keys.other,tkey);\n\t\t//state.Path.keys.other=state.Path.keys.other.concat(tkey); // last position\n\t    } else if (sin !== -1 && tin !== -1) {                        // other => select\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t    } else if (sin === -1 && tin !== -1) {                        // other => trash\n\t\tsrc=state.Path.keys.other.splice(tin, 1);\n\t\tstate.Utils.pushKey(state.Path.trash,src);\n\t\t//state.Path.trash=state.Path.trash.concat(src);            // last position\n\t    };\n\t    state.Path.exportAllKeys(state);\n\t    state.Navigate.store(state);\n\t    //console.log(\"Trashed:\",JSON.stringify(state.Path.trash),JSON.stringify(state.Path.keys));\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tstate.Html.setProgress(state, true);\n\t//console.log(\"Showing:\",JSON.stringify(state.Path.other));\n\tstate.Show.show(state,reload);\n    };\n    this.switchTableKey=function(state,key) {\n\tvar tid=state.Path.keys.other.indexOf(key);\n\tif (tid !== -1) {\n\t    var src=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t    state.Path.keys.other=state.Path.keys.other.concat(src);  // last position\n\t    //state.Utils.pushKey(state.Path.keys.other,src,0);       // first position\n\t    //state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t    state.Path.exportAllKeys(state);\n\t    var colkey=state.Path.getColKey(state);\n\t    var rowkey=state.Path.getRowKey(state);\n\t    state.Navigate.store(state);\n\t    var reload=(src[0]!==colkey && src[0]!==rowkey);\n\t    //console.log(\"Switched:\",JSON.stringify(src[0]),colkey,rowkey,reload);\n\t    state.Show.show(state,reload);\n\t}\t\n    };\n    this.selectItem=function(state,colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt) {\n\t//console.log(\"Selectitem:\",colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt);\n\t//var colkey=state.Path.getColKey(state);\n\t//var rowkey=state.Path.getRowKey(state);\n\tvar rank=state.Utils.cp(state.Path.keys.other);\n\t//console.log(\"SelectItem:\",colkey,\"=\",colval,\"  \",rowkey,\"=\",rowval);\n\tif (state.Show.getLayoutMode(state)  === state.Show.code.layout.Map) {\n\t    if (this.selectMapKey(state,colkey,colval,colwhere,colcnt)) {\n\t\tthis.rank[colkey]=state.Utils.cp(rank);\n\t\t//this.flip[colkey]=this.getFlip(state);\n\t\tif (this.selectMapKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\t    this.rank[rowkey]=state.Utils.cp(rank);\n\t\t    //this.last.flip[rowkey]=this.getFlip(state);\n\t\t}\n\t\t//this.trash[colkey]=state.Path.checkTableKeys(state);\n\t\t//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t    };\n\t    //console.log(\"Path:\",JSON.stringify(state.Path))\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\t\n\t} else {\n\t    var changed=false;\n\t    if (state.Path.selectTableKey(state,colkey,colval,colwhere,colcnt)) {\n\t\tstate.Path.exportAllKeys(state);\n\t\t//console.log(\"Selected:\",colkey,colval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\t\tthis.rank[colkey]=state.Utils.cp(rank);\n\t\tchanged=true;\n\t    } else {\n\t\tconsole.log(\"Unable to select:\",colkey);\n\t    };\n\t    if (state.Path.selectTableKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\tstate.Path.exportAllKeys(state);\n\t\t//console.log(\"Selected:\",rowkey,rowval,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\t\tthis.rank[rowkey]=state.Utils.cp(rank);\n\t\tchanged=true;\n\t    } else {\n\t\tconsole.log(\"Unable to select:\",rowkey);\n\t    }\n\t    if (changed) {\n\t\t//this.trash[colkey]=state.Path.checkTableKeys(state);\n\t\t//console.log(\"state.Path.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t\tstate.Html.setFootnote(state,\"Extracting data.\");\n\t\tstate.Html.setProgress(state, true);\n\t\tstate.Navigate.store(state);\n\t\tstate.Show.show(state);\n\t    }\n\t    //console.log(\"Selectitem Done:\",rowwhere,colwhere);\n\t};\n    };\n    this.selectMapKey=function(state,key,val,where,cnt) { // keep abscissa\n\t//console.log(\"Table.Selecting:\",key,\"=\",val,\", where=\",where);\n\tstate.Path.select.val[key]=[val];\n\tstate.Path.where[key]=where;\n\tif (state.Utils.missing(state.Path.keys.path,key)) {\n\t    //console.log(\"Adding to path:\",key);\n\t    state.Utils.pushKey(state.Path.keys.path,key);\n\t    //state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n\t};\n\treturn true;\n    };\n    this.selectKey=function(state,key,val,where,cnt) {\n\tvar rank=state.Utils.cp(state.Path.keys.other);\n\t//console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n\t//console.log(\"SelectKey:\",key,val,where,cnt);\n\tif (state.Show.getLayoutMode(state)  === state.Show.code.layout.Map) {\n\t    if (this.selectMapKey(state,key,val,where,cnt)) {\n\t\tthis.rank[key]=state.Utils.cp(rank);\n\t    }\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t} else if (state.Path.selectTableKey(state,key,val,where,cnt)) {\n\t    this.rank[key]=rank;\n\t    //this.trash[key]=state.Path.checkTableKeys(state);\n\t    //console.log(\"state.Path.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    state.Html.setProgress(state, true);\n\t    state.Navigate.store(state);\n\t    state.Show.show(state);\n\t} else {\n\t    console.log(\"Unable to select:\",key);\n\t}\n\t//console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n    };\n};\nexport default Navigate;\n"]},"metadata":{},"sourceType":"module"}