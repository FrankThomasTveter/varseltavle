{"ast":null,"code":"//console.log(\"Loading PathLib.js\");\nfunction Path() {\n  this.keys = {\n    path: [],\n    other: [],\n    trash: []\n  };\n  this.other = {\n    table: [],\n    rest: []\n  };\n  this.trash = {\n    rest: [],\n    level: undefined\n  };\n  this.values = {};\n  this.select = {\n    val: {},\n    where: {},\n    cnt: {}\n  };\n  this.ignore = [\"max\", \"min\"];\n  this.type = {\n    path: {\n      ityp: -1,\n      ptyp: \"path\"\n    },\n    eye: {\n      ityp: 0,\n      ptyp: \"eye\"\n    },\n    table: {\n      ityp: 1,\n      ptyp: \"table\"\n    },\n    rest: {\n      ityp: 2,\n      ptyp: \"rest\"\n    },\n    trash: {\n      ityp: 3,\n      ptyp: \"trash\"\n    },\n    trashRest: {\n      ityp: 4,\n      ptyp: \"trashRest\"\n    },\n    row: {\n      ityp: 5,\n      ptyp: \"row\"\n    },\n    col: {\n      ityp: 6,\n      ptyp: \"col\"\n    },\n    item: {\n      ityp: 7,\n      ptyp: \"item\"\n    },\n    rotate: {\n      ityp: 8,\n      ptyp: \"rotate\"\n    }\n  };\n  this.order = undefined; // how to order data\t    \n\n  this.init = function (state) {\n    var par = \"Path\" + state.Utils.version;\n    state.Utils.init(par, this);\n  };\n\n  this.makePath = function (state) {\n    // note that not all keys are present in the data!\n    console.log(\"Entering makepath.\", JSON.stringify(this.keys));\n    var ii, key;\n    var pathSet = [];\n\n    if (this.keys.path === undefined) {\n      this.keys.path = [];\n    }\n\n    ;\n\n    if (this.keys.other === undefined) {\n      this.keys.other = [];\n    }\n\n    ;\n\n    if (this.keys.trash === undefined) {\n      this.keys.trash = [];\n    }\n\n    ;\n\n    if (this.keys.path.length > 0 || this.keys.other.length > 0 || this.keys.trash.length > 0) {\n      // remove duplicates\n      console.log(\"Filtering.\");\n      var olen;\n      this.keys.path = this.keys.path.filter(this.Unique);\n      this.keys.other = this.keys.other.filter(this.Unique);\n      this.keys.trash = this.keys.trash.filter(this.Unique); //console.log(\"setup:\",JSON.stringify(setup));\n\n      console.log(\"Remove invalid keys from path.\"); // remove invalid keys from path\n\n      var plen = this.keys.path.length;\n\n      for (ii = 0; ii < plen; ii++) {\n        key = this.keys.path[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.keys.path.splice(ii, 1);\n          ii = ii - 1;\n          plen = plen - 1;\n        }\n      }\n\n      console.log(\"Remove invalid keys from other.\"); // remove invalid keys from other\n\n      olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.other.rest.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      }\n\n      console.log(\"Remove invalid keys from trash.\"); // remove invalid keys from trash\n\n      olen = this.keys.trash.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.trash[ii];\n\n        if (state.Database.keyCnt[key] === undefined) {\n          this.trash.rest.splice(ii, 1);\n          ii = ii - 1;\n          olen = olen - 1;\n        }\n      }\n\n      console.log(\"Update trash with keys.\"); // we already have a path, update trash with new keys\n\n      for (key in state.Database.keyCnt) {\n        if (this.keys.path.indexOf(key) === -1 && this.keys.other.indexOf(key) === -1 && this.keys.trash.indexOf(key) === -1) {\n          pathSet[key] = \"trash\";\n          this.select.val[key] = \"\";\n          this.select.where[key] = \"\";\n          this.select.cnt[key] = 0;\n          this.keys.trash.push(key);\n        }\n      }\n    } else {\n      // new path...\n      console.log(\"New path\"); // ...define this.select.val for all keys in input data\n\n      for (key in state.Database.keyCnt) {\n        pathSet[key] = \"data\";\n      }\n\n      ;\n      this.keys.path = [];\n      this.other.table = [];\n      this.other.rest = [];\n      this.trash.rest = [];\n      this.trash.values = {};\n      this.select.val = {}; // no values are set so far\n\n      this.select.where = {};\n      this.select.cnt = {};\n      console.log(\"Copy default trash keys.\", JSON.stringify(state.Default.trash)); // copy default trash keys (that are used) to trash...\n\n      if (state.Default.trash !== undefined) {\n        var tlen = state.Default.trash.length;\n\n        for (ii = 0; ii < tlen; ii++) {\n          key = state.Default.trash[ii];\n\n          if (pathSet[key] !== undefined) {\n            if (state.Utils.missing(this.keys.trash, key)) {\n              this.keys.trash.push(key);\n            }\n\n            ;\n\n            if (state.Utils.missing(this.trash.rest, key)) {\n              this.trash.rest.push(key);\n            }\n\n            ;\n            pathSet[key] = undefined; // ignore key from now on...\n          }\n        } //console.log(\"Pathset:\",JSON.stringify(pathSet),JSON.stringify(state.Default.trash));\n\n      }\n\n      ;\n      console.log(\"Copy default other keys.\"); //console.log(\"Added trash:\",JSON.stringify(setup));\n      // copy default other keys (that are used) to other...\n\n      if (state.Default.other !== undefined) {\n        var klen = state.Default.other.length;\n\n        for (ii = 0; ii < klen; ii++) {\n          key = state.Default.other[ii];\n\n          if (pathSet[key] !== undefined) {\n            // key not present in input data\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ;\n            pathSet[key] = \"found\";\n          }\n        }\n      }\n\n      console.log(\"Add missing keys.\"); // add missing keys to path\n\n      for (key in state.Database.keyCnt) {\n        if (state.Utils.missing(this.keys.trash, key)) {\n          if (pathSet[key] === \"data\") {\n            if (state.Utils.missing(this.keys.other, key)) {\n              this.keys.other.push(key);\n            }\n\n            ; //console.log(\"Added key:\",key);\n\n            pathSet[key] = \"added\";\n          }\n        }\n\n        ;\n      }\n\n      ; // add undefined values in values\n      // for (key in state.Database.keyCnt) {\n      //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n      // \tstate.Database.values[key].push(undefined);\n      //     }\n      // }\n      // // sort sub-path according to count...\n      // this.keys.other=this.keys.other.sort(function(state,a, b) {\n      //     if (state.Database.values[a]  === undefined) {\n      // \treturn -1;\n      //     } else if (state.Database.values[b]  === undefined) {\n      // \treturn 1;\n      //     } else {\n      // \treturn state.Database.values[a].length - state.Database.values[b].length\n      //     }\n      // });\n\n      console.log(\"Push other keys to table and rest.\");\n      var glen = this.keys.other.length;\n\n      for (ii = 0; ii < glen; ii++) {\n        key = this.keys.other[ii];\n\n        if (ii < 2) {\n          this.other.table.push(key);\n        } else {\n          this.other.rest.push(key);\n        }\n      }\n    }\n\n    console.log(\"keys:\", JSON.stringify(state.Database.values)); //console.log(\"Completed makepath.\");\n  };\n\n  this.getIndex = function (state, trg) {\n    return this.keys.path.indexOf(trg);\n  };\n\n  this.exportAllKeys = function (state) {\n    // export keys from \"all\" to \"rest\"\n    this.other.table = [];\n    this.other.rest = [];\n    var jj = 0;\n    var key, ii;\n\n    if (this.keys.other !== undefined) {\n      var olen = this.keys.other.length;\n\n      for (ii = 0; ii < olen; ii++) {\n        key = this.keys.other[ii];\n\n        if (state.Matrix.keyCnt[key] !== undefined && state.Matrix.keyCnt[key] > 0) {\n          if (jj < 2) {\n            this.other.table.push(key);\n            jj = jj + 1;\n          } else {\n            this.other.rest.push(key);\n          }\n        }\n      }\n\n      ;\n    }\n\n    this.trash.rest = [];\n\n    if (this.keys.trash !== undefined) {\n      var tlen = this.keys.trash.length;\n\n      for (ii = 0; ii < tlen; ii++) {\n        key = this.keys.trash[ii];\n\n        if (this.ignore.indexOf(key) === -1) {\n          //if (state.Matrix.keyCnt[key] !== undefined) {\n          this.trash.rest.push(key);\n        }\n      }\n    }\n\n    ; //this.sortTableKeys(state);\n    //console.log(\"Exported:\",JSON.stringify(this.other));\n  }; // get X-priority, {colx,coly1,coly2...)\n\n\n  this.sortTableKeys = function (state) {\n    // make priority index\n    var arr = state.Utils.cp(this.other.table);\n    var pri = state.Layout.getPriorityIndex(state, arr); // sort the array according to priority\n\n    this.other.table = arr.sort(function (a, b) {\n      if (a === \"\") {\n        return 1;\n      } else if (b === \"\") {\n        return -1;\n      } else if (pri[a] < pri[b]) {\n        return 1;\n      } else if (pri[a] > pri[b]) {\n        return -1;\n      } else {\n        return 0;\n      }\n    }); //console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n    //\t\" Pri:\",JSON.stringify(state.Layout.priority),\n    //\t\" P:\",JSON.stringify(pri));\n\n    return;\n  };\n\n  this.keyVal = function (state, key) {\n    if (this.select.val[key] !== undefined && this.select.val[key] !== null && this.select.val[key] !== \"\") {\n      return this.select.val[key];\n    } else {\n      return;\n    }\n  };\n\n  this.keyValOk = function (state, val) {\n    var ok = true;\n\n    if (this.trash.level === undefined) {// no level threshold defined\n    } else if (state.Matrix.levCnt[val] === undefined) {\n      if (this.trash.level !== undefined) {\n        ok = false;\n        console.log(\"keyValOk -- no levcnt or level\", val);\n      }\n\n      ;\n    } else {\n      ok = false;\n\n      for (var lev in state.Matrix.levCnt[val]) {\n        if (this.trash.level === null && lev !== null) {\n          ok = true;\n        } else if (this.trash.level === -1 && lev !== null && lev !== -1) {\n          ok = true;\n        } else if (this.trash.level >= 0 && lev !== null && lev !== -1 && lev < this.trash.level) {\n          ok = true;\n        } //console.log(\"Checking \",val,lev,this.trash.level,\"=>\",ok);\n\n      }\n\n      if (!ok) {\n        console.log(\"keyValOk -- no valid level\", val, JSON.stringify(state.Matrix.levCnt[val]), this.trash.level);\n      }\n    }\n\n    return ok;\n  };\n\n  this.makeOrder = function (state, typ, order) {\n    // rearrange setup according to order...\n    if (order !== undefined) {\n      var buff = [];\n\n      for (var kk = 0; kk < order.length; kk++) {\n        if (order[kk] !== \"\") {\n          var sin = this.keys[typ].indexOf(order[kk]);\n\n          if (sin !== -1) {\n            var src = this.keys[typ].splice(sin, 1); // remove from path\n\n            buff = buff.concat(src);\n          }\n        }\n      }\n\n      state.Utils.spliceArray(this.keys[typ], 0, 0, buff);\n    }\n  };\n\n  this.moveKey = function (state, styp, skey, ttyp, tid) {\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, 1); // remove from path\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKeys = function (state, styp, skeys, ttyp, tid) {\n    var len = skeys.length;\n\n    for (var ss = 0; ss < len; ss++) {\n      var skey = skeys[ss];\n      var sid = this.keys[styp].indexOf(skey);\n\n      if (sid !== -1) {\n        var src = this.keys[styp].splice(sid, 1); // remove from path\n\n        if (tid === undefined || tid === -1) {\n          this.keys[ttyp] = this.keys[ttyp].concat(src); // last position\n        } else {\n          state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n        }\n      }\n    }\n  };\n\n  this.swapTableKey = function (state, skey, tkey) {\n    var sid = this.other.table.indexOf(skey);\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== sid && this.other.table.length > 1) {\n      var tin2 = this.keys.other.indexOf(this.other.table[1]);\n      var tkey2 = this.keys.other.splice(tin2, 1); // remove from array\n\n      state.Utils.spliceArray(this.keys.other, 0, 0, tkey2); //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.delTableKey = function (state, key) {\n    var secondkey;\n    var secondind;\n    var sid = this.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      var sin = this.other.table.indexOf(key);\n      var save = sin === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      this.pullKey(state, \"other\", key);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return sin;\n    }\n  };\n\n  this.moveTableKey = function (state, skey, ttyp, tid) {\n    var sid = this.keys.other.indexOf(skey);\n\n    if (sid !== -1) {\n      //var sin=\n      this.delTableKey(state, skey);\n\n      if (tid === undefined || tid === -1) {\n        this.keys[ttyp] = this.keys[ttyp].concat(skey); // last position\n      } else {\n        state.Utils.spliceArray(this.keys[ttyp], tid, 0, skey);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveKey2Table = function (state, styp, skey, tkey) {\n    //console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n    var tid = this.keys.other.indexOf(tkey);\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (tid !== -1 && sid !== -1 && skey !== tkey) {\n      // exists and is not the same\n      this.keys[styp][sid] = tkey;\n      this.keys.other[tid] = skey;\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash2Table = function (state, tkey) {\n    var secondkey;\n    var secondind;\n    var tid = this.other.table.indexOf(tkey);\n\n    if (tid !== -1) {\n      var save = tid === 0;\n\n      if (save) {\n        secondkey = this.other.table[1];\n        secondind = this.pullKey(state, \"other\", secondkey);\n      }\n\n      ;\n      var tin = this.keys.other.indexOf(tkey);\n      this.moveTrash(state, \"other\", tin + 1);\n\n      if (save && secondind !== undefined && secondind !== -1) {\n        this.pushKey(state, \"other\", secondkey, secondind);\n      }\n\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveTrash = function (state, ttyp, tin) {\n    state.Utils.spliceArray(this.keys[ttyp], tin, 0, this.keys.trash);\n    this.keys.trash = [];\n  };\n\n  this.moveAllKey = function (state, styp, skey, ttyp, tid) {\n    var lenp = this.keys[styp].length;\n    var sid = this.keys[styp].indexOf(skey);\n\n    if (sid !== -1) {\n      var src = this.keys[styp].splice(sid, lenp - sid);\n      state.Utils.spliceArray(this.keys[ttyp], tid, 0, src);\n      return true;\n    } else {\n      return false;\n    }\n  };\n\n  this.moveAllFirst = function (state, ttyp, tin) {\n    var tlen = this.keys[ttyp].length;\n    var src = this.keys[ttyp].splice(tin, tlen - tin);\n    state.Utils.spliceArray(this.keys[ttyp], 0, 0, src);\n  };\n\n  this.filterKeys = function (state, arr) {\n    var out = [];\n    var alen = arr.length;\n\n    for (var ii = 0; ii < alen; ii++) {\n      var val = arr[ii];\n\n      if (this.keyValOk(state, val)) {\n        out.push(val);\n      }\n    } //console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\n\n    return out;\n  };\n\n  this.pullArrayKey = function (state, array, key) {\n    var sin = array.indexOf(key);\n\n    if (sin !== -1) {\n      //var src=\n      array.splice(sin, 1); // remove from path\n    }\n\n    ;\n    return sin;\n  }; //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n\n\n  this.getColKey = function (state) {\n    if (state.Show.getLayoutMode(state) === state.Show.code.mMap) {\n      return \"_lon\";\n    } else {\n      return this.other.table[0];\n    }\n  };\n\n  this.getRowKey = function (state) {\n    if (state.Show.getLayoutMode(state) === state.Show.code.mMap) {\n      return \"_lat\";\n    } else {\n      return this.other.table[1];\n    }\n  };\n\n  this.pushKey = function (state, typ, key, ind) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n    }\n  };\n\n  this.pullKey = function (state, typ, key) {\n    var sin = this.keys[typ].indexOf(key);\n\n    if (sin !== -1) {\n      var src = this.keys[typ].splice(sin, 1); // remove from path\n\n      if (src !== key) {\n        console.log(\"System error:\", src, key);\n      }\n\n      return sin;\n    }\n\n    ;\n  };\n\n  this.pushColKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 0, 0, key);\n    }\n  };\n\n  this.pushRowKey = function (state, key) {\n    if (key !== undefined && key !== \"\") {\n      state.Utils.spliceArray(this.keys.other, 1, 0, key);\n    }\n  };\n\n  this.checkNewPath = function (state, styp, skey) {\n    // check if values are defined for path\n    var ok, ii;\n    var sid = this.keys.path.indexOf(skey);\n\n    if (styp === this.type.table.ptyp) {\n      ok = true;\n      var lent = this.other.table.length - 1;\n\n      if (sid !== undefined) {\n        lent = sid + 1;\n      }\n\n      ;\n\n      for (ii = 0; ii <= lent; ii++) {\n        var key = this.other.table[ii];\n\n        if (this.keyVal(state, key) === undefined) {\n          ok = false;\n        }\n      }\n    } else if (styp === this.type.rest.ptyp) {\n      ok = this.checkNewPath(state, this.type.table.ptyp);\n\n      if (ok) {\n        var lenr = this.other.rest.length - 1;\n\n        if (sid !== undefined) {\n          lenr = sid + 1;\n        }\n\n        ;\n\n        for (ii = 0; ii <= lenr; ii++) {\n          key = this.other.rest[ii];\n\n          if (this.keyVal(state, key) === undefined) {\n            ok = false;\n          }\n        }\n      }\n    }\n\n    return ok;\n  }; //values[key]=values[key].filter(this.Unique);\n\n\n  this.Unique = function (value, index, self) {\n    return self.indexOf(value) === index;\n  };\n}\n\n;\nexport default Path;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/PathLib.js"],"names":["Path","keys","path","other","trash","table","rest","level","undefined","values","select","val","where","cnt","ignore","type","ityp","ptyp","eye","trashRest","row","col","item","rotate","order","init","state","par","Utils","version","makePath","console","log","JSON","stringify","ii","key","pathSet","length","olen","filter","Unique","plen","Database","keyCnt","splice","indexOf","push","Default","tlen","missing","klen","glen","getIndex","trg","exportAllKeys","jj","Matrix","sortTableKeys","arr","cp","pri","Layout","getPriorityIndex","sort","a","b","keyVal","keyValOk","ok","levCnt","lev","makeOrder","typ","buff","kk","sin","src","concat","spliceArray","moveKey","styp","skey","ttyp","tid","sid","moveKeys","skeys","len","ss","swapTableKey","tkey","tin2","tkey2","delTableKey","secondkey","secondind","save","pullKey","pushKey","moveTableKey","moveKey2Table","moveTrash2Table","tin","moveTrash","moveAllKey","lenp","moveAllFirst","filterKeys","out","alen","pullArrayKey","array","getColKey","Show","getLayoutMode","code","mMap","getRowKey","ind","pushColKey","pushRowKey","checkNewPath","lent","lenr","value","index","self"],"mappings":"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","sourcesContent":["//console.log(\"Loading PathLib.js\");\n\nfunction Path() {\n    this.keys={path:[],\n\t       other:[],\n\t       trash:[]\n\t      };\n    this.other={table:[],\n\t\trest:[]\n\t       };\n    this.trash={rest:[],\n\t\tlevel:undefined\n\t       };\n    this.values={};\n    this.select={val:{},where:{},cnt:{}};\n    this.ignore=[\"max\",\"min\"];\n    this.type = {\n\tpath :      {ityp:-1,ptyp:\"path\"},\n\teye :       {ityp:0, ptyp:\"eye\"},\n\ttable :     {ityp:1, ptyp:\"table\"},\n\trest :      {ityp:2, ptyp:\"rest\"},\n\ttrash :     {ityp:3, ptyp:\"trash\"},\n\ttrashRest : {ityp:4, ptyp:\"trashRest\"},\n\trow :       {ityp:5, ptyp:\"row\"},\n\tcol :       {ityp:6, ptyp:\"col\"},\n\titem :      {ityp:7, ptyp:\"item\"},\n\trotate :    {ityp:8, ptyp:\"rotate\"}\n    };\n    this.order=undefined; // how to order data\t    \n    this.init=function(state){\n\tvar par=\"Path\"+state.Utils.version;\n\tstate.Utils.init(par,this);\n    };\n    this.makePath=function(state) { // note that not all keys are present in the data!\n\tconsole.log(\"Entering makepath.\",JSON.stringify(this.keys));\n\tvar ii,key;\n\tvar pathSet=[];\n\tif (this.keys.path === undefined) {this.keys.path=[];};\n\tif (this.keys.other === undefined) {this.keys.other=[];};\n\tif (this.keys.trash === undefined) {this.keys.trash=[];};\n\tif (this.keys.path.length > 0 ||\n\t    this.keys.other.length > 0 ||\n\t    this.keys.trash.length > 0) {\n\t    // remove duplicates\n\t    console.log(\"Filtering.\");\n\t    var olen;\n\t    this.keys.path=this.keys.path.filter(this.Unique);\n\t    this.keys.other=this.keys.other.filter(this.Unique);\n\t    this.keys.trash=this.keys.trash.filter(this.Unique);\n\t    //console.log(\"setup:\",JSON.stringify(setup));\n\t    console.log(\"Remove invalid keys from path.\");\n\t    // remove invalid keys from path\n\t    var plen = this.keys.path.length;\n\t    for (ii = 0; ii < plen; ii++) {\n\t\tkey=this.keys.path[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.keys.path.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    plen=plen-1;\n\t\t}\n\t    }\n\t    console.log(\"Remove invalid keys from other.\");\n\t    // remove invalid keys from other\n\t    olen = this.keys.other.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.other.rest.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    console.log(\"Remove invalid keys from trash.\");\n\t    // remove invalid keys from trash\n\t    olen = this.keys.trash.length;\n\t    for (ii = 0; ii < olen; ii++) {\n\t\tkey=this.keys.trash[ii];\n\t\tif (state.Database.keyCnt[key]  === undefined) {\n\t\t    this.trash.rest.splice(ii, 1);\n\t\t    ii=ii-1;\n\t\t    olen=olen-1;\n\t\t}\n\t    }\n\t    console.log(\"Update trash with keys.\");\n\t    // we already have a path, update trash with new keys\n\t    for (key in state.Database.keyCnt) {\n\t\tif (this.keys.path.indexOf(key)  === -1 && \n\t\t    this.keys.other.indexOf(key)  === -1 && \n\t\t    this.keys.trash.indexOf(key)  === -1) {\n\t\t    pathSet[key]=\"trash\";\n\t\t    this.select.val[key]=\"\";\n\t\t    this.select.where[key]=\"\";\n\t\t    this.select.cnt[key]=0;\n\t\t    this.keys.trash.push(key);\n\t\t}\n\t    }\n\t} else {\n\t    // new path...\n\t    console.log(\"New path\");\n\t    // ...define this.select.val for all keys in input data\n\t    for (key in state.Database.keyCnt) {\n\t\tpathSet[key]=\"data\";\n\t    };\n\t    this.keys.path=[];\n\t    this.other.table=[]\n\t    this.other.rest=[]\n\t    this.trash.rest=[];\n\t    this.trash.values={};\n\t    this.select.val={}; // no values are set so far\n\t    this.select.where={}\n\t    this.select.cnt={}\n\t    console.log(\"Copy default trash keys.\",JSON.stringify(state.Default.trash));\n\t    // copy default trash keys (that are used) to trash...\n\t    if (state.Default.trash !== undefined) {\n\t\tvar tlen = state.Default.trash.length;\n\t\tfor (ii = 0; ii < tlen; ii++) {\n\t\t    key=state.Default.trash[ii];\n\t\t    if (pathSet[key] !== undefined) {\n\t\t\tif (state.Utils.missing(this.keys.trash,key)) { \n\t\t\t    this.keys.trash.push(key);\n\t\t\t};\n\t\t\tif (state.Utils.missing(this.trash.rest,key)) {\n\t\t\t    this.trash.rest.push(key);\n\t\t\t};\n\t\t\tpathSet[key]=undefined; // ignore key from now on...\n\t\t    }\n\t\t}\n\t\t//console.log(\"Pathset:\",JSON.stringify(pathSet),JSON.stringify(state.Default.trash));\n\t    };\n\t    console.log(\"Copy default other keys.\");\n\t    //console.log(\"Added trash:\",JSON.stringify(setup));\n\t    // copy default other keys (that are used) to other...\n\t    if (state.Default.other !== undefined) {\n\t\tvar klen = state.Default.other.length;\n\t\tfor (ii = 0; ii < klen; ii++) {\n\t\t    key=state.Default.other[ii];\n\t\t    if (pathSet[key] !== undefined) { // key not present in input data\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\tpathSet[key]=\"found\";\n\t\t    }\n\t\t}\n\t    }\n\t    console.log(\"Add missing keys.\");\n\t    // add missing keys to path\n\t    for (key in state.Database.keyCnt) {\n\t\tif (state.Utils.missing(this.keys.trash,key)) {\n\t\t    if (pathSet[key] === \"data\") {\n\t\t\tif (state.Utils.missing(this.keys.other,key)) {\n\t\t\t    this.keys.other.push(key);\n\t\t\t};\n\t\t\t//console.log(\"Added key:\",key);\n\t\t\tpathSet[key] = \"added\";\n\t\t    }\n\t\t};\n\t    };\n\t    // add undefined values in values\n\t    // for (key in state.Database.keyCnt) {\n\t    //     if (state.Database.keyCnt[key].cnt<state.Database.cnt) {\n\t    // \tstate.Database.values[key].push(undefined);\n\t    //     }\n\t    // }\n\t    // // sort sub-path according to count...\n\t    // this.keys.other=this.keys.other.sort(function(state,a, b) {\n\t    //     if (state.Database.values[a]  === undefined) {\n\t    // \treturn -1;\n\t    //     } else if (state.Database.values[b]  === undefined) {\n\t    // \treturn 1;\n\t    //     } else {\n\t    // \treturn state.Database.values[a].length - state.Database.values[b].length\n\t    //     }\n\t    // });\n\t    console.log(\"Push other keys to table and rest.\");\n\t    var glen = this.keys.other.length;\n\t    for (ii = 0; ii < glen; ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (ii<2) {\n\t\t    this.other.table.push(key);\n\t\t} else {\n\t\t    this.other.rest.push(key);\n\t\t}\n\t    }\n\t}\n\tconsole.log(\"keys:\",JSON.stringify(state.Database.values));\n\t//console.log(\"Completed makepath.\");\n    };\n    this.getIndex=function(state,trg) {\n\treturn this.keys.path.indexOf(trg);\n    };\n    this.exportAllKeys=function(state) { // export keys from \"all\" to \"rest\"\n\tthis.other.table=[];\n\tthis.other.rest=[];\n\tvar jj=0;\n\tvar key,ii;\n\tif (this.keys.other !== undefined) {\n\t    var olen=this.keys.other.length;\n\t    for (ii=0;ii<olen;ii++) {\n\t\tkey=this.keys.other[ii];\n\t\tif (state.Matrix.keyCnt[key] !== undefined &&\n\t\t    state.Matrix.keyCnt[key] > 0) {\n\t\t    if (jj < 2) {\n\t\t\tthis.other.table.push(key);\n\t\t\tjj=jj+1;\n\t\t    } else {\n\t\t\tthis.other.rest.push(key);\n\t\t    }\n\t\t}\n\t    };\n\t}\n\tthis.trash.rest=[];\n\tif (this.keys.trash !== undefined) {\n\t    var tlen=this.keys.trash.length;\n\t    for (ii=0;ii<tlen;ii++) {\n\t\tkey=this.keys.trash[ii];\n\t\tif (this.ignore.indexOf(key) === -1) {\n\t\t    //if (state.Matrix.keyCnt[key] !== undefined) {\n\t\t    this.trash.rest.push(key);\n\t\t}\n\t    }\n\t};\n\t//this.sortTableKeys(state);\n\t//console.log(\"Exported:\",JSON.stringify(this.other));\n    }\n\n    // get X-priority, {colx,coly1,coly2...)\n    this.sortTableKeys=function(state){\n\t// make priority index\n\tvar arr=state.Utils.cp(this.other.table);\n\tvar pri=state.Layout.getPriorityIndex(state,arr);\n\t// sort the array according to priority\n\tthis.other.table=arr.sort(function(a,b){\n\t    if (a  === \"\") { \n\t\treturn 1;\n\t    } else if (b  === \"\") {\n\t\treturn -1;\n\t    } else if (pri[a]<pri[b]) { \n\t\treturn 1;\n\t    } else if (pri[a]>pri[b]) {\n\t\treturn -1;\n\t    } else {\n\t\treturn 0;\n\t    }\n\t});\n\t//console.log(\"TableKeys:\",JSON.stringify(this.other.table),\n\t//\t\" Pri:\",JSON.stringify(state.Layout.priority),\n\t//\t\" P:\",JSON.stringify(pri));\n\treturn\n    };\n    this.keyVal=function(state,key) {\n\tif (this.select.val[key] !== undefined &&\n\t    this.select.val[key] !== null &&\n\t    this.select.val[key] !== \"\") {\n\t    return this.select.val[key];\n\t} else {\n\t    return;\n\t}\n    }    \n    \n    this.keyValOk=function(state,val) {\n\tvar ok=true;\n\tif (this.trash.level === undefined) { // no level threshold defined\n\t} else if (state.Matrix.levCnt[val]  === undefined) {\n\t    if (this.trash.level !== undefined) {\n\t\tok=false;\n\t\tconsole.log(\"keyValOk -- no levcnt or level\",val);\n\t    };\n\t} else {\n\t    ok=false;\n\t    for (var lev in state.Matrix.levCnt[val]) {\n\t\tif (this.trash.level  === null && lev !== null) {\n\t\t    ok=true;\n\t\t} else if (this.trash.level  === -1 && (lev !== null && lev !== -1)) {\n\t\t    ok=true;\n\t\t} else if (this.trash.level >= 0 && (lev !== null && lev !== -1 && lev < this.trash.level )) {\n\t\t    ok=true;\n\t\t}\n\t\t//console.log(\"Checking \",val,lev,this.trash.level,\"=>\",ok);\n\t    }\n\t    if (! ok) {\n\t\tconsole.log(\"keyValOk -- no valid level\",val,JSON.stringify(state.Matrix.levCnt[val]),this.trash.level);\n\t    }\n\t}\n\treturn ok;\n    };\n    this.makeOrder=function(state,typ,order) { // rearrange setup according to order...\n\tif (order !== undefined) {\n\t    var buff=[];\n\t    for (var kk=0; kk < order.length ;kk++){\n\t\tif (order[kk] !== \"\") {\n\t\t    var sin=this.keys[typ].indexOf(order[kk]);\n\t\t    if (sin !== -1) {\n\t\t\tvar src=this.keys[typ].splice(sin, 1); // remove from path\n\t\t\tbuff=buff.concat(src);\n\t\t    }\n\t\t}\n\t    }\n\t    state.Utils.spliceArray(this.keys[typ],0,0,buff);\n\t}\n    };\n    this.moveKey=function(state,styp,skey,ttyp,tid) {\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid, 1);    // remove from path\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKeys=function(state,styp,skeys,ttyp,tid) {\n\tvar len=skeys.length\n\tfor (var ss=0;ss<len;ss++) {\n\t    var skey=skeys[ss];\n\t    var sid=this.keys[styp].indexOf(skey);\n\t    if (sid !== -1) {\n\t\tvar src=this.keys[styp].splice(sid, 1);    // remove from path\n\t\tif (tid  === undefined || tid  === -1) {\n\t\t    this.keys[ttyp]=this.keys[ttyp].concat(src);         // last position\n\t\t} else {\n\t\t    state.Utils.spliceArray(this.keys[ttyp],tid, 0, src);\n\t\t}\n\t    }\n\t}\n    };\n    this.swapTableKey=function(state,skey,tkey) {\n\tvar sid=this.other.table.indexOf(skey);\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== sid && this.other.table.length > 1) {\n\t    var tin2=this.keys.other.indexOf(this.other.table[1]);\n\t    var tkey2=this.keys.other.splice(tin2, 1);    // remove from array\n\t    state.Utils.spliceArray(this.keys.other,0, 0, tkey2);\n\t    //console.log(\"Swapped:\",tkey2,tkey,JSON.stringify(this.keys.other));\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.delTableKey=function(state,key) {\n\tvar secondkey;\n\tvar secondind;\n\tvar sid=this.keys.other.indexOf(key);\n\tif (sid !== -1) {\n\t    var sin=this.other.table.indexOf(key);\n\t    var save=(sin  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    }\n\t    this.pullKey(state,\"other\",key);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return sin;\n\t}\n    };\n    this.moveTableKey=function(state,skey,ttyp,tid) {\n\tvar sid=this.keys.other.indexOf(skey);\n\tif (sid !== -1) {\n\t    //var sin=\n\t    this.delTableKey(state,skey);\n\t    if (tid  === undefined || tid  === -1) {\n\t\tthis.keys[ttyp]=this.keys[ttyp].concat(skey);         // last position\n\t    } else {\n\t\tstate.Utils.spliceArray(this.keys[ttyp],tid, 0, skey);\n\t    }\n\t    return true;\n\t}else {\n\t    return false;\n\t}\n    };\n    this.moveKey2Table=function(state,styp,skey,tkey) {\n\t//console.log(\"MoveKey2Table:\",JSON.stringify(this.keys));\n\tvar tid=this.keys.other.indexOf(tkey);\n\tvar sid=this.keys[styp].indexOf(skey)\n\tif (tid !== -1 && sid !== -1 && skey !== tkey) { // exists and is not the same\n\t    this.keys[styp][sid]=tkey\n\t    this.keys.other[tid]=skey\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash2Table=function(state,tkey) {\n\tvar secondkey;\n\tvar secondind;\n\tvar tid=this.other.table.indexOf(tkey);\n\tif (tid !== -1) {\n\t    var save=(tid  === 0);\n\t    if (save) {\n\t\tsecondkey=this.other.table[1];\n\t\tsecondind=this.pullKey(state,\"other\",secondkey);\n\t    };\n\t    var tin=this.keys.other.indexOf(tkey);\n\t    this.moveTrash(state,\"other\",tin+1);\n\t    if (save && secondind !== undefined && secondind !== -1) {\n\t\tthis.pushKey(state,\"other\",secondkey,secondind);\n\t    }\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveTrash=function(state,ttyp,tin) {\n\tstate.Utils.spliceArray(this.keys[ttyp],tin, 0, this.keys.trash);\n\tthis.keys.trash=[];\n    };\n    this.moveAllKey=function(state,styp,skey,ttyp,tid) {\n\tvar lenp=this.keys[styp].length;\n\tvar sid=this.keys[styp].indexOf(skey);\n\tif (sid !== -1) {\n\t    var src=this.keys[styp].splice(sid,lenp-sid);\n\t    state.Utils.spliceArray(this.keys[ttyp],tid,0,src);\n\t    return true;\n\t} else {\n\t    return false;\n\t}\n    };\n    this.moveAllFirst=function(state,ttyp,tin) {\n\tvar tlen=this.keys[ttyp].length;\n\tvar src=this.keys[ttyp].splice(tin,tlen-tin);\n\tstate.Utils.spliceArray(this.keys[ttyp],0, 0,src);\n    };\n    this.filterKeys=function(state,arr) {\n\tvar out=[];\n\tvar alen=arr.length;\n\tfor(var ii=0; ii<alen; ii++) {\n\t    var val=arr[ii];\n\t    if (this.keyValOk(state,val)) {\n\t\tout.push(val);\n\t    }\n\t}\n\t//console.log(\"CheckOk \",JSON.stringify(arr),\"->\",JSON.stringify(out));\n\treturn out;\n    };\n    this.pullArrayKey=function(state,array,key) {\n\tvar sin=array.indexOf(key);\n\tif (sin !== -1) {\n\t    //var src=\n\t    array.splice(sin, 1);    // remove from path\n\t};\n\treturn sin;\n    };\n    //////////////////////////////// COL/ROW FUNCTIONS ///////////////////////\n    this.getColKey=function(state) {\n\tif (state.Show.getLayoutMode(state) === state.Show.code.mMap) {\n\t    return \"_lon\";\n\t} else {\n\t    return this.other.table[0];\n\t}\n    };\n    this.getRowKey=function(state) {\n\tif (state.Show.getLayoutMode(state) === state.Show.code.mMap) {\n\t    return \"_lat\";\n\t} else {\n\t    return this.other.table[1];\n\t}\n    };\n    this.pushKey=function(state,typ,key,ind) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys[typ], ind, 0, key);\n\t}\n    };\n    this.pullKey=function(state,typ,key) {\n\tvar sin=this.keys[typ].indexOf(key);\n\tif (sin !== -1) {\n\t    var src=this.keys[typ].splice(sin, 1);    // remove from path\n\t    if (src !== key) {console.log(\"System error:\",src,key);}\n\t    return sin;\n\t};\n    };\n    this.pushColKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,0, 0, key);\n\t}\n    };\n    this.pushRowKey=function(state,key) {\n\tif (key !== undefined && key !== \"\") {\n\t    state.Utils.spliceArray(this.keys.other,1, 0, key);\n\t}\n    };\n    this.checkNewPath=function(state,styp,skey) { // check if values are defined for path\n\tvar ok,ii;\n\tvar sid=this.keys.path.indexOf(skey);\n\tif (styp  === this.type.table.ptyp) {\n\t    ok=true;\n\t    var lent=this.other.table.length-1;\n\t    if (sid !== undefined) {lent=sid+1;};\n\t    for (ii = 0; ii <= lent; ii++) {\n\t\tvar key=this.other.table[ii];\n\t\tif (this.keyVal(state,key)  === undefined) {\n\t\t    ok=false;\n\t\t}\n\t    }\n\t} else if (styp  === this.type.rest.ptyp) {\n\t    ok=this.checkNewPath(state,this.type.table.ptyp);\n\t    if (ok) {\n\t\tvar lenr=this.other.rest.length-1;\n\t\tif (sid !== undefined) {lenr=sid+1;};\n\t\tfor (ii = 0; ii <= lenr; ii++) {\n\t\t    key=this.other.rest[ii];\n\t\t    if (this.keyVal(state,key)  === undefined) {\n\t\t\tok=false;\n\t\t    }\n\t\t}\n\t    }\n\t}\n\treturn ok;\n    };\n    //values[key]=values[key].filter(this.Unique);\n    this.Unique=function(value, index, self) { \n\treturn self.indexOf(value)  === index;\n    }\n};\nexport default Path;\n"]},"metadata":{},"sourceType":"module"}