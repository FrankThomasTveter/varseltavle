{"ast":null,"code":"import _objectWithoutProperties from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _classCallCheck from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{withStyles}from'@material-ui/core/styles';var styles=function styles(theme){return{canvas:{width:\"100%\",height:\"100%\",overflow:\"hidden\",margin:\"0px\",padding:\"0px\",border:\"0px\"},pointer:{cursor:\"pointer\",padding:theme.spacing.unit*0},nopointer:{padding:theme.spacing.unit*0},div:{}};};function drawThresholds(state,elements,colkey,colvalue,range,plan,level,ctx,height,offset,dwidth){//console.log(\"Canvas:\",xmin,dx);\nvar elen=elements.length;//var maxlev=-1;\n//var minlev=0;\nvar min=range[0];var max=range[1];var ee;// determine cnt, number of elements for this colvalue\nvar cnt=0;for(ee=0;ee<elen;ee++){// loop over elements\nvar el=elements[ee];var docs=el.docs;var dlen=docs.length;for(var jj=0;jj<dlen;jj++){// loop over segments in each element\nvar d=docs[jj];var thr=d._thr;if(colvalue===\"\"||d[colkey]===colvalue){var vals;// array of thresholds\nif(thr.min!==undefined&&thr.val!==undefined){vals=thr.min;}if(thr.max!==undefined&&thr.val!==undefined){vals=thr.max;}if(vals!==undefined){var vlen=vals.length;for(var ll=0;ll<vlen;ll++){var tyval=vals[ll];var tzval=state.Show.scale(tyval,min,max,height,0);var scolor=undefined;if(ll===level){scolor=state.Colors.getLevelFgColor(ll);}else{scolor=state.Colors.getLevelBgColor(ll);};var xmin=offset+cnt*dwidth;var xmax=offset+(cnt+1)*dwidth;ctx.beginPath();ctx.lineWidth=1;if(scolor!==undefined){ctx.strokeStyle=scolor;}ctx.moveTo(xmin,tzval);ctx.lineTo(xmax,tzval);ctx.stroke();//console.log(\"Stroke color:\",sbgcolor,ll,tzval,cnv.width);\n}};if(thr.val!==undefined){cnt=cnt+1;}};};};};function drawData(state,elements,colkey,colvalue,range,plan,level,ctx,height,offset,dwidth){//console.log(\"Canvas:\",xmin,dx);\nvar elen=elements.length;var maxlev=-1;var minlev=0;var min=range[0];var max=range[1];var ee;// determine cnt, number of elements for this colvalue\nvar cnt=0;for(ee=0;ee<elen;ee++){// loop over elements\nvar el=elements[ee];var docs=el.docs;var dlen=docs.length;for(var jj=0;jj<dlen;jj++){// loop over segments in each element\nvar d=docs[jj];var thr=d._thr;if(colvalue===\"\"||d[colkey]===colvalue){//var vals;\n//console.log(\"Making canvas:\",ii,colvalues[ii],color,JSON.stringify(d),\n//\t    \" Thr=\",JSON.stringify(t),width,height,JSON.stringify(range));\n//console.log(\"CanvasGraph:\",ii,jj,d.dtg,color,el.maxlev,JSON.stringify(t));\nvar ymin=min;if(thr.min!==undefined&&thr.val!==undefined){ymin=thr.val;}var ymax=max;if(thr.max!==undefined&&thr.val!==undefined){ymax=thr.val;}var xmin=offset+cnt*dwidth;var xmax=offset+(cnt+1)*dwidth;var zmin=state.Show.scale(ymin,min,max,height,0);var zmax=state.Show.scale(ymax,min,max,height,0);//console.log(\"Fill:\",xmin,xmax,zmin,zmax,ymin,ymax,min,max,height);\n//console.log(\"Fill:\",xmin,xmax,zmin,(zmax-zmin),height,color);\n//ctx.fillStyle=\"cornflowerblue\";\nvar lev=state.Threshold.getLevel(state,d);var col=state.Colors.getLevelFgColor(lev);if(col!==undefined){if(thr.level===undefined){//  || Math.random() > 0.8\nconsole.log(\"Found undefined:\",JSON.stringify(d));minlev=Math.min(minlev,-2);}else{maxlev=Math.max(maxlev,thr.level);minlev=Math.min(minlev,thr.level);};var dx=Math.max(1,xmax-xmin);var dz=zmax-zmin;ctx.strokeStyle=col;ctx.strokeRect(xmin,zmin,dx,dz);}else{minlev=Math.min(minlev,-2);}if(thr.val!==undefined){cnt=cnt+1;};}}};if(minlev<0){return minlev;}else{return maxlev;}};function drawMarker(ctx,height,offset,width){ctx.strokeStyle='blue';ctx.beginPath();ctx.moveTo(offset,0);ctx.lineTo(offset+width,height);ctx.moveTo(offset+width,0);ctx.lineTo(offset,height);ctx.strokeRect(offset,0,offset+width,height);ctx.stroke();};function updateCanvas(item){var _item$props=item.props,state=_item$props.state,elements=_item$props.elements,colkey=_item$props.colkey,colvalues=_item$props.colvalues,index=_item$props.index,range=_item$props.range,plan=_item$props.plan,level=_item$props.level;var cnv=item.refs.canvas;// canvas\nvar ctx=cnv.getContext('2d');// context\n//console.log(\"Canvas:\",cnv.width,cnv.height);\n//console.log(\"Canvas matrix:\",JSON.stringify(state.React.matrix));\nctx.clearRect(0,0,cnv.width,cnv.height);//var elen=elements.length;\nvar clen=1;if(colvalues!==undefined){clen=colvalues.length;};// number of columns\nvar step=plan.step;var height=cnv.height;var width=cnv.width/Math.max(1,step);// width of graph segment\nvar minlev=0;if(range!==undefined){// loop over column segments...\n//console.log(\"Segments:\",index,clen);\nfor(var ii=index;ii<Math.min(index+step,clen);ii++){// loop over segments\nvar tot=state.Utils.cntDocs(elements,colkey,colvalues[ii]);//console.log(\"Canvas:\",ii,index,\" val=\",colvalues[ii],\" tot=\",tot,\" key=\",colkey,JSON.stringify(elements));\nvar offset=(ii-index)*width;// width/10;\nvar dwidth=width/Math.max(1,tot);drawThresholds(state,elements,colkey,colvalues[ii],range,plan,level,ctx,height,offset,dwidth);var lev=drawData(state,elements,colkey,colvalues[ii],range,plan,level,ctx,height,offset,dwidth);minlev=Math.min(minlev,lev);}}else{minlev=-2;};if(minlev<0){drawMarker(ctx,height,0,width);}};var CanvasGraphComponent=/*#__PURE__*/function(_React$Component){_inherits(CanvasGraphComponent,_React$Component);function CanvasGraphComponent(){_classCallCheck(this,CanvasGraphComponent);return _possibleConstructorReturn(this,_getPrototypeOf(CanvasGraphComponent).apply(this,arguments));}_createClass(CanvasGraphComponent,[{key:\"componentDidMount\",value:function componentDidMount(){updateCanvas(this);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){updateCanvas(this);}},{key:\"render\",value:function render(){var _this$props=this.props,classes=_this$props.classes,onclick=_this$props.onclick,title=_this$props.title,plan=_this$props.plan,other=_objectWithoutProperties(_this$props,[\"classes\",\"onclick\",\"title\",\"plan\"]);return React.createElement(\"canvas\",Object.assign({},other,{className:classes.canvas,classes:classes,onClick:onclick,title:title,plan:plan,width:plan.width,height:plan.height,ref:\"canvas\"}));}}]);return CanvasGraphComponent;}(React.Component);// width={plan.width} height={plan.height}\nexport default withStyles(styles)(CanvasGraphComponent);","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/react/CanvasGraphComponent.js"],"names":["React","withStyles","styles","theme","canvas","width","height","overflow","margin","padding","border","pointer","cursor","spacing","unit","nopointer","div","drawThresholds","state","elements","colkey","colvalue","range","plan","level","ctx","offset","dwidth","elen","length","min","max","ee","cnt","el","docs","dlen","jj","d","thr","_thr","vals","undefined","val","vlen","ll","tyval","tzval","Show","scale","scolor","Colors","getLevelFgColor","getLevelBgColor","xmin","xmax","beginPath","lineWidth","strokeStyle","moveTo","lineTo","stroke","drawData","maxlev","minlev","ymin","ymax","zmin","zmax","lev","Threshold","getLevel","col","console","log","JSON","stringify","Math","dx","dz","strokeRect","drawMarker","updateCanvas","item","props","colvalues","index","cnv","refs","getContext","clearRect","clen","step","ii","tot","Utils","cntDocs","CanvasGraphComponent","classes","onclick","title","other","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\n\nconst styles = theme => ({\n    canvas: {\n\twidth:\"100%\",\n\theight:\"100%\",\n\toverflow:\"hidden\",\n\tmargin:\"0px\",\n\tpadding:\"0px\",\n\tborder:\"0px\",\n    },\n    pointer: {\n\tcursor:\"pointer\",\n\tpadding: theme.spacing.unit*0,\n    },\n    nopointer: {\n\tpadding: theme.spacing.unit*0,\n    },\n    div :{},\n});\nfunction drawThresholds(state,elements,colkey,colvalue,range,plan,level,ctx,height,offset,dwidth) {\n    //console.log(\"Canvas:\",xmin,dx);\n    var elen=elements.length;\n    //var maxlev=-1;\n    //var minlev=0;\n    var min=range[0]\n    var max=range[1];\n    var ee;\n    // determine cnt, number of elements for this colvalue\n    var cnt=0;\n    for (ee=0;ee<elen;ee++) {   // loop over elements\n\tvar el=elements[ee];\n\tvar docs=el.docs;\n\tvar dlen=docs.length;\n\tfor (var jj=0;jj<dlen;jj++) {   // loop over segments in each element\n\t    var d=docs[jj];\n\t    var thr=d._thr;\n\t    if (colvalue===\"\" || d[colkey]  === colvalue) {\n\t\tvar vals; // array of thresholds\n\t\tif (thr.min !== undefined && thr.val !== undefined) {\n\t\t    vals=thr.min;\n\t\t}\n\t\tif (thr.max !== undefined && thr.val !== undefined) {\n\t\t    vals=thr.max;\n\t\t}\n\t\tif (vals !== undefined) {\n\t\t    var vlen=vals.length;\n\t\t    for (var ll=0;ll<vlen;ll++) {\n\t\t\tvar tyval=vals[ll];\n\t\t\tvar tzval=state.Show.scale(tyval,min,max,height,0);\n\t\t\tvar scolor=undefined;\n\t\t\tif (ll === level) {\n\t\t\t    scolor=state.Colors.getLevelFgColor(ll);\n\t\t\t} else {\n\t\t\t    scolor=state.Colors.getLevelBgColor(ll);\n\t\t\t};\n\t\t\tvar xmin=offset+cnt*dwidth;\n\t\t\tvar xmax=offset+(cnt+1)*dwidth;\n\t\t\tctx.beginPath();\n\t\t\tctx.lineWidth=1;\n\t\t\tif (scolor !== undefined) {ctx.strokeStyle=scolor;}\n\t\t\tctx.moveTo(xmin,tzval);\n\t\t\tctx.lineTo(xmax,tzval);\n\t\t\tctx.stroke();\n\t\t\t//console.log(\"Stroke color:\",sbgcolor,ll,tzval,cnv.width);\n\t\t    }\n\t\t};\n\t\tif (thr.val !== undefined) {\n\t\t    cnt=cnt+1;\n\t\t}\n\t    };\n\t};\n    };\n};\nfunction drawData(state,elements,colkey,colvalue,range,plan,level,ctx,height,offset,dwidth) {\n    //console.log(\"Canvas:\",xmin,dx);\n    var elen=elements.length;\n    var maxlev=-1;\n    var minlev=0;\n    var min=range[0]\n    var max=range[1];\n    var ee;\n    // determine cnt, number of elements for this colvalue\n    var cnt=0;\n    for (ee=0;ee<elen;ee++) {   // loop over elements\n\tvar el=elements[ee];\n\tvar docs=el.docs;\n\tvar dlen=docs.length;\n\tfor (var jj=0;jj<dlen;jj++) {   // loop over segments in each element\n\t    var d=docs[jj];\n\t    var thr=d._thr;\n\t    if (colvalue===\"\" || d[colkey]  === colvalue) {\n\t\t//var vals;\n\t\t//console.log(\"Making canvas:\",ii,colvalues[ii],color,JSON.stringify(d),\n\t\t//\t    \" Thr=\",JSON.stringify(t),width,height,JSON.stringify(range));\n\t\t//console.log(\"CanvasGraph:\",ii,jj,d.dtg,color,el.maxlev,JSON.stringify(t));\n\t\tvar ymin=min;\n\t\tif (thr.min !== undefined && thr.val !== undefined) {\n\t\t    ymin=thr.val\n\t\t}\n\t\tvar ymax=max;\n\t\tif (thr.max !== undefined && thr.val !== undefined) {\n\t\t    ymax=thr.val;\n\t\t}\n\t\tvar xmin=offset+cnt*dwidth;\n\t\tvar xmax=offset+(cnt+1)*dwidth;\n\t\tvar zmin=state.Show.scale(ymin,min,max,height,0);\n\t\tvar zmax=state.Show.scale(ymax,min,max,height,0);\n\t\t//console.log(\"Fill:\",xmin,xmax,zmin,zmax,ymin,ymax,min,max,height);\n\t\t//console.log(\"Fill:\",xmin,xmax,zmin,(zmax-zmin),height,color);\n\t\t//ctx.fillStyle=\"cornflowerblue\";\n                var lev=state.Threshold.getLevel(state,d);\n                var col=state.Colors.getLevelFgColor(lev);\n\t\tif (col !== undefined) {\n\t\t    if (thr.level === undefined) { //  || Math.random() > 0.8\n\n\t\t\tconsole.log(\"Found undefined:\",JSON.stringify(d));\n\n\t\t\tminlev=Math.min(minlev,-2);\n\t\t    } else {\n\t\t\tmaxlev=Math.max(maxlev,thr.level);\n\t\t\tminlev=Math.min(minlev,thr.level);\n\t\t    };\n\t\t    var dx=Math.max(1,xmax-xmin);\n\t\t    var dz=zmax-zmin;\n\t\t    ctx.strokeStyle=col;\n\t\t    ctx.strokeRect(xmin,zmin,dx,dz);\n\t\t} else {\n\t\t    minlev=Math.min(minlev,-2);\n\t\t}\n\t\tif (thr.val !== undefined) {\n\t\t    cnt=cnt+1;\n\t\t};\n\t    }\n\t}\n    };\n    if (minlev < 0) {\n\treturn minlev;\n    } else {\n\treturn maxlev;\n    }\n};\nfunction drawMarker(ctx,height,offset,width) {\n    ctx.strokeStyle='blue';\n    ctx.beginPath();\n    ctx.moveTo(offset,0);\n    ctx.lineTo(offset+width,height);\n    ctx.moveTo(offset+width,0);\n    ctx.lineTo(offset,height);\n    ctx.strokeRect(offset,0,offset+width,height);\n    ctx.stroke();\n};\nfunction updateCanvas(item) {\n    const {state,elements,colkey,colvalues,index,range,plan,level} = item.props;\n    const cnv=item.refs.canvas;        // canvas\n    const ctx = cnv.getContext('2d');  // context\n    //console.log(\"Canvas:\",cnv.width,cnv.height);\n    //console.log(\"Canvas matrix:\",JSON.stringify(state.React.matrix));\n    ctx.clearRect(0, 0, cnv.width, cnv.height);\n    //var elen=elements.length;\n    var clen=1; if (colvalues !== undefined) {clen=colvalues.length;}; // number of columns\n    const step=plan.step;\n    var height = cnv.height;\n    var width = cnv.width/Math.max(1,step); // width of graph segment\n    var minlev=0;\n    if (range !== undefined) {\n\t// loop over column segments...\n\t//console.log(\"Segments:\",index,clen);\n\tfor (var ii=index;ii<Math.min(index+step,clen);ii++) { // loop over segments\n\t    var tot=state.Utils.cntDocs(elements,colkey,colvalues[ii]);\n\t    //console.log(\"Canvas:\",ii,index,\" val=\",colvalues[ii],\" tot=\",tot,\" key=\",colkey,JSON.stringify(elements));\n\t    var offset=(ii-index)*width;       // width/10;\n\t    var dwidth=width/Math.max(1,tot);\n\t    drawThresholds(state,elements,colkey,colvalues[ii],range,plan,level,ctx,height,offset,dwidth);\n\t    var lev=drawData(state,elements,colkey,colvalues[ii],range,plan,level,ctx,height,offset,dwidth);\n\t    minlev=Math.min(minlev,lev);\n\t}\n    } else {\n\tminlev=-2;\n    };\n    if (minlev < 0) {\n\tdrawMarker(ctx,height,0,width);\n    }\n};\nclass CanvasGraphComponent extends React.Component {\n    componentDidMount() {\n        updateCanvas(this);\n    }\n    componentDidUpdate() {\n        updateCanvas(this);\n    }\n    render() {\n        const { classes, onclick, title, plan, ...other } = this.props;\n        return (\n\t\t<canvas {...other} className={classes.canvas} classes={classes} onClick={onclick} title={title} \n\t            plan={plan} width={plan.width} height={plan.height} ref=\"canvas\"/>\n        );\n    }\n}\n\n// width={plan.width} height={plan.height}\n\nCanvasGraphComponent.propTypes = {\n    classes: PropTypes.object.isRequired,\n};\n\nexport default withStyles(styles)(CanvasGraphComponent);\n"]},"metadata":{},"sourceType":"module"}