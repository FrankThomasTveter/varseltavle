{"ast":null,"code":"//console.log(\"Loading NavigateLib.js\");\nfunction Navigate() {\n  this.history = {\n    pos: 0,\n    // position of next snapshot\n    track: []\n  };\n\n  this.store = function (state) {\n    // store state\n    if (state.Navigate.history.track.length > state.Navigate.history.pos) {\n      state.Navigate.history.track = state.Navigate.history.track.splice(0, state.Navigate.history.pos);\n    }\n\n    ;\n    var snapshot = state.Path.getSnapshot(state);\n    state.Navigate.history.track.push(snapshot);\n    state.Navigate.history.pos = state.Navigate.history.track.length;\n  };\n\n  this.canUndo = function (state) {\n    return state.Navigate.history.pos > 0;\n  };\n\n  this.canRedo = function (state) {\n    return state.Navigate.history.pos < state.Navigate.history.track.length - 1;\n  };\n\n  this.undo = function (state) {\n    if (this.canUndo(state)) {\n      state.Navigate.history.pos = state.Navigate.history.pos - 1;\n      var snapshot = state.Navigate.history.track[state.Navigate.history.pos];\n      state.path.setSnapshot(state, snapshot);\n    }\n  };\n\n  this.redo = function (state) {\n    if (this.canRedo(state)) {\n      state.Navigate.history.pos = state.Navigate.history.pos + 1;\n      var snapshot = state.Navigate.history.track[state.Navigate.history.pos];\n      state.path.setSnapshot(state, snapshot);\n    }\n  };\n\n  this.onClickPath = function (state, ttyp, tkey) {\n    var reload = false; // matrix changed?\n\n    var tid, tin, src, sec;\n    console.log(\"Clicked:\", ttyp, tkey, JSON.stringify(state.Path.keys), JSON.stringify(state.Path.other));\n\n    if (ttyp === \"path\") {\n      // path -> table\n      tid = state.Path.keys.path.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.path.splice(tid, 1); // remove from path\n\n        state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n\n        reload = true;\n      }\n    } else if (ttyp === \"table\") {\n      // table -> path/other\n      tid = state.Path.keys.other.indexOf(tkey);\n      tin = state.Path.other.table.indexOf(tkey);\n      console.log(\"Tin:\", tin, \" tid:\", tid);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        if (tin === 0) {\n          sec = state.Path.keys.other.splice(tid, 1); // remove from path\n        }\n\n        if (state.Path.values[tkey]) {\n          // table -> path\n          state.Path.keys.path = state.Path.keys.path.concat(src); // last path position\n        } else {\n          // table -> other\n          state.Path.keys.other = state.Path.keys.other.concat(src); // last position\n        }\n\n        if (tin === 0) {\n          src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n          state.Utils.spliceArray(state.Path.keys.other, 0, 0, sec); // first position (table)\n\n          state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n        }\n\n        reload = true;\n      }\n    } else if (ttyp === \"rest\") {\n      // rest -> table\n      tid = state.Path.keys.other.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.other.splice(tid, 1); // remove from path\n\n        state.Utils.spliceArray(state.Path.keys.other, 0, 0, src); // first position (table)\n\n        reload = true;\n      }\n\n      ;\n    } else if (ttyp === \"trash\") {\n      tid = state.Path.keys.trash.indexOf(tkey);\n      tin = state.Path.keys.other.indexOf(tkey);\n\n      if (tid !== -1) {\n        src = state.Path.keys.trash.splice(tid, 1); // trash => other\n\n        state.Path.keys.other = state.Path.keys.other.concat(src); // last position\n\n        state.Path.values[src] = undefined;\n      } else if (tin !== -1) {\n        src = state.Path.keys.other.splice(tin, 1); // other => trash\n\n        state.Path.keys.trash = state.Path.keys.trash.concat(src);\n      }\n\n      ;\n    }\n\n    state.Html.setFootnote(state, \"Extracting data.\");\n    setTimeout(function () {\n      state.Show.showAll(state, reload);\n    }.bind(this), 0);\n  };\n\n  this.selectItem = function (state, colkey, rowkey, colval, rowval, colwhere, rowwhere, colcnt, rowcnt) {\n    console.log(\"Selectitem:\", colkey, rowkey, colval, rowval, colwhere, rowwhere, colcnt, rowcnt); //var colkey=state.Path.getColKey(state);\n    //var rowkey=state.Path.getRowKey(state);\n\n    var order = state.Utils.cp(state.Path.keys.other);\n    console.log(\"SelectItem:\", colkey, \"=\", colval, \"  \", rowkey, \"=\", rowval);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      if (this.selectMapKey(state, colkey, colval, colwhere, colcnt)) {\n        this.order[colkey] = state.Utils.cp(order); //this.flip[colkey]=this.getFlip(state);\n\n        if (this.selectMapKey(state, rowkey, rowval, rowwhere, rowcnt)) {\n          this.order[rowkey] = state.Utils.cp(order); //this.last.flip[rowkey]=this.getFlip(state);\n        }\n\n        this.trash[colkey] = this.checkTableKeys(state);\n        console.log(\"this.checkTableKeys Done.\", colkey, JSON.stringify(this.trash[colkey]));\n      }\n\n      ; //console.log(\"Path:\",JSON.stringify(state.Path))\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      setTimeout(function () {\n        state.Show.showAll(state);\n      }.bind(this), 0);\n    } else if (this.selectTableKey(state, colkey, colval, colwhere, colcnt)) {\n      this.order[colkey] = order; //this.flip[colkey]=this.getFlip(state);\n\n      if (this.selectTableKey(state, rowkey, rowval, rowwhere, rowcnt)) {\n        this.order[rowkey] = state.Utils.cp(order); //this.last.flip[rowkey]=this.getFlip(state);\n      }\n\n      this.trash[colkey] = this.checkTableKeys(state);\n      console.log(\"this.checkTableKeys Done.\", colkey, JSON.stringify(this.trash[colkey]));\n      state.Html.setFootnote(state, \"Extracting data.\");\n      setTimeout(function () {\n        state.Show.showAll(state);\n      }.bind(this), 0);\n    } else if (this.selectTableKey(state, rowkey, rowval, rowwhere, rowcnt)) {\n      this.order[rowkey] = order; //this.last.flip[rowkey]=this.getFlip(state);\n\n      this.trash[rowkey] = this.checkTableKeys(state);\n      console.log(\"this.checkTableKeys Done.\", rowkey, JSON.stringify(this.trash[rowkey]));\n      state.Html.setFootnote(state, \"Extracting data.\");\n      setTimeout(function () {\n        state.Show.showAll(state);\n      }.bind(this), 0);\n    } else {\n      console.log(\"Unable to select:\", rowkey, colkey);\n    }\n\n    console.log(\"Selectitem Done:\", rowwhere, colwhere);\n  };\n\n  this.selectMapKey = function (state, key, val, where, cnt) {\n    // keep abscissa\n    console.log(\"Table.Selecting:\", key, \"=\", val, \", where=\", where);\n    state.Path.select.val[key] = [val];\n    state.Path.select.where[key] = where;\n    state.Path.select.cnt[key] = cnt;\n\n    if (state.Utils.missing(state.Path.keys.path, key)) {\n      //console.log(\"Adding to path:\",key);\n      state.Path.keys.path = state.Path.keys.path.concat(key); // last path position\n    }\n\n    ;\n    return true;\n  };\n\n  this.selectTableKey = function (state, key, val, where, cnt) {\n    // keep abscissa\n    console.log(\"this.Selecting:\", key, \"=\", val, \", where=\", where);\n    var sid = state.Path.keys.other.indexOf(key);\n\n    if (sid !== -1) {\n      state.Path.select.val[key] = [val];\n      state.Path.select.where[key] = where;\n      state.Path.select.cnt[key] = cnt;\n      var src = state.Path.keys.other.splice(sid, 1); // remove from path\n\n      if (state.Utils.missing(state.Path.keys.path, src)) {\n        //console.log(\"Adding to path:\",JSON.stringify(src));\n        state.Path.keys.path = state.Path.keys.path.concat(src); // last path position\n      }\n\n      ;\n\n      if (cnt > 1 && state.Utils.missing(state.Path.keys.trash, src)) {\n        console.log(\"Adding \", JSON.stringify(src), \" to trash.\");\n        state.Path.keys.trash = state.Path.keys.trash.concat(src);\n      }\n\n      ; //console.log(\"Selectkey:\",JSON.stringify(setup),JSON.stringify(src));\n\n      return true;\n    } else {\n      console.log(\"Missing \", key, \" in path:\", JSON.stringify(state.Path.keys));\n      return false;\n    }\n  };\n\n  this.selectKey = function (state, key, val, where, cnt) {\n    var order = state.Utils.cp(state.Path.keys.other); //console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n\n    console.log(\"SelectKey:\", key, val, where, cnt);\n\n    if (state.Show.getLayoutMode(state) === state.Show.code.layout.Map) {\n      if (this.selectMapKey(state, key, val, where, cnt)) {\n        this.order[key] = state.Utils.cp(order);\n      }\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      setTimeout(function () {\n        state.Show.showAll(state);\n      }.bind(this), 0);\n    } else if (this.selectTableKey(state, key, val, where, cnt)) {\n      this.order[key] = order;\n      this.trash[key] = this.checkTableKeys(state); //console.log(\"this.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\n\n      state.Html.setFootnote(state, \"Extracting data.\");\n      setTimeout(function () {\n        state.Show.showAll(state);\n      }.bind(this), 0);\n    } else {\n      console.log(\"Unable to select:\", key);\n    } //console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n\n  };\n\n  this.swapTableKeys = function (state, c, r) {\n    //console.log(\"Swapping:\",c,\"<->\",r);\n    var sid = state.Path.keys.other.indexOf(c);\n    var tid = state.Path.keys.other.indexOf(r);\n\n    if (sid !== -1 && tid !== -1) {\n      var src = state.Path.keys.other[sid];\n      var trg = state.Path.keys.other[tid];\n\n      if (sid > tid) {\n        state.Path.keys.other.splice(sid, 1);\n        state.Path.keys.other.splice(tid, 1);\n        state.Path.keys.other.splice(tid, 0, src);\n        state.Path.keys.other.splice(sid, 0, trg);\n      } else {\n        state.Path.keys.other.splice(tid, 1);\n        state.Path.keys.other.splice(sid, 1);\n        state.Path.keys.other.splice(sid, 0, trg);\n        state.Path.keys.other.splice(tid, 0, src);\n      }\n    } else {\n      console.log(\"Invalid keys:\", c, r, JSON.stringify(state.Path.keys));\n    }\n  };\n\n  this.checkTableKeys = function (state) {\n    var ret = [];\n    var where = state.Database.getWhere(state);\n    state.Matrix.initKeyCnt(state);\n    state.Matrix.mapKeyCnt(state, where, 0, state.Path.keys.other); // possible table keys (no undefined)\n\n    state.Path.exportAllKeys(state); //console.log(\"this.checkTableKeys Entering.\",JSON.stringify(setup));\n\n    var keys = state.Path.other.table;\n    var bdone = !keys.length < 2;\n    var iinew = -1;\n    var jjnew = -1;\n    var order = state.Utils.cp(state.Path.keys.other);\n\n    do {\n      //console.log(\"this.checkTableKeys Looping.\");\n      if (keys.length < 2) {\n        bdone = true;\n      } else {\n        // check for number of column values\n        var docs = state.Database.getCntDocs(state, where, state.Path.other.table); // current table keys\n\n        var slen = state.Path.other.table.length;\n        var hits = {};\n        var maxh = {};\n        var kval = {};\n        var ii, jj, key, val; // loop over docs\n\n        var dlen = docs.length;\n\n        for (ii = 0; ii < dlen; ii++) {\n          var doc = docs[ii]; //console.log(\"Trash doc=\",ii,JSON.stringify(doc));\n\n          for (jj = 0; jj < slen; jj++) {\n            key = state.Path.other.table[jj];\n\n            if (doc[key] !== undefined) {\n              val = doc[key];\n              kval[key] = val;\n\n              if (hits[key] === undefined) {\n                hits[key] = {};\n              }\n\n              hits[key][val] = 1 + (hits[key][val] || 0); //console.log(\"Found:\",key,val,hits[key][val]);\n\n              if (hits[key][val] > (maxh[key] || 0)) {\n                maxh[key] = hits[key][val];\n              }\n            }\n          }\n        } //console.log(\"this.checkTableKeys Checking.\",dlen);\n\n\n        var rm = {};\n        bdone = true; //console.log(\"Max:\",JSON.stringify(maxh));\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n          rm[key] = \"\"; //console.log(\"Checking:\",key,JSON.stringify(maxh));\n\n          if (maxh[key] !== undefined) {\n            if (maxh[key] === 1) {\n              rm[key] = \"other\";\n            } else if (maxh[key] === dlen) {\n              // remove key from table\n              rm[key] = \"self\";\n            }\n          }\n        }\n\n        var rmthis = {};\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n\n          if (rm[key] === \"other\") {\n            for (var kk = 0; kk < slen; kk++) {\n              var rkey = state.Path.other.table[kk];\n\n              if (kk !== jj) {\n                rmthis[rkey] = \"trash\";\n                iinew = kk;\n              }\n            }\n          } else if (rm[key] === \"self\") {\n            rmthis[key] = \"path\";\n            jjnew = jj;\n          }\n        }\n\n        if (iinew !== -1 && jjnew !== -1) {\n          iinew = -1;\n          jjnew = -1;\n        } //console.log(\"Rm:\",JSON.stringify(rmthis),JSON.stringify(rm));\n\n\n        for (jj = 0; jj < slen; jj++) {\n          key = state.Path.other.table[jj];\n\n          if (rmthis[key] !== undefined) {\n            bdone = false;\n            var sin = state.Path.keys.other.indexOf(key);\n\n            if (sin !== -1) {\n              if (jj === 0) {// flipTable\n                //console.log(\"Flipped table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n              } else {//console.log(\"Not Flipping table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n                }\n\n              ;\n              var src = state.Path.keys.other.splice(sin, 1); // remove from path\n\n              if (rmthis[key] === \"trash\") {\n                // trash key\n                //console.log(\"### Trashing:\",key);\n                state.Path.keys.trash = state.Path.keys.trash.concat(src); // last path position\n\n                ret = ret.concat(src);\n              } else if (rmthis[key] === \"path\") {\n                // add to path\n                // add to path...\n                val = kval[key]; //console.log(\"### Pathing:\",key,val);\n\n                state.Path.keys.path = state.Path.keys.path.concat(src); // last path position\n\n                state.Path.select.val[key] = [val];\n                state.Path.select.where[key] = key + '=\"' + val + '\"';\n                state.Path.select.cnt[key] = 1;\n                this.order[key] = order; //this.last.flip[key]=this.getFlip(state);\n              }\n\n              ;\n            }\n          }\n        }\n\n        if (!bdone) {\n          state.Path.exportAllKeys(state);\n        }\n      }\n\n      ;\n    } while (!bdone); //console.log(\"this.checkTableKeys Done.\",JSON.stringify(state.Path.other.table));\n\n\n    return ret;\n  };\n}\n\n;\nexport default Navigate;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/NavigateLib.js"],"names":["Navigate","history","pos","track","store","state","length","splice","snapshot","Path","getSnapshot","push","canUndo","canRedo","undo","path","setSnapshot","redo","onClickPath","ttyp","tkey","reload","tid","tin","src","sec","console","log","JSON","stringify","keys","other","indexOf","Utils","spliceArray","table","values","concat","trash","undefined","Html","setFootnote","setTimeout","Show","showAll","bind","selectItem","colkey","rowkey","colval","rowval","colwhere","rowwhere","colcnt","rowcnt","order","cp","getLayoutMode","code","layout","Map","selectMapKey","checkTableKeys","selectTableKey","key","val","where","cnt","select","missing","sid","selectKey","swapTableKeys","c","r","trg","ret","Database","getWhere","Matrix","initKeyCnt","mapKeyCnt","exportAllKeys","bdone","iinew","jjnew","docs","getCntDocs","slen","hits","maxh","kval","ii","jj","dlen","doc","rm","rmthis","kk","rkey","sin"],"mappings":"AAAA;AAEA,SAASA,QAAT,GAAoB;AAChB,OAAKC,OAAL,GAAa;AAACC,IAAAA,GAAG,EAAC,CAAL;AAAQ;AACrBC,IAAAA,KAAK,EAAC;AADO,GAAb;;AAGA,OAAKC,KAAL,GAAW,UAASC,KAAT,EAAgB;AAAE;AAChC,QAAIA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BG,MAA7B,GAAoCD,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAA/D,EAAoE;AAChEG,MAAAA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,GAA6BE,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BI,MAA7B,CAAoC,CAApC,EAAsCF,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAA7D,CAA7B;AACH;;AAAA;AACD,QAAIM,QAAQ,GAACH,KAAK,CAACI,IAAN,CAAWC,WAAX,CAAuBL,KAAvB,CAAb;AACAA,IAAAA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BQ,IAA7B,CAAkCH,QAAlC;AACAH,IAAAA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA2BG,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BG,MAAxD;AACI,GAPD;;AAQA,OAAKM,OAAL,GAAa,UAASP,KAAT,EAAgB;AAChC,WAAQA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA6B,CAArC;AACI,GAFD;;AAGA,OAAKW,OAAL,GAAa,UAASR,KAAT,EAAgB;AAChC,WAAQA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA6BG,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BG,MAA7B,GAAoC,CAAzE;AACI,GAFD;;AAGA,OAAKQ,IAAL,GAAU,UAAST,KAAT,EAAgB;AAC7B,QAAI,KAAKO,OAAL,CAAaP,KAAb,CAAJ,EAAyB;AACrBA,MAAAA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA2BG,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA2B,CAAtD;AACA,UAAIM,QAAQ,GAACH,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BE,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAApD,CAAb;AACAG,MAAAA,KAAK,CAACU,IAAN,CAAWC,WAAX,CAAuBX,KAAvB,EAA6BG,QAA7B;AACH;AACG,GAND;;AAOA,OAAKS,IAAL,GAAU,UAASZ,KAAT,EAAgB;AAC7B,QAAI,KAAKQ,OAAL,CAAaR,KAAb,CAAJ,EAAyB;AACrBA,MAAAA,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA2BG,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAAvB,GAA2B,CAAtD;AACA,UAAIM,QAAQ,GAACH,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBE,KAAvB,CAA6BE,KAAK,CAACL,QAAN,CAAeC,OAAf,CAAuBC,GAApD,CAAb;AACAG,MAAAA,KAAK,CAACU,IAAN,CAAWC,WAAX,CAAuBX,KAAvB,EAA6BG,QAA7B;AACH;AACG,GAND;;AAOA,OAAKU,WAAL,GAAiB,UAASb,KAAT,EAAec,IAAf,EAAoBC,IAApB,EAA0B;AAC9C,QAAIC,MAAM,GAAC,KAAX,CAD8C,CAC5B;;AAClB,QAAIC,GAAJ,EAAQC,GAAR,EAAYC,GAAZ,EAAgBC,GAAhB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBR,IAAvB,EAA4BC,IAA5B,EAAiCQ,IAAI,CAACC,SAAL,CAAexB,KAAK,CAACI,IAAN,CAAWqB,IAA1B,CAAjC,EAAiEF,IAAI,CAACC,SAAL,CAAexB,KAAK,CAACI,IAAN,CAAWsB,KAA1B,CAAjE;;AACA,QAAIZ,IAAI,KAAM,MAAd,EAAsB;AAAE;AACpBG,MAAAA,GAAG,GAACjB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBiB,OAArB,CAA6BZ,IAA7B,CAAJ;;AACA,UAAIE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnBE,QAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBR,MAArB,CAA4Be,GAA5B,EAAiC,CAAjC,CAAJ,CADmB,CACsC;;AACzDjB,QAAAA,KAAK,CAAC4B,KAAN,CAAYC,WAAZ,CAAwB7B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAxC,EAA8C,CAA9C,EAAgD,CAAhD,EAAkDP,GAAlD,EAFmB,CAEqC;;AACxDH,QAAAA,MAAM,GAAC,IAAP;AACI;AACJ,KAPD,MAOO,IAAIF,IAAI,KAAM,OAAd,EAAuB;AAAE;AAC5BG,MAAAA,GAAG,GAACjB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BZ,IAA9B,CAAJ;AACAG,MAAAA,GAAG,GAAClB,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuBH,OAAvB,CAA+BZ,IAA/B,CAAJ;AACAM,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAmBJ,GAAnB,EAAuB,OAAvB,EAA+BD,GAA/B;;AACA,UAAIA,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnBE,QAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,CAAJ,CADmB,CACuC;;AAC1D,YAAIC,GAAG,KAAG,CAAV,EAAa;AACTE,UAAAA,GAAG,GAACpB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,CAAJ,CADS,CACiD;AAC7D;;AACD,YAAIjB,KAAK,CAACI,IAAN,CAAW2B,MAAX,CAAkBhB,IAAlB,CAAJ,EAA6B;AAAE;AAC3Bf,UAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,GAAqBV,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBsB,MAArB,CAA4Bb,GAA5B,CAArB,CADyB,CAC8B;AAC1D,SAFD,MAEO;AAAwB;AAC3BnB,UAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,GAAsB1B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBM,MAAtB,CAA6Bb,GAA7B,CAAtB,CADG,CACsD;AAC5D;;AACD,YAAID,GAAG,KAAG,CAAV,EAAa;AACTC,UAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,CAAJ,CADS,CACiD;;AAC1DjB,UAAAA,KAAK,CAAC4B,KAAN,CAAYC,WAAZ,CAAwB7B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAxC,EAA8C,CAA9C,EAAgD,CAAhD,EAAkDN,GAAlD,EAFS,CAE+C;;AACxDpB,UAAAA,KAAK,CAAC4B,KAAN,CAAYC,WAAZ,CAAwB7B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAxC,EAA8C,CAA9C,EAAgD,CAAhD,EAAkDP,GAAlD,EAHS,CAG+C;AAC3D;;AACDH,QAAAA,MAAM,GAAC,IAAP;AACI;AACJ,KArBM,MAqBA,IAAIF,IAAI,KAAK,MAAb,EAAqB;AAAE;AAC1BG,MAAAA,GAAG,GAACjB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BZ,IAA9B,CAAJ;;AACA,UAAIE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnBE,QAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,CAAJ,CADmB,CACuC;;AAC1DjB,QAAAA,KAAK,CAAC4B,KAAN,CAAYC,WAAZ,CAAwB7B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAxC,EAA8C,CAA9C,EAAgD,CAAhD,EAAkDP,GAAlD,EAFmB,CAEqC;;AACxDH,QAAAA,MAAM,GAAC,IAAP;AACI;;AAAA;AACJ,KAPM,MAOA,IAAIF,IAAI,KAAK,OAAb,EAAsB;AACzBG,MAAAA,GAAG,GAACjB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,CAAsBN,OAAtB,CAA8BZ,IAA9B,CAAJ;AACAG,MAAAA,GAAG,GAAClB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BZ,IAA9B,CAAJ;;AACA,UAAIE,GAAG,KAAK,CAAC,CAAb,EAAgB;AACnBE,QAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,CAAsB/B,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,CAAJ,CADmB,CACuC;;AAC1DjB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,GAAsB1B,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBM,MAAtB,CAA6Bb,GAA7B,CAAtB,CAFmB,CAEsC;;AACzDnB,QAAAA,KAAK,CAACI,IAAN,CAAW2B,MAAX,CAAkBZ,GAAlB,IAAuBe,SAAvB;AACI,OAJD,MAIO,IAAIhB,GAAG,KAAK,CAAC,CAAb,EAAgB;AAC1BC,QAAAA,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6BgB,GAA7B,EAAkC,CAAlC,CAAJ,CAD0B,CACgC;;AAC1DlB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,GAAsBjC,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,CAAsBD,MAAtB,CAA6Bb,GAA7B,CAAtB;AACI;;AAAA;AACJ;;AACDnB,IAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,IAAAA,UAAU,CAAC,YAAW;AAClBrC,MAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB,EAAyBgB,MAAzB;AACH,KAFU,CAETwB,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGI,GAvDD;;AAwDA,OAAKC,UAAL,GAAgB,UAASzC,KAAT,EAAe0C,MAAf,EAAsBC,MAAtB,EAA6BC,MAA7B,EAAoCC,MAApC,EAA2CC,QAA3C,EAAoDC,QAApD,EAA6DC,MAA7D,EAAoEC,MAApE,EAA4E;AAC/F5B,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA0BoB,MAA1B,EAAiCC,MAAjC,EAAwCC,MAAxC,EAA+CC,MAA/C,EAAsDC,QAAtD,EAA+DC,QAA/D,EAAwEC,MAAxE,EAA+EC,MAA/E,EAD+F,CAE/F;AACA;;AACA,QAAIC,KAAK,GAAClD,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAenD,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAA/B,CAAV;AACAL,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA0BoB,MAA1B,EAAiC,GAAjC,EAAqCE,MAArC,EAA4C,IAA5C,EAAiDD,MAAjD,EAAwD,GAAxD,EAA4DE,MAA5D;;AACA,QAAI7C,KAAK,CAACsC,IAAN,CAAWc,aAAX,CAAyBpD,KAAzB,MAAqCA,KAAK,CAACsC,IAAN,CAAWe,IAAX,CAAgBC,MAAhB,CAAuBC,GAAhE,EAAqE;AACjE,UAAI,KAAKC,YAAL,CAAkBxD,KAAlB,EAAwB0C,MAAxB,EAA+BE,MAA/B,EAAsCE,QAAtC,EAA+CE,MAA/C,CAAJ,EAA4D;AAC/D,aAAKE,KAAL,CAAWR,MAAX,IAAmB1C,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAeD,KAAf,CAAnB,CAD+D,CAE/D;;AACA,YAAI,KAAKM,YAAL,CAAkBxD,KAAlB,EAAwB2C,MAAxB,EAA+BE,MAA/B,EAAsCE,QAAtC,EAA+CE,MAA/C,CAAJ,EAA4D;AACxD,eAAKC,KAAL,CAAWP,MAAX,IAAmB3C,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAeD,KAAf,CAAnB,CADwD,CAExD;AACH;;AACD,aAAKjB,KAAL,CAAWS,MAAX,IAAmB,KAAKe,cAAL,CAAoBzD,KAApB,CAAnB;AACAqB,QAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAwCoB,MAAxC,EAA+CnB,IAAI,CAACC,SAAL,CAAe,KAAKS,KAAL,CAAWS,MAAX,CAAf,CAA/C;AACI;;AAAA,OAVgE,CAWjE;;AACA1C,MAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,MAAAA,UAAU,CAAC,YAAW;AACzBrC,QAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB;AACI,OAFU,CAETwC,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGH,KAhBD,MAgBO,IAAI,KAAKkB,cAAL,CAAoB1D,KAApB,EAA0B0C,MAA1B,EAAiCE,MAAjC,EAAwCE,QAAxC,EAAiDE,MAAjD,CAAJ,EAA8D;AACjE,WAAKE,KAAL,CAAWR,MAAX,IAAmBQ,KAAnB,CADiE,CAEjE;;AACA,UAAI,KAAKQ,cAAL,CAAoB1D,KAApB,EAA0B2C,MAA1B,EAAiCE,MAAjC,EAAwCE,QAAxC,EAAiDE,MAAjD,CAAJ,EAA8D;AACjE,aAAKC,KAAL,CAAWP,MAAX,IAAmB3C,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAeD,KAAf,CAAnB,CADiE,CAEjE;AACI;;AACD,WAAKjB,KAAL,CAAWS,MAAX,IAAmB,KAAKe,cAAL,CAAoBzD,KAApB,CAAnB;AACAqB,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAwCoB,MAAxC,EAA+CnB,IAAI,CAACC,SAAL,CAAe,KAAKS,KAAL,CAAWS,MAAX,CAAf,CAA/C;AACA1C,MAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,MAAAA,UAAU,CAAC,YAAW;AACzBrC,QAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB;AACI,OAFU,CAETwC,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGH,KAbM,MAaA,IAAI,KAAKkB,cAAL,CAAoB1D,KAApB,EAA0B2C,MAA1B,EAAiCE,MAAjC,EAAwCE,QAAxC,EAAiDE,MAAjD,CAAJ,EAA8D;AACjE,WAAKC,KAAL,CAAWP,MAAX,IAAmBO,KAAnB,CADiE,CAEjE;;AACA,WAAKjB,KAAL,CAAWU,MAAX,IAAmB,KAAKc,cAAL,CAAoBzD,KAApB,CAAnB;AACAqB,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAwCqB,MAAxC,EAA+CpB,IAAI,CAACC,SAAL,CAAe,KAAKS,KAAL,CAAWU,MAAX,CAAf,CAA/C;AACA3C,MAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,MAAAA,UAAU,CAAC,YAAW;AACzBrC,QAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB;AACI,OAFU,CAETwC,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGH,KATM,MASA;AACHnB,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgCqB,MAAhC,EAAuCD,MAAvC;AACH;;AACDrB,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+ByB,QAA/B,EAAwCD,QAAxC;AACI,GAhDD;;AAiDA,OAAKU,YAAL,GAAkB,UAASxD,KAAT,EAAe2D,GAAf,EAAmBC,GAAnB,EAAuBC,KAAvB,EAA6BC,GAA7B,EAAkC;AAAE;AACzDzC,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+BqC,GAA/B,EAAmC,GAAnC,EAAuCC,GAAvC,EAA2C,UAA3C,EAAsDC,KAAtD;AACA7D,IAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBH,GAAlB,CAAsBD,GAAtB,IAA2B,CAACC,GAAD,CAA3B;AACA5D,IAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBF,KAAlB,CAAwBF,GAAxB,IAA6BE,KAA7B;AACA7D,IAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBD,GAAlB,CAAsBH,GAAtB,IAA2BG,GAA3B;;AACA,QAAI9D,KAAK,CAAC4B,KAAN,CAAYoC,OAAZ,CAAoBhE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAApC,EAAyCiD,GAAzC,CAAJ,EAAmD;AAC/C;AACA3D,MAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,GAAqBV,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBsB,MAArB,CAA4B2B,GAA5B,CAArB,CAF+C,CAEQ;AAC1D;;AAAA;AACD,WAAO,IAAP;AACI,GAVD;;AAWA,OAAKD,cAAL,GAAoB,UAAS1D,KAAT,EAAe2D,GAAf,EAAmBC,GAAnB,EAAuBC,KAAvB,EAA6BC,GAA7B,EAAkC;AAAE;AAC3DzC,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BqC,GAA9B,EAAkC,GAAlC,EAAsCC,GAAtC,EAA0C,UAA1C,EAAqDC,KAArD;AACA,QAAII,GAAG,GAAGjE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BgC,GAA9B,CAAV;;AACA,QAAIM,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZjE,MAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBH,GAAlB,CAAsBD,GAAtB,IAA2B,CAACC,GAAD,CAA3B;AACA5D,MAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBF,KAAlB,CAAwBF,GAAxB,IAA6BE,KAA7B;AACA7D,MAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBD,GAAlB,CAAsBH,GAAtB,IAA2BG,GAA3B;AACA,UAAI3C,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B+D,GAA7B,EAAkC,CAAlC,CAAR,CAJY,CAIkC;;AAC9C,UAAKjE,KAAK,CAAC4B,KAAN,CAAYoC,OAAZ,CAAoBhE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAApC,EAAyCS,GAAzC,CAAL,EAAoD;AACvD;AACAnB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,GAAqBV,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBsB,MAArB,CAA4Bb,GAA5B,CAArB,CAFuD,CAEA;AACnD;;AAAA;;AACD,UAAI2C,GAAG,GAAC,CAAJ,IAAS9D,KAAK,CAAC4B,KAAN,CAAYoC,OAAZ,CAAoBhE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAApC,EAA0Cd,GAA1C,CAAb,EAA6D;AAChEE,QAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAsBC,IAAI,CAACC,SAAL,CAAeL,GAAf,CAAtB,EAA0C,YAA1C;AACAnB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,GAAsBjC,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,CAAsBD,MAAtB,CAA6Bb,GAA7B,CAAtB;AACI;;AAAA,OAZW,CAaZ;;AACA,aAAO,IAAP;AACH,KAfD,MAeO;AACHE,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBqC,GAAvB,EAA2B,WAA3B,EAAuCpC,IAAI,CAACC,SAAL,CAAexB,KAAK,CAACI,IAAN,CAAWqB,IAA1B,CAAvC;AACA,aAAO,KAAP;AACH;AACG,GAtBD;;AAuBA,OAAKyC,SAAL,GAAe,UAASlE,KAAT,EAAe2D,GAAf,EAAmBC,GAAnB,EAAuBC,KAAvB,EAA6BC,GAA7B,EAAkC;AACpD,QAAIZ,KAAK,GAAClD,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAenD,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAA/B,CAAV,CADoD,CAEpD;;AACAL,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBqC,GAAzB,EAA6BC,GAA7B,EAAiCC,KAAjC,EAAuCC,GAAvC;;AACA,QAAI9D,KAAK,CAACsC,IAAN,CAAWc,aAAX,CAAyBpD,KAAzB,MAAqCA,KAAK,CAACsC,IAAN,CAAWe,IAAX,CAAgBC,MAAhB,CAAuBC,GAAhE,EAAqE;AACjE,UAAI,KAAKC,YAAL,CAAkBxD,KAAlB,EAAwB2D,GAAxB,EAA4BC,GAA5B,EAAgCC,KAAhC,EAAsCC,GAAtC,CAAJ,EAAgD;AACnD,aAAKZ,KAAL,CAAWS,GAAX,IAAgB3D,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAeD,KAAf,CAAhB;AACI;;AACDlD,MAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,MAAAA,UAAU,CAAC,YAAW;AACzBrC,QAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB;AACI,OAFU,CAETwC,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGH,KARD,MAQO,IAAI,KAAKkB,cAAL,CAAoB1D,KAApB,EAA0B2D,GAA1B,EAA8BC,GAA9B,EAAkCC,KAAlC,EAAwCC,GAAxC,CAAJ,EAAkD;AACrD,WAAKZ,KAAL,CAAWS,GAAX,IAAgBT,KAAhB;AACA,WAAKjB,KAAL,CAAW0B,GAAX,IAAgB,KAAKF,cAAL,CAAoBzD,KAApB,CAAhB,CAFqD,CAGrD;;AACAA,MAAAA,KAAK,CAACmC,IAAN,CAAWC,WAAX,CAAuBpC,KAAvB,EAA6B,kBAA7B;AACAqC,MAAAA,UAAU,CAAC,YAAW;AACzBrC,QAAAA,KAAK,CAACsC,IAAN,CAAWC,OAAX,CAAmBvC,KAAnB;AACI,OAFU,CAETwC,IAFS,CAEJ,IAFI,CAAD,EAEG,CAFH,CAAV;AAGH,KARM,MAQA;AACHnB,MAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAgCqC,GAAhC;AACH,KAtBmD,CAuBpD;;AACI,GAxBD;;AAyBA,OAAKQ,aAAL,GAAmB,UAASnE,KAAT,EAAeoE,CAAf,EAAiBC,CAAjB,EAAoB;AAC1C;AACA,QAAIJ,GAAG,GAAGjE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8ByC,CAA9B,CAAV;AACA,QAAInD,GAAG,GAAGjB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8B0C,CAA9B,CAAV;;AACA,QAAIJ,GAAG,KAAK,CAAC,CAAT,IAAchD,GAAG,KAAK,CAAC,CAA3B,EAA8B;AAC1B,UAAIE,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBuC,GAAtB,CAAR;AACA,UAAIK,GAAG,GAACtE,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBT,GAAtB,CAAR;;AACA,UAAIgD,GAAG,GAAGhD,GAAV,EAAe;AAClBjB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B+D,GAA7B,EAAkC,CAAlC;AACAjE,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC;AACAjB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,EAAqCE,GAArC;AACAnB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B+D,GAA7B,EAAkC,CAAlC,EAAqCK,GAArC;AACI,OALD,MAKO;AACVtE,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC;AACAjB,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B+D,GAA7B,EAAkC,CAAlC;AACAjE,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B+D,GAA7B,EAAkC,CAAlC,EAAqCK,GAArC;AACAtE,QAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6Be,GAA7B,EAAkC,CAAlC,EAAqCE,GAArC;AACI;AACJ,KAdD,MAcO;AACHE,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4B8C,CAA5B,EAA8BC,CAA9B,EAAgC9C,IAAI,CAACC,SAAL,CAAexB,KAAK,CAACI,IAAN,CAAWqB,IAA1B,CAAhC;AACH;AACG,GArBD;;AAsBA,OAAKgC,cAAL,GAAoB,UAASzD,KAAT,EAAgB;AACvC,QAAIuE,GAAG,GAAC,EAAR;AACA,QAAIV,KAAK,GAAG7D,KAAK,CAACwE,QAAN,CAAeC,QAAf,CAAwBzE,KAAxB,CAAZ;AACAA,IAAAA,KAAK,CAAC0E,MAAN,CAAaC,UAAb,CAAwB3E,KAAxB;AACAA,IAAAA,KAAK,CAAC0E,MAAN,CAAaE,SAAb,CAAuB5E,KAAvB,EAA6B6D,KAA7B,EAAmC,CAAnC,EAAqC7D,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAArD,EAJuC,CAIsB;;AAC7D1B,IAAAA,KAAK,CAACI,IAAN,CAAWyE,aAAX,CAAyB7E,KAAzB,EALuC,CAMvC;;AACA,QAAIyB,IAAI,GAACzB,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAA1B;AACA,QAAIgD,KAAK,GAAE,CAAErD,IAAI,CAACxB,MAAP,GAAgB,CAA3B;AACA,QAAI8E,KAAK,GAAC,CAAC,CAAX;AACA,QAAIC,KAAK,GAAC,CAAC,CAAX;AACA,QAAI9B,KAAK,GAAClD,KAAK,CAAC4B,KAAN,CAAYuB,EAAZ,CAAenD,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAA/B,CAAV;;AACA,OAAG;AACC;AACA,UAAID,IAAI,CAACxB,MAAL,GAAc,CAAlB,EAAqB;AACxB6E,QAAAA,KAAK,GAAC,IAAN;AACI,OAFD,MAEO;AACV;AACA,YAAIG,IAAI,GAACjF,KAAK,CAACwE,QAAN,CAAeU,UAAf,CAA0BlF,KAA1B,EAAgC6D,KAAhC,EAAsC7D,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAvD,CAAT,CAFU,CAE8D;;AACxE,YAAIqD,IAAI,GAACnF,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB7B,MAAhC;AACA,YAAImF,IAAI,GAAC,EAAT;AACA,YAAIC,IAAI,GAAC,EAAT;AACA,YAAIC,IAAI,GAAC,EAAT;AACA,YAAIC,EAAJ,EAAOC,EAAP,EAAU7B,GAAV,EAAcC,GAAd,CAPU,CAQV;;AACA,YAAI6B,IAAI,GAAGR,IAAI,CAAChF,MAAhB;;AACA,aAAKsF,EAAE,GAAG,CAAV,EAAaA,EAAE,GAAGE,IAAlB,EAAwBF,EAAE,EAA1B,EAA8B;AACtB,cAAIG,GAAG,GAACT,IAAI,CAACM,EAAD,CAAZ,CADsB,CAE1B;;AACA,eAAKC,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACL,IAAb,EAAkBK,EAAE,EAApB,EAAwB;AAC3B7B,YAAAA,GAAG,GAAC3D,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB0D,EAAvB,CAAJ;;AACA,gBAAIE,GAAG,CAAC/B,GAAD,CAAH,KAAazB,SAAjB,EAA4B;AACxB0B,cAAAA,GAAG,GAAC8B,GAAG,CAAC/B,GAAD,CAAP;AACA2B,cAAAA,IAAI,CAAC3B,GAAD,CAAJ,GAAUC,GAAV;;AACA,kBAAIwB,IAAI,CAACzB,GAAD,CAAJ,KAAezB,SAAnB,EAA8B;AAACkD,gBAAAA,IAAI,CAACzB,GAAD,CAAJ,GAAU,EAAV;AAAc;;AAC7CyB,cAAAA,IAAI,CAACzB,GAAD,CAAJ,CAAUC,GAAV,IAAiB,KAAIwB,IAAI,CAACzB,GAAD,CAAJ,CAAUC,GAAV,KAAgB,CAApB,CAAjB,CAJwB,CAKxB;;AACA,kBAAIwB,IAAI,CAACzB,GAAD,CAAJ,CAAUC,GAAV,KAAkByB,IAAI,CAAC1B,GAAD,CAAJ,IAAW,CAA7B,CAAJ,EAAqC;AACxC0B,gBAAAA,IAAI,CAAC1B,GAAD,CAAJ,GAAUyB,IAAI,CAACzB,GAAD,CAAJ,CAAUC,GAAV,CAAV;AACI;AACJ;AACG;AACJ,SA1BS,CA2BV;;;AACA,YAAI+B,EAAE,GAAC,EAAP;AACAb,QAAAA,KAAK,GAAC,IAAN,CA7BU,CA8BV;;AACA,aAAKU,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACL,IAAb,EAAkBK,EAAE,EAApB,EAAwB;AACpB7B,UAAAA,GAAG,GAAC3D,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB0D,EAAvB,CAAJ;AACAG,UAAAA,EAAE,CAAChC,GAAD,CAAF,GAAQ,EAAR,CAFoB,CAGpB;;AACA,cAAI0B,IAAI,CAAC1B,GAAD,CAAJ,KAAczB,SAAlB,EAA6B;AAChC,gBAAImD,IAAI,CAAC1B,GAAD,CAAJ,KAAe,CAAnB,EAAsB;AAClBgC,cAAAA,EAAE,CAAChC,GAAD,CAAF,GAAQ,OAAR;AACH,aAFD,MAEO,IAAI0B,IAAI,CAAC1B,GAAD,CAAJ,KAAe8B,IAAnB,EAAyB;AAAE;AAC9BE,cAAAA,EAAE,CAAChC,GAAD,CAAF,GAAQ,MAAR;AACH;AACG;AACJ;;AACD,YAAIiC,MAAM,GAAC,EAAX;;AACA,aAAKJ,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACL,IAAb,EAAkBK,EAAE,EAApB,EAAwB;AACpB7B,UAAAA,GAAG,GAAC3D,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB0D,EAAvB,CAAJ;;AACA,cAAIG,EAAE,CAAChC,GAAD,CAAF,KAAa,OAAjB,EAA0B;AAC7B,iBAAK,IAAIkC,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACV,IAAjB,EAAsBU,EAAE,EAAxB,EAA4B;AACxB,kBAAIC,IAAI,GAAC9F,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB+D,EAAvB,CAAT;;AACA,kBAAIA,EAAE,KAAKL,EAAX,EAAe;AAClBI,gBAAAA,MAAM,CAACE,IAAD,CAAN,GAAa,OAAb;AACAf,gBAAAA,KAAK,GAACc,EAAN;AACI;AACJ;AACG,WARD,MAQO,IAAIF,EAAE,CAAChC,GAAD,CAAF,KAAa,MAAjB,EAAyB;AACnCiC,YAAAA,MAAM,CAACjC,GAAD,CAAN,GAAY,MAAZ;AACAqB,YAAAA,KAAK,GAACQ,EAAN;AACI;AACJ;;AACD,YAAIT,KAAK,KAAK,CAAC,CAAX,IAAgBC,KAAK,KAAK,CAAC,CAA/B,EAAkC;AAC9BD,UAAAA,KAAK,GAAC,CAAC,CAAP;AACAC,UAAAA,KAAK,GAAC,CAAC,CAAP;AACH,SA9DS,CA+DV;;;AACA,aAAKQ,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACL,IAAb,EAAkBK,EAAE,EAApB,EAAwB;AACpB7B,UAAAA,GAAG,GAAC3D,KAAK,CAACI,IAAN,CAAWsB,KAAX,CAAiBI,KAAjB,CAAuB0D,EAAvB,CAAJ;;AACA,cAAII,MAAM,CAACjC,GAAD,CAAN,KAAgBzB,SAApB,EAA+B;AAClC4C,YAAAA,KAAK,GAAC,KAAN;AACA,gBAAIiB,GAAG,GAAC/F,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBC,OAAtB,CAA8BgC,GAA9B,CAAR;;AACA,gBAAIoC,GAAG,KAAK,CAAC,CAAb,EAAgB;AACZ,kBAAIP,EAAE,KAAM,CAAZ,EAAe,CAClB;AACA;AACI,eAHD,MAGO,CACV;AACI;;AAAA;AACD,kBAAIrE,GAAG,GAACnB,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBC,KAAhB,CAAsBxB,MAAtB,CAA6B6F,GAA7B,EAAkC,CAAlC,CAAR,CAPY,CAOkC;;AAC9C,kBAAIH,MAAM,CAACjC,GAAD,CAAN,KAAiB,OAArB,EAA8B;AAAC;AAClC;AACA3D,gBAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,GAAsBjC,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBQ,KAAhB,CAAsBD,MAAtB,CAA6Bb,GAA7B,CAAtB,CAFiC,CAEwB;;AACzDoD,gBAAAA,GAAG,GAACA,GAAG,CAACvC,MAAJ,CAAWb,GAAX,CAAJ;AACI,eAJD,MAIO,IAAIyE,MAAM,CAACjC,GAAD,CAAN,KAAiB,MAArB,EAA6B;AAAC;AACxC;AACAC,gBAAAA,GAAG,GAAC0B,IAAI,CAAC3B,GAAD,CAAR,CAFuC,CAGvC;;AACA3D,gBAAAA,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,GAAqBV,KAAK,CAACI,IAAN,CAAWqB,IAAX,CAAgBf,IAAhB,CAAqBsB,MAArB,CAA4Bb,GAA5B,CAArB,CAJuC,CAIgB;;AACvDnB,gBAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBH,GAAlB,CAAsBD,GAAtB,IAA2B,CAACC,GAAD,CAA3B;AACA5D,gBAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBF,KAAlB,CAAwBF,GAAxB,IAA6BA,GAAG,GAAC,IAAJ,GAASC,GAAT,GAAa,GAA1C;AACA5D,gBAAAA,KAAK,CAACI,IAAN,CAAW2D,MAAX,CAAkBD,GAAlB,CAAsBH,GAAtB,IAA2B,CAA3B;AACA,qBAAKT,KAAL,CAAWS,GAAX,IAAgBT,KAAhB,CARuC,CASvC;AACI;;AAAA;AACJ;AACG;AACJ;;AACD,YAAI,CAAE4B,KAAN,EAAa;AAAC9E,UAAAA,KAAK,CAACI,IAAN,CAAWyE,aAAX,CAAyB7E,KAAzB;AAAiC;AAC3C;;AAAA;AACJ,KArGD,QAqGS,CAAE8E,KArGX,EAZuC,CAkHvC;;;AACA,WAAOP,GAAP;AACI,GApHD;AAqHH;;AAAA;AACD,eAAe5E,QAAf","sourcesContent":["//console.log(\"Loading NavigateLib.js\");\n    \nfunction Navigate() {\n    this.history={pos:0, // position of next snapshot\n\t\t  track:[]\n\t\t };\n    this.store=function(state) { // store state\n\tif (state.Navigate.history.track.length>state.Navigate.history.pos) {\n\t    state.Navigate.history.track=state.Navigate.history.track.splice(0,state.Navigate.history.pos)\n\t};\n\tvar snapshot=state.Path.getSnapshot(state)\n\tstate.Navigate.history.track.push(snapshot);\n\tstate.Navigate.history.pos=state.Navigate.history.track.length;\n    };\n    this.canUndo=function(state) {\n\treturn (state.Navigate.history.pos > 0);\n    };\n    this.canRedo=function(state) {\n\treturn (state.Navigate.history.pos < state.Navigate.history.track.length-1);\n    };\n    this.undo=function(state) {\n\tif (this.canUndo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos-1;\t\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    state.path.setSnapshot(state,snapshot);\n\t}\n    };\n    this.redo=function(state) {\n\tif (this.canRedo(state)) {\n\t    state.Navigate.history.pos=state.Navigate.history.pos+1;\t\n\t    var snapshot=state.Navigate.history.track[state.Navigate.history.pos]\n\t    state.path.setSnapshot(state,snapshot);\n\t}\n    };\n    this.onClickPath=function(state,ttyp,tkey) {\n\tvar reload=false; // matrix changed?\n\tvar tid,tin,src,sec;\n\tconsole.log(\"Clicked:\",ttyp,tkey,JSON.stringify(state.Path.keys),JSON.stringify(state.Path.other));\n\tif (ttyp  === \"path\") { // path -> table\n\t    tid=state.Path.keys.path.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.path.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\treload=true;\n\t    }\n\t} else if (ttyp  === \"table\") { // table -> path/other\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    tin=state.Path.other.table.indexOf(tkey);\n\t    console.log(\"Tin:\",tin,\" tid:\",tid);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tif (tin===0) {\n\t\t    sec=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\t}\n\t\tif (state.Path.values[tkey]) { // table -> path\n\t\t    state.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t\t} else {                       // table -> other\n\t\t    state.Path.keys.other=state.Path.keys.other.concat(src); // last position\n\t\t}\n\t\tif (tin===0) {\n\t\t    src=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\t    state.Utils.spliceArray(state.Path.keys.other,0,0,sec); // first position (table)\n\t\t    state.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\t}\n\t\treload=true;\n\t    }\n\t} else if (ttyp === \"rest\") { // rest -> table\n\t    tid=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tid, 1);                 // remove from path\n\t\tstate.Utils.spliceArray(state.Path.keys.other,0,0,src); // first position (table)\n\t\treload=true;\n\t    };\n\t} else if (ttyp === \"trash\") {\n\t    tid=state.Path.keys.trash.indexOf(tkey);\n\t    tin=state.Path.keys.other.indexOf(tkey);\n\t    if (tid !== -1) {\n\t\tsrc=state.Path.keys.trash.splice(tid, 1);                 // trash => other\n\t\tstate.Path.keys.other=state.Path.keys.other.concat(src); // last position\n\t\tstate.Path.values[src]=undefined;\n\t    } else if (tin !== -1) {\n\t\tsrc=state.Path.keys.other.splice(tin, 1);                 // other => trash\n\t\tstate.Path.keys.trash=state.Path.keys.trash.concat(src);\n\t    };\n\t}\n\tstate.Html.setFootnote(state,\"Extracting data.\");\n\tsetTimeout(function() {\n\t    state.Show.showAll(state,reload);\n\t}.bind(this),0);\n    };\n    this.selectItem=function(state,colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt) {\n\tconsole.log(\"Selectitem:\",colkey,rowkey,colval,rowval,colwhere,rowwhere,colcnt,rowcnt);\n\t//var colkey=state.Path.getColKey(state);\n\t//var rowkey=state.Path.getRowKey(state);\n\tvar order=state.Utils.cp(state.Path.keys.other);\n\tconsole.log(\"SelectItem:\",colkey,\"=\",colval,\"  \",rowkey,\"=\",rowval);\n\tif (state.Show.getLayoutMode(state)  === state.Show.code.layout.Map) {\n\t    if (this.selectMapKey(state,colkey,colval,colwhere,colcnt)) {\n\t\tthis.order[colkey]=state.Utils.cp(order);\n\t\t//this.flip[colkey]=this.getFlip(state);\n\t\tif (this.selectMapKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\t    this.order[rowkey]=state.Utils.cp(order);\n\t\t    //this.last.flip[rowkey]=this.getFlip(state);\n\t\t}\n\t\tthis.trash[colkey]=this.checkTableKeys(state);\n\t\tconsole.log(\"this.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t    };\n\t    //console.log(\"Path:\",JSON.stringify(state.Path))\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    setTimeout(function() {\n\t\tstate.Show.showAll(state);\t\n\t    }.bind(this),0);\n\t} else if (this.selectTableKey(state,colkey,colval,colwhere,colcnt)) {\n\t    this.order[colkey]=order;\n\t    //this.flip[colkey]=this.getFlip(state);\n\t    if (this.selectTableKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t\tthis.order[rowkey]=state.Utils.cp(order);\n\t\t//this.last.flip[rowkey]=this.getFlip(state);\n\t    }\n\t    this.trash[colkey]=this.checkTableKeys(state);\n\t    console.log(\"this.checkTableKeys Done.\",colkey,JSON.stringify(this.trash[colkey]));\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    setTimeout(function() {\n\t\tstate.Show.showAll(state);\n\t    }.bind(this),0);\n\t} else if (this.selectTableKey(state,rowkey,rowval,rowwhere,rowcnt)) {\n\t    this.order[rowkey]=order;\n\t    //this.last.flip[rowkey]=this.getFlip(state);\n\t    this.trash[rowkey]=this.checkTableKeys(state);\n\t    console.log(\"this.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[rowkey]));\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    setTimeout(function() {\n\t\tstate.Show.showAll(state);\n\t    }.bind(this),0);\n\t} else {\n\t    console.log(\"Unable to select:\",rowkey,colkey);\n\t}\n\tconsole.log(\"Selectitem Done:\",rowwhere,colwhere);\n    };\n    this.selectMapKey=function(state,key,val,where,cnt) { // keep abscissa\n\tconsole.log(\"Table.Selecting:\",key,\"=\",val,\", where=\",where);\n\tstate.Path.select.val[key]=[val];\n\tstate.Path.select.where[key]=where;\n\tstate.Path.select.cnt[key]=cnt;\n\tif (state.Utils.missing(state.Path.keys.path,key)) {\n\t    //console.log(\"Adding to path:\",key);\n\t    state.Path.keys.path=state.Path.keys.path.concat(key); // last path position\n\t};\n\treturn true;\n    };\n    this.selectTableKey=function(state,key,val,where,cnt) { // keep abscissa\n\tconsole.log(\"this.Selecting:\",key,\"=\",val,\", where=\",where);\n\tvar sid = state.Path.keys.other.indexOf(key);\n\tif (sid !== -1) {\n\t    state.Path.select.val[key]=[val];\n\t    state.Path.select.where[key]=where;\n\t    state.Path.select.cnt[key]=cnt;\n\t    var src=state.Path.keys.other.splice(sid, 1); // remove from path\n\t    if ( state.Utils.missing(state.Path.keys.path,src)) {\n\t\t//console.log(\"Adding to path:\",JSON.stringify(src));\n\t\tstate.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t    };\n\t    if (cnt>1 && state.Utils.missing(state.Path.keys.trash,src)) {\n\t\tconsole.log(\"Adding \",JSON.stringify(src),\" to trash.\");\n\t\tstate.Path.keys.trash=state.Path.keys.trash.concat(src)\n\t    };\n\t    //console.log(\"Selectkey:\",JSON.stringify(setup),JSON.stringify(src));\n\t    return true;\n\t} else {\n\t    console.log(\"Missing \",key,\" in path:\",JSON.stringify(state.Path.keys));\n\t    return false;\n\t}\n    };\n    this.selectKey=function(state,key,val,where,cnt) {\n\tvar order=state.Utils.cp(state.Path.keys.other);\n\t//console.log(\"SelecRow: rowkey=\",key,\" val=\",val);\n\tconsole.log(\"SelectKey:\",key,val,where,cnt);\n\tif (state.Show.getLayoutMode(state)  === state.Show.code.layout.Map) {\n\t    if (this.selectMapKey(state,key,val,where,cnt)) {\n\t\tthis.order[key]=state.Utils.cp(order);\n\t    }\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    setTimeout(function() {\n\t\tstate.Show.showAll(state);\n\t    }.bind(this),0);\n\t} else if (this.selectTableKey(state,key,val,where,cnt)) {\n\t    this.order[key]=order;\n\t    this.trash[key]=this.checkTableKeys(state);\n\t    //console.log(\"this.checkTableKeys Done.\",rowkey,JSON.stringify(this.trash[key]));\n\t    state.Html.setFootnote(state,\"Extracting data.\");\n\t    setTimeout(function() {\n\t\tstate.Show.showAll(state);\n\t    }.bind(this),0);\n\t} else {\n\t    console.log(\"Unable to select:\",key);\n\t}\n\t//console.log(\"Finally:\",JSON.stringify(state.Path.keys.other));\n    };\n    this.swapTableKeys=function(state,c,r) {\n\t//console.log(\"Swapping:\",c,\"<->\",r);\n\tvar sid = state.Path.keys.other.indexOf(c);\n\tvar tid = state.Path.keys.other.indexOf(r);\n\tif (sid !== -1 && tid !== -1) {\n\t    var src=state.Path.keys.other[sid];\n\t    var trg=state.Path.keys.other[tid];\n\t    if (sid > tid) {\n\t\tstate.Path.keys.other.splice(sid, 1);\n\t\tstate.Path.keys.other.splice(tid, 1);\n\t\tstate.Path.keys.other.splice(tid, 0, src);\n\t\tstate.Path.keys.other.splice(sid, 0, trg);\n\t    } else {\n\t\tstate.Path.keys.other.splice(tid, 1);\n\t\tstate.Path.keys.other.splice(sid, 1);\n\t\tstate.Path.keys.other.splice(sid, 0, trg);\n\t\tstate.Path.keys.other.splice(tid, 0, src);\n\t    }\n\t} else {\n\t    console.log(\"Invalid keys:\",c,r,JSON.stringify(state.Path.keys));\n\t}\n    };\n    this.checkTableKeys=function(state) {\n\tvar ret=[];\n\tvar where = state.Database.getWhere(state);\n\tstate.Matrix.initKeyCnt(state);\n\tstate.Matrix.mapKeyCnt(state,where,0,state.Path.keys.other); // possible table keys (no undefined)\n\tstate.Path.exportAllKeys(state);\n\t//console.log(\"this.checkTableKeys Entering.\",JSON.stringify(setup));\n\tvar keys=state.Path.other.table;\n\tvar bdone= ! keys.length < 2;\n\tvar iinew=-1;\n\tvar jjnew=-1;\n\tvar order=state.Utils.cp(state.Path.keys.other);\n\tdo {\n\t    //console.log(\"this.checkTableKeys Looping.\");\n\t    if (keys.length < 2) {\n\t\tbdone=true;\n\t    } else {\n\t\t// check for number of column values\n\t\tvar docs=state.Database.getCntDocs(state,where,state.Path.other.table); // current table keys\n\t\tvar slen=state.Path.other.table.length;\n\t\tvar hits={};\n\t\tvar maxh={};\n\t\tvar kval={};\n\t\tvar ii,jj,key,val;\n\t\t// loop over docs\n\t\tvar dlen = docs.length;\n\t\tfor (ii = 0; ii < dlen; ii++) {\n    \t\t    var doc=docs[ii];\n\t\t    //console.log(\"Trash doc=\",ii,JSON.stringify(doc));\n\t\t    for (jj=0;jj<slen;jj++) {\n\t\t\tkey=state.Path.other.table[jj];\n\t\t\tif (doc[key] !== undefined) {\n\t\t\t    val=doc[key];\n\t\t\t    kval[key]=val;\n\t\t\t    if (hits[key]  === undefined) {hits[key]={};}\n\t\t\t    hits[key][val] = 1+ (hits[key][val]||0);\n\t\t\t    //console.log(\"Found:\",key,val,hits[key][val]);\n\t\t\t    if (hits[key][val] > (maxh[key]||0)) {\n\t\t\t\tmaxh[key]=hits[key][val];\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t\t//console.log(\"this.checkTableKeys Checking.\",dlen);\n\t\tvar rm={};\n\t\tbdone=true;\n\t\t//console.log(\"Max:\",JSON.stringify(maxh));\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    rm[key]=\"\";\n\t\t    //console.log(\"Checking:\",key,JSON.stringify(maxh));\n\t\t    if (maxh[key] !== undefined) {\n\t\t\tif (maxh[key]  === 1) {\n\t\t\t    rm[key]=\"other\";\n\t\t\t} else if (maxh[key]  === dlen) { // remove key from table\n\t\t\t    rm[key]=\"self\";\n\t\t\t}\n\t\t    }\n\t\t}\n\t\tvar rmthis={};\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    if (rm[key]  === \"other\") {\n\t\t\tfor (var kk=0;kk<slen;kk++) {\n\t\t\t    var rkey=state.Path.other.table[kk];\n\t\t\t    if (kk !== jj) {\n\t\t\t\trmthis[rkey]=\"trash\";\n\t\t\t\tiinew=kk;\n\t\t\t    }\n\t\t\t}\n\t\t    } else if (rm[key]  === \"self\") {\n\t\t\trmthis[key]=\"path\";\n\t\t\tjjnew=jj;\n\t\t    }\n\t\t}\n\t\tif (iinew !== -1 && jjnew !== -1) {\n\t\t    iinew=-1;\n\t\t    jjnew=-1;\n\t\t}\n\t\t//console.log(\"Rm:\",JSON.stringify(rmthis),JSON.stringify(rm));\n\t\tfor (jj=0;jj<slen;jj++) {\n\t\t    key=state.Path.other.table[jj];\n\t\t    if (rmthis[key] !== undefined) {\n\t\t\tbdone=false;\n\t\t\tvar sin=state.Path.keys.other.indexOf(key);\n\t\t\tif (sin !== -1) {\n\t\t\t    if (jj  === 0) {\n\t\t\t\t// flipTable\n\t\t\t\t//console.log(\"Flipped table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n\t\t\t    } else {\n\t\t\t\t//console.log(\"Not Flipping table.\",JSON.stringify(state.Path.keys),this.getFlipString(state));\n\t\t\t    };\n\t\t\t    var src=state.Path.keys.other.splice(sin, 1); // remove from path\n\t\t\t    if (rmthis[key]  === \"trash\") {// trash key\n\t\t\t\t//console.log(\"### Trashing:\",key);\n\t\t\t\tstate.Path.keys.trash=state.Path.keys.trash.concat(src); // last path position\n\t\t\t\tret=ret.concat(src);\n\t\t\t    } else if (rmthis[key]  === \"path\") {// add to path\n\t\t\t\t// add to path...\n\t\t\t\tval=kval[key];\n\t\t\t\t//console.log(\"### Pathing:\",key,val);\n\t\t\t\tstate.Path.keys.path=state.Path.keys.path.concat(src); // last path position\n\t\t\t\tstate.Path.select.val[key]=[val];\n\t\t\t\tstate.Path.select.where[key]=key+'=\"'+val+'\"'\n\t\t\t\tstate.Path.select.cnt[key]=1;\n\t\t\t\tthis.order[key]=order;\n\t\t\t\t//this.last.flip[key]=this.getFlip(state);\n\t\t\t    };\n\t\t\t}\n\t\t    }\n\t\t}\n\t\tif (! bdone) {state.Path.exportAllKeys(state);}\n\t    };\n\t} while (! bdone);\n\t//console.log(\"this.checkTableKeys Done.\",JSON.stringify(state.Path.other.table));\n\treturn ret;\n    };\n};\nexport default Navigate;\n"]},"metadata":{},"sourceType":"module"}