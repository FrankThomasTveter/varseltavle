{"ast":null,"code":"//console.log(\"Loading DefaultLib.js\");\nfunction Default(){this.setupdir=\"def/\";// defaults directory\nthis.setup=\"defaults.json\";// defaults file, contains default setup...\nthis.path=\"test.json\";this.current={};this.start=undefined;// setup at start\n// map: Default => setup\nthis.cpJsonToDefaultFill=[[[\"Database\",\"data\"],[\"data\"]],[[\"other\"],[\"other\"]],[[\"trash\"],[\"trash\"]]];this.cpJsonToDefaultForce=[[[\"Threshold\",\"thrs\"],[\"thrs\"]],[[\"Colors\",\"colors\"],[\"colors\"]],[[\"Path\",\"order\"],[\"order\"]],[[\"Path\",\"select\"],[\"select\"]],[[\"Path\",\"home\"],[\"home\"]],[[\"Path\",\"tooltip\"],[\"tooltip\"]],[[\"Layout\",\"priority\"],[\"priority\"]],[[\"Layout\",\"state\"],[\"state\"]]];// map: Default => state\nthis.cpStateToDefaultFill=[[[\"Database\",\"data\"],[\"Database\",\"data\"]],[[\"Threshold\",\"thrs\"],[\"Threshold\",\"thrs\"]],[[\"Colors\",\"colors\"],[\"Colors\",\"colors\"]],[[\"Path\",\"order\"],[\"Path\",\"order\"]],[[\"Path\",\"home\"],[\"Path\",\"home\"]],[[\"Path\",\"tooltip\",\"keys\"],[\"Path\",\"tooltip\",\"keys\"]],[[\"Path\",\"tooltip\",\"select\"],[\"Path\",\"tooltip\",\"select\"]],[[\"Path\",\"tooltip\",\"sort\"],[\"Path\",\"tooltip\",\"sort\"]],[[\"Path\",\"tooltip\",\"click\"],[\"Path\",\"tooltip\",\"click\"]],[[\"Path\",\"select\"],[\"Path\",\"select\"]],[[\"Path\",\"keys\",\"path\"],[\"Path\",\"keys\",\"path\"]],[[\"Path\",\"keys\",\"other\"],[\"Path\",\"keys\",\"other\"]],[[\"Layout\",\"priority\"],[\"Layout\",\"priority\"]],[[\"Layout\",\"state\"],[\"Layout\",\"state\"]]];this.cpStateToDefaultForce=[[[\"Path\",\"home\"],[\"Path\",\"home\"]]];this.cpDefaultToStateFill=this.cpStateToDefaultFill;this.cpDefaultToDefaultFill=this.cpStateToDefaultFill;this.init=function(state){state.Utils.init(\"setup\",this);};this.loadDefault=function(state,response,callbacks){var file=this.setup;console.log(\"Default setup:\",file);if(state.Threshold.thrs!==undefined){// defaults already loaded, execute callback...\nstate.File.next(state,\"\",callbacks);}else{var path=state.Default.setupdir+state.Default.setup;state.File.load(state,path,callbacks);}};this.makeStart=function(state,response,callbacks){if(state.Default.start===undefined){state.Default.start={};state.Utils.copyFill(state,state,state.Default.start,state.Default.cpStateToDefaultFill);//console.log(\"Start:\",JSON.stringify(state.Default.start.Path));\n//console.log(\"State:\",JSON.stringify(state.Path.select));\n//state.Default.save(state);\n}state.File.next(state,\"\",callbacks);};this.processDefault=function(state,response,callbacks){if(state.Threshold.thrs!==undefined){// defaults already loaded, execute callback...\nstate.File.next(state,\"\",callbacks);}else{try{var json=JSON.parse(response);}catch(e){alert(\"Default '\"+state.Default.setup+\"' contains Invalid JSON:\"+e.name+\":\"+e.message);}if(json!==undefined){//console.log(\"State:\",JSON.stringify(state.Database));\nstate.Utils.copyFill(state,json,state.Default.current,state.Default.cpJsonToDefaultFill);state.Utils.copyForce(state,json,state.Default.current,state.Default.cpJsonToDefaultForce);state.Utils.copyFill(state,state.Default.current,state,state.Default.cpDefaultToStateFill);//console.log(\"JSON:\",JSON.stringify(json.data));\n//console.log(\"Default:\",JSON.stringify(state.Default.current.Database));\n//console.log(\"State:\",JSON.stringify(state.Database));\n};// finally execute next callback\nstate.File.next(state,\"\",callbacks);}};this.resetSetup=function(state,response,callbacks){try{var json=JSON.parse(response);}catch(e){alert(\"Default '\"+state.Default.setup+\"' contains Invalid JSON:\"+e.name+\":\"+e.message);}if(json!==undefined&&state.Default.start!==undefined){console.log(\"Reset state:\",JSON.stringify(state.Path));state.Default.current={};state.Utils.copyFill(state,json,state.Default.current,state.Default.cpJsonToDefaultFill);state.Utils.copyForce(state,json,state.Default.current,state.Default.cpJsonToDefaultForce);state.Utils.copyFill(state,state.Default.start,state.Default.current,state.Default.cpDefaultToDefaultFill);state.Utils.copyForce(state,state.Default.current,state,state.Default.cpDefaultToStateFill);//console.log(\"JSON:\",JSON.stringify(json.tooltip));\n//console.log(\"Default:\",JSON.stringify(state.Default.Path.tooltip));\nstate.Database.resetSetup(state);console.log(\"Reset State:\",JSON.stringify(state.Path));};};this.getSetup=function(state){// get updated information\nvar json={};var current={};state.Utils.copyFill(state,state.Default.current,current,state.Default.cpDefaultToDefaultFill);state.Utils.copyForce(state,state,current,state.Default.cpStateToDefaultForce);state.Utils.copyForce(state,current,json,state.Utils.invert(state.Default.cpJsonToDefaultForce));state.Utils.copyFill(state,current,json,state.Utils.invert(state.Default.cpJsonToDefaultFill));//console.log(\"Current:\",JSON.stringify(state.Default.current));\n//console.log(\"Setup:\",JSON.stringify(current));\n//JSON.stringify(setup, null, \"   \");\nreturn json;};this.save=function(state){var setup=state.Utils.prettyJson(state.Default.getSetup(state));state.Utils.save(setup,\"setup.json\",\"json\");};this.hasChanged=function(state,pth){var src=state.Default.start;var trg=state;var lenp=pth.length;for(var ii=0;ii<lenp;ii++){var p=pth[ii];if(src[p]!==undefined){src=src[p];}else{console.log(\"Missing Defaults-key:\",\"'\"+p+\"'\",\"(path=\",JSON.stringify(pth),\") Default root=\",JSON.stringify(Object.keys(src)));return true;}if(trg[p]!==undefined){trg=trg[p];}else{console.log(\"Missing State-key:\",p,JSON.stringify(pth),JSON.stringify(Object.keys(trg)));return true;}}var s=JSON.stringify(src);var t=JSON.stringify(trg);//console.log(\"Checking:\",JSON.stringify(pth),\"\\n\",s,\"\\n\",t,\"->\",s!==t);\nreturn s!==t;};};export default Default;","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/lib/DefaultLib.js"],"names":["Default","setupdir","setup","path","current","start","undefined","cpJsonToDefaultFill","cpJsonToDefaultForce","cpStateToDefaultFill","cpStateToDefaultForce","cpDefaultToStateFill","cpDefaultToDefaultFill","init","state","Utils","loadDefault","response","callbacks","file","console","log","Threshold","thrs","File","next","load","makeStart","copyFill","processDefault","json","JSON","parse","e","alert","name","message","copyForce","resetSetup","stringify","Path","Database","getSetup","invert","save","prettyJson","hasChanged","pth","src","trg","lenp","length","ii","p","Object","keys","s","t"],"mappings":"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","sourcesContent":["//console.log(\"Loading DefaultLib.js\");\nfunction Default() {\n    this.setupdir=\"def/\"; // defaults directory\n    this.setup=\"defaults.json\"; // defaults file, contains default setup...\n    this.path=\"test.json\";\n    this.current={};\n    this.start=undefined; // setup at start\n    // map: Default => setup\n    this.cpJsonToDefaultFill= [[[\"Database\",\"data\"],        [\"data\"]],\n\t\t\t       [[\"other\"],                  [\"other\"]],\n\t\t\t       [[\"trash\"],                  [\"trash\"]]\n\t\t\t      ];\n    this.cpJsonToDefaultForce=[[[\"Threshold\",\"thrs\"],       [\"thrs\"]],\n\t\t\t       [[\"Colors\",\"colors\"],        [\"colors\"]],\n\t\t\t       [[\"Path\",\"order\"],           [\"order\"]],\n\t\t\t       [[\"Path\",\"select\"],          [\"select\"]],\n\t\t\t       [[\"Path\",\"home\"],            [\"home\"]],\n\t\t\t       [[\"Path\",\"tooltip\"],         [\"tooltip\"]],\n\t\t\t       [[\"Layout\",\"priority\"],      [\"priority\"]],\n\t\t\t       [[\"Layout\",\"state\"],         [\"state\"]]\n\t\t\t      ];\n    // map: Default => state\n    this.cpStateToDefaultFill= [[[\"Database\",\"data\"],        [\"Database\",\"data\"]],\n\t\t\t\t[[\"Threshold\",\"thrs\"],       [\"Threshold\",\"thrs\"]],\n\t\t\t\t[[\"Colors\",\"colors\"],        [\"Colors\",\"colors\"]],\n\t\t\t\t[[\"Path\",\"order\"],           [\"Path\",\"order\"]],\n\t\t\t\t[[\"Path\",\"home\"],            [\"Path\",\"home\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"keys\"],  [\"Path\",\"tooltip\",\"keys\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"select\"],[\"Path\",\"tooltip\",\"select\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"sort\"],  [\"Path\",\"tooltip\",\"sort\"]],\n\t\t\t\t[[\"Path\",\"tooltip\",\"click\"], [\"Path\",\"tooltip\",\"click\"]],\n\t\t\t\t[[\"Path\",\"select\"],          [\"Path\",\"select\"]],\n\t\t\t\t[[\"Path\",\"keys\",\"path\"],     [\"Path\",\"keys\",\"path\"]],\n\t\t\t\t[[\"Path\",\"keys\",\"other\"],    [\"Path\",\"keys\",\"other\"]],\n\t\t\t\t[[\"Layout\",\"priority\"],      [\"Layout\",\"priority\"]],\n\t\t\t\t[[\"Layout\",\"state\"],         [\"Layout\",\"state\"]]\n\t\t\t       ];\n    this.cpStateToDefaultForce=[[[\"Path\",\"home\"],[\"Path\",\"home\"]]];\n    this.cpDefaultToStateFill=this.cpStateToDefaultFill;\n    this.cpDefaultToDefaultFill=this.cpStateToDefaultFill;\n    this.init=function(state){\n\tstate.Utils.init(\"setup\",this);\n    };\n    this.loadDefault=function(state, response, callbacks ) {\n\tvar file=this.setup;\n\tconsole.log(\"Default setup:\",file);\n\tif (state.Threshold.thrs !== undefined) { // defaults already loaded, execute callback...\n\t    state.File.next(state,\"\",callbacks);\n\t} else {\n\t    var path=state.Default.setupdir + state.Default.setup;\n\t    state.File.load(state,path,callbacks);\n\t}\n    };\n    this.makeStart=function(state,response,callbacks) {\n\tif (state.Default.start === undefined) {\n\t    state.Default.start={};\n\t    state.Utils.copyFill(state, state, state.Default.start, state.Default.cpStateToDefaultFill);\n\t    //console.log(\"Start:\",JSON.stringify(state.Default.start.Path));\n\t    //console.log(\"State:\",JSON.stringify(state.Path.select));\n\t    //state.Default.save(state);\n\t}\n\tstate.File.next(state,\"\",callbacks);\n    };\n    this.processDefault=function(state,response,callbacks) {\n\tif (state.Threshold.thrs !== undefined) { // defaults already loaded, execute callback...\n\t    state.File.next(state,\"\",callbacks);\n\t} else {\n\t    try {\n\t\tvar json = JSON.parse(response);\n\t    } catch (e) {\n\t\talert(\"Default '\"+state.Default.setup+\"' contains Invalid JSON:\"+e.name+\":\"+e.message);\n\t    }\n\t    if (json !== undefined) {\n\t\t//console.log(\"State:\",JSON.stringify(state.Database));\n\t\t\n\t\tstate.Utils.copyFill(state, json,                   state.Default.current, state.Default.cpJsonToDefaultFill);\n\t\tstate.Utils.copyForce(state,json,                   state.Default.current, state.Default.cpJsonToDefaultForce);\n\t\tstate.Utils.copyFill(state, state.Default.current,  state,                 state.Default.cpDefaultToStateFill);\n\t\t\n\t\t//console.log(\"JSON:\",JSON.stringify(json.data));\n\t\t//console.log(\"Default:\",JSON.stringify(state.Default.current.Database));\n\t\t//console.log(\"State:\",JSON.stringify(state.Database));\n\t\t\n\t    };\n\t    // finally execute next callback\n\t    state.File.next(state,\"\",callbacks);\n\t}\n    };\n    this.resetSetup=function(state,response,callbacks) {\n\ttry {\n\t    var json = JSON.parse(response);\n\t} catch (e) {\n\t    alert(\"Default '\"+state.Default.setup+\"' contains Invalid JSON:\"+e.name+\":\"+e.message);\n\t}\n\tif (json !== undefined && state.Default.start !== undefined) {\n\t    console.log(\"Reset state:\",JSON.stringify(state.Path));\n\t    state.Default.current={};\n\t    state.Utils.copyFill( state, json,                  state.Default.current, state.Default.cpJsonToDefaultFill);\n\t    state.Utils.copyForce(state, json,                  state.Default.current, state.Default.cpJsonToDefaultForce);\n\t    state.Utils.copyFill( state, state.Default.start,   state.Default.current, state.Default.cpDefaultToDefaultFill);\n\t    state.Utils.copyForce(state, state.Default.current, state,                 state.Default.cpDefaultToStateFill);\n\t    //console.log(\"JSON:\",JSON.stringify(json.tooltip));\n\t    //console.log(\"Default:\",JSON.stringify(state.Default.Path.tooltip));\n\t    state.Database.resetSetup(state);\n\t    console.log(\"Reset State:\",JSON.stringify(state.Path));\n\t};\n    };\n    this.getSetup=function(state) {\n\t// get updated information\n\tvar json={};\n\tvar current={};\n\tstate.Utils.copyFill(state,  state.Default.current, current, state.Default.cpDefaultToDefaultFill);\n\tstate.Utils.copyForce(state, state,                 current, state.Default.cpStateToDefaultForce);\n\tstate.Utils.copyForce(state, current,               json,    state.Utils.invert(state.Default.cpJsonToDefaultForce));\n\tstate.Utils.copyFill(state,  current,               json,    state.Utils.invert(state.Default.cpJsonToDefaultFill));\n\t//console.log(\"Current:\",JSON.stringify(state.Default.current));\n\t//console.log(\"Setup:\",JSON.stringify(current));\n\t//JSON.stringify(setup, null, \"   \");\n\treturn json;\n    };\n    this.save=function(state) {\n\tvar setup=state.Utils.prettyJson(state.Default.getSetup(state));\n\tstate.Utils.save(setup,\"setup.json\",\"json\");\n    };\n    this.hasChanged=function(state,pth) {\n\tvar src=state.Default.start;\n\tvar trg=state;\n\tvar lenp=pth.length;\n\tfor (var ii=0;ii<lenp;ii++) {\n\t    var p=pth[ii];\n\t    if (src[p] !== undefined) {\n\t\tsrc=src[p];\n\t    } else {\n\t\tconsole.log(\"Missing Defaults-key:\",\"'\"+p+\"'\",\n\t\t\t    \"(path=\",JSON.stringify(pth),\") Default root=\",\n\t\t\t    JSON.stringify(Object.keys(src)));\n\t\treturn true;\n\t    }\n\t    if (trg[p] !== undefined) {\n\t\ttrg=trg[p];\n\t    } else {\n\t\tconsole.log(\"Missing State-key:\",p,JSON.stringify(pth),JSON.stringify(Object.keys(trg)));\n\t\treturn true;\n\t    }\n\t}\n\tvar s=JSON.stringify(src);\n\tvar t=JSON.stringify(trg);\n\t//console.log(\"Checking:\",JSON.stringify(pth),\"\\n\",s,\"\\n\",t,\"->\",s!==t);\n\treturn s!==t;\n    };\n};\nexport default Default;\n"]},"metadata":{},"sourceType":"module"}