{"ast":null,"code":"import _objectWithoutProperties from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _classCallCheck from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/franktt/react/varseltavle/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/franktt/react/varseltavle/src/react/CanvasComponent.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\n\nvar styles = function styles(theme) {\n  return {\n    canvas: {},\n    pointer: {\n      cursor: \"pointer\"\n    },\n    nopointer: {}\n  };\n};\n\nfunction updateCanvas(item) {\n  var _item$props = item.props,\n      state = _item$props.state,\n      elements = _item$props.elements,\n      colkey = _item$props.colkey,\n      rowkey = _item$props.rowkey,\n      colvalues = _item$props.colvalues,\n      index = _item$props.index,\n      range = _item$props.range;\n  var cnv = item.refs.canvas;\n  var ctx = cnv.getContext('2d');\n  var step = 1;\n  var height = cnv.height;\n  var elen = elements.length;\n  var blev = -1;\n  var ee;\n  var tot = 0;\n\n  for (ee = 0; ee < elen; ee++) {\n    tot = tot + elements[ee].docs.length;\n  }\n\n  ;\n  var first = true;\n  var cnt = 0;\n  var dw = cnv.width / Math.max(step, tot); //console.log(\"******** Canvas elements:\",elen,tot,dw,width)\n\n  for (ee = 0; ee < elen; ee++) {\n    var el = elements[ee];\n    var level = el.lev;\n    var color = state.Colors.getLevelColor(level);\n    blev = Math.max(blev, level);\n    var docs = el.docs;\n    var dlen = docs.length; //console.log(\"Element:\",level,color,tot,cnt);\n\n    if (dlen > 0) {\n      for (var jj = 0; jj < dlen; jj++) {\n        cnt = cnt + 1;\n        var d = docs[jj];\n        state.Threshold.setGThr(state, d);\n        var lev = state.Threshold.getLevel(state, d);\n        var col = state.Colors.getLevelColor(lev); //console.log(\"   Doc:\",colkey,jj,JSON.stringify(lev),JSON.stringify(d));\n\n        for (var ii = index; ii < Math.min(index + step, colvalues.length); ii++) {\n          console.log(\"   Checking Val:\", colkey, rowkey, ii, colvalues[ii], d[colkey]);\n          console.log(\"Position:\", ii, jj, dlen, step, colkey, rowkey, colvalues[ii], d[colkey]);\n\n          if (d[colkey] === colvalues[ii]) {\n            if (first) {\n              first = false; //console.log(\"Doc:\",jj,JSON.stringify(d));\n            }\n\n            ;\n            var t = state.Threshold.getThresholds(d); //console.log(\"Making canvas:\",ii,colvalues[ii],color,JSON.stringify(d),\n            //\t    \" Thr=\",JSON.stringify(t),width,height,JSON.stringify(range));\n            //console.log(\"Canvas:\",ii,jj,d.dtg,color,level,JSON.stringify(t));\n\n            var min = range[0];\n            var max = range[1];\n            var ymin = min;\n\n            if (t.min !== undefined && t.min[state.Threshold.ival] !== undefined) {\n              ymin = t.min[state.Threshold.ival];\n            }\n\n            var ymax = max;\n\n            if (t.max !== undefined && t.max[state.Threshold.ival] !== undefined) {\n              ymax = t.max[state.Threshold.ival];\n            }\n\n            var mm = ii - index;\n\n            if (step < tot) {\n              mm = cnt - 1;\n            } //console.log(\" canvas position:\",mm,ii,cnt,step,tot)\n\n\n            var xmin = mm * dw; // width/10;\n\n            var xmax = (mm + 1) * dw - 2; //width-2*xmin;\n\n            var zmin = state.Show.scale(ymin, min, max, height, 0);\n            var zmax = state.Show.scale(ymax, min, max, height, 0); //console.log(\"Fill:\",xmin,xmax,width,zmin,(zmax-zmin),height,color);\n            //ctx.fillStyle=\"cornflowerblue\";\n\n            color = col;\n\n            if (color !== undefined) {\n              ctx.fillStyle = color;\n            }\n\n            ctx.fillRect(xmin, zmin, xmax - xmin, zmax - zmin); //ctx.beginPath();\n            //ctx.lineWidth=2;\n            //if (color !== undefined) {ctx.strokeStyle=color;}\n            //ctx.strokeStyle=\"black\";\n            //ctx.moveTo(xmin,zmax);\n            //ctx.lineTo(xmax,zmax);\n            //ctx.stroke();\n            // draw thresholds\n\n            for (var msr in t) {\n              var tt = t[msr];\n              var tmax = tt[state.Threshold.imax];\n              var tthr = tt[state.Threshold.ithr];\n              var tkey = tt[state.Threshold.ikey]; //var tlev  = tt[state.Threshold.ilev];\n              //var tval  = tt[state.Threshold.ival];\n\n              var ts;\n\n              if (tmax) {\n                ts = state.Threshold.thrs[tthr][tkey].max;\n              } else {\n                ts = state.Threshold.thrs[tthr][tkey].min;\n              }\n\n              ;\n              var tlen = ts.length;\n\n              for (var ll = 0; ll < tlen; ll++) {\n                var tyval = ts[ll];\n                var tzval = state.Show.scale(tyval, min, max, height, 0);\n                var scolor = state.Colors.getLevelColor(ll);\n                ctx.beginPath();\n                ctx.lineWidth = 5;\n\n                if (scolor !== undefined) {\n                  ctx.strokeStyle = scolor;\n                }\n\n                ctx.moveTo(xmin, tzval);\n                ctx.lineTo(xmax, tzval);\n                ctx.stroke();\n                console.log(\"Stroke color:\", scolor, ll, tzval, cnv.width);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  ;\n\n  if (tot === 0) {\n    console.log(\"No draw:\", JSON.stringify(colvalues), JSON.stringify(docs), dlen);\n  } else {\n    console.log(\"Drew:\", JSON.stringify(colvalues), tot, dlen);\n  }\n\n  ctx.lineWidth = 5;\n  ctx.strokeStyle = state.Colors.getLevelColor(blev);\n  ctx.strokeRect(0, 0, cnv.width, cnv.height);\n  console.log(\"Canvas:\", cnv.width, cnv.height);\n}\n\nvar CanvasComponent =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CanvasComponent, _React$Component);\n\n  function CanvasComponent(props) {\n    var _this;\n\n    _classCallCheck(this, CanvasComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CanvasComponent).call(this, props));\n    var state = props.state;\n    return _this;\n  }\n\n  _createClass(CanvasComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      updateCanvas(this);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          classes = _this$props.classes,\n          onclick = _this$props.onclick,\n          title = _this$props.title,\n          other = _objectWithoutProperties(_this$props, [\"classes\", \"onclick\", \"title\"]);\n\n      return React.createElement(\"canvas\", Object.assign({}, other, {\n        className: classes.canvas,\n        classes: classes,\n        onClick: onclick,\n        title: title,\n        ref: \"canvas\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return CanvasComponent;\n}(React.Component);\n\nCanvasComponent.propTypes = {\n  classes: PropTypes.object.isRequired\n};\nexport default withStyles(styles)(CanvasComponent);","map":{"version":3,"sources":["/home/franktt/react/varseltavle/src/react/CanvasComponent.js"],"names":["React","Component","PropTypes","withStyles","styles","theme","canvas","pointer","cursor","nopointer","updateCanvas","item","props","state","elements","colkey","rowkey","colvalues","index","range","cnv","refs","ctx","getContext","step","height","elen","length","blev","ee","tot","docs","first","cnt","dw","width","Math","max","el","level","lev","color","Colors","getLevelColor","dlen","jj","d","Threshold","setGThr","getLevel","col","ii","min","console","log","t","getThresholds","ymin","undefined","ival","ymax","mm","xmin","xmax","zmin","Show","scale","zmax","fillStyle","fillRect","msr","tt","tmax","imax","tthr","ithr","tkey","ikey","ts","thrs","tlen","ll","tyval","tzval","scolor","beginPath","lineWidth","strokeStyle","moveTo","lineTo","stroke","JSON","stringify","strokeRect","CanvasComponent","classes","onclick","title","other","propTypes","object","isRequired"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAgC,OAAhC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,UAAT,QAA2B,0BAA3B;;AAEA,IAAMC,MAAM,GAAG,SAATA,MAAS,CAAAC,KAAK;AAAA,SAAK;AACrBC,IAAAA,MAAM,EAAE,EADa;AAGrBC,IAAAA,OAAO,EAAE;AACZC,MAAAA,MAAM,EAAC;AADK,KAHY;AAMrBC,IAAAA,SAAS,EAAE;AANU,GAAL;AAAA,CAApB;;AAUA,SAASC,YAAT,CAAsBC,IAAtB,EAA4B;AAAA,oBACqCA,IAAI,CAACC,KAD1C;AAAA,MACjBC,KADiB,eACjBA,KADiB;AAAA,MACXC,QADW,eACXA,QADW;AAAA,MACFC,MADE,eACFA,MADE;AAAA,MACKC,MADL,eACKA,MADL;AAAA,MACYC,SADZ,eACYA,SADZ;AAAA,MACsBC,KADtB,eACsBA,KADtB;AAAA,MAC4BC,KAD5B,eAC4BA,KAD5B;AAExB,MAAMC,GAAG,GAACT,IAAI,CAACU,IAAL,CAAUf,MAApB;AACA,MAAMgB,GAAG,GAAGF,GAAG,CAACG,UAAJ,CAAe,IAAf,CAAZ;AACA,MAAMC,IAAI,GAAC,CAAX;AACA,MAAIC,MAAM,GAAGL,GAAG,CAACK,MAAjB;AACA,MAAIC,IAAI,GAACZ,QAAQ,CAACa,MAAlB;AACA,MAAIC,IAAI,GAAC,CAAC,CAAV;AACA,MAAIC,EAAJ;AACA,MAAIC,GAAG,GAAC,CAAR;;AAAW,OAAKD,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACH,IAAb,EAAkBG,EAAE,EAApB,EAAwB;AAACC,IAAAA,GAAG,GAACA,GAAG,GAAChB,QAAQ,CAACe,EAAD,CAAR,CAAaE,IAAb,CAAkBJ,MAA1B;AAAkC;;AAAA;AACtE,MAAIK,KAAK,GAAC,IAAV;AACA,MAAIC,GAAG,GAAC,CAAR;AACA,MAAIC,EAAE,GAAEd,GAAG,CAACe,KAAJ,GAAUC,IAAI,CAACC,GAAL,CAASb,IAAT,EAAcM,GAAd,CAAlB,CAZwB,CAaxB;;AACA,OAAKD,EAAE,GAAC,CAAR,EAAUA,EAAE,GAACH,IAAb,EAAkBG,EAAE,EAApB,EAAwB;AAC3B,QAAIS,EAAE,GAACxB,QAAQ,CAACe,EAAD,CAAf;AACA,QAAIU,KAAK,GAACD,EAAE,CAACE,GAAb;AACA,QAAIC,KAAK,GAAC5B,KAAK,CAAC6B,MAAN,CAAaC,aAAb,CAA2BJ,KAA3B,CAAV;AACAX,IAAAA,IAAI,GAACQ,IAAI,CAACC,GAAL,CAAST,IAAT,EAAcW,KAAd,CAAL;AACA,QAAIR,IAAI,GAACO,EAAE,CAACP,IAAZ;AACA,QAAIa,IAAI,GAACb,IAAI,CAACJ,MAAd,CAN2B,CAO3B;;AACA,QAAIiB,IAAI,GAAC,CAAT,EAAY;AACR,WAAK,IAAIC,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACD,IAAjB,EAAsBC,EAAE,EAAxB,EAA4B;AAC/BZ,QAAAA,GAAG,GAACA,GAAG,GAAC,CAAR;AACA,YAAIa,CAAC,GAACf,IAAI,CAACc,EAAD,CAAV;AACAhC,QAAAA,KAAK,CAACkC,SAAN,CAAgBC,OAAhB,CAAwBnC,KAAxB,EAA8BiC,CAA9B;AACA,YAAIN,GAAG,GAAC3B,KAAK,CAACkC,SAAN,CAAgBE,QAAhB,CAAyBpC,KAAzB,EAA+BiC,CAA/B,CAAR;AACA,YAAII,GAAG,GAACrC,KAAK,CAAC6B,MAAN,CAAaC,aAAb,CAA2BH,GAA3B,CAAR,CAL+B,CAM/B;;AACA,aAAK,IAAIW,EAAE,GAACjC,KAAZ,EAAkBiC,EAAE,GAACf,IAAI,CAACgB,GAAL,CAASlC,KAAK,GAACM,IAAf,EAAoBP,SAAS,CAACU,MAA9B,CAArB,EAA2DwB,EAAE,EAA7D,EAAiE;AAC7DE,UAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAA+BvC,MAA/B,EAAsCC,MAAtC,EAA6CmC,EAA7C,EAAgDlC,SAAS,CAACkC,EAAD,CAAzD,EAA8DL,CAAC,CAAC/B,MAAD,CAA/D;AACAsC,UAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAwBH,EAAxB,EAA2BN,EAA3B,EAA8BD,IAA9B,EAAmCpB,IAAnC,EAAwCT,MAAxC,EAA+CC,MAA/C,EAAsDC,SAAS,CAACkC,EAAD,CAA/D,EAAoEL,CAAC,CAAC/B,MAAD,CAArE;;AACA,cAAI+B,CAAC,CAAC/B,MAAD,CAAD,KAAeE,SAAS,CAACkC,EAAD,CAA5B,EAAkC;AACrC,gBAAInB,KAAJ,EAAW;AACPA,cAAAA,KAAK,GAAC,KAAN,CADO,CAEP;AACH;;AAAA;AACD,gBAAIuB,CAAC,GAAC1C,KAAK,CAACkC,SAAN,CAAgBS,aAAhB,CAA8BV,CAA9B,CAAN,CALqC,CAMrC;AACA;AACA;;AACA,gBAAIM,GAAG,GAACjC,KAAK,CAAC,CAAD,CAAb;AACA,gBAAIkB,GAAG,GAAClB,KAAK,CAAC,CAAD,CAAb;AACA,gBAAIsC,IAAI,GAACL,GAAT;;AACA,gBAAIG,CAAC,CAACH,GAAF,KAAUM,SAAV,IAAuBH,CAAC,CAACH,GAAF,CAAMvC,KAAK,CAACkC,SAAN,CAAgBY,IAAtB,MAAgCD,SAA3D,EAAsE;AAClED,cAAAA,IAAI,GAACF,CAAC,CAACH,GAAF,CAAMvC,KAAK,CAACkC,SAAN,CAAgBY,IAAtB,CAAL;AACH;;AACD,gBAAIC,IAAI,GAACvB,GAAT;;AACA,gBAAIkB,CAAC,CAAClB,GAAF,KAAUqB,SAAV,IAAuBH,CAAC,CAAClB,GAAF,CAAMxB,KAAK,CAACkC,SAAN,CAAgBY,IAAtB,MAAgCD,SAA3D,EAAsE;AAClEE,cAAAA,IAAI,GAACL,CAAC,CAAClB,GAAF,CAAMxB,KAAK,CAACkC,SAAN,CAAgBY,IAAtB,CAAL;AACH;;AACD,gBAAIE,EAAE,GAACV,EAAE,GAACjC,KAAV;;AACA,gBAAIM,IAAI,GAACM,GAAT,EAAc;AAAC+B,cAAAA,EAAE,GAAC5B,GAAG,GAAC,CAAP;AAAU,aApBY,CAqBrC;;;AACA,gBAAI6B,IAAI,GAACD,EAAE,GAAC3B,EAAZ,CAtBqC,CAsBf;;AACtB,gBAAI6B,IAAI,GAAC,CAACF,EAAE,GAAC,CAAJ,IAAO3B,EAAP,GAAU,CAAnB,CAvBqC,CAuBb;;AACxB,gBAAI8B,IAAI,GAACnD,KAAK,CAACoD,IAAN,CAAWC,KAAX,CAAiBT,IAAjB,EAAsBL,GAAtB,EAA0Bf,GAA1B,EAA8BZ,MAA9B,EAAqC,CAArC,CAAT;AACA,gBAAI0C,IAAI,GAACtD,KAAK,CAACoD,IAAN,CAAWC,KAAX,CAAiBN,IAAjB,EAAsBR,GAAtB,EAA0Bf,GAA1B,EAA8BZ,MAA9B,EAAqC,CAArC,CAAT,CAzBqC,CA0BrC;AACA;;AACAgB,YAAAA,KAAK,GAACS,GAAN;;AACA,gBAAIT,KAAK,KAAKiB,SAAd,EAAyB;AAACpC,cAAAA,GAAG,CAAC8C,SAAJ,GAAc3B,KAAd;AAAqB;;AAC/CnB,YAAAA,GAAG,CAAC+C,QAAJ,CAAaP,IAAb,EAAkBE,IAAlB,EAAuBD,IAAI,GAACD,IAA5B,EAAkCK,IAAI,GAACH,IAAvC,EA9BqC,CA+BrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,iBAAK,IAAIM,GAAT,IAAgBf,CAAhB,EAAmB;AACf,kBAAIgB,EAAE,GAAMhB,CAAC,CAACe,GAAD,CAAb;AACA,kBAAIE,IAAI,GAAID,EAAE,CAAC1D,KAAK,CAACkC,SAAN,CAAgB0B,IAAjB,CAAd;AACA,kBAAIC,IAAI,GAAIH,EAAE,CAAC1D,KAAK,CAACkC,SAAN,CAAgB4B,IAAjB,CAAd;AACA,kBAAIC,IAAI,GAAIL,EAAE,CAAC1D,KAAK,CAACkC,SAAN,CAAgB8B,IAAjB,CAAd,CAJe,CAKf;AACA;;AACA,kBAAIC,EAAJ;;AACA,kBAAIN,IAAJ,EAAU;AACbM,gBAAAA,EAAE,GAACjE,KAAK,CAACkC,SAAN,CAAgBgC,IAAhB,CAAqBL,IAArB,EAA2BE,IAA3B,EAAiCvC,GAApC;AACI,eAFD,MAEO;AACVyC,gBAAAA,EAAE,GAACjE,KAAK,CAACkC,SAAN,CAAgBgC,IAAhB,CAAqBL,IAArB,EAA2BE,IAA3B,EAAiCxB,GAApC;AACI;;AAAA;AACD,kBAAI4B,IAAI,GAACF,EAAE,CAACnD,MAAZ;;AACA,mBAAK,IAAIsD,EAAE,GAAC,CAAZ,EAAcA,EAAE,GAACD,IAAjB,EAAsBC,EAAE,EAAxB,EAA4B;AAC/B,oBAAIC,KAAK,GAACJ,EAAE,CAACG,EAAD,CAAZ;AACA,oBAAIE,KAAK,GAACtE,KAAK,CAACoD,IAAN,CAAWC,KAAX,CAAiBgB,KAAjB,EAAuB9B,GAAvB,EAA2Bf,GAA3B,EAA+BZ,MAA/B,EAAsC,CAAtC,CAAV;AACA,oBAAI2D,MAAM,GAACvE,KAAK,CAAC6B,MAAN,CAAaC,aAAb,CAA2BsC,EAA3B,CAAX;AACA3D,gBAAAA,GAAG,CAAC+D,SAAJ;AACA/D,gBAAAA,GAAG,CAACgE,SAAJ,GAAc,CAAd;;AACA,oBAAIF,MAAM,KAAK1B,SAAf,EAA0B;AAACpC,kBAAAA,GAAG,CAACiE,WAAJ,GAAgBH,MAAhB;AAAwB;;AACnD9D,gBAAAA,GAAG,CAACkE,MAAJ,CAAW1B,IAAX,EAAgBqB,KAAhB;AACA7D,gBAAAA,GAAG,CAACmE,MAAJ,CAAW1B,IAAX,EAAgBoB,KAAhB;AACA7D,gBAAAA,GAAG,CAACoE,MAAJ;AACArC,gBAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA4B8B,MAA5B,EAAmCH,EAAnC,EAAsCE,KAAtC,EAA4C/D,GAAG,CAACe,KAAhD;AACI;AACJ;AACG;AACJ;AACG;AACJ;AACG;;AAAA;;AACD,MAAIL,GAAG,KAAM,CAAb,EAAgB;AACnBuB,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAuBqC,IAAI,CAACC,SAAL,CAAe3E,SAAf,CAAvB,EAAiD0E,IAAI,CAACC,SAAL,CAAe7D,IAAf,CAAjD,EAAsEa,IAAtE;AACI,GAFD,MAEO;AACVS,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAoBqC,IAAI,CAACC,SAAL,CAAe3E,SAAf,CAApB,EAA8Ca,GAA9C,EAAkDc,IAAlD;AACI;;AACDtB,EAAAA,GAAG,CAACgE,SAAJ,GAAc,CAAd;AACAhE,EAAAA,GAAG,CAACiE,WAAJ,GAAgB1E,KAAK,CAAC6B,MAAN,CAAaC,aAAb,CAA2Bf,IAA3B,CAAhB;AACAN,EAAAA,GAAG,CAACuE,UAAJ,CAAe,CAAf,EAAiB,CAAjB,EAAoBzE,GAAG,CAACe,KAAxB,EAA8Bf,GAAG,CAACK,MAAlC;AACA4B,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAsBlC,GAAG,CAACe,KAA1B,EAAgCf,GAAG,CAACK,MAApC;AACH;;IAGKqE,e;;;;;AACF,2BAAYlF,KAAZ,EAAmB;AAAA;;AAAA;;AACf,yFAAMA,KAAN;AADe,QAERC,KAFQ,GAECD,KAFD,CAERC,KAFQ;AAAA;AAGlB;;;;wCACmB;AAChBH,MAAAA,YAAY,CAAC,IAAD,CAAZ;AACH;;;6BACQ;AAAA,wBACyC,KAAKE,KAD9C;AAAA,UACGmF,OADH,eACGA,OADH;AAAA,UACYC,OADZ,eACYA,OADZ;AAAA,UACqBC,KADrB,eACqBA,KADrB;AAAA,UAC+BC,KAD/B;;AAEL,aACN,gDAAYA,KAAZ;AAAmB,QAAA,SAAS,EAAEH,OAAO,CAACzF,MAAtC;AAA8C,QAAA,OAAO,EAAEyF,OAAvD;AAAgE,QAAA,OAAO,EAAEC,OAAzE;AAAkF,QAAA,KAAK,EAAEC,KAAzF;AAAgG,QAAA,GAAG,EAAC,QAApG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADM;AAGH;;;;EAbyBjG,KAAK,CAACC,S;;AAgBpC6F,eAAe,CAACK,SAAhB,GAA4B;AACxBJ,EAAAA,OAAO,EAAE7F,SAAS,CAACkG,MAAV,CAAiBC;AADF,CAA5B;AAIA,eAAelG,UAAU,CAACC,MAAD,CAAV,CAAmB0F,eAAnB,CAAf","sourcesContent":["import React, { Component} from 'react';\nimport PropTypes from 'prop-types';\nimport { withStyles } from '@material-ui/core/styles';\n\nconst styles = theme => ({\n    canvas: {\n    },\n    pointer: {\n\tcursor:\"pointer\"\n    },\n    nopointer: {\n    },\n});\n\nfunction updateCanvas(item) {\n    const {state,elements,colkey,rowkey,colvalues,index,range} = item.props;\n    const cnv=item.refs.canvas;\n    const ctx = cnv.getContext('2d');\n    const step=1;\n    var height = cnv.height;\n    var elen=elements.length;\n    var blev=-1;\n    var ee;\n    var tot=0; for (ee=0;ee<elen;ee++) {tot=tot+elements[ee].docs.length;};\n    var first=true;\n    var cnt=0;\n    var dw= cnv.width/Math.max(step,tot)\n    //console.log(\"******** Canvas elements:\",elen,tot,dw,width)\n    for (ee=0;ee<elen;ee++) {\n\tvar el=elements[ee];\n\tvar level=el.lev;\n\tvar color=state.Colors.getLevelColor(level);\n\tblev=Math.max(blev,level);\n\tvar docs=el.docs;\n\tvar dlen=docs.length;\n\t//console.log(\"Element:\",level,color,tot,cnt);\n\tif (dlen>0) {\n\t    for (var jj=0;jj<dlen;jj++) {\n\t\tcnt=cnt+1;\n\t\tvar d=docs[jj];\n\t\tstate.Threshold.setGThr(state,d);\n\t\tvar lev=state.Threshold.getLevel(state,d);\n\t\tvar col=state.Colors.getLevelColor(lev);\n\t\t//console.log(\"   Doc:\",colkey,jj,JSON.stringify(lev),JSON.stringify(d));\n\t\tfor (var ii=index;ii<Math.min(index+step,colvalues.length);ii++) {\n\t\t    console.log(\"   Checking Val:\",colkey,rowkey,ii,colvalues[ii],d[colkey]);\n\t\t    console.log(\"Position:\",ii,jj,dlen,step,colkey,rowkey,colvalues[ii],d[colkey])\n\t\t    if (d[colkey]  === colvalues[ii]) {\n\t\t\tif (first) {\n\t\t\t    first=false;\n\t\t\t    //console.log(\"Doc:\",jj,JSON.stringify(d));\n\t\t\t};\n\t\t\tvar t=state.Threshold.getThresholds(d);\n\t\t\t//console.log(\"Making canvas:\",ii,colvalues[ii],color,JSON.stringify(d),\n\t\t\t//\t    \" Thr=\",JSON.stringify(t),width,height,JSON.stringify(range));\n\t\t\t//console.log(\"Canvas:\",ii,jj,d.dtg,color,level,JSON.stringify(t));\n\t\t\tvar min=range[0]\n\t\t\tvar max=range[1];\n\t\t\tvar ymin=min;\n\t\t\tif (t.min !== undefined && t.min[state.Threshold.ival] !== undefined) {\n\t\t\t    ymin=t.min[state.Threshold.ival];\n\t\t\t}\n\t\t\tvar ymax=max;\n\t\t\tif (t.max !== undefined && t.max[state.Threshold.ival] !== undefined) {\n\t\t\t    ymax=t.max[state.Threshold.ival];\n\t\t\t}\n\t\t\tvar mm=ii-index\n\t\t\tif (step<tot) {mm=cnt-1;}\n\t\t\t//console.log(\" canvas position:\",mm,ii,cnt,step,tot)\n\t\t\tvar xmin=mm*dw;       // width/10;\n\t\t\tvar xmax=(mm+1)*dw-2;   //width-2*xmin;\n\t\t\tvar zmin=state.Show.scale(ymin,min,max,height,0);\n\t\t\tvar zmax=state.Show.scale(ymax,min,max,height,0);\n\t\t\t//console.log(\"Fill:\",xmin,xmax,width,zmin,(zmax-zmin),height,color);\n\t\t\t//ctx.fillStyle=\"cornflowerblue\";\n\t\t\tcolor=col;\n\t\t\tif (color !== undefined) {ctx.fillStyle=color;}\n\t\t\tctx.fillRect(xmin,zmin,xmax-xmin,(zmax-zmin));\n\t\t\t//ctx.beginPath();\n\t\t\t//ctx.lineWidth=2;\n\t\t\t//if (color !== undefined) {ctx.strokeStyle=color;}\n\t\t\t//ctx.strokeStyle=\"black\";\n\t\t\t//ctx.moveTo(xmin,zmax);\n\t\t\t//ctx.lineTo(xmax,zmax);\n\t\t\t//ctx.stroke();\n\t\t\t// draw thresholds\n\t\t\tfor (var msr in t) {\n\t\t\t    var tt    = t[msr];\n\t\t\t    var tmax  = tt[state.Threshold.imax];\n\t\t\t    var tthr  = tt[state.Threshold.ithr];\n\t\t\t    var tkey  = tt[state.Threshold.ikey];\n\t\t\t    //var tlev  = tt[state.Threshold.ilev];\n\t\t\t    //var tval  = tt[state.Threshold.ival];\n\t\t\t    var ts;\n\t\t\t    if (tmax) {\n\t\t\t\tts=state.Threshold.thrs[tthr][tkey].max;\n\t\t\t    } else {\n\t\t\t\tts=state.Threshold.thrs[tthr][tkey].min;\n\t\t\t    };\n\t\t\t    var tlen=ts.length;\n\t\t\t    for (var ll=0;ll<tlen;ll++) {\n\t\t\t\tvar tyval=ts[ll];\n\t\t\t\tvar tzval=state.Show.scale(tyval,min,max,height,0);\n\t\t\t\tvar scolor=state.Colors.getLevelColor(ll);\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.lineWidth=5;\n\t\t\t\tif (scolor !== undefined) {ctx.strokeStyle=scolor;}\n\t\t\t\tctx.moveTo(xmin,tzval);\n\t\t\t\tctx.lineTo(xmax,tzval);\n\t\t\t\tctx.stroke();\n\t\t\t\tconsole.log(\"Stroke color:\",scolor,ll,tzval,cnv.width);\n\t\t\t    }\n\t\t\t}\n\t\t    }\n\t\t}\n\t    }\n\t}\n    };\n    if (tot  === 0) {\n\tconsole.log(\"No draw:\",JSON.stringify(colvalues),JSON.stringify(docs),dlen);\n    } else {\n\tconsole.log(\"Drew:\",JSON.stringify(colvalues),tot,dlen);\n    }\n    ctx.lineWidth=5;\n    ctx.strokeStyle=state.Colors.getLevelColor(blev);\n    ctx.strokeRect(0,0, cnv.width,cnv.height);\n    console.log(\"Canvas:\",cnv.width,cnv.height);\n}\n    \n\nclass CanvasComponent extends React.Component {\n    constructor(props) {\n        super(props);\n        const {state} = props;\n    };\n    componentDidMount() {\n        updateCanvas(this);\n    }\n    render() {\n        const { classes, onclick, title, ...other } = this.props;\n        return (\n\t\t<canvas {...other} className={classes.canvas} classes={classes} onClick={onclick} title={title} ref=\"canvas\"/>\n        );\n    }\n}\n\nCanvasComponent.propTypes = {\n    classes: PropTypes.object.isRequired,\n};\n\nexport default withStyles(styles)(CanvasComponent);\n"]},"metadata":{},"sourceType":"module"}